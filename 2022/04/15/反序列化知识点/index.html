<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="个人总结的知识点，持续更新。">
<meta property="og:type" content="article">
<meta property="og:title" content="反序列化知识点">
<meta property="og:url" content="https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/index.html">
<meta property="og:site_name" content="HDFZZF&#39;s BLOG">
<meta property="og:description" content="个人总结的知识点，持续更新。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-04-14T16:00:00.000Z">
<meta property="article:modified_time" content="2022-04-18T09:31:43.799Z">
<meta property="article:author" content="hdfzzf">
<meta property="article:tag" content="PHP反序列化">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/LOGO.jpg">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>反序列化知识点</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 6.0.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="القائمة"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="القائمة"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="الأعلى" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2022/04/15/POP%E9%93%BE/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2022/04/14/11%20Vulnhub%20Billu_b0x%20Writeup/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&text=反序列化知识点"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&title=反序列化知识点"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&is_video=false&description=反序列化知识点"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=反序列化知识点&body=Check out this article: https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&title=反序列化知识点"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&title=反序列化知识点"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&title=反序列化知识点"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&title=反序列化知识点"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&name=反序列化知识点&description=&lt;p&gt;个人总结的知识点，持续更新。&lt;/p&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&t=反序列化知识点"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%A6%82%E5%BF%B5%E7%89%B9%E7%82%B9"><span class="toc-number">1.</span> <span class="toc-text">1 反序列化概念、特点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 反序列化概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%89%B9%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 反序列化特点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">2 常见的魔术方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sleep"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 __sleep()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wakeup"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 __wakeup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tostring"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 __toString</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#invoke"><span class="toc-number">2.4.</span> <span class="toc-text">2.4__invoke</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#construct"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 __construct()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#destruct"><span class="toc-number">2.6.</span> <span class="toc-text">2.6 __destruct()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#set"><span class="toc-number">2.7.</span> <span class="toc-text">2.7 __set()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#get"><span class="toc-number">2.8.</span> <span class="toc-text">2.8 __get()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#isset"><span class="toc-number">2.9.</span> <span class="toc-text">2.9 __isset()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#unset"><span class="toc-number">2.10.</span> <span class="toc-text">2.10 __unset()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#callstatic"><span class="toc-number">2.11.</span> <span class="toc-text">2.10 __callStatic()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#call"><span class="toc-number">2.12.</span> <span class="toc-text">2.11 __call()</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-number">3.</span> <span class="toc-text">3 访问控制修饰符</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%95%E8%BF%87-__wakeup-%E5%87%BD%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">4 绕过 __wakeup() 函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8"><span class="toc-number">5.</span> <span class="toc-text">5 字符串逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%90%8E%E5%AD%97%E7%AC%A6%E5%8F%98%E5%A4%9A"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 过滤后字符变多</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%90%8E%E5%AD%97%E7%AC%A6%E5%8F%98%E5%B0%91"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 过滤后字符变少</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E4%B8%AD%E5%90%AB%E6%9C%89%E6%95%B0%E7%BB%84%E8%AF%A5%E5%A6%82%E4%BD%95%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">6.</span> <span class="toc-text">6 属性中含有数组该如何反序列化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%90%8E%E7%9A%84%E5%B1%9E%E6%80%A7%E9%A1%BA%E5%BA%8F"><span class="toc-number">7.</span> <span class="toc-text">7 序列化后的属性顺序</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        反序列化知识点
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">hdfzzf</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-04-14T16:00:00.000Z" itemprop="datePublished">2022-04-15</time>
        
        (Updated: <time datetime="2022-04-18T09:31:43.799Z" itemprop="dateModified">2022-04-18</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/CTF/">CTF</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">PHP反序列化</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>个人总结的知识点，持续更新。</p>
<span id="more"></span>
<h1 id="反序列化概念特点">1 反序列化概念、特点</h1>
<h2 id="反序列化概念">1.1 反序列化概念</h2>
<p>序列化就是将对象转换成字符串。字符串包括 <strong>属性名</strong> <strong>属性值</strong> <strong>属性类型</strong>和<strong>该对象对应的类名</strong>。</p>
<p>反序列化则相反将字符串重新恢复成对象。</p>
<p>对象的序列化利于对象的保存和传输,也可以让多个文件共享对象。</p>
<p>如下例子： <pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">O:3:&quot;Ctf&quot;:3&#123;s:4:&quot;flag&quot;;s:13:&quot;flag&#123;abedyui&#125;&quot;;s:4:&quot;name&quot;;s:7:&quot;Sch0lar&quot;;s:3:&quot;age&quot;;s:2:&quot;18&quot;;&#125;

O   代表对象 因为我们序列化的是一个对象 序列化数组则用A来表示
3   代表类名字占三个字符 
ctf 类名
3   代表三个属性
s   代表字符串
4   代表属性名长度
flag属性名
s:13:&quot;flag&#123;abedyui&#125;&quot; 字符串 属性值长度 属性值<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h2 id="反序列化特点">1.2 反序列化特点</h2>
<ol type="1">
<li><strong>php在反序列化时，底层代码是以 <code>;</code> 作为字段的分隔，以 <code>&#125;</code> 作为结尾，并且是根据长度判断内容的 ，同时反序列化的过程中必须严格按照序列化规则才能成功实现反序列化</strong> 。 <pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php
class A&#123;
    public $name&#x3D;&#39;shy&#39;;
    public $pass&#x3D;&#39;123456&#39;;
&#125;

$lemon &#x3D; new A();
echo serialize($lemon);
?&gt;

序列化结果为：
O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:3:&quot;shy&quot;;s:4:&quot;pass&quot;;s:6:&quot;123456&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<p>超出的部分不会被发序列化成功，如下： <pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php
class A&#123;
    public $name&#x3D;&#39;shy&#39;;
    public $pass&#x3D;&#39;123456&#39;;
&#125;

$lemon &#x3D; new A();
echo serialize($lemon);
var_dump(unserialize(serialize($lemon)));
?&gt;

结果为：
O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:3:&quot;shy&quot;;s:4:&quot;pass&quot;;s:6:&quot;123456&quot;;&#125;object(A)#2 (2) &#123;
  [&quot;name&quot;]&#x3D;&gt;
  string(3) &quot;shy&quot;
  [&quot;pass&quot;]&#x3D;&gt;
  string(6) &quot;123456&quot;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>这说明反序列化的过程是有一定识别范围的，在这个范围之外的字符都会被忽略，不影响反序列化的正常进行。而且可以看到反序列化字符串都是以<code>";&#125;</code>结束的，<strong>那如果把<code>";&#125;</code>添入到需要反序列化的字符串中（除了结尾处），就能让反序列化提前闭合结束，后面的内容就相应的丢弃了</strong>。</p>
<ol start="2" type="1">
<li><p><strong>长度不对应的时候会报错</strong> <pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php
$str &#x3D; &#39;O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:3:&quot;shy&quot;;s:4:&quot;pass&quot;;s:6:&quot;12&quot;;&#125;&#39;;  
&#x2F;&#x2F; 注意 s:6:&quot;12&quot; 明显长度不够
var_dump(unserialize($str));
?&gt;

结果为：
bool(false)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li>
<li><p><strong>可以在反序列化类中不存在的元素</strong>。 <pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php
$str &#x3D; &#39;O:1:&quot;A&quot;:3:&#123;s:4:&quot;name&quot;;s:3:&quot;shy&quot;;s:4:&quot;pass&quot;;s:6:&quot;123456&quot;;s:5:&quot;pass2&quot;;s:4:&quot;1234&quot;;&#125;&#39;;
&#x2F;&#x2F; 注意要修改A后面的值，要与后面的属性个数对应
var_dump(unserialize($str));
?&gt;

结果为：（原来的类中没有pass2这个属性）
object(__PHP_Incomplete_Class)#1 (4) &#123;
  [&quot;__PHP_Incomplete_Class_Name&quot;]&#x3D;&gt;
  string(1) &quot;A&quot;
  [&quot;name&quot;]&#x3D;&gt;
  string(3) &quot;shy&quot;
  [&quot;pass&quot;]&#x3D;&gt;
  string(6) &quot;123456&quot;
  [&quot;pass2&quot;]&#x3D;&gt;
  string(4) &quot;1234&quot;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p></li>
</ol>
<h1 id="常见的魔术方法">2 常见的魔术方法</h1>
<pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">__construct() 创建对象时调用
__destruct() 销毁对象时调用
__toString() 当一个对象被当作一个字符串使用
__sleep() 在对象在被序列化之前运行
__wakeup 将在序列化之后立即被调用<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>PHP将所有以 <strong><strong><strong> （两个下划线）开头的类方法保留为魔术方法。所以在定义类方法时，除了上述魔术方法，建议不要以 </strong></strong></strong> 为前缀。</p>
<h2 id="sleep">2.1 <code>__sleep()</code></h2>
<p>在使用 <code>serialize()</code> 函数时，程序会检查类中是否存在一个 <code>__sleep()</code> 魔术方法。如果存在，则该方法会先被调用，然后再执行序列化操作。</p>
<h2 id="wakeup">2.2 <code>__wakeup</code></h2>
<p>在使用 <code>unserialize()</code> 时，会检查是否存在一个 <code>__wakeup()</code>魔术方法。如果存在，则该方法会先被调用，预先准备对象需要的资源。（注意与 <code>__sleep()</code> 对比）</p>
<h2 id="tostring">2.3 <code>__toString</code></h2>
<p><code>__toString()</code> 方法用于定义一个类被当成字符串时该如何处理。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>  
<span class="token keyword">class</span> <span class="token class-name-definition class-name">TestClass</span>  
<span class="token punctuation">&#123;</span>  
    <span class="token keyword">public</span> <span class="token variable">$foo</span><span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$foo</span><span class="token punctuation">)</span> 										 	      
    <span class="token punctuation">&#123;</span>  
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">foo</span> <span class="token operator">=</span> <span class="token variable">$foo</span><span class="token punctuation">;</span>  
    <span class="token punctuation">&#125;</span>  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">foo</span><span class="token punctuation">;</span>  
    <span class="token punctuation">&#125;</span>  
<span class="token punctuation">&#125;</span>  
  
<span class="token variable">$class</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestClass</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token keyword">echo</span> <span class="token variable">$class</span><span class="token punctuation">;</span>    
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>解释：</p>
<p>这里<code>echo $class;</code>把一个类对象当作字符串变量打印，因此执行了<code>__toSting()</code>，然后返回<code>$this-&gt;foo</code>，即Hello。</p>
<h2 id="invoke">2.4<code>__invoke</code></h2>
<p>当尝试以调用函数的方式调用一个对象时，<code>__invoke()</code> 方法会被自动调用。(本特性只在 PHP 5.3.0 及以上版本有效。)</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">CallableClass</span> 
<span class="token punctuation">&#123;</span>
    <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CallableClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$obj</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>解释：</p>
<p>直接将类对象当作一个函数使用，从而直接调用了<code>__invoke()</code>方法，所以返回结果为<code>int(5)</code></p>
<h2 id="construct">2.5 <code>__construct()</code></h2>
<p>具有<code>__construct()</code>函数的类会在每次创建新对象时先调用此方法，适合在使用对象之前做一些初始化工作。</p>
<h2 id="destruct">2.6 <code>__destruct()</code></h2>
<p><code>__destruct</code>函数会在到某个对象的所有引用都被删除或者当对象被显式销毁时执行</p>
<h2 id="set">2.7 <code>__set()</code></h2>
<p>给不可访问属性赋值时，<code>__set()</code> 会被调用。</p>
<h2 id="get">2.8 <code>__get()</code></h2>
<p>读取不可访问属性的值时，<code>__get()</code> 会被调用。</p>
<h2 id="isset">2.9 <code>__isset()</code></h2>
<p>对不可访问属性调用 <code>__isset()</code> 或 <code>empty()</code> 时，<code>__isset()</code> 会被调用。</p>
<h2 id="unset">2.10 <code>__unset()</code></h2>
<p>对不可访问属性调用 <code>unset()</code>时，<code>__unset()</code> 会被调用。</p>
<h2 id="callstatic">2.10 <code>__callStatic()</code></h2>
<p>在静态上下文中调用一个不可访问方法时，<code>__callStatic()</code> 会被调用。 <pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">MethodTest</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">__callStatic</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">// Note: value of $name is case sensitive.</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Triggering __call method when calling  method '<span class="token interpolation"><span class="token variable">$name</span></span>' with arguments '"</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">', '</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span><span class="token operator">.</span> <span class="token string double-quoted-string">"'.\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name static-context">MethodTest</span><span class="token operator">::</span><span class="token function">callStaticTest</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arg3'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'arg4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// As of PHP 5.3.0</span>

<span class="token operator">/</span><span class="token operator">*</span>运行结果
Triggering __call method when calling  method <span class="token string single-quoted-string">'callStaticTest'</span> with arguments <span class="token string single-quoted-string">'arg3, arg4'</span><span class="token operator">.</span>
<span class="token operator">*</span><span class="token operator">/</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h2 id="call">2.11 <code>__call()</code></h2>
<p>在对象中调用一个不可访问方法时，<code>__call()</code> 会被调用。 <pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">MethodTest</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">// Note: value of $name is case sensitive.</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Triggering __call method when calling  method '<span class="token interpolation"><span class="token variable">$name</span></span>' with arguments '"</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">', '</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span><span class="token operator">.</span> <span class="token string double-quoted-string">"'.\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MethodTest</span><span class="token punctuation">;</span>
<span class="token variable">$obj</span><span class="token operator">-></span><span class="token function">callTest</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'arg1'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'arg2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">/</span><span class="token operator">*</span>运行结果
Triggering __call method when calling  method <span class="token string single-quoted-string">'callTest'</span> with arguments <span class="token string single-quoted-string">'arg1, arg2'</span><span class="token operator">.</span>
<span class="token operator">*</span><span class="token operator">/</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h1 id="访问控制修饰符">3 访问控制修饰符</h1>
<p>根据访问控制修饰符的不同，序列化后的 <strong>属性长度</strong> 和 <strong>属性值</strong> 会有所不同。 <pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">public(公有)
protected(受保护)
private(私有的)

protected 属性被序列化的时候属性名会变成：%00*%00属性名
private 属性被序列化的时候属性名会变成：%00类名%00属性名

注意：这里的%00其实是\0经过urlencode得到的，而\0长度是1，所以%00的长度也是1，切记！！！可以数下面例子的长度。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>like this: <pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">O:4:&quot;Name&quot;:2:&#123;s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;i:100;&#125;&#x2F;&#x2F;这里是private属性被序列化
O:3:&quot;ctf&quot;:2:&#123;s:11:&quot;%00*%00username&quot;;s:5:&quot;admin&quot;;s:6:&quot;%00*%00cmd&quot;;s:2:&quot;ls&quot;;&#125;&#x2F;&#x2F;这里是protected属性被序列化<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p>
<p>注意：<code>var</code> 为 <code>public</code> 的别名。php中必须使用这三个修饰符，如果没有，则必须使用 <code>var</code> 代替 <code>pubic</code>。</p>
<p>如果不想复制的时候没复制到不可见字符，可以将得到的字符串进行url编码！[[MRCTF2020 Ezpop]]</p>
<h1 id="绕过-__wakeup-函数">4 绕过 __wakeup() 函数</h1>
<p>当序列化字符串表示对象属性个数的值大于真实个数的属性时就会跳过__wakeup的执行。该方法和__sleep()相反，前者使用serialize()时自动调用，后者当使用 unserialize() 时自动调用。</p>
<p>该方法有一个漏洞(CVE-2016-7124)，只需要序列化字符串表示对象属性个数的值大于真实个数的属性时就会跳过执行。</p>
<h1 id="字符串逃逸">5 字符串逃逸</h1>
<p>原理：先将对象序列化，然后将对象中的字符进行过滤，最后再进行反序列化。这个时候就有可能会产生PHP反序列化字符逃逸的漏洞。</p>
<p>有两种情况：</p>
<ol type="1">
<li>过滤后字符变多</li>
<li>过滤后字符变少</li>
</ol>
<h2 id="过滤后字符变多">5.1 过滤后字符变多</h2>
<p>假设定义如下一个类： <pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php
class User
&#123;
    public $username;
    public $password;
    public $vip;
    public function __construct($uname, $passwd)&#123;
        $this-&gt;username &#x3D; $uname;
        $this-&gt;password &#x3D; $passwd;
        $this-&gt;vip &#x3D; 0;
    &#125;
&#125;
$a &#x3D; new User(&quot;admin&quot;, &quot;111&quot;);
$a_ser &#x3D; serialize($a);
echo $a_ser;

结果为：
O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:3:&quot;111&quot;;s:3:&quot;vip&quot;;i:0;&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>此时如果有一个过滤函数，并将反序列后的字符串带入执行： <pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">class User
&#123;
    public $username;
    public $password;
    public $vip;
    public function __construct($uname, $passwd)&#123;
        $this-&gt;username &#x3D; $uname;
        $this-&gt;password &#x3D; $passwd;
        $this-&gt;vip &#x3D; 0;
    &#125;
&#125;

function filter($str)&#123;
    return str_replace(&quot;admin&quot;, &quot;hacker&quot;, $str);
&#125;

$a &#x3D; new User(&quot;admin&quot;, &quot;111&quot;);
$a_ser &#x3D; serialize($a);
echo filter($a_ser);

结果为：
O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;hacker&quot;;s:8:&quot;password&quot;;s:3:&quot;111&quot;;s:3:&quot;vip&quot;;i:0;&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>注意对比上面两者的输出结果，会发现 <pre class="line-numbers language-none"><code class="language-none">s:5:&quot;admin&quot;;
s:5:&quot;hacker&quot;;

明显下面hacker长度为6，大于5，按理来说这是不应该的。这就是漏洞所在<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>这时候<code>admin</code>（被过滤的）就是我们的可控变量，假设我们需要把vip属性变为1。 对比现有的子串和目标子串(部分比较)： <pre class="line-numbers language-none"><code class="language-none">&quot;;s:8:&quot;password&quot;;s:3:&quot;111&quot;;s:3:&quot;vip&quot;;i:0;&#125; &#x2F;&#x2F; 现有
&quot;;s:8:&quot;password&quot;;s:3:&quot;123&quot;;s:3:&quot;vip&quot;;i:1;&#125; &#x2F;&#x2F; 目标<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p>
<p>我们可以要在admin这个可控变量的位置，<strong>注入目标子串</strong></p>
<p>计算目标字串的长度： <pre class="line-numbers language-none"><code class="language-none">&quot;;s:8:&quot;password&quot;;s:3:&quot;123&quot;;s:3:&quot;vip&quot;;i:1;&#125; &#x2F;&#x2F;长度42<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<p>也就是需要逃逸的字符串长度为42，每次admin过滤后都变为hacker，也就是每有一个admin，过滤后长度都会增加1。利用这个漏洞，我们输入42个admin，这样子过滤后字符串长度就会增加42，因此可控变量修改为： <code>adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin";s:8:"password";s:3:"123";s:3:"vip";i:1;&#125;</code></p>
<p>完整程序如下： <pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php
class User
&#123;
    public $username;
    public $password;
    public $vip;
    public function __construct($uname, $passwd)&#123;
        $this-&gt;username &#x3D; $uname;
        $this-&gt;password &#x3D; $passwd;
        $this-&gt;vip &#x3D; 0;
    &#125;
&#125;

function filter($str)&#123;
    return str_replace(&quot;admin&quot;, &quot;hacker&quot;, $str);
&#125;

$a &#x3D; new User(&#39;adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin&quot;;s:8:&quot;password&quot;;s:3:&quot;123&quot;;s:3:&quot;vip&quot;;i:1;&#125;&#39;, &quot;111&quot;);
$a_ser &#x3D; serialize($a);
$a_ser_filter &#x3D; filter($a_ser);
echo $a_ser_filter;
?&gt;

输出结果：
O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:252:&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;;s:8:&quot;password&quot;;s:3:&quot;123&quot;;s:3:&quot;vip&quot;;i:1;&#125;&quot;;s:8:&quot;password&quot;;s:3:&quot;111&quot;;s:3:&quot;vip&quot;;i:0;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>发现有42个hacker，长度正好与252对应。</p>
<blockquote>
<p>反序列化后，多余的字串会被抛弃。而password（不在username里面的）就会被抛弃。</p>
</blockquote>
<p>将这个结果反序列化得到如下： <pre class="line-numbers language-none"><code class="language-none">object(User)#2 (3) &#123;
  [&quot;username&quot;]&#x3D;&gt;
  string(252) &quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;
  [&quot;password&quot;]&#x3D;&gt;
  string(3) &quot;123&quot;
  [&quot;vip&quot;]&#x3D;&gt;
  int(1)
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>注意看密码与我们输入的password不同，而是与username里面的password相同；并且，vip字段也修改为1。</p>
<blockquote>
<p>解释：username=adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin";s:8:"password";s:3:"111";s:3:"vip";i:1;} 长度为252；而username=hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker 长度也是252 因此系统将所有的hack接收为username之后正好达到了username的长度，所以会将";s:8:"password";s:3:"111";s:3:"vip";i:1;}放到password字段。注意，这里前面的<strong><code>";</code>正好将username闭合</strong>，然后后面的s:8:"password";s:3:"111";s:3:"vip";i:1;}<strong>正好又符合password和vip属性的反序列化要求</strong>，就会被当作password和vip属性进行反序列化，<strong><code>;</code>将vip属性闭合</strong>，<strong><code>&#125;</code>将序列化后的子串闭合</strong>，这样子就形成一个完整的序列化对象，而后面的"111"就会被抛弃。</p>
</blockquote>
<p>注意：一定要闭合：属性之间的闭合用<code>;</code>，闭合序列化对象用的是<code>&#125;</code>。</p>
<h2 id="过滤后字符变少">5.2 过滤后字符变少</h2>
<p>主体和上面一样，区别就是过滤函数变为如下： <pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">function filter($str)&#123;
    return str_replace(&quot;admin&quot;, &quot;hack&quot;, $str);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p>
<p>对比过滤前后的字符串： <pre class="line-numbers language-none"><code class="language-none">O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:3:&quot;111&quot;;s:3:&quot;vip&quot;;i:0;&#125;
O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;hack&quot;;s:8:&quot;password&quot;;s:3:&quot;111&quot;;s:3:&quot;vip&quot;;i:0;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p>
<p>因为过滤的时候，将<strong>5</strong>个字符删减为了<strong>4</strong>个，所以和上面字符变多的情况相反，随着加入的<strong>admin</strong>的数量增多，<strong>现有子串</strong>后面会缩进来。</p>
<p>计算以下目标字串长度： <pre class="line-numbers language-none"><code class="language-none">&quot;;s:8:&quot;password&quot;;s:3:&quot;123&quot;;s:3:&quot;vip&quot;;i:1;&#125;  
&#x2F;&#x2F;长度42<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p>
<p>计算到<strong>下一个可控变量</strong>（这里是password）的字符串（称为缩进串）长度： ^184190 <pre class="line-numbers language-none"><code class="language-none">&quot;;s:8:&quot;password&quot;;s:3:&quot;
&#x2F;&#x2F; 长度为22<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p>
<p>因为每次过滤都会减少一个字符，因此减少22个字符就能将上面的缩进串缩进username属性里面 （注意，这里演示所以每次就减少一个字符串，可能一次减少3个字符串，此时需要8个，也就是缩短了24个字符，我们输入的时候多输入2个字符，让其缩进到前一个属性即可） ^8660cb</p>
<pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php
class User
&#123;
    public $username;
    public $password;
    public $vip;
    public function __construct($uname, $passwd)&#123;
        $this-&gt;username &#x3D; $uname;
        $this-&gt;password &#x3D; $passwd;
        $this-&gt;vip &#x3D; 0;
    &#125;
&#125;

function filter($str)&#123;
    return str_replace(&quot;admin&quot;, &quot;hack&quot;, $str);
&#125;

$a &#x3D; new User(&quot;adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin&quot;, &quot;111&quot;);
$a_ser &#x3D; serialize($a);
echo filter($a_ser);
?&gt;

结果如下：
O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:110:&quot;hackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhack&quot;;s:8:&quot;password&quot;;s:3:&quot;111&quot;;s:3:&quot;vip&quot;;i:0;&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>注意</strong>：PHP反序列化的机制是，比如如果前面是规定了有10个字符，但是只读到了9个就到了双引号，这个时候PHP会把双引号当做第10个字符，也就是说不根据双引号判断一个字符串是否已经结束，而是根据前面规定的数量来读取字符串。<strong>所以需要闭合！闭合！闭合！</strong></p>
<p>分析：这里s指定的长度是110，而从第一个双引号开始的105个字符为：<code>hackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhack";s:8:"password";s:3:"</code>，这字符串会被当作username属性值。</p>
<p><strong>重点</strong>：所以<code>111</code>就成为了可控变量，也就是我们输入的password变为了可控变量。将111替换为我们的目标字串即可，代码如下：</p>
<pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php
class User
&#123;
    public $username;
    public $password;
    public $vip;
    public function __construct($uname, $passwd)&#123;
        $this-&gt;username &#x3D; $uname;
        $this-&gt;password &#x3D; $passwd;
        $this-&gt;vip &#x3D; 0;
    &#125;
&#125;

function filter($str)&#123;
    return str_replace(&quot;admin&quot;, &quot;hack&quot;, $str);
&#125;

$a &#x3D; new User(&#39;adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin&#39;, &#39;&quot;;s:8:&quot;password&quot;;s:3:&quot;123&quot;;s:3:&quot;vip&quot;;i:1;&#125;&#39;);
$a_ser &#x3D; serialize($a);
echo filter($a_ser);
&#x2F;&#x2F;var_dump(unserialize(filter($a_ser)));
?&gt;

结果为：
O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:110:&quot;hackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhack&quot;;s:8:&quot;password&quot;;s:42:&quot;&quot;;s:8:&quot;password&quot;;s:3:&quot;123&quot;;s:3:&quot;vip&quot;;i:1;&#125;&quot;;s:3:&quot;vip&quot;;i:0;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>会发现报错了，其实这里有一个细节：</p>
<p><strong>细节</strong>：替换之前我们的输入的密码为111，只有3位数，因此我们缩进串的长度只有22，而替换为目标子串后，“password”的长度为42，此时的缩进串长度为23，所以我们需要有23个admin。最终代码如下：</p>
<pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php
class User
&#123;
    public $username;
    public $password;
    public $vip;
    public function __construct($uname, $passwd)&#123;
        $this-&gt;username &#x3D; $uname;
        $this-&gt;password &#x3D; $passwd;
        $this-&gt;vip &#x3D; 0;
    &#125;
&#125;

function filter($str)&#123;
    return str_replace(&quot;admin&quot;, &quot;hack&quot;, $str);
&#125;
$a &#x3D; new User(&quot;adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin&quot;, &#39;&quot;;s:8:&quot;password&quot;;s:3:&quot;123&quot;;s:3:&quot;vip&quot;;i:1;&#125;&#39;);
$a_ser &#x3D; serialize($a); 
var_dump(unserialize(filter($a_ser)));
?&gt;

结果为：
object(User)#2 (3) &#123;
  [&quot;username&quot;]&#x3D;&gt;
  string(115) &quot;hackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhack&quot;;s:8:&quot;password&quot;;s:42:&quot;&quot;
  [&quot;password&quot;]&#x3D;&gt;
  string(3) &quot;123&quot;
  [&quot;vip&quot;]&#x3D;&gt;
  int(1)
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="总结">5.3 总结</h2>
<p>两种情况是不一样的，前者是把目标子串写在第一个变量，然后让第一个变量变长，挤走原先的第二个变量，让目标子串占据第二变量的位置从而被反序列化。而后者是把目标子串写在第二变量，然后让第一变量长度变短，将[[#^184190|缩进串]]缩进到第一变量里面，然后把目标子串占据第二变量的位置从而被反序列化。</p>
<p>两者都要注意：<strong>闭合</strong>；</p>
<p>后者还需要注意</p>
<ol type="1">
<li>缩进串长度的变化</li>
<li>不能够正好将缩进串缩到前一个变量的情况</li>
</ol>
<p>bugku_newphp运用到了这个知识点。</p>
<h1 id="属性中含有数组该如何反序列化">6 属性中含有数组该如何反序列化</h1>
<p>编写如下测试代码： <pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Test1</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">public</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">Array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Test2</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">public</span> <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'hello world'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$test1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>
<span class="token variable">$test2</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$test1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span>
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$test2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>结果为： <pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Test1"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"a"</span><span class="token punctuation">;</span>a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"hello world"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>  
<span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Test2"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"b"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"hello world"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p>
<p>因此，如果需要在序列化中提交数组，需要注意这一点，不仅需要闭合双引号，还要把<code>&#123;&#125;</code>也给闭合了。</p>
<p>例题：<a href="0CTF%202016%20piapiapia.md">0CTF 2016 piapiapia</a></p>
<h1 id="序列化后的属性顺序">7 序列化后的属性顺序</h1>
<p>编写代码测试： <pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">profile</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$phone</span><span class="token operator">=</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$email</span><span class="token operator">=</span><span class="token string single-quoted-string">'2'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$nickname</span><span class="token operator">=</span><span class="token string single-quoted-string">'3'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$photo</span><span class="token operator">=</span><span class="token string single-quoted-string">'4'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">profile</span><span class="token punctuation">;</span>
<span class="token variable">$p</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>结果为： <pre class="line-numbers language-none"><code class="language-none">O:7:&quot;profile&quot;:4:&#123;s:5:&quot;phone&quot;;s:1:&quot;1&quot;;s:5:&quot;email&quot;;s:1:&quot;2&quot;;s:8:&quot;nickname&quot;;s:1:&quot;3&quot;;s:5:&quot;photo&quot;;s:1:&quot;4&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<p>如果将属性颠倒一下，其余不变 <pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token variable">$photo</span><span class="token operator">=</span><span class="token string single-quoted-string">'4'</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token variable">$nickname</span><span class="token operator">=</span><span class="token string single-quoted-string">'3'</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token variable">$email</span><span class="token operator">=</span><span class="token string single-quoted-string">'2'</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token variable">$phone</span><span class="token operator">=</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>得到的结果如下： <pre class="line-numbers language-none"><code class="language-none">O:7:&quot;profile&quot;:4:&#123;s:5:&quot;photo&quot;;s:1:&quot;4&quot;;s:8:&quot;nickname&quot;;s:1:&quot;3&quot;;s:5:&quot;email&quot;;s:1:&quot;2&quot;;s:5:&quot;phone&quot;;s:1:&quot;1&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<p><strong>结论</strong>：从以上实验可以看出，编写类的时候属性的先后顺序就是序列化后字符串中属性的先后顺序。</p>
<p>例题：<a href="0CTF%202016%20piapiapia.md">0CTF 2016 piapiapia</a></p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>加载评论需要在浏览器启用 JavaScript 脚本支持。</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%A6%82%E5%BF%B5%E7%89%B9%E7%82%B9"><span class="toc-number">1.</span> <span class="toc-text">1 反序列化概念、特点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 反序列化概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%89%B9%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 反序列化特点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">2 常见的魔术方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sleep"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 __sleep()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wakeup"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 __wakeup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tostring"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 __toString</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#invoke"><span class="toc-number">2.4.</span> <span class="toc-text">2.4__invoke</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#construct"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 __construct()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#destruct"><span class="toc-number">2.6.</span> <span class="toc-text">2.6 __destruct()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#set"><span class="toc-number">2.7.</span> <span class="toc-text">2.7 __set()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#get"><span class="toc-number">2.8.</span> <span class="toc-text">2.8 __get()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#isset"><span class="toc-number">2.9.</span> <span class="toc-text">2.9 __isset()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#unset"><span class="toc-number">2.10.</span> <span class="toc-text">2.10 __unset()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#callstatic"><span class="toc-number">2.11.</span> <span class="toc-text">2.10 __callStatic()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#call"><span class="toc-number">2.12.</span> <span class="toc-text">2.11 __call()</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-number">3.</span> <span class="toc-text">3 访问控制修饰符</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%95%E8%BF%87-__wakeup-%E5%87%BD%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">4 绕过 __wakeup() 函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8"><span class="toc-number">5.</span> <span class="toc-text">5 字符串逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%90%8E%E5%AD%97%E7%AC%A6%E5%8F%98%E5%A4%9A"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 过滤后字符变多</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%90%8E%E5%AD%97%E7%AC%A6%E5%8F%98%E5%B0%91"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 过滤后字符变少</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E4%B8%AD%E5%90%AB%E6%9C%89%E6%95%B0%E7%BB%84%E8%AF%A5%E5%A6%82%E4%BD%95%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">6.</span> <span class="toc-text">6 属性中含有数组该如何反序列化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%90%8E%E7%9A%84%E5%B1%9E%E6%80%A7%E9%A1%BA%E5%BA%8F"><span class="toc-number">7.</span> <span class="toc-text">7 序列化后的属性顺序</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&text=反序列化知识点"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&title=反序列化知识点"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&is_video=false&description=反序列化知识点"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=反序列化知识点&body=Check out this article: https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&title=反序列化知识点"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&title=反序列化知识点"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&title=反序列化知识点"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&title=反序列化知识点"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&name=反序列化知识点&description=&lt;p&gt;个人总结的知识点，持续更新。&lt;/p&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://hdfzzf.github.io/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/&t=反序列化知识点"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2022
    hdfzzf
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'cactus-1';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
